{"version":3,"sources":["webpack:///webpack/bootstrap","webpack:///./content-src/activity-stream.jsx","webpack:///(webpack)/buildin/global.js","webpack:///./common/Actions.jsm","webpack:///./content-src/lib/snippets.js","webpack:///./content-src/asrouter/asrouter-content.jsx","webpack:///external \"ReactIntl\"","webpack:///./content-src/lib/init-store.js","webpack:///external \"Redux\"","webpack:///./content-src/asrouter/rich-text-strings.js","webpack:///./content-src/asrouter/components/ImpressionsWrapper/ImpressionsWrapper.jsx","webpack:///external \"React\"","webpack:///external \"PropTypes\"","webpack:///./content-src/asrouter/templates/OnboardingMessage/OnboardingMessage.jsx","webpack:///./content-src/asrouter/components/ModalOverlay/ModalOverlay.jsx","webpack:///external \"ReactDOM\"","webpack:///./content-src/asrouter/templates/StartupOverlay/StartupOverlay.jsx","webpack:///external \"ReactRedux\"","webpack:///./content-src/components/Base/Base.jsx","webpack:///./content-src/components/ASRouterAdmin/ASRouterAdmin.jsx","webpack:///./content-src/components/ConfirmDialog/ConfirmDialog.jsx","webpack:///./content-src/components/ErrorBoundary/ErrorBoundary.jsx","webpack:///./content-src/components/ManualMigration/ManualMigration.jsx","webpack:///./common/PrerenderData.jsm","webpack:///./content-src/components/Search/Search.jsx","webpack:///./content-src/lib/constants.js","webpack:///./content-src/components/Sections/Sections.jsx","webpack:///./content-src/lib/link-menu-options.js","webpack:///./content-src/components/LinkMenu/LinkMenu.jsx","webpack:///./content-src/components/ContextMenu/ContextMenu.jsx","webpack:///./content-src/lib/screenshot-utils.js","webpack:///./content-src/components/CollapsibleSection/CollapsibleSection.jsx","webpack:///./content-src/components/SectionMenu/SectionMenu.jsx","webpack:///./content-src/lib/section-menu-options.js","webpack:///./content-src/components/ComponentPerfTimer/ComponentPerfTimer.jsx","webpack:///./common/PerfService.jsm","webpack:///./content-src/components/MoreRecommendations/MoreRecommendations.jsx","webpack:///./content-src/components/PocketLoggedInCta/PocketLoggedInCta.jsx","webpack:///./content-src/components/Topics/Topics.jsx","webpack:///./content-src/components/TopSites/TopSites.jsx","webpack:///./content-src/components/TopSites/TopSitesConstants.js","webpack:///./content-src/components/TopSites/SearchShortcutsForm.jsx","webpack:///./content-src/components/TopSites/TopSite.jsx","webpack:///./content-src/lib/detect-user-session-start.js","webpack:///./content-src/lib/asroutercontent.js","webpack:///./content-src/asrouter/components/Button/Button.jsx","webpack:///./content-src/asrouter/template-utils.js","webpack:///./content-src/asrouter/components/RichText/RichText.jsx","webpack:///./content-src/asrouter/components/SnippetBase/SnippetBase.jsx","webpack:///./content-src/asrouter/templates/SimpleSnippet/SimpleSnippet.jsx","webpack:///./content-src/asrouter/templates/EOYSnippet/EOYSnippet.jsx","webpack:///./content-src/asrouter/templates/SubmitFormSnippet/SubmitFormSnippet.jsx","webpack:///./content-src/asrouter/templates/FXASignupSnippet/FXASignupSnippet.jsx","webpack:///./content-src/asrouter/templates/NewsletterSnippet/NewsletterSnippet.jsx","webpack:///./content-src/asrouter/templates/SendToDeviceSnippet/isEmailOrPhoneNumber.js","webpack:///./content-src/asrouter/templates/SendToDeviceSnippet/SendToDeviceSnippet.jsx","webpack:///./content-src/asrouter/templates/template-manifest.jsx","webpack:///./node_modules/fluent/src/parser.js","webpack:///./node_modules/fluent/src/types.js","webpack:///./node_modules/fluent/src/builtins.js","webpack:///./node_modules/fluent/src/resolver.js","webpack:///./node_modules/fluent/src/context.js","webpack:///./node_modules/fluent/src/cached_iterable.js","webpack:///./node_modules/fluent/src/fallback.js","webpack:///./node_modules/fluent/src/util.js","webpack:///./node_modules/fluent/src/index.js","webpack:///./node_modules/fluent-react/src/localization.js","webpack:///./node_modules/fluent-react/src/provider.js","webpack:///./node_modules/fluent-react/src/with_localization.js","webpack:///./node_modules/fluent-react/src/markup.js","webpack:///./node_modules/fluent-react/vendor/omittedCloseTags.js","webpack:///./node_modules/fluent-react/vendor/voidElementTags.js","webpack:///./node_modules/fluent-react/src/localized.js","webpack:///./node_modules/fluent-react/src/index.js","webpack:///./common/Dedupe.jsm","webpack:///./common/Reducers.jsm","webpack:///./content-src/components/Card/types.js","webpack:///./content-src/components/Card/Card.jsx","webpack:///./content-src/components/TopSites/TopSiteFormInput.jsx","webpack:///./content-src/components/TopSites/TopSiteForm.jsx"],"names":["store","initStore","reducers","global","gActivityStreamPrerenderedState","asrouterContent","ASRouterContent","DetectUserSessionStart","sendEventOrAddListener","dispatch","ac","AlsoToMain","type","at","NEW_TAB_STATE_REQUEST","enableASRouterContent","ReactDOM","hydrate","document","documentElement","lang","gActivityStreamStrings","getElementById","addSnippetsSubscriber","globalImportContext","Window","BACKGROUND_PROCESS","UI_CODE","actionTypes","ASRouterActions","_RouteMessage","action","options","meta","from","to","Error","forEach","o","fromTarget","skipLocal","CONTENT_MESSAGE_TYPE","MAIN_MESSAGE_TYPE","OnlyToMain","BroadcastToContent","AlsoToOneContent","target","skipMain","toTarget","OnlyToOneContent","AlsoToPreloaded","PRELOAD_MESSAGE_TYPE","UserEvent","data","TELEMETRY_USER_EVENT","ASRouterUserEvent","AS_ROUTER_TELEMETRY_USER_EVENT","UndesiredEvent","importContext","TELEMETRY_UNDESIRED_EVENT","PerfEvent","TELEMETRY_PERFORMANCE_EVENT","ImpressionStats","TELEMETRY_IMPRESSION_STATS","SetPref","name","value","SET_PREF","WebExtEvent","source","isSendToMain","isBroadcastToContent","isSendToOneContent","isSendToPreloaded","isFromMain","getPortIdOfSender","DATABASE_NAME","DATABASE_VERSION","SNIPPETS_OBJECTSTORE_NAME","SNIPPETS_UPDATE_INTERVAL_MS","SNIPPETS_ENABLED_EVENT","SNIPPETS_DISABLED_EVENT","SnippetsMap","Map","constructor","_db","_dispatch","set","key","_dbTransaction","db","put","delete","clear","SNIPPETS_BLOCKLIST_CLEARED","blockList","get","blockSnippetById","id","includes","push","SNIPPETS_BLOCKLIST_UPDATED","disableOnboarding","showFirefoxAccounts","SHOW_FIREFOX_ACCOUNTS","getTotalBookmarksCount","Promise","resolve","TOTAL_BOOKMARKS_REQUEST","RPMAddMessageListener","onMessage","TOTAL_BOOKMARKS_RESPONSE","RPMRemoveMessageListener","getAddonsInfo","ADDONS_INFO_REQUEST","ADDONS_INFO_RESPONSE","connect","_openDB","_restoreFromDb","modifier","reject","transaction","objectStore","onsuccess","event","onerror","error","openRequest","indexedDB","open","deleteDatabase","onupgradeneeded","result","objectStoreNames","contains","createObjectStore","err","console","onversionchange","versionChangeEvent","close","cursorRequest","openCursor","cursor","continue","SnippetsProvider","gSnippetsMap","_onAction","bind","snippetsMap","_refreshSnippets","cachedVersion","appData","version","lastUpdate","needsUpdate","Date","now","snippetsURL","response","fetch","status","payload","text","e","_showRemoteSnippets","snippetsEl","elementId","innerHTML","_logIfDevtools","scriptEl","getElementsByTagName","relocatedScript","createElement","parentNode","replaceChild","msg","SNIPPET_BLOCKED","concat","style","display","devtoolsEnabled","log","init","Object","assign","keys","window","dispatchEvent","Event","initialized","uninit","snippets","initializing","subscribe","state","getState","Prefs","values","ASRouter","allowLegacySnippets","disableSnippets","Snippets","location","href","hash","INCOMING_MESSAGE_NAME","OUTGOING_MESSAGE_NAME","ASR_CONTAINER_ID","ASRouterUtils","addListener","listener","removeListener","sendMessage","RPMSendAsyncMessage","blockById","dismissById","blockBundle","bundle","executeAction","button_action","unblockById","unblockBundle","overrideMessage","sendTelemetry","ping","AS_GENERAL_OUTGOING_MESSAGE_NAME","getPreviewEndpoint","params","URLSearchParams","slice","indexOf","endpoint","URL","url","snippetId","shouldSendImpressionOnUpdate","nextProps","prevProps","message","ASRouterUISurface","React","PureComponent","props","onMessageFromParent","sendClick","sendImpression","sendUserActionTelemetry","extraProps","message_id","eventType","provider","metric","dataset","args","content","do_not_autoblock","onBlockById","onDismissById","clearBundle","setState","componentWillMount","addLocaleData","trigger","componentDidMount","componentWillUnmount","renderSnippets","template","SnippetComponent","SnippetsTemplates","generateMessages","renderOnboarding","renderFirstRunOverlay","body","classList","add","activityStreamStore","renderPreviewBanner","render","defaultProps","containerElement","_mount","zIndex","appendChild","_activityStreamStore","_unmount","unmountComponentAtNode","MERGE_STORE_ACTION","EARLY_QUEUED_ACTIONS","SAVE_SESSION_PERF_DATA","PAGE_PRERENDERED","mergeStateReducer","mainReducer","prevState","messageMiddleware","next","au","rehydrationMiddleware","_didRehydrate","isMergeStoreAction","isRehydrationRequest","_didRequestInitialState","INIT","queueEarlyMessageMiddleware","_receivedFromMain","_earlyActionQueue","initialState","createStore","combineReducers","applyMiddleware","ex","dump","JSON","stringify","stack","RICH_TEXT_CONFIG","RICH_TEXT_KEYS","cx","MessageContext","attrs","attrsToTry","Array","isArray","string","length","attr","pop","addMessages","VISIBLE","VISIBILITY_CHANGE_EVENT","ImpressionsWrapper","sendImpressionOrAddListener","visibilityState","_onVisibilityChange","removeEventListener","addEventListener","sendOnMount","componentDidUpdate","children","OnboardingCard","onClick","UISurface","onAction","icon","title","button_label","OnboardingMessage","header","extraTemplateStrings","map","ModalOverlay","active","remove","onDoneButton","_StartupOverlay","onInputChange","onSubmit","clickSkip","initScene","removeOverlay","onInputInvalid","emailInput","overlayRemoved","flowId","flowBeginTime","didFetch","componentWillUpdate","fxa_endpoint","fxaParams","json","setTimeout","show","onBlock","previousSibling","_getFormInfo","has_flow_params","preventDefault","focus","termsLink","privacyLink","intl","formatMessage","terms","privacy","StartupOverlay","injectIntl","PrefsButton","addLocaleDataForReactIntl","locale","parentLocale","debounce","func","wait","timer","wakeUp","apply","_Base","isPrerendered","updateTheme","bodyClassName","filter","v","join","className","App","strings","prefs","BaseContent","openPreferences","onWindowScroll","fixedSearch","SCROLL_THRESHOLD","scrollY","SETTINGS_OPEN","shouldBeFixedToTop","PrerenderData","arePrefsValid","noSectionsEnabled","Sections","section","enabled","outerClassName","showSearch","migrationExpired","Base","ASRouterAdmin","handleEnabledToggle","handleUserPrefToggle","onChangeMessageFilter","findOtherBundledMessagesOfSameTemplate","handleExpressionEval","onChangeTargetingParameters","onCopyTargetingParams","onPasteTargetingParams","onNewTargetingParams","messageFilter","evaluationStatus","stringTargetingParameters","newStringTargetingParameters","copiedToClipboard","pasteFromClipboard","param","targetingParameters","messages","bundled","handleBlock","handleUnblock","handleOverride","expireCache","resetPref","context","parse","expression","refs","expressionInput","targetingParametersError","updatedParameters","providerPrefs","find","p","userPrefInfo","userPrefs","isUserEnabled","isSystemEnabled","isEnabling","checked","undefined","setClipboardData","clipboardData","setData","execCommand","targetingParamsEval","innerText","renderMessageItem","isCurrent","lastMessageId","isBlocked","messageBlockList","campaign","impressions","messageImpressions","itemClassName","renderMessages","messagesToShow","renderMessageFilter","providers","renderTableHead","renderProviders","providersConfig","providerInfo","i","isTestProvider","info","label","bucket","reasonsDisabled","cohort","whiteSpace","lastUpdated","toLocaleString","renderPasteModal","errors","renderTargetingParameters","success","errorState","inputComp","_ConfirmDialog","_handleCancelBtn","_handleConfirmBtn","DIALOG_CANCEL","eventSource","onConfirm","_renderModalMessage","message_body","body_string_id","visible","cancel_button_string_id","confirm_button_string_id","ConfirmDialog","Dialog","ErrorBoundaryFallback","windowObj","reload","defaultClass","ErrorBoundary","hasError","componentDidCatch","FallbackComponent","_ManualMigration","onLaunchTour","onCancelTour","MIGRATION_START","MIGRATION_CANCEL","ManualMigration","_PrerenderData","initialPrefs","initialSections","_setValidation","validation","_validation","invalidatingPrefs","_invalidatingPrefs","reduce","oneOf","getPref","indexedDBPrefs","some","anyModifiedPrefs","prefName","pref","order","_Search","onInputMount","handleEvent","detail","gContentSearchController","search","input","healthReportKey","IS_NEWTAB","searchSource","ContentSearchUIController","showLogo","Search","documentURI","CARDS_PER_ROW_DEFAULT","CARDS_PER_ROW_COMPACT_WIDE","getFormattedMessage","Section","numRows","rowsPref","maxRows","_dispatchImpressionStats","cardsPerRow","compactCards","matchMedia","matches","maxCards","cards","rows","needsImpressionStats","tiles","link","guid","impressionCardGuids","sendImpressionStatsOrAddListener","shouldSendImpressionStats","collapsed","sendNewTabRehydrated","isCollapsed","wasCollapsed","renderNotified","NEW_TAB_REHYDRATED","Pocket","topics","emptyState","read_more_endpoint","contextMenuOptions","learnMore","privacyNoticeURL","isFirst","isLast","waitingForSpoc","maxCardsPerRow","maxCardsOnNarrow","pocketCta","isUserLoggedIn","useCta","isPocketLoggedInDefined","hasTopics","shouldShowPocketCta","shouldShowTopics","shouldShowReadMore","realRows","shouldShowEmptyState","usePlaceholder","isWebExtension","sectionClassName","feed","padding","startsWith","SectionIntl","_Sections","renderSections","sections","enabledSections","sectionOrder","showTopSites","expectedCount","sectionId","split","commonProps","s","_OpenInPrivateWindow","site","OPEN_PRIVATE_WINDOW","referrer","userEvent","GetPlatformString","platform","LinkMenuOptions","Separator","EmptyItem","RemoveBookmark","DELETE_BOOKMARK_BY_ID","bookmarkGuid","AddBookmark","BOOKMARK_URL","OpenInNewWindow","OPEN_NEW_WINDOW","typedBonus","BlockUrl","index","BLOCK_URL","open_url","pocket_id","impression","block","pos","WebExtDismiss","string_id","WEBEXT_DISMISS","action_position","DeleteUrl","isEnabled","siteInfo","DIALOG_OPEN","DELETE_HISTORY_URL","forceBlock","ShowFile","SHOW_DOWNLOAD_FILE","OpenFile","OPEN_DOWNLOAD_FILE","CopyDownloadLink","COPY_DOWNLOAD_LINK","GoToDownloadPage","OPEN_LINK","disabled","RemoveDownload","REMOVE_DOWNLOAD_FILE","PinTopSite","searchTopSite","TOP_SITES_PIN","UnpinTopSite","TOP_SITES_UNPIN","SaveToPocket","SAVE_TO_POCKET","pocket","DeleteFromPocket","DELETE_FROM_POCKET","ArchiveFromPocket","ARCHIVE_FROM_POCKET","EditTopSite","TOP_SITES_EDIT","CheckBookmark","CheckPinTopSite","isPinned","CheckSavedToPocket","CheckBookmarkOrArchive","OpenInPrivateWindow","DEFAULT_SITE_MENU_OPTIONS","_LinkMenu","getOptions","isPrivateBrowsingEnabled","propOptions","isDefault","option","userEventData","first","last","onUpdate","LinkMenu","ContextMenu","hideContext","stopPropagation","ContextMenuItem","onKeyDown","shiftKey","ScreenshotUtils","isBlob","isLocal","image","path","createLocalImageObject","remoteImage","createObjectURL","maybeRevokeBlobObjectURL","localImage","revokeObjectURL","isRemoteImageLocal","_CollapsibleSection","onBodyMount","onHeaderClick","onTransitionEnd","enableOrDisableAnimation","onMenuButtonClick","onMenuButtonMouseEnter","onMenuButtonMouseLeave","onMenuUpdate","enableAnimation","isAnimating","menuButtonHover","showContextMenu","sectionBody","scrollHeight","node","maxHeight","_getSectionBodyHeight","SectionMenuOptions","CheckCollapsed","div","currentTarget","renderIcon","backgroundImage","isCollapsible","extraMenuOptions","showPrefName","bodyStyle","CollapsibleSection","DEFAULT_SECTION_MENU_OPTIONS","WEBEXT_SECTION_MENU_OPTIONS","_SectionMenu","extraOptions","splice","SectionMenu","MoveUp","SECTION_MOVE","direction","MoveDown","RemoveSection","CollapseSection","UPDATE_SECTION_PREFS","ExpandSection","ManageSection","ManageWebExtension","OPEN_WEBEXT_SETTINGS","AddTopSite","AddSearchShortcut","TOP_SITES_OPEN_SEARCH_SHORTCUTS_MODAL","PrivacyNotice","RECORDED_SECTIONS","ComponentPerfTimer","Component","perfSvc","_sendBadStateEvent","_sendPaintedEvent","_reportMissingData","_timestampHandled","_recordedFirstRender","_maybeSendPaintedEvent","_afterFramePaint","callback","requestAnimationFrame","_maybeSendBadStateEvent","_ensureFirstRenderTsRecorded","mark","dataReadyKey","firstRenderKey","parseInt","getMostRecentAbsMarkStartByName","ChromeUtils","import","usablePerfObj","Services","appShell","hiddenDOMWindow","performance","_PerfService","performanceObj","_perf","prototype","str","getEntriesByName","timeOrigin","absNow","entries","mostRecentEntry","startTime","MoreRecommendations","_PocketLoggedInCta","ctaUrl","ctaButton","ctaText","PocketLoggedInCta","Topic","Topics","t","topSiteIconType","customScreenshotURL","tippyTopIcon","faviconRef","faviconSize","MIN_RICH_FAVICON_SIZE","screenshot","MIN_CORNER_FAVICON_SIZE","countTopSitesIconsTypes","topSites","countTopSitesTypes","acc","_TopSites","onEditFormClose","onSearchShortcutsFormClose","_dispatchTopSitesStats","_getVisibleTopSites","topSitesIconsStats","topSitesPinned","searchShortcuts","topsites_icon_stats","topsites_pinned","topsites_search_shortcuts","sitesPerRow","TOP_SITES_MAX_SITES_PER_ROW","TopSites","TopSitesRows","TOP_SITES_SOURCE","TOP_SITES_CANCEL_EDIT","TOP_SITES_CLOSE_SEARCH_SHORTCUTS_MODAL","editForm","showSearchShortcutsForm","topSitesRows","TOP_SITES_CONTEXT_MENU_OPTIONS","TOP_SITES_SEARCH_SHORTCUTS_CONTEXT_MENU_OPTIONS","SelectableSearchShortcut","shortcut","selected","imageStyle","keyword","onChange","SearchShortcutsForm","handleChange","onCancelButtonClick","onSaveButtonClick","shortcuts","isSelected","row","ev","onClose","pinQueue","unpinQueue","alreadyPinned","_searchTopSite","searchVendor","shortURL","UPDATE_PINNED_SEARCH_SHORTCUTS","addedShortcuts","deletedShortcuts","search_vendor","TopSiteLink","screenshotImage","onDragEvent","onKeyPress","_allowDrop","dataTransfer","types","dragged","effectAllowed","blur","button","getNextStateFromProps","imageInState","nextState","componentWillReceiveProps","defaultStyle","isDraggable","topSiteOuterClassName","isDragged","letterFallback","imageClassName","showSmallFavicon","smallFaviconStyle","smallFaviconFallback","hasScreenshotImage","backgroundColor","favicon","draggableProps","onDragEnd","onDragStart","onMouseDown","TopSite","onLinkClick","_getTelemetryInfo","icon_type","iconType","card_type","hostname","altKey","ctrlKey","metaKey","FILL_SEARCH_TERM","onActivate","isContextMenuOpen","activeIndex","TopSitePlaceholder","onEditButtonClick","_TopSiteList","DEFAULT_STATE","draggedIndex","draggedSite","draggedTitle","topSitesPreview","prevTopSites","newTopSites","dropped","_makeTopSitesPreview","TOP_SITES_INSERT","draggedFromIndex","_getTopSites","pinnedOnly","unpinned","siteToInsert","holeIndex","indexStep","shiftingStep","nextIndex","preview","shift","topSitesUI","maxNarrowVisibleIndex","l","slotProps","TopSiteList","_store","_perfService","perfService","_sendEvent","visibility_event_rcvd_ts","ALLOWED_STYLE_TAGS","Button","tag","border","safeURI","protocol","isAllowed","warn","ALLOWED_TAGS","b","u","strong","em","br","convertLinks","links","doNotAutoBlock","openNewWindow","linkTag","RichText","localization_id","customElements","SnippetBase","onBlockClicked","renderDismissButton","footerDismiss","onDismiss","scene2_dismiss_button_text","defaultTitle","schema","properties","block_button_text","default","containerClassName","textStyle","DEFAULT_ICON_PATH","SimpleSnippet","onButtonClick","button_url","button_action_args","_shouldRenderButton","renderTitle","renderTitleIcon","titleIcon","title_icon","renderButton","button_color","button_background_color","renderText","tall","extraContent","EOYSnippetBase","handleSubmit","setFrequencyValue","frequencyCheckbox","form","querySelector","submit","renderDonations","fieldNames","numberFormat","Intl","NumberFormat","navigator","language","currency","currency_code","minimumFractionDigits","selected_button","btnStyle","color","donation_form_url","form_method","field","idx","button_name","amount","format","monthly_checkbox_label_text","text_color","background_color","customElement","highlight_color","test","EOYSnippet","extendedContent","SubmitFormSnippet","expandSnippet","handleSubmitAttempt","expanded","submitAttempted","signupSubmitted","signupSuccess","disableForm","toUpperCase","formData","processFormData","mainInput","FormData","fetchRequest","Request","method","preventDismiss","renderHiddenFormInputs","hidden_inputs","renderDisclaimer","scene2_disclaimer_html","renderFormPrivacyNotice","scene2_privacy_html","renderSignupSubmitted","isSuccess","successTitle","success_title","bodyText","success_text","error_text","retryButtonText","scene1_button_label","validateInput","setCustomValidity","renderInput","placholder","scene2_email_placeholder_text","scene2_input_placeholder","inputType","renderSignupView","containerClass","scene2_icon","scene2_title","scene2_text","form_action","scene2_button_label","getFirstSceneContent","substr","FXASignupSnippet","userAgent","match","firefox_version","entrypoint","service","utm_source","utm_content","utm_campaign","utm_term","NewsletterSnippet","newsletters","scene2_newsletter","fmt","source_url","isEmailOrPhoneNumber","val","email_re","check_email","check_phone","isNaN","include_sms","append","message_id_sms","country","message_id_email","encodeURIComponent","addDefaultValues","SendToDeviceSnippet","propsWithDefaults","simple_snippet","newsletter_snippet","fxa_signup_snippet","send_to_device_snippet","eoy_snippet","MAX_PLACEABLES","entryIdentifierRe","identifierRe","functionIdentifierRe","RuntimeParser","getResource","_source","_index","_length","skipWS","getEntry","SyntaxError","skipToNextEntryStart","ch","skipComment","skipSection","getMessage","skipInlineWS","getVariantName","getEntryIdentifier","getPattern","lineStart","getAttributes","skipBlankLines","ptr","getIdentifier","re","lastIndex","exec","toString","start","cc","charCodeAt","getString","substring","eol","firstLineContent","getComplexPattern","buffer","placeables","blankLinesStart","blankLinesEnd","ch2","getPlaceable","variants","getVariants","exp","vars","def","selector","getSelectorExpression","literal","getLiteral","getVariantKey","getCallArgs","fun","lastIndexOf","getNumber","num","defaultIndex","cc0","cc1","parser","FluentType","opts","valueOf","FluentNone","FluentNumber","parseFloat","ctx","nf","_memoizeIntlObject","other","FluentDateTime","dtf","DateTimeFormat","FluentSymbol","pr","PluralRules","select","arg","merge","argopts","unwrapped","opt","MAX_PLACEABLE_LENGTH","FSI","PDI","DefaultMember","env","members","RangeError","MessageReference","_terms","_messages","ReferenceError","VariantExpression","Type","isVariantList","variant","variantKey","AttributeExpression","attrName","SelectExpression","keyCanMatch","expr","Pattern","ExternalArgument","FunctionReference","CallExpression","member","hasOwnProperty","TypeError","_functions","builtins","callee","posargs","keyargs","ptn","dirty","has","useIsolating","_useIsolating","elem","part","WeakSet","locales","functions","_intls","WeakMap","Symbol","iterator","hasMessage","ctor","cache","CachedIterable","iterable","asyncIterator","seen","cur","touchNext","done","mapContextSync","ids","getContextForId","remainingCount","foundContexts","fill","mapContextAsync","nonBlank","line","countIndent","indent","ftl","code","lines","indents","common","Math","min","RegExp","replace","ReactLocalization","contexts","subs","Set","comp","unsubscribe","setMessages","relocalize","getMessageContext","formatCompound","mcx","fallback","isReactLocalization","propName","prop","LocalizationProvider","l10n","getChildContext","Children","only","childContextTypes","propTypes","PropTypes","element","isRequired","isIterable","componentName","withLocalization","Inner","WithLocalization","forceUpdate","displayName","contextTypes","component","TEMPLATE","parseMarkup","omittedCloseTags","area","base","col","embed","hr","img","keygen","track","wbr","voidElementTags","menuitem","reMarkup","toArguments","elems","propname","propval","isValidElement","toLowerCase","Localized","messageValue","messageAttrs","localizedProps","VOID_ELEMENTS","cloneElement","translationNodes","childNodes","translatedChildren","childNode","nodeType","TEXT_NODE","textContent","localName","sourceChild","Dedupe","createKey","defaultCreateKey","item","group","groups","globalKeys","valueMap","m","TOP_SITES_DEFAULT_ROWS","dedupe","INITIAL_STATE","AS_ROUTER_INITIALIZED","AS_ROUTER_PREF_CHANGED","insertPinned","pinned","pinnedUrls","newLinks","pinIndex","hasMatch","newRows","TOP_SITES_UPDATED","TOP_SITES_PREFS_UPDATED","previewResponse","PREVIEW_RESPONSE","previewUrl","PREVIEW_REQUEST","PREVIEW_REQUEST_CANCEL","SCREENSHOT_UPDATED","PLACES_BOOKMARK_ADDED","bookmarkTitle","dateAdded","bookmarkDateCreated","PLACES_BOOKMARK_REMOVED","newSite","PLACES_LINK_DELETED","UPDATE_SEARCH_SHORTCUTS","SNIPPETS_PREVIEW_MODE","newValues","PREFS_INITIAL_VALUES","PREF_CHANGED","newState","SECTION_DEREGISTER","SECTION_REGISTER","SECTION_UPDATE","card","dedupeConfigurations","dedupeConf","dedupedRows","dedupeFrom","dedupeSectionId","dedupeSection","SECTION_UPDATE_CARD","PLACES_SAVED_TO_POCKET","PLACES_LINK_BLOCKED","SNIPPETS_DATA","SNIPPETS_RESET","POCKET_WAITING_FOR_SPOC","POCKET_LOGGED_IN","POCKET_CTA","cta_button","cta_text","cta_url","use_cta","cardContextTypes","history","intlID","bookmark","trending","download","gImageLoading","_Card","activeCard","imageLoaded","cardImage","maybeLoadImage","imageUrl","loaderPromise","loader","Image","src","catch","then","WEBEXT_CLICK","click","hasImage","placeholder","description","Card","PlaceholderCard","TopSiteFormInput","validationError","onMount","shouldFocus","showClearButton","onClear","typeUrl","titleId","loading","placeholderId","errorMessageId","TopSiteForm","customScreenshotUrl","showCustomScreenshotForm","onClearScreenshotInput","onLabelChange","onUrlChange","onClearUrlClick","onDoneButtonClick","onCustomScreenshotUrlChange","onPreviewButtonClick","onEnableScreenshotUrlForm","validateUrl","_updateCustomScreenshotInput","validateForm","cleanUrl","_tryParseUrl","validProtocols","urlObj","validateCustomScreenshotUrl","validate","_renderCustomScreenshotInput","requestFailed","isLoading","showAsAdd","previous","changed","previewMode","previewLink"],"mappings":";AAAA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;;;AAGA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;AACA,kDAA0C,gCAAgC;AAC1E;AACA;;AAEA;AACA;AACA;AACA,gEAAwD,kBAAkB;AAC1E;AACA,yDAAiD,cAAc;AAC/D;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,iDAAyC,iCAAiC;AAC1E,wHAAgH,mBAAmB,EAAE;AACrI;AACA;;AAEA;AACA;AACA;AACA,mCAA2B,0BAA0B,EAAE;AACvD,yCAAiC,eAAe;AAChD;AACA;AACA;;AAEA;AACA,8DAAsD,+DAA+D;;AAErH;AACA;;;AAGA;AACA;;;;;;;;AClFA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA,MAAMA,QAAQC,4EAASA,CAACC,6DAAV,EAAoBC,OAAOC,+BAA3B,CAAd;AACA,MAAMC,kBAAkB,IAAIC,qFAAJ,EAAxB;;AAEA,IAAIC,gGAAJ,CAA2BP,KAA3B,EAAkCQ,sBAAlC;;AAEA;AACA;AACA;AACA,IAAI,CAACL,OAAOC,+BAAZ,EAA6C;AAC3CJ,QAAMS,QAAN,CAAeC,iEAAEA,CAACC,UAAH,CAAc,EAACC,MAAMC,8DAAEA,CAACC,qBAAV,EAAd,CAAf;AACD;AACDC,6FAAqBA,CAACf,KAAtB,EAA6BK,eAA7B;;AAEAW,gDAAQA,CAACC,OAAT,CAAiB;AAAC,sDAAD;AAAA,IAAU,OAAOjB,KAAjB;AACf,6DAAC,qEAAD;AACE,mBAAe,CAAC,CAACG,OAAOC,+BAD1B;AAEE,YAAQD,OAAOe,QAAP,CAAgBC,eAAhB,CAAgCC,IAF1C;AAGE,aAASjB,OAAOkB,sBAHlB;AADe,CAAjB,EAKaH,SAASI,cAAT,CAAwB,MAAxB,CALb;;AAOAC,sFAAqBA,CAACvB,KAAtB,E;;;;;;;AChCA;;AAEA;AACA;AACA;AACA,CAAC;;AAED;AACA;AACA;AACA,CAAC;AACD;AACA;AACA;;AAEA;AACA;AACA,4CAA4C;;AAE5C;;;;;;;;ACnBA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;;;AAGa;;wBAEY,qB;2BACG,wB;2BACA,iC;cACb,C;yBACW,C;;AAE1B;;;;;;AAKA,MAAMwB,sBAAsB,OAAOC,MAAP,KAAkB,WAAlB,GAAgCC,kBAAhC,GAAqDC,OAAjF;AACA;;AAGA;AACA;AACA;AACA;AACA;AACA,MAAMC,cAAc,EAApB;;AACA,KAAK,MAAMhB,IAAX,IAAmB,CACjB,qBADiB,EAEjB,sBAFiB,EAGjB,qBAHiB,EAIjB,uBAJiB,EAKjB,wBALiB,EAMjB,gCANiB,EAOjB,WAPiB,EAQjB,cARiB,EASjB,oBATiB,EAUjB,uBAViB,EAWjB,oBAXiB,EAYjB,oBAZiB,EAajB,eAbiB,EAcjB,aAdiB,EAejB,kBAfiB,EAgBjB,kBAhBiB,EAiBjB,MAjBiB,EAkBjB,kBAlBiB,EAmBjB,qBAnBiB,EAoBjB,iBApBiB,EAqBjB,cArBiB,EAsBjB,uBAtBiB,EAuBjB,cAvBiB,EAwBjB,oBAxBiB,EAyBjB,uBAzBiB,EA0BjB,gBA1BiB,EA2BjB,oBA3BiB,EA4BjB,WA5BiB,EA6BjB,iBA7BiB,EA8BjB,qBA9BiB,EA+BjB,sBA/BiB,EAgCjB,kBAhCiB,EAiCjB,uBAjCiB,EAkCjB,yBAlCiB,EAmCjB,wBAnCiB,EAoCjB,sBApCiB,EAqCjB,qBArCiB,EAsCjB,qBAtCiB,EAuCjB,wBAvCiB,EAwCjB,YAxCiB,EAyCjB,kBAzCiB,EA0CjB,yBA1CiB,EA2CjB,sBA3CiB,EA4CjB,cA5CiB,EA6CjB,iBA7CiB,EA8CjB,wBA9CiB,EA+CjB,kBA/CiB,EAgDjB,sBAhDiB,EAiDjB,mBAjDiB,EAkDjB,wBAlDiB,EAmDjB,gBAnDiB,EAoDjB,oBApDiB,EAqDjB,oBArDiB,EAsDjB,iBAtDiB,EAuDjB,gBAvDiB,EAwDjB,cAxDiB,EAyDjB,yBAzDiB,EA0DjB,kBA1DiB,EA2DjB,gBA3DiB,EA4DjB,qBA5DiB,EA6DjB,gBA7DiB,EA8DjB,eA9DiB,EA+DjB,UA/DiB,EAgEjB,oBAhEiB,EAiEjB,uBAjEiB,EAkEjB,gBAlEiB,EAmEjB,4BAnEiB,EAoEjB,4BApEiB,EAqEjB,eArEiB,EAsEjB,uBAtEiB,EAuEjB,gBAvEiB,EAwEjB,iBAxEiB,EAyEjB,cAzEiB,EA0EjB,aA1EiB,EA2EjB,4BA3EiB,EA4EjB,6BA5EiB,EA6EjB,2BA7EiB,EA8EjB,sBA9EiB,EA+EjB,uBA/EiB,EAgFjB,wCAhFiB,EAiFjB,gBAjFiB,EAkFjB,kBAlFiB,EAmFjB,uCAnFiB,EAoFjB,eApFiB,EAqFjB,yBArFiB,EAsFjB,iBAtFiB,EAuFjB,mBAvFiB,EAwFjB,yBAxFiB,EAyFjB,0BAzFiB,EA0FjB,QA1FiB,EA2FjB,gCA3FiB,EA4FjB,yBA5FiB,EA6FjB,sBA7FiB,EA8FjB,cA9FiB,EA+FjB,gBA/FiB,CAAnB,EAgGG;AACDgB,cAAYhB,IAAZ,IAAoBA,IAApB;AACD;;AAED;AACA;AACA,MAAMiB,kBAAkB,EAAxB;;AACA,KAAK,MAAMjB,IAAX,IAAmB,CACjB,wBADiB,EAEjB,wBAFiB,EAGjB,6BAHiB,EAIjB,UAJiB,EAKjB,iBALiB,EAMjB,uBANiB,EAOjB,uBAPiB,CAAnB,EAQG;AACDiB,kBAAgBjB,IAAhB,IAAwBA,IAAxB;AACD;;AAED;AACA;AACA,SAASkB,aAAT,CAAuBC,MAAvB,EAA+BC,OAA/B,EAAwC;AACtC,QAAMC,OAAOF,OAAOE,IAAP,qBAAkBF,OAAOE,IAAzB,IAAiC,EAA9C;AACA,MAAI,CAACD,OAAD,IAAY,CAACA,QAAQE,IAArB,IAA6B,CAACF,QAAQG,EAA1C,EAA8C;AAC5C,UAAM,IAAIC,KAAJ,CAAU,gHAAV,CAAN;AACD;AACD;AACA;AACA,GAAC,MAAD,EAAS,IAAT,EAAe,UAAf,EAA2B,YAA3B,EAAyC,UAAzC,EAAqD,WAArD,EAAkEC,OAAlE,CAA0EC,KAAK;AAC7E,QAAI,OAAON,QAAQM,CAAR,CAAP,KAAsB,WAA1B,EAAuC;AACrCL,WAAKK,CAAL,IAAUN,QAAQM,CAAR,CAAV;AACD,KAFD,MAEO,IAAIL,KAAKK,CAAL,CAAJ,EAAa;AAClB,aAAOL,KAAKK,CAAL,CAAP;AACD;AACF,GAND;AAOA,2BAAWP,MAAX,IAAmBE,IAAnB;AACD;;AAED;;;;;;;;;AASA,SAAStB,UAAT,CAAoBoB,MAApB,EAA4BQ,UAA5B,EAAwCC,SAAxC,EAAmD;AACjD,SAAOV,cAAcC,MAAd,EAAsB;AAC3BG,UAAMO,oBADqB;AAE3BN,QAAIO,iBAFuB;AAG3BH,cAH2B;AAI3BC;AAJ2B,GAAtB,CAAP;AAMD;;AAED;;;;;;;;AAQA,SAASG,UAAT,CAAoBZ,MAApB,EAA4BQ,UAA5B,EAAwC;AACtC,SAAO5B,WAAWoB,MAAX,EAAmBQ,UAAnB,EAA+B,IAA/B,CAAP;AACD;;AAED;;;;;;AAMA,SAASK,kBAAT,CAA4Bb,MAA5B,EAAoC;AAClC,SAAOD,cAAcC,MAAd,EAAsB;AAC3BG,UAAMQ,iBADqB;AAE3BP,QAAIM;AAFuB,GAAtB,CAAP;AAID;;AAED;;;;;;;;;AASA,SAASI,gBAAT,CAA0Bd,MAA1B,EAAkCe,MAAlC,EAA0CC,QAA1C,EAAoD;AAClD,MAAI,CAACD,MAAL,EAAa;AACX,UAAM,IAAIV,KAAJ,CAAU,gJAAV,CAAN;AACD;AACD,SAAON,cAAcC,MAAd,EAAsB;AAC3BG,UAAMQ,iBADqB;AAE3BP,QAAIM,oBAFuB;AAG3BO,cAAUF,MAHiB;AAI3BC;AAJ2B,GAAtB,CAAP;AAMD;;AAED;;;;;;;;AAQA,SAASE,gBAAT,CAA0BlB,MAA1B,EAAkCe,MAAlC,EAA0C;AACxC,SAAOD,iBAAiBd,MAAjB,EAAyBe,MAAzB,EAAiC,IAAjC,CAAP;AACD;;AAED;;;;;;AAMA,SAASI,eAAT,CAAyBnB,MAAzB,EAAiC;AAC/B,SAAOD,cAAcC,MAAd,EAAsB;AAC3BG,UAAMQ,iBADqB;AAE3BP,QAAIgB;AAFuB,GAAtB,CAAP;AAID;;AAED;;;;;;;AAOA,SAASC,SAAT,CAAmBC,IAAnB,EAAyB;AACvB,SAAO1C,WAAW;AAChBC,UAAMgB,YAAY0B,oBADF;AAEhBD;AAFgB,GAAX,CAAP;AAID;;AAED;;;;;;;AAOA,SAASE,iBAAT,CAA2BF,IAA3B,EAAiC;AAC/B,SAAO1C,WAAW;AAChBC,UAAMgB,YAAY4B,8BADF;AAEhBH;AAFgB,GAAX,CAAP;AAID;;AAED;;;;;;;AAOA,SAASI,cAAT,CAAwBJ,IAAxB,EAA8BK,gBAAgBlC,mBAA9C,EAAmE;AACjE,QAAMO,SAAS;AACbnB,UAAMgB,YAAY+B,yBADL;AAEbN;AAFa,GAAf;AAIA,SAAOK,kBAAkB/B,OAAlB,GAA4BhB,WAAWoB,MAAX,CAA5B,GAAiDA,MAAxD;AACD;;AAED;;;;;;;AAOA,SAAS6B,SAAT,CAAmBP,IAAnB,EAAyBK,gBAAgBlC,mBAAzC,EAA8D;AAC5D,QAAMO,SAAS;AACbnB,UAAMgB,YAAYiC,2BADL;AAEbR;AAFa,GAAf;AAIA,SAAOK,kBAAkB/B,OAAlB,GAA4BhB,WAAWoB,MAAX,CAA5B,GAAiDA,MAAxD;AACD;;AAED;;;;;;;AAOA,SAAS+B,eAAT,CAAyBT,IAAzB,EAA+BK,gBAAgBlC,mBAA/C,EAAoE;AAClE,QAAMO,SAAS;AACbnB,UAAMgB,YAAYmC,0BADL;AAEbV;AAFa,GAAf;AAIA,SAAOK,kBAAkB/B,OAAlB,GAA4BhB,WAAWoB,MAAX,CAA5B,GAAiDA,MAAxD;AACD;;AAED,SAASiC,OAAT,CAAiBC,IAAjB,EAAuBC,KAAvB,EAA8BR,gBAAgBlC,mBAA9C,EAAmE;AACjE,QAAMO,SAAS,EAACnB,MAAMgB,YAAYuC,QAAnB,EAA6Bd,MAAM,EAACY,IAAD,EAAOC,KAAP,EAAnC,EAAf;AACA,SAAOR,kBAAkB/B,OAAlB,GAA4BhB,WAAWoB,MAAX,CAA5B,GAAiDA,MAAxD;AACD;;AAED,SAASqC,WAAT,CAAqBxD,IAArB,EAA2ByC,IAA3B,EAAiCK,gBAAgBlC,mBAAjD,EAAsE;AACpE,MAAI,CAAC6B,IAAD,IAAS,CAACA,KAAKgB,MAAnB,EAA2B;AACzB,UAAM,IAAIjC,KAAJ,CAAU,qHAAV,CAAN;AACD;AACD,QAAML,SAAS,EAACnB,IAAD,EAAOyC,IAAP,EAAf;AACA,SAAOK,kBAAkB/B,OAAlB,GAA4BhB,WAAWoB,MAAX,CAA5B,GAAiDA,MAAxD;AACD;;qBAKqB;AACpBa,oBADoB;AAEpBQ,WAFoB;AAGpBG,mBAHoB;AAIpBE,gBAJoB;AAKpBG,WALoB;AAMpBE,iBANoB;AAOpBjB,kBAPoB;AAQpBI,kBARoB;AASpBtC,YAToB;AAUpBgC,YAVoB;AAWpBO,iBAXoB;AAYpBc,SAZoB;AAapBI;AAboB,C;;AAgBtB;;kBACmB;AACjBE,eAAavC,MAAb,EAAqB;AACnB,QAAI,CAACA,OAAOE,IAAZ,EAAkB;AAChB,aAAO,KAAP;AACD;AACD,WAAOF,OAAOE,IAAP,CAAYE,EAAZ,KAAmBO,iBAAnB,IAAwCX,OAAOE,IAAP,CAAYC,IAAZ,KAAqBO,oBAApE;AACD,GANgB;AAOjB8B,uBAAqBxC,MAArB,EAA6B;AAC3B,QAAI,CAACA,OAAOE,IAAZ,EAAkB;AAChB,aAAO,KAAP;AACD;AACD,QAAIF,OAAOE,IAAP,CAAYE,EAAZ,KAAmBM,oBAAnB,IAA2C,CAACV,OAAOE,IAAP,CAAYe,QAA5D,EAAsE;AACpE,aAAO,IAAP;AACD;AACD,WAAO,KAAP;AACD,GAfgB;AAgBjBwB,qBAAmBzC,MAAnB,EAA2B;AACzB,QAAI,CAACA,OAAOE,IAAZ,EAAkB;AAChB,aAAO,KAAP;AACD;AACD,QAAIF,OAAOE,IAAP,CAAYE,EAAZ,KAAmBM,oBAAnB,IAA2CV,OAAOE,IAAP,CAAYe,QAA3D,EAAqE;AACnE,aAAO,IAAP;AACD;AACD,WAAO,KAAP;AACD,GAxBgB;AAyBjByB,oBAAkB1C,MAAlB,EAA0B;AACxB,QAAI,CAACA,OAAOE,IAAZ,EAAkB;AAChB,aAAO,KAAP;AACD;AACD,WAAOF,OAAOE,IAAP,CAAYE,EAAZ,KAAmBgB,oBAAnB,IACLpB,OAAOE,IAAP,CAAYC,IAAZ,KAAqBQ,iBADvB;AAED,GA/BgB;AAgCjBgC,aAAW3C,MAAX,EAAmB;AACjB,QAAI,CAACA,OAAOE,IAAZ,EAAkB;AAChB,aAAO,KAAP;AACD;AACD,WAAOF,OAAOE,IAAP,CAAYC,IAAZ,KAAqBQ,iBAArB,IACLX,OAAOE,IAAP,CAAYE,EAAZ,KAAmBM,oBADrB;AAED,GAtCgB;AAuCjBkC,oBAAkB5C,MAAlB,EAA0B;AACxB,WAAQA,OAAOE,IAAP,IAAeF,OAAOE,IAAP,CAAYM,UAA5B,IAA2C,IAAlD;AACD,GAzCgB;AA0CjBT;AA1CiB,C;;;;;;;;;;;;;;;ACnWnB,MAAM8C,gBAAgB,aAAtB;AACA,MAAMC,mBAAmB,CAAzB;AACA,MAAMC,4BAA4B,UAAlC;AACO,MAAMC,8BAA8B,QAApC,C,CAA8C;;AAErD,MAAMC,yBAAyB,kBAA/B;AACA,MAAMC,0BAA0B,mBAAhC;;AAEA;;AAEA;;;;;;;;AAQO,MAAMC,WAAN,SAA0BC,GAA1B,CAA8B;AACnCC,cAAY3E,QAAZ,EAAsB;AACpB;AACA,SAAK4E,GAAL,GAAW,IAAX;AACA,SAAKC,SAAL,GAAiB7E,QAAjB;AACD;;AAED8E,MAAIC,GAAJ,EAAStB,KAAT,EAAgB;AACd,UAAMqB,GAAN,CAAUC,GAAV,EAAetB,KAAf;AACA,WAAO,KAAKuB,cAAL,CAAoBC,MAAMA,GAAGC,GAAH,CAAOzB,KAAP,EAAcsB,GAAd,CAA1B,CAAP;AACD;;AAEDI,SAAOJ,GAAP,EAAY;AACV,UAAMI,MAAN,CAAaJ,GAAb;AACA,WAAO,KAAKC,cAAL,CAAoBC,MAAMA,GAAGE,MAAH,CAAUJ,GAAV,CAA1B,CAAP;AACD;;AAEDK,UAAQ;AACN,UAAMA,KAAN;AACA,SAAKP,SAAL,CAAe5E,iEAAEA,CAACiC,UAAH,CAAc,EAAC/B,MAAMC,8DAAEA,CAACiF,0BAAV,EAAd,CAAf;AACA,WAAO,KAAKL,cAAL,CAAoBC,MAAMA,GAAGG,KAAH,EAA1B,CAAP;AACD;;AAED,MAAIE,SAAJ,GAAgB;AACd,WAAO,KAAKC,GAAL,CAAS,WAAT,KAAyB,EAAhC;AACD;;AAED;;;;;;;AAOMC,kBAAN,CAAuBC,EAAvB,EAA2B;AAAA;;AAAA;AACzB,UAAI,CAACA,EAAL,EAAS;AACP;AACD;AACD,YAAM,EAACH,SAAD,KAAc,KAApB;AACA,UAAI,CAACA,UAAUI,QAAV,CAAmBD,EAAnB,CAAL,EAA6B;AAC3BH,kBAAUK,IAAV,CAAeF,EAAf;AACA,cAAKZ,SAAL,CAAe5E,iEAAEA,CAACC,UAAH,CAAc,EAACC,MAAMC,8DAAEA,CAACwF,0BAAV,EAAsChD,MAAM6C,EAA5C,EAAd,CAAf;AACA,cAAM,MAAKX,GAAL,CAAS,WAAT,EAAsBQ,SAAtB,CAAN;AACD;AATwB;AAU1B;;AAEDO,sBAAoB,CAAE;;AAEtBC,wBAAsB;AACpB,SAAKjB,SAAL,CAAe5E,iEAAEA,CAACC,UAAH,CAAc,EAACC,MAAMC,8DAAEA,CAAC2F,qBAAV,EAAd,CAAf;AACD;;AAEDC,2BAAyB;AACvB,WAAO,IAAIC,OAAJ,CAAYC,WAAW;AAC5B,WAAKrB,SAAL,CAAe5E,iEAAEA,CAACiC,UAAH,CAAc,EAAC/B,MAAMC,8DAAEA,CAAC+F,uBAAV,EAAd,CAAf;AACAzG,aAAO0G,qBAAP,CAA6B,8BAA7B,EAA6D,SAASC,SAAT,CAAmB,EAACzD,MAAMtB,MAAP,EAAnB,EAAmC;AAC9F,YAAIA,OAAOnB,IAAP,KAAgBC,8DAAEA,CAACkG,wBAAvB,EAAiD;AAC/CJ,kBAAQ5E,OAAOsB,IAAf;AACAlD,iBAAO6G,wBAAP,CAAgC,8BAAhC,EAAgEF,SAAhE;AACD;AACF,OALD;AAMD,KARM,CAAP;AASD;;AAEDG,kBAAgB;AACd,WAAO,IAAIP,OAAJ,CAAYC,WAAW;AAC5B,WAAKrB,SAAL,CAAe5E,iEAAEA,CAACiC,UAAH,CAAc,EAAC/B,MAAMC,8DAAEA,CAACqG,mBAAV,EAAd,CAAf;AACA/G,aAAO0G,qBAAP,CAA6B,8BAA7B,EAA6D,SAASC,SAAT,CAAmB,EAACzD,MAAMtB,MAAP,EAAnB,EAAmC;AAC9F,YAAIA,OAAOnB,IAAP,KAAgBC,8DAAEA,CAACsG,oBAAvB,EAA6C;AAC3CR,kBAAQ5E,OAAOsB,IAAf;AACAlD,iBAAO6G,wBAAP,CAAgC,8BAAhC,EAAgEF,SAAhE;AACD;AACF,OALD;AAMD,KARM,CAAP;AASD;;AAED;;;;;;;AAOMM,SAAN,GAAgB;AAAA;;AAAA;AACd;AACA,YAAM1B,KAAK,MAAM,OAAK2B,OAAL,EAAjB;;AAEA;AACA,YAAM,OAAKC,cAAL,CAAoB5B,EAApB,CAAN;;AAEA;AACA,aAAKL,GAAL,GAAWK,EAAX;AARc;AASf;;AAED;;;;;;;;;AASAD,iBAAe8B,QAAf,EAAyB;AACvB,QAAI,CAAC,KAAKlC,GAAV,EAAe;AACb,aAAOqB,QAAQC,OAAR,EAAP;AACD;AACD,WAAO,IAAID,OAAJ,CAAY,CAACC,OAAD,EAAUa,MAAV,KAAqB;AACtC,YAAMC,cAAcF,SAClB,KAAKlC,GAAL,CACGoC,WADH,CACe3C,yBADf,EAC0C,WAD1C,EAEG4C,WAFH,CAEe5C,yBAFf,CADkB,CAApB;AAKA2C,kBAAYE,SAAZ,GAAwBC,SAASjB,SAAjC;;AAEA;AACAc,kBAAYI,OAAZ,GAAsBD,SAASJ,OAAOC,YAAYK,KAAnB,CAA/B;AACD,KAVM,CAAP;AAWD;;AAEDT,YAAU;AACR,WAAO,IAAIX,OAAJ,CAAY,CAACC,OAAD,EAAUa,MAAV,KAAqB;AACtC,YAAMO,cAAcC,UAAUC,IAAV,CAAerD,aAAf,EAA8BC,gBAA9B,CAApB;;AAEA;AACAkD,kBAAYF,OAAZ,GAAsBD,SAAS;AAC7B;AACA;AACAI,kBAAUE,cAAV,CAAyBtD,aAAzB;AACA4C,eAAOI,KAAP;AACD,OALD;;AAOAG,kBAAYI,eAAZ,GAA8BP,SAAS;AACrC,cAAMlC,KAAKkC,MAAM9E,MAAN,CAAasF,MAAxB;AACA,YAAI,CAAC1C,GAAG2C,gBAAH,CAAoBC,QAApB,CAA6BxD,yBAA7B,CAAL,EAA8D;AAC5DY,aAAG6C,iBAAH,CAAqBzD,yBAArB;AACD;AACF,OALD;;AAOAiD,kBAAYJ,SAAZ,GAAwBC,SAAS;AAC/B,YAAIlC,KAAKkC,MAAM9E,MAAN,CAAasF,MAAtB;;AAEA;AACA1C,WAAGmC,OAAH,GAAaW,OAAOC,QAAQX,KAAR,CAAcU,GAAd,CAApB,CAJ+B,CAIS;AACxC;AACA9C,WAAGgD,eAAH,GAAqBC,sBAAsBA,mBAAmB7F,MAAnB,CAA0B8F,KAA1B,EAA3C;;AAEAjC,gBAAQjB,EAAR;AACD,OATD;AAUD,KA5BM,CAAP;AA6BD;;AAED4B,iBAAe5B,EAAf,EAAmB;AACjB,WAAO,IAAIgB,OAAJ,CAAY,CAACC,OAAD,EAAUa,MAAV,KAAqB;AACtC,UAAIqB,aAAJ;AACA,UAAI;AACFA,wBAAgBnD,GAAG+B,WAAH,CAAe3C,yBAAf,EACb4C,WADa,CACD5C,yBADC,EAC0BgE,UAD1B,EAAhB;AAED,OAHD,CAGE,OAAON,GAAP,EAAY;AACZ;AACAhB,eAAOgB,GAAP;AACA;AACA;AACD;;AAED;AACAK,oBAAchB,OAAd,GAAwBD,SAASJ,OAAOI,KAAP,CAAjC;;AAEAiB,oBAAclB,SAAd,GAA0BC,SAAS;AACjC,YAAImB,SAASnB,MAAM9E,MAAN,CAAasF,MAA1B;AACA;AACA,YAAIW,MAAJ,EAAY;AACV,cAAIA,OAAO7E,KAAP,KAAiB,WAArB,EAAkC;AAChC,iBAAKqB,GAAL,CAASwD,OAAOvD,GAAhB,EAAqBuD,OAAO7E,KAA5B;AACD;AACD6E,iBAAOC,QAAP;AACD,SALD,MAKO;AACL;AACArC;AACD;AACF,OAZD;AAaD,KA5BM,CAAP;AA6BD;AAtLkC;;AAyLrC;;;;;AAKO,MAAMsC,gBAAN,CAAuB;AAC5B7D,cAAY3E,QAAZ,EAAsB;AACpB;AACA;AACAN,WAAO+I,YAAP,GAAsB,IAAIhE,WAAJ,CAAgBzE,QAAhB,CAAtB;AACA,SAAK0I,SAAL,GAAiB,KAAKA,SAAL,CAAeC,IAAf,CAAoB,IAApB,CAAjB;AACD;;AAED,MAAIC,WAAJ,GAAkB;AAChB,WAAOlJ,OAAO+I,YAAd;AACD;;AAEKI,kBAAN,GAAyB;AAAA;;AAAA;AACvB;AACA;AACA,YAAMC,gBAAgB,OAAKF,WAAL,CAAiBrD,GAAjB,CAAqB,yBAArB,CAAtB;;AAEA,UAAIuD,kBAAkB,OAAKC,OAAL,CAAaC,OAAnC,EAA4C;AAC1C,eAAKJ,WAAL,CAAiBxD,KAAjB;AACD;;AAED;AACA,YAAM6D,aAAa,OAAKL,WAAL,CAAiBrD,GAAjB,CAAqB,sBAArB,CAAnB;AACA,YAAM2D,cAAc,EAAED,cAAc,CAAhB,KAAsBE,KAAKC,GAAL,KAAaH,UAAb,GAA0B3E,2BAApE;;AAEA,UAAI4E,eAAe,OAAKH,OAAL,CAAaM,WAAhC,EAA6C;AAC3C,eAAKT,WAAL,CAAiB9D,GAAjB,CAAqB,sBAArB,EAA6CqE,KAAKC,GAAL,EAA7C;AACA,YAAI;AACF,gBAAME,WAAW,MAAMC,MAAM,OAAKR,OAAL,CAAaM,WAAnB,CAAvB;AACA,cAAIC,SAASE,MAAT,KAAoB,GAAxB,EAA6B;AAC3B,kBAAMC,UAAU,MAAMH,SAASI,IAAT,EAAtB;;AAEA,mBAAKd,WAAL,CAAiB9D,GAAjB,CAAqB,UAArB,EAAiC2E,OAAjC;AACA,mBAAKb,WAAL,CAAiB9D,GAAjB,CAAqB,yBAArB,EAAgD,OAAKiE,OAAL,CAAaC,OAA7D;AACD;AACF,SARD,CAQE,OAAOW,CAAP,EAAU;AACV3B,kBAAQX,KAAR,CAAcsC,CAAd,EADU,CACQ;AACnB;AACF;AA1BsB;AA2BxB;;AAEDC,wBAAsB;AACpB,UAAMC,aAAapJ,SAASI,cAAT,CAAwB,KAAKiJ,SAA7B,CAAnB;AACA,UAAML,UAAU,KAAKb,WAAL,CAAiBrD,GAAjB,CAAqB,UAArB,CAAhB;;AAEA,QAAI,CAACsE,UAAL,EAAiB;AACf,YAAM,IAAIlI,KAAJ,CAAW,iCAAgC,KAAKmI,SAAU,IAA1D,CAAN;AACD;;AAED;AACA,QAAI,CAACL,OAAL,EAAc;AACZ,YAAM,IAAI9H,KAAJ,CAAU,gDAAV,CAAN;AACD;;AAED,QAAI,OAAO8H,OAAP,KAAmB,QAAvB,EAAiC;AAC/B,YAAM,IAAI9H,KAAJ,CAAU,2CAAV,CAAN;AACD;;AAED;AACA;AACAkI,eAAWE,SAAX,GAAuBN,OAAvB;;AAEA,SAAKO,cAAL,CAAoB,8BAApB;;AAEA;AACA;AACA,SAAK,MAAMC,QAAX,IAAuBJ,WAAWK,oBAAX,CAAgC,QAAhC,CAAvB,EAAkE;AAChE,YAAMC,kBAAkB1J,SAAS2J,aAAT,CAAuB,QAAvB,CAAxB;AACAD,sBAAgBT,IAAhB,GAAuBO,SAASP,IAAhC;AACAO,eAASI,UAAT,CAAoBC,YAApB,CAAiCH,eAAjC,EAAkDF,QAAlD;AACD;AACF;;AAEDvB,YAAU6B,GAAV,EAAe;AACb,QAAIA,IAAI3H,IAAJ,CAASzC,IAAT,KAAkBC,8DAAEA,CAACoK,eAAzB,EAA0C;AACxC,UAAI,CAAC,KAAK5B,WAAL,CAAiBtD,SAAjB,CAA2BI,QAA3B,CAAoC6E,IAAI3H,IAAJ,CAASA,IAA7C,CAAL,EAAyD;AACvD,aAAKgG,WAAL,CAAiB9D,GAAjB,CAAqB,WAArB,EAAkC,KAAK8D,WAAL,CAAiBtD,SAAjB,CAA2BmF,MAA3B,CAAkCF,IAAI3H,IAAJ,CAASA,IAA3C,CAAlC;AACAnC,iBAASI,cAAT,CAAwB,oBAAxB,EAA8C6J,KAA9C,CAAoDC,OAApD,GAA8D,MAA9D;AACD;AACF;AACF;;AAED;AACAX,iBAAeN,IAAf,EAAqB;AACnB,QAAI,KAAKkB,eAAT,EAA0B;AACxB5C,cAAQ6C,GAAR,CAAY,kBAAZ,EAAgCnB,IAAhC,EADwB,CACe;AACxC;AACF;;AAED;;;;;;;;;AASMoB,MAAN,CAAWvJ,OAAX,EAAoB;AAAA;;AAAA;AAClBwJ,aAAOC,MAAP,CAAc,MAAd,EAAoB;AAClBjC,iBAAS,EADS;AAElBe,mBAAW,UAFO;AAGlBnD,iBAAS,IAHS;AAIlBiE,yBAAiB;AAJC,OAApB,EAKGrJ,OALH;;AAOA,aAAKyI,cAAL,CAAoB,iBAApB;;AAEA;AACA,UAAItK,OAAO0G,qBAAX,EAAkC;AAChC1G,eAAO0G,qBAAP,CAA6B,8BAA7B,EAA6D,OAAKsC,SAAlE;AACD;;AAED;AACA;AACA,UAAI,OAAK/B,OAAT,EAAkB;AAChB,YAAI;AACF,gBAAM,OAAKiC,WAAL,CAAiBjC,OAAjB,EAAN;AACD,SAFD,CAEE,OAAOgD,CAAP,EAAU;AACV3B,kBAAQX,KAAR,CAAcsC,CAAd,EADU,CACQ;AACnB;AACF;;AAED;AACA,WAAK,MAAM5E,GAAX,IAAkBgG,OAAOE,IAAP,CAAY,OAAKlC,OAAjB,CAAlB,EAA6C;AAC3C,YAAIhE,QAAQ,WAAZ,EAAyB;AACvB,iBAAK6D,WAAL,CAAiB9D,GAAjB,CAAqB,WAArB,EAAkC,OAAKiE,OAAL,CAAahE,GAAb,CAAlC;AACD,SAFD,MAEO;AACL,iBAAK6D,WAAL,CAAiB9D,GAAjB,CAAsB,WAAUC,GAAI,EAApC,EAAuC,OAAKgE,OAAL,CAAahE,GAAb,CAAvC;AACD;AACF;;AAED;AACA,YAAM,OAAK8D,gBAAL,EAAN;;AAEA;AACA,UAAI;AACF,eAAKe,mBAAL;AACD,OAFD,CAEE,OAAOD,CAAP,EAAU;AACV,eAAKK,cAAL,CAAoB,oCAApB;AACAhC,gBAAQX,KAAR,CAAcsC,CAAd,EAFU,CAEQ;AACnB;;AAEDuB,aAAOC,aAAP,CAAqB,IAAIC,KAAJ,CAAU7G,sBAAV,CAArB;;AAEA,aAAK8G,WAAL,GAAmB,IAAnB;AACA,aAAKrB,cAAL,CAAoB,wBAApB;AAhDkB;AAiDnB;;AAEDsB,WAAS;AACPJ,WAAOC,aAAP,CAAqB,IAAIC,KAAJ,CAAU5G,uBAAV,CAArB;AACA,QAAI9E,OAAO6G,wBAAX,EAAqC;AACnC7G,aAAO6G,wBAAP,CAAgC,8BAAhC,EAAgE,KAAKmC,SAArE;AACD;AACD,SAAK2C,WAAL,GAAmB,KAAnB;AACD;AA3J2B;;AA8J9B;;;;;;;;AAQO,SAASvK,qBAAT,CAA+BvB,KAA/B,EAAsC;AAC3C,QAAMgM,WAAW,IAAI/C,gBAAJ,CAAqBjJ,MAAMS,QAA3B,CAAjB;;AAEA,MAAIwL,eAAe,KAAnB;;AAEAjM,QAAMkM,SAAN,mBAAgB,aAAY;AAC1B,UAAMC,QAAQnM,MAAMoM,QAAN,EAAd;;AAEA;;;;;;;;;;;;;AAaA;AACA,QACED,MAAME,KAAN,CAAYC,MAAZ,CAAmB,gBAAnB,KACAH,MAAMI,QAAN,CAAeT,WADf,IAEAK,MAAMI,QAAN,CAAeC,mBAFf,IAGA,CAACL,MAAME,KAAN,CAAYC,MAAZ,CAAmBG,eAHpB,IAIAN,MAAMO,QAAN,CAAeZ,WAJf,IAKA,CAACE,SAASF,WALV;AAMA;AACA,KAACG,YAPD,IAQAU,SAASC,IAAT,KAAkB,eARlB,IASAD,SAASE,IAAT,KAAkB,WAVpB,EAWE;AACAZ,qBAAe,IAAf;AACA,YAAMD,SAAST,IAAT,CAAc,EAAC/B,SAAS2C,MAAMO,QAAhB,EAA0BrB,iBAAiBc,MAAME,KAAN,CAAYC,MAAZ,CAAmB,0BAAnB,CAA3C,EAAd,CAAN;AACAL,qBAAe,KAAf;;AAEF;AACC,KAjBD,MAiBO,IACL,CACEE,MAAME,KAAN,CAAYC,MAAZ,CAAmB,gBAAnB,MAAyC,KAAzC,IACAH,MAAME,KAAN,CAAYC,MAAZ,CAAmBG,eAAnB,KAAuC,IADvC,IAECN,MAAMI,QAAN,CAAeT,WAAf,IAA8B,CAACK,MAAMI,QAAN,CAAeC,mBAHjD,KAKAR,SAASF,WANJ,EAOL;AACA;AACAE,eAASD,MAAT;AACA;AACA,UAAII,MAAME,KAAN,CAAYC,MAAZ,CAAmB,0BAAnB,CAAJ,EAAoD;AAClD7D,gBAAQ6C,GAAR,CAAY,yBAAZ,EADkD,CACV;AACzC;AACF;AACF,GAjDD;;AAmDA;AACA,SAAO,EAACU,QAAD,EAAP;AACD,C;;;;;;;;;;;;;;;;;;;;;;;;;;;;AChbD;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA,MAAMc,wBAAwB,0BAA9B;AACA,MAAMC,wBAAwB,0BAA9B;AACA,MAAMC,mBAAmB,sBAAzB;;AAEO,MAAMC,gBAAgB;AAC3BC,cAAYC,QAAZ,EAAsB;AACpBhN,WAAO0G,qBAAP,CAA6BiG,qBAA7B,EAAoDK,QAApD;AACD,GAH0B;AAI3BC,iBAAeD,QAAf,EAAyB;AACvBhN,WAAO6G,wBAAP,CAAgC8F,qBAAhC,EAAuDK,QAAvD;AACD,GAN0B;AAO3BE,cAAYtL,MAAZ,EAAoB;AAClB5B,WAAOmN,mBAAP,CAA2BP,qBAA3B,EAAkDhL,MAAlD;AACD,GAT0B;AAU3BwL,YAAUrH,EAAV,EAAclE,OAAd,EAAuB;AACrBiL,kBAAcI,WAAd,CAA0B,EAACzM,MAAM,qBAAP,EAA8ByC,sBAAO6C,EAAP,IAAclE,OAAd,CAA9B,EAA1B;AACD,GAZ0B;AAa3BwL,cAAYtH,EAAZ,EAAgB;AACd+G,kBAAcI,WAAd,CAA0B,EAACzM,MAAM,uBAAP,EAAgCyC,MAAM,EAAC6C,EAAD,EAAtC,EAA1B;AACD,GAf0B;AAgB3BuH,cAAYC,MAAZ,EAAoB;AAClBT,kBAAcI,WAAd,CAA0B,EAACzM,MAAM,cAAP,EAAuByC,MAAM,EAACqK,MAAD,EAA7B,EAA1B;AACD,GAlB0B;AAmB3BC,gBAAcC,aAAd,EAA6B;AAC3BX,kBAAcI,WAAd,CAA0B;AACxBzM,YAAM,aADkB;AAExByC,YAAMuK;AAFkB,KAA1B;AAID,GAxB0B;AAyB3BC,cAAY3H,EAAZ,EAAgB;AACd+G,kBAAcI,WAAd,CAA0B,EAACzM,MAAM,uBAAP,EAAgCyC,MAAM,EAAC6C,EAAD,EAAtC,EAA1B;AACD,GA3B0B;AA4B3B4H,gBAAcJ,MAAd,EAAsB;AACpBT,kBAAcI,WAAd,CAA0B,EAACzM,MAAM,gBAAP,EAAyByC,MAAM,EAACqK,MAAD,EAA/B,EAA1B;AACD,GA9B0B;AA+B3BK,kBAAgB7H,EAAhB,EAAoB;AAClB+G,kBAAcI,WAAd,CAA0B,EAACzM,MAAM,kBAAP,EAA2ByC,MAAM,EAAC6C,EAAD,EAAjC,EAA1B;AACD,GAjC0B;AAkC3B8H,gBAAcC,IAAd,EAAoB;AAClB,UAAM/D,UAAUxJ,iEAAEA,CAAC6C,iBAAH,CAAqB0K,IAArB,CAAhB;AACA9N,WAAOmN,mBAAP,CAA2BY,gFAA3B,EAA6DhE,OAA7D;AACD,GArC0B;AAsC3BiE,uBAAqB;AACnB,QAAIxC,OAAOgB,QAAP,CAAgBC,IAAhB,CAAqBzG,QAArB,CAA8B,UAA9B,CAAJ,EAA+C;AAC7C,YAAMiI,SAAS,IAAIC,eAAJ,CAAoB1C,OAAOgB,QAAP,CAAgBC,IAAhB,CAAqB0B,KAArB,CAA2B3C,OAAOgB,QAAP,CAAgBC,IAAhB,CAAqB2B,OAArB,CAA6B,UAA7B,CAA3B,CAApB,CAAf;AACA,UAAI;AACF,cAAMC,WAAW,IAAIC,GAAJ,CAAQL,OAAOpI,GAAP,CAAW,UAAX,CAAR,CAAjB;AACA,eAAO;AACL0I,eAAKF,SAAS5B,IADT;AAEL+B,qBAAWP,OAAOpI,GAAP,CAAW,WAAX;AAFN,SAAP;AAID,OAND,CAME,OAAOoE,CAAP,EAAU,CAAE;AACf;;AAED,WAAO,IAAP;AACD;AAnD0B,CAAtB;;AAsDP;AACA,SAASwE,4BAAT,CAAsCC,SAAtC,EAAiDC,SAAjD,EAA4D;AAC1D,SAAQD,UAAUE,OAAV,CAAkB7I,EAAlB,KAAyB,CAAC4I,UAAUC,OAAX,IAAsBD,UAAUC,OAAV,CAAkB7I,EAAlB,KAAyB2I,UAAUE,OAAV,CAAkB7I,EAA1F,CAAR;AACD;;AAEM,MAAM8I,iBAAN,SAAgCC,4CAAKA,CAACC,aAAtC,CAAoD;AACzD9J,cAAY+J,KAAZ,EAAmB;AACjB,UAAMA,KAAN;AACA,SAAKC,mBAAL,GAA2B,KAAKA,mBAAL,CAAyBhG,IAAzB,CAA8B,IAA9B,CAA3B;AACA,SAAKiG,SAAL,GAAiB,KAAKA,SAAL,CAAejG,IAAf,CAAoB,IAApB,CAAjB;AACA,SAAKkG,cAAL,GAAsB,KAAKA,cAAL,CAAoBlG,IAApB,CAAyB,IAAzB,CAAtB;AACA,SAAKmG,uBAAL,GAA+B,KAAKA,uBAAL,CAA6BnG,IAA7B,CAAkC,IAAlC,CAA/B;AACA,SAAK+C,KAAL,GAAa,EAAC4C,SAAS,EAAV,EAAcrB,QAAQ,EAAtB,EAAb;AACD;;AAED6B,0BAAwBC,aAAa,EAArC,EAAyC;AACvC,UAAM,EAACT,OAAD,EAAUrB,MAAV,KAAoB,KAAKvB,KAA/B;AACA,QAAI,CAAC4C,OAAD,IAAY,CAACS,WAAWC,UAA5B,EAAwC;AACtC,YAAM,IAAIrN,KAAJ,CAAW,oDAAX,CAAN;AACD;AACD,UAAMsN,YAAa,GAAEX,QAAQY,QAAR,IAAoBjC,OAAOiC,QAAS,aAAzD;AACA1C,kBAAce,aAAd;AACEyB,kBAAYV,QAAQ7I,EAAR,IAAcsJ,WAAWC,UADvC;AAEEpL,cAAQmL,WAAWtJ,EAFrB;AAGEnE,cAAQ2N;AAHV,OAIKF,UAJL;AAMD;;AAEDF,iBAAeE,UAAf,EAA2B;AACzB,QAAI,KAAKrD,KAAL,CAAW4C,OAAX,CAAmBY,QAAnB,KAAgC,SAApC,EAA+C;AAC7C;AACD;;AAED1C,kBAAcI,WAAd,CAA0B,EAACzM,MAAM,YAAP,EAAqByC,MAAM,KAAK8I,KAAL,CAAW4C,OAAtC,EAA1B;AACA,SAAKQ,uBAAL,iBAA8B3H,OAAO,YAArC,IAAsD4H,UAAtD;AACD;;AAED;AACA;AACA;AACAH,YAAUzH,KAAV,EAAiB;AACf,UAAMgI,SAAS;AACb1L,aAAO0D,MAAM9E,MAAN,CAAa+M,OAAb,CAAqBD,MADf;AAEb;AACA;AACA1J,UAAI;AAJS,KAAf;AAMA,UAAMnE,SAAS;AACbnB,YAAMgH,MAAM9E,MAAN,CAAa+M,OAAb,CAAqB9N,MADd;AAEbsB,YAAM,EAACyM,MAAMlI,MAAM9E,MAAN,CAAa+M,OAAb,CAAqBC,IAA5B;AAFO,KAAf;AAIA,QAAI/N,OAAOnB,IAAX,EAAiB;AACfqM,oBAAcU,aAAd,CAA4B5L,MAA5B;AACD;AACD,QAAI,CAAC,KAAKoK,KAAL,CAAW4C,OAAX,CAAmBgB,OAAnB,CAA2BC,gBAA5B,IAAgD,CAACpI,MAAM9E,MAAN,CAAa+M,OAAb,CAAqBG,gBAA1E,EAA4F;AAC1F/C,oBAAcM,SAAd,CAAwB,KAAKpB,KAAL,CAAW4C,OAAX,CAAmB7I,EAA3C;AACD;AACD,QAAI,KAAKiG,KAAL,CAAW4C,OAAX,CAAmBY,QAAnB,KAAgC,SAApC,EAA+C;AAC7C,WAAKJ,uBAAL,iBAA8B3H,OAAO,cAArC,IAAwDgI,MAAxD;AACD;AACF;;AAEDK,cAAY/J,EAAZ,EAAgB;AACd,WAAOlE,WAAWiL,cAAcM,SAAd,CAAwBrH,EAAxB,EAA4BlE,OAA5B,CAAlB;AACD;;AAEDkO,gBAAchK,EAAd,EAAkB;AAChB,WAAO,MAAM+G,cAAcO,WAAd,CAA0BtH,EAA1B,CAAb;AACD;;AAEDiK,cAAYzC,MAAZ,EAAoB;AAClB,WAAO,MAAMT,cAAcQ,WAAd,CAA0BC,MAA1B,CAAb;AACD;;AAED0B,sBAAoB,EAAC/L,MAAMtB,MAAP,EAApB,EAAoC;AAClC,YAAQA,OAAOnB,IAAf;AACE,WAAK,aAAL;AACE,aAAKwP,QAAL,CAAc,EAACrB,SAAShN,OAAOsB,IAAjB,EAAd;AACA;AACF,WAAK,sBAAL;AACE,aAAK+M,QAAL,CAAc,EAAC1C,QAAQ3L,OAAOsB,IAAhB,EAAd;AACA;AACF,WAAK,eAAL;AACE,YAAItB,OAAOsB,IAAP,CAAY6C,EAAZ,KAAmB,KAAKiG,KAAL,CAAW4C,OAAX,CAAmB7I,EAA1C,EAA8C;AAC5C,eAAKkK,QAAL,CAAc,EAACrB,SAAS,EAAV,EAAd;AACD;AACD;AACF,WAAK,gBAAL;AACE,YAAIhN,OAAOsB,IAAP,CAAY6C,EAAZ,KAAmB,KAAKiG,KAAL,CAAW4C,OAAX,CAAmBY,QAA1C,EAAoD;AAClD,eAAKS,QAAL,CAAc,EAACrB,SAAS,EAAV,EAAd;AACD;AACD;AACF,WAAK,cAAL;AACE,YAAI,KAAK5C,KAAL,CAAWuB,MAAX,CAAkBA,MAAtB,EAA8B;AAC5B,eAAK0C,QAAL,CAAc,EAAC1C,QAAQ,EAAT,EAAd;AACD;AACD;AACF,WAAK,WAAL;AACE,aAAK0C,QAAL,CAAc,EAACrB,SAAS,EAAV,EAAcrB,QAAQ,EAAtB,EAAd;AAvBJ;AAyBD;;AAED2C,uBAAqB;AACnB;AACAC,oEAAaA,CAACnQ,OAAOe,QAAP,CAAgBC,eAAhB,CAAgCC,IAA9C;;AAEA,UAAMoN,WAAWvB,cAAckB,kBAAd,EAAjB;AACAlB,kBAAcC,WAAd,CAA0B,KAAKkC,mBAA/B;;AAEA;AACA,QAAI,KAAKD,KAAL,CAAWjO,QAAX,CAAoByL,QAApB,CAA6BC,IAA7B,KAAsC,eAA1C,EAA2D;AACzDK,oBAAcI,WAAd,CAA0B,EAACzM,MAAM,SAAP,EAAkByC,MAAM,EAACkN,SAAS,EAACrK,IAAI,UAAL,EAAV,EAAxB,EAA1B;AACD,KAFD,MAEO;AACL+G,oBAAcI,WAAd,CAA0B,EAACzM,MAAM,kBAAP,EAA2ByC,MAAM,EAACmL,QAAD,EAAjC,EAA1B;AACD;AACF;;AAEDgC,sBAAoB;AAClB,QAAI,KAAKrB,KAAL,CAAWjO,QAAX,CAAoByL,QAApB,CAA6BC,IAA7B,KAAsC,eAA1C,EAA2D;AACzD;AACA;AACAK,oBAAcI,WAAd,CAA0B,EAACzM,MAAM,SAAP,EAAkByC,MAAM,EAACkN,SAAS,EAACrK,IAAI,gBAAL,EAAV,EAAxB,EAA1B;AACD;AACF;;AAEDuK,yBAAuB;AACrBxD,kBAAcG,cAAd,CAA6B,KAAKgC,mBAAlC;AACD;;AAEDsB,mBAAiB;AACf,QAAI,KAAKvE,KAAL,CAAWuB,MAAX,CAAkBiD,QAAlB,KAA+B,YAA/B,IACA,KAAKxE,KAAL,CAAW4C,OAAX,CAAmB4B,QAAnB,KAAgC,aADpC,EACmD;AACjD,aAAO,IAAP;AACD;AACD,UAAMC,mBAAmBC,8EAAiBA,CAAC,KAAK1E,KAAL,CAAW4C,OAAX,CAAmB4B,QAArC,CAAzB;AACA,UAAM,EAACZ,OAAD,KAAY,KAAK5D,KAAL,CAAW4C,OAA7B;;AAEA,WACE;AAAC,0GAAD;AAAA;AACE,YAAG,mBADL;AAEE,iBAAS,KAAK5C,KAAL,CAAW4C,OAFtB;AAGE,wBAAgB,KAAKO,cAHvB;AAIE,sCAA8BV;AAC9B;AALF,UAME,UAAU,KAAKO,KAAL,CAAWjO,QANvB;AAOI;AAAC,yEAAD;AAAA,UAAsB,UAAU4P,2EAAgBA,CAACf,OAAjB,CAAhC;AACE,mEAAC,gBAAD,eACM,KAAK5D,KAAL,CAAW4C,OADjB;AAEE,qBAAU,mBAFZ;AAGE,mBAAS,KAAKkB,WAAL,CAAiB,KAAK9D,KAAL,CAAW4C,OAAX,CAAmB7I,EAApC,CAHX;AAIE,qBAAW,KAAKgK,aAAL,CAAmB,KAAK/D,KAAL,CAAW4C,OAAX,CAAmB7I,EAAtC,CAJb;AAKE,oBAAU+G,cAAcU,aAL1B;AAME,qBAAW,KAAK0B,SANlB;AAOE,mCAAyB,KAAKE,uBAPhC;AADF;AAPJ,KADF;AAmBD;;AAEDwB,qBAAmB;AACjB,QAAI,KAAK5E,KAAL,CAAWuB,MAAX,CAAkBiD,QAAlB,KAA+B,YAAnC,EAAiD;AAC/C,aACE,2DAAC,gGAAD,eACM,KAAKxE,KAAL,CAAWuB,MADjB;AAEE,mBAAU,gBAFZ;AAGE,kBAAUT,cAAcU,aAH1B;AAIE,sBAAc,KAAKwC,WAAL,CAAiB,KAAKhE,KAAL,CAAWuB,MAAX,CAAkBA,MAAnC,CAJhB;AAKE,iCAAyB,KAAK6B,uBALhC,IADF;AAOD;AACD,WAAO,IAAP;AACD;;AAEDyB,0BAAwB;AACtB,QAAI,KAAK7E,KAAL,CAAW4C,OAAX,CAAmB4B,QAAnB,KAAgC,aAApC,EAAmD;AACjDxQ,aAAOe,QAAP,CAAgB+P,IAAhB,CAAqBC,SAArB,CAA+BC,GAA/B,CAAmC,SAAnC,EAA8C,WAA9C;AACA,aACE;AAAC,+DAAD;AAAA,UAAc,QAAQhR,OAAOe,QAAP,CAAgBC,eAAhB,CAAgCC,IAAtD,EAA4D,UAAUjB,OAAOkB,sBAA7E;AACE,mEAAC,wFAAD;AACE,mBAAS,KAAK4O,WAAL,CAAiB,KAAK9D,KAAL,CAAW4C,OAAX,CAAmB7I,EAApC,CADX;AAEE,oBAAU,KAAKiJ,KAAL,CAAWiC,mBAAX,CAA+B3Q,QAF3C;AAGE,iBAAO,KAAK0O,KAAL,CAAWiC,mBAHpB;AADF,OADF;AAQD;AACD,WAAO,IAAP;AACD;;AAEDC,wBAAsB;AACpB,QAAI,KAAKlF,KAAL,CAAW4C,OAAX,CAAmBY,QAAnB,KAAgC,SAApC,EAA+C;AAC7C,aAAO,IAAP;AACD;;AAED,WACE;AAAA;AAAA,QAAK,WAAU,yBAAf;AACE,2EAAM,WAAU,kCAAhB,GADF;AAEE;AAAA;AAAA;AAAA;AAAA;AAFF,KADF;AAMD;;AAED2B,WAAS;AACP,UAAM,EAACvC,OAAD,EAAUrB,MAAV,KAAoB,KAAKvB,KAA/B;AACA,QAAI,CAAC4C,QAAQ7I,EAAT,IAAe,CAACwH,OAAOiD,QAA3B,EAAqC;AAAE,aAAO,IAAP;AAAc;AACrD,WACE;AAAC,kDAAD,CAAO,QAAP;AAAA;AACG,WAAKU,mBAAL,EADH;AAEG,WAAKL,qBAAL,EAFH;AAGG,WAAKD,gBAAL,EAHH;AAIG,WAAKL,cAAL;AAJH,KADF;AAQD;AA9MwD;;AAiN3D1B,kBAAkBuC,YAAlB,GAAiC,EAACrQ,UAAUf,OAAOe,QAAlB,EAAjC;;AAEO,MAAMZ,eAAN,CAAsB;AAC3B8E,gBAAc;AACZ,SAAK0G,WAAL,GAAmB,KAAnB;AACA,SAAK0F,gBAAL,GAAwB,IAAxB;AACD;;AAEDC,WAAS;AACP,SAAKD,gBAAL,GAAwBrR,OAAOe,QAAP,CAAgBI,cAAhB,CAA+B0L,gBAA/B,CAAxB;AACA,QAAI,CAAC,KAAKwE,gBAAV,EAA4B;AAC1B,WAAKA,gBAAL,GAAwBrR,OAAOe,QAAP,CAAgB2J,aAAhB,CAA8B,KAA9B,CAAxB;AACA,WAAK2G,gBAAL,CAAsBtL,EAAtB,GAA2B8G,gBAA3B;AACA,WAAKwE,gBAAL,CAAsBrG,KAAtB,CAA4BuG,MAA5B,GAAqC,CAArC;AACAvR,aAAOe,QAAP,CAAgB+P,IAAhB,CAAqBU,WAArB,CAAiC,KAAKH,gBAAtC;AACD;;AAEDxQ,oDAAQA,CAACsQ,MAAT,CAAgB,2DAAC,iBAAD,IAAmB,qBAAqB,KAAKM,oBAA7C,GAAhB,EAAuF,KAAKJ,gBAA5F;AACD;;AAEDK,aAAW;AACT7Q,oDAAQA,CAAC8Q,sBAAT,CAAgC,KAAKN,gBAArC;AACD;;AAEDjG,OAAKvL,KAAL,EAAY;AACV,SAAK4R,oBAAL,GAA4B5R,KAA5B;AACA,SAAKyR,MAAL;AACA,SAAK3F,WAAL,GAAmB,IAAnB;AACD;;AAEDC,WAAS;AACP,QAAI,KAAKD,WAAT,EAAsB;AACpB,WAAK+F,QAAL;AACA,WAAK/F,WAAL,GAAmB,KAAnB;AACD;AACF;AAjC0B,C;;;;;;;AC9R7B,2B;;;;;;;ACAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;;AAEA;AACA;;AAEO,MAAMiG,qBAAqB,uBAA3B;AACA,MAAMhF,wBAAwB,8BAA9B;AACA,MAAMD,wBAAwB,8BAA9B;AACA,MAAMkF,uBAAuB,CAACnR,8DAAEA,CAACoR,sBAAJ,EAA4BpR,8DAAEA,CAACqR,gBAA/B,CAA7B;;AAEP;;;;;;;;;;;;;;;;AAgBA,SAASC,iBAAT,CAA2BC,WAA3B,EAAwC;AACtC,SAAO,CAACC,SAAD,EAAYtQ,MAAZ,KAAuB;AAC5B,QAAIA,OAAOnB,IAAP,KAAgBmR,kBAApB,EAAwC;AACtC,+BAAWM,SAAX,EAAyBtQ,OAAOsB,IAAhC;AACD;;AAED,WAAO+O,YAAYC,SAAZ,EAAuBtQ,MAAvB,CAAP;AACD,GAND;AAOD;;AAED;;;AAGA,MAAMuQ,oBAAoBtS,SAASuS,QAAQxQ,UAAU;AACnD,QAAMS,YAAYT,OAAOE,IAAP,IAAeF,OAAOE,IAAP,CAAYO,SAA7C;AACA,MAAIgQ,8DAAEA,CAAClO,YAAH,CAAgBvC,MAAhB,CAAJ,EAA6B;AAC3BuL,wBAAoBP,qBAApB,EAA2ChL,MAA3C;AACD;AACD,MAAI,CAACS,SAAL,EAAgB;AACd+P,SAAKxQ,MAAL;AACD;AACF,CARD;;AAUO,MAAM0Q,wBAAwBzS,SAASuS,QAAQxQ,UAAU;AAC9D,MAAI/B,MAAM0S,aAAV,EAAyB;AACvB,WAAOH,KAAKxQ,MAAL,CAAP;AACD;;AAED,QAAM4Q,qBAAqB5Q,OAAOnB,IAAP,KAAgBmR,kBAA3C;AACA,QAAMa,uBAAuB7Q,OAAOnB,IAAP,KAAgBC,8DAAEA,CAACC,qBAAhD;;AAEA,MAAI8R,oBAAJ,EAA0B;AACxB5S,UAAM6S,uBAAN,GAAgC,IAAhC;AACA,WAAON,KAAKxQ,MAAL,CAAP;AACD;;AAED,MAAI4Q,kBAAJ,EAAwB;AACtB3S,UAAM0S,aAAN,GAAsB,IAAtB;AACA,WAAOH,KAAKxQ,MAAL,CAAP;AACD;;AAED;AACA,MAAI/B,MAAM6S,uBAAN,IAAiC9Q,OAAOnB,IAAP,KAAgBC,8DAAEA,CAACiS,IAAxD,EAA8D;AAC5D,WAAOP,KAAK7R,iEAAEA,CAACC,UAAH,CAAc,EAACC,MAAMC,8DAAEA,CAACC,qBAAV,EAAd,CAAL,CAAP;AACD;;AAED,MAAI0R,8DAAEA,CAACjO,oBAAH,CAAwBxC,MAAxB,KAAmCyQ,8DAAEA,CAAChO,kBAAH,CAAsBzC,MAAtB,CAAnC,IAAoEyQ,8DAAEA,CAAC/N,iBAAH,CAAqB1C,MAArB,CAAxE,EAAsG;AACpG;AACA;AACA;AACA,WAAO,IAAP;AACD;;AAED,SAAOwQ,KAAKxQ,MAAL,CAAP;AACD,CA/BM;;AAiCP;;;;;;;AAOO,MAAMgR,8BAA8B/S,SAASuS,QAAQxQ,UAAU;AACpE,MAAI/B,MAAMgT,iBAAV,EAA6B;AAC3BT,SAAKxQ,MAAL;AACD,GAFD,MAEO,IAAIyQ,8DAAEA,CAAC9N,UAAH,CAAc3C,MAAd,CAAJ,EAA2B;AAChCwQ,SAAKxQ,MAAL;AACA/B,UAAMgT,iBAAN,GAA0B,IAA1B;AACA;AACA,QAAIhT,MAAMiT,iBAAV,EAA6B;AAC3BjT,YAAMiT,iBAAN,CAAwB5Q,OAAxB,CAAgCkQ,IAAhC;AACAvS,YAAMiT,iBAAN,GAA0B,EAA1B;AACD;AACF,GARM,MAQA,IAAIjB,qBAAqB7L,QAArB,CAA8BpE,OAAOnB,IAArC,CAAJ,EAAgD;AACrDZ,UAAMiT,iBAAN,GAA0BjT,MAAMiT,iBAAN,IAA2B,EAArD;AACAjT,UAAMiT,iBAAN,CAAwB7M,IAAxB,CAA6BrE,MAA7B;AACD,GAHM,MAGA;AACL;AACAwQ,SAAKxQ,MAAL;AACD;AACF,CAlBM;;AAoBP;;;;;;;AAOO,SAAS9B,SAAT,CAAmBC,QAAnB,EAA6BgT,YAA7B,EAA2C;AAChD,QAAMlT,QAAQmT,yDAAWA,CACvBhB,kBAAkBiB,6DAAeA,CAAClT,QAAhB,CAAlB,CADY,EAEZgT,YAFY,EAGZ/S,OAAO0G,qBAAP,IAAgCwM,6DAAeA,CAACZ,qBAAhB,EAAuCM,2BAAvC,EAAoET,iBAApE,CAHpB,CAAd;;AAMAtS,QAAM0S,aAAN,GAAsB,KAAtB;AACA1S,QAAM6S,uBAAN,GAAgC,KAAhC;;AAEA,MAAI1S,OAAO0G,qBAAX,EAAkC;AAChC1G,WAAO0G,qBAAP,CAA6BiG,qBAA7B,EAAoD9B,OAAO;AACzD,UAAI;AACFhL,cAAMS,QAAN,CAAeuK,IAAI3H,IAAnB;AACD,OAFD,CAEE,OAAOiQ,EAAP,EAAW;AACX7K,gBAAQX,KAAR,CAAc,cAAd,EAA8BkD,GAA9B,EAAmC,kBAAnC,EAAuDsI,EAAvD,EADW,CACiD;AAC5DC,aAAM,gBAAeC,KAAKC,SAAL,CAAezI,GAAf,CAAoB,qBAAoBsI,EAAG,KAAIA,GAAGI,KAAM,EAA7E;AACD;AACF,KAPD;AAQD;;AAED,SAAO1T,KAAP;AACD,C;;;;;;;AC1ID,uB;;;;;;;ACAA;AAAA;AAAA;AAAA;AAAA;;AAEA;;;;;AAKA,MAAM2T,mBAAmB;AACvB,UAAQ,CAAC,MAAD,EAAS,aAAT,CADe;AAEvB,kBAAgB,cAFO;AAGvB,gBAAc,YAHS;AAIvB,iBAAe,aAJQ;AAKvB,kBAAgB,qBALO;AAMvB,qBAAmB;AANI,CAAzB;;AASO,MAAMC,iBAAiBpI,OAAOE,IAAP,CAAYiI,gBAAZ,CAAvB;;AAEP;;;;;;AAMO,SAAS7C,gBAAT,CAA0Bf,OAA1B,EAAmC;AACxC,QAAM8D,KAAK,IAAIC,qDAAJ,CAAmB,OAAnB,CAAX;;AAEAF,iBAAevR,OAAf,CAAuBmD,OAAO;AAC5B,UAAMuO,QAAQJ,iBAAiBnO,GAAjB,CAAd;AACA,UAAMwO,aAAaC,MAAMC,OAAN,CAAcH,KAAd,IAAuB,CAAC,GAAGA,KAAJ,CAAvB,GAAoC,CAACA,KAAD,CAAvD;AACA,QAAII,SAAS,EAAb;AACA,WAAO,CAACA,MAAD,IAAWH,WAAWI,MAA7B,EAAqC;AACnC,YAAMC,OAAOL,WAAWM,GAAX,EAAb;AACAH,eAASpE,QAAQsE,IAAR,CAAT;AACD;AACDR,OAAGU,WAAH,CAAgB,GAAE/O,GAAI,MAAK2O,MAAO,EAAlC;AACD,GATD;AAUA,SAAO,CAACN,EAAD,CAAP;AACD,C;;;;;;;ACtCD;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;;AAEO,MAAMW,UAAU,SAAhB;AACA,MAAMC,0BAA0B,kBAAhC;;AAEP;;;AAGO,MAAMC,kBAAN,SAAiCzF,4CAAKA,CAACC,aAAvC,CAAqD;AAC1D;AACA;AACA;AACAyF,gCAA8B;AAC5B,QAAI,KAAKxF,KAAL,CAAWjO,QAAX,CAAoB0T,eAApB,KAAwCJ,OAA5C,EAAqD;AACnD,WAAKrF,KAAL,CAAWG,cAAX,CAA0B,EAACpJ,IAAI,KAAKiJ,KAAL,CAAWjJ,EAAhB,EAA1B;AACD,KAFD,MAEO;AACL;AACA;AACA,UAAI,KAAK2O,mBAAT,EAA8B;AAC5B,aAAK1F,KAAL,CAAWjO,QAAX,CAAoB4T,mBAApB,CAAwCL,uBAAxC,EAAiE,KAAKI,mBAAtE;AACD;;AAED;AACA,WAAKA,mBAAL,GAA2B,MAAM;AAC/B,YAAI,KAAK1F,KAAL,CAAWjO,QAAX,CAAoB0T,eAApB,KAAwCJ,OAA5C,EAAqD;AACnD,eAAKrF,KAAL,CAAWG,cAAX,CAA0B,EAACpJ,IAAI,KAAKiJ,KAAL,CAAWjJ,EAAhB,EAA1B;AACA,eAAKiJ,KAAL,CAAWjO,QAAX,CAAoB4T,mBAApB,CAAwCL,uBAAxC,EAAiE,KAAKI,mBAAtE;AACD;AACF,OALD;AAMA,WAAK1F,KAAL,CAAWjO,QAAX,CAAoB6T,gBAApB,CAAqCN,uBAArC,EAA8D,KAAKI,mBAAnE;AACD;AACF;;AAEDpE,yBAAuB;AACrB,QAAI,KAAKoE,mBAAT,EAA8B;AAC5B,WAAK1F,KAAL,CAAWjO,QAAX,CAAoB4T,mBAApB,CAAwCL,uBAAxC,EAAiE,KAAKI,mBAAtE;AACD;AACF;;AAEDrE,sBAAoB;AAClB,QAAI,KAAKrB,KAAL,CAAW6F,WAAf,EAA4B;AAC1B,WAAKL,2BAAL;AACD;AACF;;AAEDM,qBAAmBnG,SAAnB,EAA8B;AAC5B,QAAI,KAAKK,KAAL,CAAWP,4BAAX,CAAwC,KAAKO,KAA7C,EAAoDL,SAApD,CAAJ,EAAoE;AAClE,WAAK6F,2BAAL;AACD;AACF;;AAEDrD,WAAS;AACP,WAAO,KAAKnC,KAAL,CAAW+F,QAAlB;AACD;AA7CyD;;AAgD5DR,mBAAmBnD,YAAnB,GAAkC;AAChCrQ,YAAUf,OAAOe,QADe;AAEhC8T,eAAa;AAFmB,CAAlC,C;;;;;;;ACxDA,uB;;;;;;ACAA,2B;;;;;;;;;;;;;;ACAA;AACA;;AAEA,MAAMG,cAAN,SAA6BlG,4CAAKA,CAACC,aAAnC,CAAiD;AAC/C9J,cAAY+J,KAAZ,EAAmB;AACjB,UAAMA,KAAN;AACA,SAAKiG,OAAL,GAAe,KAAKA,OAAL,CAAahM,IAAb,CAAkB,IAAlB,CAAf;AACD;;AAEDgM,YAAU;AACR,UAAM,EAACjG,KAAD,KAAU,IAAhB;AACA,UAAMlB,OAAO;AACXrG,aAAO,cADI;AAEX6H,kBAAYN,MAAMjJ,EAFP;AAGXA,UAAIiJ,MAAMkG;AAHC,KAAb;AAKAlG,UAAMI,uBAAN,CAA8BtB,IAA9B;AACAkB,UAAMmG,QAAN,CAAenG,MAAMY,OAAN,CAAcnC,aAA7B;AACD;;AAED0D,WAAS;AACP,UAAM,EAACvB,OAAD,KAAY,KAAKZ,KAAvB;AACA,WACE;AAAA;AAAA,QAAK,WAAU,mBAAf;AACE,0EAAK,WAAY,0BAAyBY,QAAQwF,IAAK,EAAvD,GADF;AAEE;AAAA;AAAA,UAAK,WAAU,mBAAf;AACE;AAAA;AAAA;AACE;AAAA;AAAA;AAAA;AAAMxF,oBAAQyF,KAAd;AAAA;AAAA,WADF;AAEE;AAAA;AAAA;AAAA;AAAKzF,oBAAQ5F,IAAb;AAAA;AAAA;AAFF,SADF;AAKE;AAAA;AAAA;AACE;AAAA;AAAA,cAAQ,UAAS,GAAjB,EAAqB,WAAU,yBAA/B,EAAyD,SAAS,KAAKiL,OAAvE;AAAA;AAAkFrF,oBAAQ0F,YAA1F;AAAA;AAAA;AADF;AALF;AAFF,KADF;AAcD;AAjC8C;;AAoC1C,MAAMC,iBAAN,SAAgCzG,4CAAKA,CAACC,aAAtC,CAAoD;AACzDoC,WAAS;AACP,UAAM,EAACnC,KAAD,KAAU,IAAhB;AACA,UAAM,EAACsG,YAAD,EAAeE,MAAf,KAAyBxG,MAAMyG,oBAArC;AACA,WACE;AAAC,wFAAD;AAAA,mBAAkBzG,KAAlB,IAAyB,cAAcsG,YAAvC,EAAqD,OAAOE,MAA5D;AACE;AAAA;AAAA,UAAK,WAAU,4BAAf;AACGxG,cAAMzB,MAAN,CAAamI,GAAb,CAAiB9G,WAChB,2DAAC,cAAD,aAAgB,KAAKA,QAAQ7I,EAA7B;AACE,mCAAyBiJ,MAAMI,uBADjC;AAEE,oBAAUJ,MAAMmG,QAFlB;AAGE,qBAAWnG,MAAMkG;AAHnB,WAIMtG,OAJN,EADD;AADH;AADF,KADF;AAaD;AAjBwD,C;;;;;;;ACvC3D;AAAA;AAAA;AAAA;AAAA;;AAEO,MAAM+G,YAAN,SAA2B7G,4CAAKA,CAACC,aAAjC,CAA+C;AACpDmB,uBAAqB;AACnB,SAAKD,QAAL,CAAc,EAAC2F,QAAQ,IAAT,EAAd;AACA7U,aAAS+P,IAAT,CAAcC,SAAd,CAAwBC,GAAxB,CAA4B,YAA5B;AACD;;AAEDV,yBAAuB;AACrBvP,aAAS+P,IAAT,CAAcC,SAAd,CAAwB8E,MAAxB,CAA+B,YAA/B;AACA,SAAK5F,QAAL,CAAc,EAAC2F,QAAQ,KAAT,EAAd;AACD;;AAEDzE,WAAS;AACP,UAAM,EAACyE,MAAD,KAAW,KAAK5J,KAAtB;AACA,UAAM,EAACqJ,KAAD,EAAQC,YAAR,KAAwB,KAAKtG,KAAnC;AACA,WACE;AAAA;AAAA;AACE,0EAAK,WAAY,qBAAoB4G,SAAS,QAAT,GAAoB,EAAG,EAA5D,GADF;AAEE;AAAA;AAAA,UAAK,WAAY,qBAAoBA,SAAS,QAAT,GAAoB,EAAG,EAA5D;AACE;AAAA;AAAA;AAAA;AAAMP,eAAN;AAAA;AAAA,SADF;AAEG,aAAKrG,KAAL,CAAW+F,QAFd;AAGE;AAAA;AAAA,YAAK,WAAU,QAAf;AACE;AAAA;AAAA,cAAQ,UAAS,GAAjB,EAAqB,SAAS,KAAK/F,KAAL,CAAW8G,YAAzC,EAAuD,WAAU,4BAAjE;AAAA;AAAgGR,wBAAhG;AAAA;AAAA;AADF;AAHF;AAFF,KADF;AAYD;AA1BmD,C;;;;;;ACFtD,0B;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;ACAA;AACA;AACA;AACA;;AAEO,MAAMS,eAAN,SAA8BjH,4CAAKA,CAACC,aAApC,CAAkD;AACvD9J,cAAY+J,KAAZ,EAAmB;AACjB,UAAMA,KAAN;AACA,SAAKgH,aAAL,GAAqB,KAAKA,aAAL,CAAmB/M,IAAnB,CAAwB,IAAxB,CAArB;AACA,SAAKgN,QAAL,GAAgB,KAAKA,QAAL,CAAchN,IAAd,CAAmB,IAAnB,CAAhB;AACA,SAAKiN,SAAL,GAAiB,KAAKA,SAAL,CAAejN,IAAf,CAAoB,IAApB,CAAjB;AACA,SAAKkN,SAAL,GAAiB,KAAKA,SAAL,CAAelN,IAAf,CAAoB,IAApB,CAAjB;AACA,SAAKmN,aAAL,GAAqB,KAAKA,aAAL,CAAmBnN,IAAnB,CAAwB,IAAxB,CAArB;AACA,SAAKoN,cAAL,GAAsB,KAAKA,cAAL,CAAoBpN,IAApB,CAAyB,IAAzB,CAAtB;;AAEA,SAAK+C,KAAL,GAAa;AACXsK,kBAAY,EADD;AAEXC,sBAAgB,KAFL;AAGXC,cAAQ,EAHG;AAIXC,qBAAe;AAJJ,KAAb;AAMA,SAAKC,QAAL,GAAgB,KAAhB;AACD;;AAEKC,qBAAN,GAA4B;AAAA;;AAAA;AAC1B,UAAI,MAAK3H,KAAL,CAAW4H,YAAX,IAA2B,CAAC,MAAKF,QAArC,EAA+C;AAC7C,YAAI;AACF,gBAAKA,QAAL,GAAgB,IAAhB;AACA,gBAAMG,YAAY,sGAAlB;AACA,gBAAMjN,WAAW,MAAMC,MAAO,GAAE,MAAKmF,KAAL,CAAW4H,YAAa,iBAAgBC,SAAU,EAA3D,CAAvB;AACA,cAAIjN,SAASE,MAAT,KAAoB,GAAxB,EAA6B;AAC3B,kBAAM,EAAC0M,MAAD,EAASC,aAAT,KAA0B,MAAM7M,SAASkN,IAAT,EAAtC;AACA,kBAAK7G,QAAL,CAAc,EAACuG,MAAD,EAASC,aAAT,EAAd;AACD,WAHD,MAGO;AACL,kBAAKzH,KAAL,CAAW1O,QAAX,CAAoBC,iEAAEA,CAACiC,UAAH,CAAc,EAAC/B,MAAMC,8DAAEA,CAAC8C,yBAAV,EAAqCN,MAAM,EAACuE,OAAO,yBAAR,EAAmC1D,OAAO6F,SAASE,MAAnD,EAA3C,EAAd,CAApB;AACD;AACF,SAVD,CAUE,OAAOnC,KAAP,EAAc;AACd,gBAAKqH,KAAL,CAAW1O,QAAX,CAAoBC,iEAAEA,CAACiC,UAAH,CAAc,EAAC/B,MAAMC,8DAAEA,CAAC8C,yBAAV,EAAqCN,MAAM,EAACuE,OAAO,mBAAR,EAA3C,EAAd,CAApB;AACD;AACF;AAfyB;AAgB3B;;AAED4I,sBAAoB;AAClB,SAAK8F,SAAL;AACD;;AAEDA,cAAY;AACV;AACA;AACAY,eAAW,MAAM;AACf,WAAK9G,QAAL,CAAc,EAAC+G,MAAM,IAAP,EAAd;AACD,KAFD,EAEG,EAFH;AAGD;;AAEDZ,kBAAgB;AACd5K,WAAOmJ,mBAAP,CAA2B,kBAA3B,EAA+C,KAAKyB,aAApD;AACArV,aAAS+P,IAAT,CAAcC,SAAd,CAAwB8E,MAAxB,CAA+B,WAA/B;AACA,SAAK5F,QAAL,CAAc,EAAC+G,MAAM,KAAP,EAAd;AACA,SAAKhI,KAAL,CAAWiI,OAAX;AACAF,eAAW,MAAM;AACf;AACAhW,eAAS+P,IAAT,CAAcC,SAAd,CAAwB8E,MAAxB,CAA+B,SAA/B;AACA,WAAK5F,QAAL,CAAc,EAACsG,gBAAgB,IAAjB,EAAd;AACD,KAJD,EAIG,GAJH;AAKD;;AAEDP,gBAAc/L,CAAd,EAAiB;AACf,QAAItC,QAAQsC,EAAEtH,MAAF,CAASuU,eAArB;AACA,SAAKjH,QAAL,CAAc,EAACqG,YAAYrM,EAAEtH,MAAF,CAASoB,KAAtB,EAAd;AACA4D,UAAMoJ,SAAN,CAAgB8E,MAAhB,CAAuB,QAAvB;AACA5L,MAAEtH,MAAF,CAASoO,SAAT,CAAmB8E,MAAnB,CAA0B,SAA1B;AACD;;AAEDI,aAAW;AACT,SAAKjH,KAAL,CAAW1O,QAAX,CAAoBC,iEAAEA,CAAC0C,SAAH,iBAAcwE,OAAO,cAArB,IAAwC,KAAK0P,YAAL,EAAxC,EAApB;;AAEA3L,WAAOoJ,gBAAP,CAAwB,kBAAxB,EAA4C,KAAKwB,aAAjD;AACD;;AAEDF,cAAY;AACV,SAAKlH,KAAL,CAAW1O,QAAX,CAAoBC,iEAAEA,CAAC0C,SAAH,iBAAcwE,OAAO,gBAArB,IAA0C,KAAK0P,YAAL,EAA1C,EAApB;AACA,SAAKf,aAAL;AACD;;AAED;;;AAGAe,iBAAe;AACb,UAAMpT,QAAQ,EAACqT,iBAAiB,KAAKpL,KAAL,CAAWwK,MAAX,CAAkBvC,MAAlB,GAA2B,CAA7C,EAAd;AACA,WAAO,EAAClQ,KAAD,EAAP;AACD;;AAEDsS,iBAAepM,CAAf,EAAkB;AAChB,QAAItC,QAAQsC,EAAEtH,MAAF,CAASuU,eAArB;AACAvP,UAAMoJ,SAAN,CAAgBC,GAAhB,CAAoB,QAApB;AACA/G,MAAEtH,MAAF,CAASoO,SAAT,CAAmBC,GAAnB,CAAuB,SAAvB;AACA/G,MAAEoN,cAAF,GAJgB,CAII;AACpBpN,MAAEtH,MAAF,CAAS2U,KAAT;AACD;;AAEDnG,WAAS;AACP;AACA;AACA,QAAI,KAAKnF,KAAL,CAAWuK,cAAf,EAA+B;AAC7B,aAAO,IAAP;AACD;;AAED,QAAIgB,YAAa;AAAA;AAAA,QAAG,MAAO,GAAE,KAAKvI,KAAL,CAAW4H,YAAa,cAApC,EAAmD,QAAO,QAA1D,EAAmE,KAAI,qBAAvE;AAA6F,iEAAC,2DAAD,IAAkB,IAAG,2BAArB;AAA7F,KAAjB;AACA,QAAIY,cAAe;AAAA;AAAA,QAAG,MAAO,GAAE,KAAKxI,KAAL,CAAW4H,YAAa,gBAApC,EAAqD,QAAO,QAA5D,EAAqE,KAAI,qBAAzE;AAA+F,iEAAC,2DAAD,IAAkB,IAAG,yBAArB;AAA/F,KAAnB;;AAEA,WACE;AAAA;AAAA,QAAK,WAAY,mBAAkB,KAAK5K,KAAL,CAAWgL,IAAX,GAAkB,MAAlB,GAA2B,EAAG,EAAjE;AACE,0EAAK,WAAU,YAAf,GADF;AAEE;AAAA;AAAA,UAAK,WAAU,gBAAf;AACE;AAAA;AAAA,YAAK,WAAU,sBAAf;AACE;AAAA;AAAA,cAAK,WAAU,uBAAf;AACE;AAAA;AAAA,gBAAI,WAAU,gBAAd;AAA+B,yEAAC,2DAAD,IAAkB,IAAG,gBAArB;AAA/B,aADF;AAEE;AAAA;AAAA,gBAAG,WAAU,kBAAb;AAAgC,yEAAC,2DAAD,IAAkB,IAAG,kBAArB;AAAhC,aAFF;AAGE;AAAA;AAAA,gBAAG,WAAU,eAAb,EAA6B,MAAK,gDAAlC,EAAmF,QAAO,QAA1F,EAAmG,KAAI,qBAAvG;AAA6H,yEAAC,2DAAD,IAAkB,IAAG,0BAArB;AAA7H;AAHF,WADF;AAME;AAAA;AAAA,cAAK,WAAU,kBAAf;AACE;AAAA;AAAA,gBAAG,WAAU,aAAb;AAA2B,yEAAC,2DAAD,IAAkB,IAAG,sBAArB,GAA3B;AAAyE;AAAA;AAAA,kBAAM,WAAU,YAAhB;AAA6B,2EAAC,2DAAD,IAAkB,IAAG,0BAArB;AAA7B;AAAzE,aADF;AAEE;AAAA;AAAA,gBAAM,QAAO,KAAb,EAAmB,QAAQ,KAAKhI,KAAL,CAAW4H,YAAtC,EAAoD,QAAO,QAA3D,EAAoE,KAAI,qBAAxE,EAA8F,UAAU,KAAKX,QAA7G;AACE,oFAAO,MAAK,SAAZ,EAAsB,MAAK,QAA3B,EAAoC,OAAM,MAA1C,GADF;AAEE,oFAAO,MAAK,QAAZ,EAAqB,MAAK,QAA1B,EAAmC,OAAM,OAAzC,GAFF;AAGE,oFAAO,MAAK,SAAZ,EAAsB,MAAK,QAA3B,EAAoC,OAAM,eAA1C,GAHF;AAIE,oFAAO,MAAK,YAAZ,EAAyB,MAAK,QAA9B,EAAuC,OAAM,0BAA7C,GAJF;AAKE,oFAAO,MAAK,YAAZ,EAAyB,MAAK,QAA9B,EAAuC,OAAM,iBAA7C,GALF;AAME,oFAAO,MAAK,cAAZ,EAA2B,MAAK,QAAhC,EAAyC,OAAM,UAA/C,GANF;AAOE,oFAAO,MAAK,SAAZ,EAAsB,MAAK,QAA3B,EAAoC,OAAO,KAAKjK,KAAL,CAAWwK,MAAtD,GAPF;AAQE,oFAAO,MAAK,iBAAZ,EAA8B,MAAK,QAAnC,EAA4C,OAAO,KAAKxK,KAAL,CAAWyK,aAA9D,GARF;AASE;AAAA;AAAA,kBAAM,WAAU,OAAhB;AAAyB,qBAAKzH,KAAL,CAAWyI,IAAX,CAAgBC,aAAhB,CAA8B,EAAC3R,IAAI,wBAAL,EAA9B;AAAzB,eATF;AAUE,oFAAO,WAAU,aAAjB,EAA+B,MAAK,OAApC,EAA4C,MAAK,OAAjD,EAAyD,UAAS,MAAlE,EAAyE,WAAW,KAAKsQ,cAAzF,EAAyG,aAAa,KAAKrH,KAAL,CAAWyI,IAAX,CAAgBC,aAAhB,CAA8B,EAAC3R,IAAI,kCAAL,EAA9B,CAAtH,EAA+L,UAAU,KAAKiQ,aAA9M,GAVF;AAWE;AAAA;AAAA,kBAAK,WAAU,aAAf;AACE,2EAAC,2DAAD;AACE,sBAAG,4BADL;AAEE,0BAAQ;AACN2B,2BAAOJ,SADD;AAENK,6BAASJ;AAFH,mBAFV;AADF,eAXF;AAmBE;AAAA;AAAA,kBAAQ,WAAU,iBAAlB,EAAoC,MAAK,QAAzC;AAAkD,2EAAC,2DAAD,IAAkB,IAAG,4BAArB;AAAlD;AAnBF,aAFF;AAuBE;AAAA;AAAA,gBAAQ,WAAU,aAAlB,EAAgC,UAAU,CAAC,CAAC,KAAKxL,KAAL,CAAWsK,UAAvD,EAAmE,SAAS,KAAKJ,SAAjF;AAA4F,yEAAC,2DAAD,IAAkB,IAAG,qBAArB;AAA5F;AAvBF;AANF;AADF;AAFF,KADF;AAuCD;AAhJsD;;AAmJzD,MAAMjK,WAAWD,UAAU,EAAC4K,cAAc5K,MAAME,KAAN,CAAYC,MAAZ,CAAmByK,YAAlC,EAAV,CAAjB;AACO,MAAMiB,iBAAiB5Q,2DAAOA,CAACgF,QAAR,EAAkB6L,6DAAUA,CAAC/B,eAAX,CAAlB,CAAvB,C;;;;;;ACzJP,4B;;;;;;;ACAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA,MAAMgC,cAAcD,6DAAUA,CAAC9I,SAC7B;AAAA;AAAA,IAAK,WAAU,cAAf;AACE,yEAAQ,WAAU,oBAAlB,EAAuC,SAASA,MAAMiG,OAAtD,EAA+D,OAAOjG,MAAMyI,IAAN,CAAWC,aAAX,CAAyB,EAAC3R,IAAI,4BAAL,EAAzB,CAAtE;AADF,CADkB,CAApB;;AAMA;AACA;AACA;AACA,SAASiS,yBAAT,CAAmCC,MAAnC,EAA2C;AACzC9H,kEAAaA,CAAC,CAAC,EAAC8H,MAAD,EAASC,cAAc,IAAvB,EAAD,CAAd;AACD;;AAED;AACA;AACA,SAASC,QAAT,CAAkBC,IAAlB,EAAwBC,IAAxB,EAA8B;AAC5B,MAAIC,KAAJ;AACA,SAAO,CAAC,GAAG3I,IAAJ,KAAa;AAClB,QAAI2I,KAAJ,EAAW;AAAE;AAAS;;AAEtB,QAAIC,SAAS,MAAM;AAAED,cAAQ,IAAR;AAAe,KAApC;;AAEAA,YAAQvB,WAAWwB,MAAX,EAAmBF,IAAnB,CAAR;AACAD,SAAKI,KAAL,CAAW,IAAX,EAAiB7I,IAAjB;AACD,GAPD;AAQD;;AAEM,MAAM8I,KAAN,SAAoB3J,4CAAKA,CAACC,aAA1B,CAAwC;AAC7CmB,uBAAqB;AACnB,UAAM,EAAC+H,MAAD,KAAW,KAAKjJ,KAAtB;AACAgJ,8BAA0BC,MAA1B;AACD;;AAED5H,sBAAoB;AAClB;AACA;AACA;AACA,QAAI,KAAKrB,KAAL,CAAW0J,aAAf,EAA8B;AAC5B,WAAK1J,KAAL,CAAW1O,QAAX,CAAoBC,iEAAEA,CAACC,UAAH,CAAc,EAACC,MAAMC,8DAAEA,CAACC,qBAAV,EAAd,CAApB;AACA,WAAKqO,KAAL,CAAW1O,QAAX,CAAoBC,iEAAEA,CAACC,UAAH,CAAc,EAACC,MAAMC,8DAAEA,CAACqR,gBAAV,EAAd,CAApB;AACD;AACF;;AAEDzB,yBAAuB;AACrB,SAAKqI,WAAL;AACD;;AAEDhC,wBAAsB;AACpB,SAAKgC,WAAL;AACD;;AAEDA,gBAAc;AACZ,UAAMC,gBAAgB,CACpB,iBADoB;AAEpB;AACA;AACA7X,aAAS+P,IAAT,CAAcC,SAAd,CAAwB5I,QAAxB,CAAiC,SAAjC,IAA8C,SAA9C,GAA0D,EAJtC,EAKpBpH,SAAS+P,IAAT,CAAcC,SAAd,CAAwB5I,QAAxB,CAAiC,WAAjC,IAAgD,WAAhD,GAA8D,EAL1C,EAMpB0Q,MANoB,CAMbC,KAAKA,CANQ,EAMLC,IANK,CAMA,GANA,CAAtB;AAOA/Y,WAAOe,QAAP,CAAgB+P,IAAhB,CAAqBkI,SAArB,GAAiCJ,aAAjC;AACD;;AAEDzH,WAAS;AACP,UAAM,EAACnC,KAAD,KAAU,IAAhB;AACA,UAAM,EAACiK,GAAD,EAAMhB,MAAN,EAAciB,OAAd,KAAyBlK,KAA/B;AACA,UAAM,EAACrD,WAAD,KAAgBsN,GAAtB;;AAEA,UAAME,QAAQnK,MAAM9C,KAAN,CAAYC,MAA1B;AACA,QAAIgN,MAAM,0BAAN,CAAJ,EAAuC;AACrC,UAAI3N,OAAOgB,QAAP,CAAgBE,IAAhB,KAAyB,WAA7B,EAA0C;AACxC,eAAQ,2DAAC,gGAAD,OAAR;AACD;AACDpE,cAAQ6C,GAAR,CAAY,oEAAZ,EAAkF,mBAAlF,EAJqC,CAImE;AACzG;;AAED,QAAI,CAAC6D,MAAM0J,aAAP,IAAwB,CAAC/M,WAA7B,EAA0C;AACxC,aAAO,IAAP;AACD;;AAED,WAAQ;AAAC,6DAAD;AAAA,QAAc,QAAQsM,MAAtB,EAA8B,UAAUiB,OAAxC;AACJ;AAAC,wGAAD;AAAA,UAAe,WAAU,uBAAzB;AACE,mEAAC,WAAD,EAAiB,KAAKlK,KAAtB;AADF;AADI,KAAR;AAKD;AAzD4C;;AA4DxC,MAAMoK,WAAN,SAA0BtK,4CAAKA,CAACC,aAAhC,CAA8C;AACnD9J,cAAY+J,KAAZ,EAAmB;AACjB,UAAMA,KAAN;AACA,SAAKqK,eAAL,GAAuB,KAAKA,eAAL,CAAqBpQ,IAArB,CAA0B,IAA1B,CAAvB;AACA,SAAKqQ,cAAL,GAAsBnB,SAAS,KAAKmB,cAAL,CAAoBrQ,IAApB,CAAyB,IAAzB,CAAT,EAAyC,CAAzC,CAAtB;AACA,SAAK+C,KAAL,GAAa,EAACuN,aAAa,KAAd,EAAb;AACD;;AAEDlJ,sBAAoB;AAClBrQ,WAAO4U,gBAAP,CAAwB,QAAxB,EAAkC,KAAK0E,cAAvC;AACD;;AAEDhJ,yBAAuB;AACrBtQ,WAAO2U,mBAAP,CAA2B,QAA3B,EAAqC,KAAK2E,cAA1C;AACD;;AAEDA,mBAAiB;AACf,UAAME,mBAAmB,EAAzB;AACA,QAAIxZ,OAAOyZ,OAAP,GAAiBD,gBAAjB,IAAqC,CAAC,KAAKxN,KAAL,CAAWuN,WAArD,EAAkE;AAChE,WAAKtJ,QAAL,CAAc,EAACsJ,aAAa,IAAd,EAAd;AACD,KAFD,MAEO,IAAIvZ,OAAOyZ,OAAP,IAAkBD,gBAAlB,IAAsC,KAAKxN,KAAL,CAAWuN,WAArD,EAAkE;AACvE,WAAKtJ,QAAL,CAAc,EAACsJ,aAAa,KAAd,EAAd;AACD;AACF;;AAEDF,oBAAkB;AAChB,SAAKrK,KAAL,CAAW1O,QAAX,CAAoBC,iEAAEA,CAACiC,UAAH,CAAc,EAAC/B,MAAMC,8DAAEA,CAACgZ,aAAV,EAAd,CAApB;AACA,SAAK1K,KAAL,CAAW1O,QAAX,CAAoBC,iEAAEA,CAAC0C,SAAH,CAAa,EAACwE,OAAO,mBAAR,EAAb,CAApB;AACD;;AAED0J,WAAS;AACP,UAAM,EAACnC,KAAD,KAAU,IAAhB;AACA,UAAM,EAACiK,GAAD,KAAQjK,KAAd;AACA,UAAM,EAACrD,WAAD,KAAgBsN,GAAtB;AACA,UAAME,QAAQnK,MAAM9C,KAAN,CAAYC,MAA1B;;AAEA,UAAMwN,qBAAqBC,sEAAaA,CAACC,aAAd,CAA4B/V,QAAQqV,MAAMrV,IAAN,CAApC,CAA3B;AACA,UAAMgW,oBAAoB,CAACX,MAAM,gBAAN,CAAD,IAA4BnK,MAAM+K,QAAN,CAAelB,MAAf,CAAsBmB,WAAWA,QAAQC,OAAzC,EAAkDhG,MAAlD,KAA6D,CAAnH;;AAEA,UAAMiG,iBAAiB,CACrB,eADqB,EAErBP,sBAAsB,cAFD,EAGrBR,MAAMgB,UAAN,IAAoB,KAAKnO,KAAL,CAAWuN,WAA/B,IAA8C,CAACO,iBAA/C,IAAoE,cAH/C,EAIrBX,MAAMgB,UAAN,IAAoBL,iBAApB,IAAyC,aAJpB,EAKrBjB,MALqB,CAKdC,KAAKA,CALS,EAKNC,IALM,CAKD,GALC,CAAvB;;AAOA,WACE;AAAA;AAAA;AACE;AAAA;AAAA,UAAK,WAAWmB,cAAhB;AACE;AAAA;AAAA;AACGf,gBAAMgB,UAAN,IACC;AAAA;AAAA,cAAK,WAAU,yBAAf;AACE;AAAC,8GAAD;AAAA;AACE,yEAAC,2EAAD,IAAQ,UAAUL,iBAAlB;AADF;AADF,WAFJ;AAQE;AAAA;AAAA,cAAK,WAAY,eAAenO,cAAc,KAAd,GAAsB,EAAI,EAA1D;AACG,aAACwN,MAAMiB,gBAAP,IACC;AAAA;AAAA,gBAAK,WAAU,yBAAf;AACE,yEAAC,sGAAD;AADF,aAFJ;AAME,uEAAC,kFAAD,OANF;AAOE,uEAAC,WAAD,IAAa,SAAS,KAAKf,eAA3B;AAPF,WARF;AAiBE,qEAAC,gGAAD;AAjBF;AADF;AADF,KADF;AAwBD;AAtEkD;;AAyE9C,MAAMgB,OAAOpT,2DAAOA,CAAC+E,UAAU,EAACiN,KAAKjN,MAAMiN,GAAZ,EAAiB/M,OAAOF,MAAME,KAA9B,EAAqC6N,UAAU/N,MAAM+N,QAArD,EAAV,CAAR,EAAmFtB,KAAnF,CAAb,C;;;;;;;;AC5KP;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AACA;AACA;;AAEO,MAAM6B,aAAN,SAA4BxL,4CAAKA,CAACC,aAAlC,CAAgD;AACrD9J,cAAY+J,KAAZ,EAAmB;AACjB,UAAMA,KAAN;AACA,SAAKrI,SAAL,GAAiB,KAAKA,SAAL,CAAesC,IAAf,CAAoB,IAApB,CAAjB;AACA,SAAKsR,mBAAL,GAA2B,KAAKA,mBAAL,CAAyBtR,IAAzB,CAA8B,IAA9B,CAA3B;AACA,SAAKuR,oBAAL,GAA4B,KAAKA,oBAAL,CAA0BvR,IAA1B,CAA+B,IAA/B,CAA5B;AACA,SAAKwR,qBAAL,GAA6B,KAAKA,qBAAL,CAA2BxR,IAA3B,CAAgC,IAAhC,CAA7B;AACA,SAAKyR,sCAAL,GAA8C,KAAKA,sCAAL,CAA4CzR,IAA5C,CAAiD,IAAjD,CAA9C;AACA,SAAK0R,oBAAL,GAA4B,KAAKA,oBAAL,CAA0B1R,IAA1B,CAA+B,IAA/B,CAA5B;AACA,SAAK2R,2BAAL,GAAmC,KAAKA,2BAAL,CAAiC3R,IAAjC,CAAsC,IAAtC,CAAnC;AACA,SAAK4R,qBAAL,GAA6B,KAAKA,qBAAL,CAA2B5R,IAA3B,CAAgC,IAAhC,CAA7B;AACA,SAAK6R,sBAAL,GAA8B,KAAKA,sBAAL,CAA4B7R,IAA5B,CAAiC,IAAjC,CAA9B;AACA,SAAK8R,oBAAL,GAA4B,KAAKA,oBAAL,CAA0B9R,IAA1B,CAA+B,IAA/B,CAA5B;AACA,SAAK+C,KAAL,GAAa;AACXgP,qBAAe,KADJ;AAEXC,wBAAkB,EAFP;AAGXC,iCAA2B,IAHhB;AAIXC,oCAA8B,IAJnB;AAKXC,yBAAmB,KALR;AAMXC,0BAAoB;AANT,KAAb;AAQD;;AAED1U,YAAU,EAACzD,MAAMtB,MAAP,EAAV,EAA0B;AACxB,QAAIA,OAAOnB,IAAP,KAAgB,iBAApB,EAAuC;AACrC,WAAKwP,QAAL,CAAcrO,OAAOsB,IAArB;AACA,UAAI,CAAC,KAAK8I,KAAL,CAAWkP,yBAAhB,EAA2C;AACzC,cAAMA,4BAA4B,EAAlC;AACA,aAAK,MAAMI,KAAX,IAAoBjQ,OAAOE,IAAP,CAAY3J,OAAOsB,IAAP,CAAYqY,mBAAxB,CAApB,EAAkE;AAChEL,oCAA0BI,KAA1B,IAAmCjI,KAAKC,SAAL,CAAe1R,OAAOsB,IAAP,CAAYqY,mBAAZ,CAAgCD,KAAhC,CAAf,EAAuD,IAAvD,EAA6D,CAA7D,CAAnC;AACD;AACD,aAAKrL,QAAL,CAAc,EAACiL,yBAAD,EAAd;AACD;AACF;AACF;;AAEDhL,uBAAqB;AACnB,UAAM7B,WAAWvB,wEAAaA,CAACkB,kBAAd,EAAjB;AACAlB,4EAAaA,CAACI,WAAd,CAA0B,EAACzM,MAAM,qBAAP,EAA8ByC,MAAM,EAACmL,QAAD,EAApC,EAA1B;AACAvB,4EAAaA,CAACC,WAAd,CAA0B,KAAKpG,SAA/B;AACD;;AAED2J,yBAAuB;AACrBxD,4EAAaA,CAACG,cAAd,CAA6B,KAAKtG,SAAlC;AACD;;AAED+T,yCAAuClK,QAAvC,EAAiD;AAC/C,WAAO,KAAKxE,KAAL,CAAWwP,QAAX,CAAoB3C,MAApB,CAA2BhO,OAAOA,IAAI2F,QAAJ,KAAiBA,QAAjB,IAA6B3F,IAAI4Q,OAAnE,CAAP;AACD;;AAEDC,cAAY7Q,GAAZ,EAAiB;AACf,QAAIA,IAAI4Q,OAAR,EAAiB;AACf;AACA,UAAIlO,SAAS,KAAKmN,sCAAL,CAA4C7P,IAAI2F,QAAhD,CAAb;AACA,aAAO,MAAM1D,wEAAaA,CAACQ,WAAd,CAA0BC,MAA1B,CAAb;AACD;AACD,WAAO,MAAMT,wEAAaA,CAACM,SAAd,CAAwBvC,IAAI9E,EAA5B,CAAb;AACD;;AAED4V,gBAAc9Q,GAAd,EAAmB;AACjB,QAAIA,IAAI4Q,OAAR,EAAiB;AACf;AACA,UAAIlO,SAAS,KAAKmN,sCAAL,CAA4C7P,IAAI2F,QAAhD,CAAb;AACA,aAAO,MAAM1D,wEAAaA,CAACa,aAAd,CAA4BJ,MAA5B,CAAb;AACD;AACD,WAAO,MAAMT,wEAAaA,CAACY,WAAd,CAA0B7C,IAAI9E,EAA9B,CAAb;AACD;;AAED6V,iBAAe7V,EAAf,EAAmB;AACjB,WAAO,MAAM+G,wEAAaA,CAACc,eAAd,CAA8B7H,EAA9B,CAAb;AACD;;AAED8V,gBAAc;AACZ/O,4EAAaA,CAACI,WAAd,CAA0B,EAACzM,MAAM,oBAAP,EAA1B;AACD;;AAEDqb,cAAY;AACVhP,4EAAaA,CAACI,WAAd,CAA0B,EAACzM,MAAM,qBAAP,EAA1B;AACD;;AAEDka,yBAAuB;AACrB,UAAMoB,UAAU,EAAhB;AACA,SAAK,MAAMT,KAAX,IAAoBjQ,OAAOE,IAAP,CAAY,KAAKS,KAAL,CAAWkP,yBAAvB,CAApB,EAAuE;AACrE,YAAMnX,QAAQ,KAAKiI,KAAL,CAAWkP,yBAAX,CAAqCI,KAArC,CAAd;AACAS,cAAQT,KAAR,IAAiBvX,QAAQsP,KAAK2I,KAAL,CAAWjY,KAAX,CAAR,GAA4B,IAA7C;AACD;AACD+I,4EAAaA,CAACI,WAAd,CAA0B;AACxBzM,YAAM,0BADkB;AAExByC,YAAM;AACJ+Y,oBAAY,KAAKC,IAAL,CAAUC,eAAV,CAA0BpY,KADlC;AAEJgY;AAFI;AAFkB,KAA1B;AAOD;;AAEDnB,8BAA4BnT,KAA5B,EAAmC;AACjC,UAAM,EAAC3D,IAAD,KAAS2D,MAAM9E,MAArB;AACA,UAAM,EAACoB,KAAD,KAAU0D,MAAM9E,MAAtB;;AAEA,SAAKsN,QAAL,CAAc,CAAC,EAACiL,yBAAD,EAAD,KAAiC;AAC7C,UAAIkB,2BAA2B,IAA/B;AACA,YAAMC,sCAAwBnB,yBAAxB,CAAN;AACAmB,wBAAkBvY,IAAlB,IAA0BC,KAA1B;AACA,UAAI;AACFsP,aAAK2I,KAAL,CAAWjY,KAAX;AACD,OAFD,CAEE,OAAOkG,CAAP,EAAU;AACV3B,gBAAQ6C,GAAR,CAAa,oCAAmCrH,IAAK,EAArD,EADU,CAC+C;AACzDsY,mCAA2B,EAACrW,IAAIjC,IAAL,EAA3B;AACD;;AAED,aAAO;AACLsX,2BAAmB,KADd;AAELH,0BAAkB,EAFb;AAGLC,mCAA2BmB,iBAHtB;AAILD;AAJK,OAAP;AAMD,KAjBD;AAkBD;;AAED7B,sBAAoB9S,KAApB,EAA2B;AACzB,UAAM+H,WAAW,KAAKxD,KAAL,CAAWsQ,aAAX,CAAyBC,IAAzB,CAA8BC,KAAKA,EAAEzW,EAAF,KAAS0B,MAAM9E,MAAN,CAAa+M,OAAb,CAAqBF,QAAjE,CAAjB;AACA,UAAMiN,eAAe,KAAKzQ,KAAL,CAAW0Q,SAAhC;;AAEA,UAAMC,gBAAgBnN,SAASzJ,EAAT,IAAe0W,YAAf,GAA8BA,aAAajN,SAASzJ,EAAtB,CAA9B,GAA0D,IAAhF;AACA,UAAM6W,kBAAkBpN,SAASyK,OAAjC;AACA,UAAM4C,aAAapV,MAAM9E,MAAN,CAAama,OAAhC;;AAEA,QAAID,UAAJ,EAAgB;AACd,UAAI,CAACF,aAAL,EAAoB;AAClB7P,gFAAaA,CAACI,WAAd,CAA0B,EAACzM,MAAM,wBAAP,EAAiCyC,MAAM,EAAC6C,IAAIyJ,SAASzJ,EAAd,EAAkBhC,OAAO,IAAzB,EAAvC,EAA1B;AACD;AACD,UAAI,CAAC6Y,eAAL,EAAsB;AACpB9P,gFAAaA,CAACI,WAAd,CAA0B,EAACzM,MAAM,iBAAP,EAA0ByC,MAAMsM,SAASzJ,EAAzC,EAA1B;AACD;AACF,KAPD,MAOO;AACL+G,8EAAaA,CAACI,WAAd,CAA0B,EAACzM,MAAM,kBAAP,EAA2ByC,MAAMsM,SAASzJ,EAA1C,EAA1B;AACD;;AAED,SAAKkK,QAAL,CAAc,EAAC+K,eAAe,KAAhB,EAAd;AACD;;AAEDR,uBAAqB/S,KAArB,EAA4B;AAC1B,UAAM7F,SAAS,EAACnB,MAAM,wBAAP,EAAiCyC,MAAM,EAAC6C,IAAI0B,MAAM9E,MAAN,CAAa+M,OAAb,CAAqBF,QAA1B,EAAoCzL,OAAO0D,MAAM9E,MAAN,CAAama,OAAxD,EAAvC,EAAf;AACAhQ,4EAAaA,CAACI,WAAd,CAA0BtL,MAA1B;AACA,SAAKqO,QAAL,CAAc,EAAC+K,eAAe,KAAhB,EAAd;AACD;;AAEDP,wBAAsBhT,KAAtB,EAA6B;AAC3B,SAAKwI,QAAL,CAAc,EAAC+K,eAAevT,MAAM9E,MAAN,CAAaoB,KAA7B,EAAd;AACD;;AAED;AACA8W,wBAAsBpT,KAAtB,EAA6B;AAC3B,UAAMyT,8CAAgC,KAAKlP,KAAL,CAAWkP,yBAA3C,CAAN;AACA,SAAK,MAAM7V,GAAX,IAAkBgG,OAAOE,IAAP,CAAY2P,yBAAZ,CAAlB,EAA0D;AACxD;AACA,UAAIA,0BAA0B7V,GAA1B,MAAmC0X,SAAvC,EAAkD;AAChD7B,kCAA0B7V,GAA1B,IAAiC,IAAjC;AACD;AACF;AACD,UAAM2X,mBAAmB/S,KAAK;AAC5BA,QAAEoN,cAAF;AACApN,QAAEgT,aAAF,CAAgBC,OAAhB,CAAwB,MAAxB,EAAgC7J,KAAKC,SAAL,CAAe4H,yBAAf,EAA0C,IAA1C,EAAgD,CAAhD,CAAhC;AACAna,eAAS4T,mBAAT,CAA6B,MAA7B,EAAqCqI,gBAArC;AACA,WAAK/M,QAAL,CAAc,EAACmL,mBAAmB,IAApB,EAAd;AACD,KALD;;AAOAra,aAAS6T,gBAAT,CAA0B,MAA1B,EAAkCoI,gBAAlC;;AAEAjc,aAASoc,WAAT,CAAqB,MAArB;AACD;;AAED;AACArC,yBAAuBrT,KAAvB,EAA8B;AAC5B,SAAKwI,QAAL,CAAc,CAAC,EAACoL,kBAAD,EAAD,MAA2B;AACvCA,0BAAoB,CAACA,kBADkB;AAEvCF,oCAA8B;AAFS,KAA3B,CAAd;AAID;;AAEDJ,uBAAqBtT,KAArB,EAA4B;AAC1B,SAAKwI,QAAL,CAAc,EAACkL,8BAA8B1T,MAAM9E,MAAN,CAAaoB,KAA5C,EAAd;AACA0D,UAAM9E,MAAN,CAAaoO,SAAb,CAAuB8E,MAAvB,CAA8B,YAA9B;AACA,SAAKqG,IAAL,CAAUkB,mBAAV,CAA8BC,SAA9B,GAA0C,EAA1C;;AAEA,QAAI;AACF,YAAMnC,4BAA4B7H,KAAK2I,KAAL,CAAWvU,MAAM9E,MAAN,CAAaoB,KAAxB,CAAlC;AACA,WAAKkM,QAAL,CAAc,EAACiL,yBAAD,EAAd;AACD,KAHD,CAGE,OAAOjR,CAAP,EAAU;AACVxC,YAAM9E,MAAN,CAAaoO,SAAb,CAAuBC,GAAvB,CAA2B,YAA3B;AACA,WAAKkL,IAAL,CAAUkB,mBAAV,CAA8BC,SAA9B,GAA0CpT,EAAE2E,OAA5C;AACD;AACF;;AAED0O,oBAAkBzS,GAAlB,EAAuB;AACrB,UAAM0S,YAAY1S,IAAI9E,EAAJ,KAAW,KAAKiG,KAAL,CAAWwR,aAAxC;AACA,UAAMC,YAAY,KAAKzR,KAAL,CAAW0R,gBAAX,CAA4B1X,QAA5B,CAAqC6E,IAAI9E,EAAzC,KAAgD,KAAKiG,KAAL,CAAW0R,gBAAX,CAA4B1X,QAA5B,CAAqC6E,IAAI8S,QAAzC,CAAlE;AACA,UAAMC,cAAc,KAAK5R,KAAL,CAAW6R,kBAAX,CAA8BhT,IAAI9E,EAAlC,IAAwC,KAAKiG,KAAL,CAAW6R,kBAAX,CAA8BhT,IAAI9E,EAAlC,EAAsCkO,MAA9E,GAAuF,CAA3G;;AAEA,QAAI6J,gBAAgB,cAApB;AACA,QAAIP,SAAJ,EAAe;AAAEO,uBAAiB,UAAjB;AAA8B;AAC/C,QAAIL,SAAJ,EAAe;AAAEK,uBAAiB,UAAjB;AAA8B;;AAE/C,WAAQ;AAAA;AAAA,QAAI,WAAWA,aAAf,EAA8B,KAAKjT,IAAI9E,EAAvC;AACN;AAAA;AAAA,UAAI,WAAU,YAAd;AAA2B;AAAA;AAAA;AAAO8E,cAAI9E,EAAX;AAAA;AAAe;AAAf;AAA3B,OADM;AAEN;AAAA;AAAA;AACE;AAAA;AAAA,YAAQ,WAAY,UAAU0X,YAAY,EAAZ,GAAiB,UAAY,EAA3D,EAA8D,SAASA,YAAY,KAAK9B,aAAL,CAAmB9Q,GAAnB,CAAZ,GAAsC,KAAK6Q,WAAL,CAAiB7Q,GAAjB,CAA7G;AAAqI4S,sBAAY,SAAZ,GAAwB;AAA7J,SADF;AAEEA,oBAAY,IAAZ,GAAmB;AAAA;AAAA,YAAQ,WAAU,QAAlB,EAA2B,SAAS,KAAK7B,cAAL,CAAoB/Q,IAAI9E,EAAxB,CAApC;AAAA;AAAA,SAFrB;AAGC,8EAHD;AAAA;AAGS6X,mBAHT;AAAA;AAAA,OAFM;AAON;AAAA;AAAA,UAAI,WAAU,iBAAd;AACE;AAAA;AAAA;AAAMvK,eAAKC,SAAL,CAAezI,GAAf,EAAoB,IAApB,EAA0B,CAA1B;AAAN;AADF;AAPM,KAAR;AAWD;;AAEDkT,mBAAiB;AACf,QAAI,CAAC,KAAK/R,KAAL,CAAWwP,QAAhB,EAA0B;AACxB,aAAO,IAAP;AACD;AACD,UAAMwC,iBAAiB,KAAKhS,KAAL,CAAWgP,aAAX,KAA6B,KAA7B,GAAqC,KAAKhP,KAAL,CAAWwP,QAAhD,GAA2D,KAAKxP,KAAL,CAAWwP,QAAX,CAAoB3C,MAApB,CAA2BjK,WAAWA,QAAQY,QAAR,KAAqB,KAAKxD,KAAL,CAAWgP,aAAtE,CAAlF;AACA,WAAQ;AAAA;AAAA;AAAO;AAAA;AAAA;AACZgD,uBAAetI,GAAf,CAAmB7K,OAAO,KAAKyS,iBAAL,CAAuBzS,GAAvB,CAA1B;AADY;AAAP,KAAR;AAGD;;AAEDoT,wBAAsB;AACpB,QAAI,CAAC,KAAKjS,KAAL,CAAWkS,SAAhB,EAA2B;AACzB,aAAO,IAAP;AACD;AACD,WAAQ;AAAA;AAAA;AAAA;AAAsB;AAAA;AAAA,UAAQ,OAAO,KAAKlS,KAAL,CAAWgP,aAA1B,EAAyC,UAAU,KAAKP,qBAAxD;AAC5B;AAAA;AAAA,YAAQ,OAAM,KAAd;AAAA;AAAA,SAD4B;AAE3B,aAAKzO,KAAL,CAAWkS,SAAX,CAAqBxI,GAArB,CAAyBlG,YAAa;AAAA;AAAA,YAAQ,KAAKA,SAASzJ,EAAtB,EAA0B,OAAOyJ,SAASzJ,EAA1C;AAA+CyJ,mBAASzJ;AAAxD,SAAtC;AAF2B;AAAtB,KAAR;AAID;;AAEDoY,oBAAkB;AAChB,WAAQ;AAAA;AAAA;AACN;AAAA;AAAA,UAAI,WAAU,cAAd;AACE,2EAAI,WAAU,KAAd,GADF;AAEE;AAAA;AAAA,YAAI,WAAU,KAAd;AAAA;AAAA,SAFF;AAGE;AAAA;AAAA;AAAA;AAAA,SAHF;AAIE;AAAA;AAAA,YAAI,WAAU,KAAd;AAAA;AAAA,SAJF;AAKE;AAAA;AAAA,YAAI,WAAU,KAAd;AAAA;AAAA;AALF;AADM,KAAR;AASD;;AAEDC,oBAAkB;AAChB,UAAMC,kBAAkB,KAAKrS,KAAL,CAAWsQ,aAAnC;AACA,UAAMgC,eAAe,KAAKtS,KAAL,CAAWkS,SAAhC;AACA,UAAMzB,eAAe,KAAKzQ,KAAL,CAAW0Q,SAAhC;;AAEA,WAAQ;AAAA;AAAA;AAAQ,WAAKyB,eAAL,EAAR;AAA+B;AAAA;AAAA;AACpCE,wBAAgB3I,GAAhB,CAAoB,CAAClG,QAAD,EAAW+O,CAAX,KAAiB;AACpC,gBAAMC,iBAAiBhP,SAASzJ,EAAT,KAAgB,wBAAvC;AACA,gBAAM0Y,OAAOH,aAAa/B,IAAb,CAAkBC,KAAKA,EAAEzW,EAAF,KAASyJ,SAASzJ,EAAzC,KAAgD,EAA7D;AACA,gBAAM4W,gBAAgBnN,SAASzJ,EAAT,IAAe0W,YAAf,GAA8BA,aAAajN,SAASzJ,EAAtB,CAA9B,GAA0D,IAAhF;AACA,gBAAM6W,kBAAmB4B,kBAAkBhP,SAASyK,OAApD;;AAEA,cAAIyE,QAAQ,OAAZ;AACA,cAAIlP,SAAS/O,IAAT,KAAkB,QAAtB,EAAgC;AAC9Bie,oBAAS;AAAA;AAAA;AAAA;AAAgB;AAAA;AAAA,kBAAG,WAAU,aAAb,EAA2B,QAAO,QAAlC,EAA2C,MAAMD,KAAKlQ,GAAtD;AAA4DkQ,qBAAKlQ;AAAjE,eAAhB;AAAA;AAAA,aAAT;AACD,WAFD,MAEO,IAAIiB,SAAS/O,IAAT,KAAkB,iBAAtB,EAAyC;AAC9Cie,oBAAS,oBAAmBlP,SAASmP,MAAO,GAA5C;AACD;;AAED,cAAIC,kBAAkB,EAAtB;AACA,cAAI,CAAChC,eAAL,EAAsB;AACpBgC,4BAAgB3Y,IAAhB,CAAqB,aAArB;AACD;AACD,cAAI,CAAC0W,aAAL,EAAoB;AAClBiC,4BAAgB3Y,IAAhB,CAAqB,WAArB;AACD;AACD,cAAI2Y,gBAAgB3K,MAApB,EAA4B;AAC1ByK,oBAAS,gBAAeE,gBAAgB7F,IAAhB,CAAqB,IAArB,CAA2B,EAAnD;AACD;;AAED,iBAAQ;AAAA;AAAA,cAAI,WAAU,cAAd,EAA6B,KAAKwF,CAAlC;AAEN;AAAA;AAAA;AAAKC,+BAAiB,sEAAO,MAAK,UAAZ,EAAuB,UAAU,IAAjC,EAAuC,UAAU,IAAjD,EAAuD,SAAS,IAAhE,GAAjB,GAA4F,sEAAO,MAAK,UAAZ,EAAuB,iBAAehP,SAASzJ,EAA/C,EAAmD,SAAS4W,iBAAiBC,eAA7E,EAA8F,UAAU,KAAKrC,mBAA7G;AAAjG,aAFM;AAGN;AAAA;AAAA;AAAK/K,uBAASzJ;AAAd,aAHM;AAIN;AAAA;AAAA;AAAI;AAAA;AAAA,kBAAM,WAAY,cAAc4W,iBAAiBC,eAAlB,GAAqC,EAArC,GAA0C,aAAc,EAAvF;AAA2F8B;AAA3F;AAAJ,aAJM;AAKN;AAAA;AAAA;AAAKlP,uBAASqP;AAAd,aALM;AAMN;AAAA;AAAA,gBAAI,OAAO,EAACC,YAAY,QAAb,EAAX;AAAoCL,mBAAKM,WAAL,GAAmB,IAAItV,IAAJ,CAASgV,KAAKM,WAAd,EAA2BC,cAA3B,EAAnB,GAAiE;AAArG;AANM,WAAR;AAQD,SAhCA;AADoC;AAA/B,KAAR;AAmCD;;AAEDC,qBAAmB;AACjB,QAAI,CAAC,KAAKjT,KAAL,CAAWqP,kBAAhB,EAAoC;AAClC,aAAO,IAAP;AACD;AACD,UAAM6D,SAAS,KAAKhD,IAAL,CAAUkB,mBAAV,IAAiC,KAAKlB,IAAL,CAAUkB,mBAAV,CAA8BC,SAA9B,CAAwCpJ,MAAxF;AACA,WACE;AAAC,iGAAD;AAAA,QAAc,OAAM,0BAApB,EAA+C,cAAciL,SAAS,QAAT,GAAoB,MAAjF,EAAyF,cAAc,KAAKpE,sBAA5G;AACE;AAAA;AAAA,UAAK,WAAU,mBAAf;AACE;AAAA;AAAA;AACE,mFAAU,UAAU,KAAKC,oBAAzB,EAA+C,OAAO,KAAK/O,KAAL,CAAWmP,4BAAjE,EAA+F,WAAW,IAA1G,EAAgH,MAAK,IAArH,EAA0H,MAAK,IAA/H;AADF,SADF;AAIE,0EAAG,KAAI,qBAAP;AAJF;AADF,KADF;AAUD;;AAEDgE,8BAA4B;AAC1B;AACA,UAAMC,UAAU,KAAKpT,KAAL,CAAWiP,gBAAX,CAA4BmE,OAA5B,IAAuC,CAAC,CAAC,KAAKpT,KAAL,CAAWiP,gBAAX,CAA4BhT,MAArF;AACA,UAAMA,SAASoL,KAAKC,SAAL,CAAe,KAAKtH,KAAL,CAAWiP,gBAAX,CAA4BhT,MAA3C,EAAmD,IAAnD,EAAyD,CAAzD,KAA+D,gBAA9E;;AAEA,WAAQ;AAAA;AAAA;AAAO;AAAA;AAAA;AACb;AAAA;AAAA;AAAI;AAAA;AAAA;AAAI;AAAA;AAAA;AAAA;AAAA;AAAJ;AAAJ,SADa;AAEb;AAAA;AAAA;AACE;AAAA;AAAA;AACE;AAAA;AAAA;AAAG,uFAAU,KAAI,iBAAd,EAAgC,MAAK,IAArC,EAA0C,MAAK,IAA/C,EAAoD,aAAY,8EAAhE;AAAH,aADF;AAEE;AAAA;AAAA;AAAA;AAAW;AAAA;AAAA,kBAAM,KAAI,kBAAV;AAA8BmX,0BAAU,GAAV,GAAgB,GAA9C;AAAA;AAA6DnX;AAA7D;AAAX;AAFF,WADF;AAKE;AAAA;AAAA;AACG;AAAA;AAAA,gBAAQ,WAAU,0BAAlB,EAA6C,SAAS,KAAK0S,oBAA3D;AAAA;AAAA;AADH;AALF,SAFa;AAWb;AAAA;AAAA;AAAI;AAAA;AAAA;AAAI;AAAA;AAAA;AAAA;AAAA;AAAJ;AAAJ,SAXa;AAYb;AAAA;AAAA;AACE;AAAA;AAAA;AACE;AAAA;AAAA,gBAAQ,WAAU,0BAAlB,EAA6C,SAAS,KAAKE,qBAA3D,EAAkF,UAAU,KAAK7O,KAAL,CAAWoP,iBAAvG;AACG,mBAAKpP,KAAL,CAAWoP,iBAAX,GAA+B,oBAA/B,GAAsD;AADzD,aADF;AAIE;AAAA;AAAA,gBAAQ,WAAU,0BAAlB,EAA6C,SAAS,KAAKN,sBAA3D,EAAmF,UAAU,KAAK9O,KAAL,CAAWqP,kBAAxG;AAAA;AAAA;AAJF;AADF,SAZa;AAsBZ,aAAKrP,KAAL,CAAWkP,yBAAX,IAAwC7P,OAAOE,IAAP,CAAY,KAAKS,KAAL,CAAWkP,yBAAvB,EAAkDxF,GAAlD,CAAsD,CAAC4F,KAAD,EAAQiD,CAAR,KAAc;AAC3G,gBAAMxa,QAAQ,KAAKiI,KAAL,CAAWkP,yBAAX,CAAqCI,KAArC,CAAd;AACA,gBAAM+D,aAAa,KAAKrT,KAAL,CAAWoQ,wBAAX,IAAuC,KAAKpQ,KAAL,CAAWoQ,wBAAX,CAAoCrW,EAApC,KAA2CuV,KAArG;AACA,gBAAMtC,YAAYqG,aAAa,YAAb,GAA4B,EAA9C;AACA,gBAAMC,YAAY,CAACvb,SAASA,MAAMkQ,MAAhB,IAA0B,EAA1B,GAChB,yEAAU,MAAMqH,KAAhB,EAAuB,WAAWtC,SAAlC,EAA6C,OAAOjV,KAApD,EAA2D,MAAK,IAAhE,EAAqE,MAAK,IAA1E,EAA+E,UAAU,KAAK6W,2BAA9F,GADgB,GAEhB,sEAAO,MAAMU,KAAb,EAAoB,WAAWtC,SAA/B,EAA0C,OAAOjV,KAAjD,EAAwD,UAAU,KAAK6W,2BAAvE,GAFF;;AAIA,iBAAQ;AAAA;AAAA,cAAI,KAAK2D,CAAT;AACN;AAAA;AAAA;AAAKjD;AAAL,aADM;AAEN;AAAA;AAAA;AAAKgE;AAAL;AAFM,WAAR;AAID,SAZwC;AAtB5B;AAAP,KAAR;AAoCD;;AAEDnO,WAAS;AACP,WAAQ;AAAA;AAAA,QAAK,WAAU,8BAAf;AACN;AAAA;AAAA;AAAA;AAAA,OADM;AAEN;AAAA;AAAA;AAAA;AAAA,OAFM;AAGN;AAAA;AAAA,UAAQ,WAAU,QAAlB,EAA2B,SAAS,KAAK0K,WAAzC;AAAA;AAAA,OAHM;AAAA;AAIN;AAAA;AAAA;AAAA;AAAsB;AAAA;AAAA,YAAQ,OAAM,sDAAd,EAAqE,WAAU,QAA/E,EAAwF,SAAS,KAAKC,SAAtG;AAAA;AAAA;AAAtB,OAJM;AAML,WAAK9P,KAAL,CAAWkS,SAAX,GAAuB,KAAKE,eAAL,EAAvB,GAAgD,IAN3C;AAON;AAAA;AAAA;AAAA;AAAA,OAPM;AAQL,WAAKH,mBAAL,EARK;AASL,WAAKF,cAAL,EATK;AAUL,WAAKkB,gBAAL,EAVK;AAWL,WAAKE,yBAAL;AAXK,KAAR;AAaD;AA5WoD,C;;;;;;;ACJvD;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AACA;AACA;AACA;;AAEA;;;;;;;;;;;;;;;;;;;AAmBO,MAAMI,cAAN,SAA6BzQ,4CAAKA,CAACC,aAAnC,CAAiD;AACtD9J,cAAY+J,KAAZ,EAAmB;AACjB,UAAMA,KAAN;AACA,SAAKwQ,gBAAL,GAAwB,KAAKA,gBAAL,CAAsBvW,IAAtB,CAA2B,IAA3B,CAAxB;AACA,SAAKwW,iBAAL,GAAyB,KAAKA,iBAAL,CAAuBxW,IAAvB,CAA4B,IAA5B,CAAzB;AACD;;AAEDuW,qBAAmB;AACjB,SAAKxQ,KAAL,CAAW1O,QAAX,CAAoB,EAACG,MAAMgB,8DAAWA,CAACie,aAAnB,EAApB;AACA,SAAK1Q,KAAL,CAAW1O,QAAX,CAAoBC,iEAAEA,CAAC0C,SAAH,CAAa,EAACwE,OAAOhG,8DAAWA,CAACie,aAApB,EAAmCxb,QAAQ,KAAK8K,KAAL,CAAW9L,IAAX,CAAgByc,WAA3D,EAAb,CAApB;AACD;;AAEDF,sBAAoB;AAClB,SAAKzQ,KAAL,CAAW9L,IAAX,CAAgB0c,SAAhB,CAA0B1d,OAA1B,CAAkC,KAAK8M,KAAL,CAAW1O,QAA7C;AACD;;AAEDuf,wBAAsB;AACpB,UAAMC,eAAe,KAAK9Q,KAAL,CAAW9L,IAAX,CAAgB6c,cAArC;;AAEA,QAAI,CAACD,YAAL,EAAmB;AACjB,aAAO,IAAP;AACD;;AAED,WAAQ;AAAA;AAAA;AACLA,mBAAapK,GAAb,CAAiB7K,OAAO;AAAA;AAAA,UAAG,KAAKA,GAAR;AAAa,mEAAC,2DAAD,IAAkB,IAAIA,GAAtB;AAAb,OAAxB;AADK,KAAR;AAGD;;AAEDsG,WAAS;AACP,QAAI,CAAC,KAAKnC,KAAL,CAAWgR,OAAhB,EAAyB;AACvB,aAAO,IAAP;AACD;;AAED,WAAQ;AAAA;AAAA,QAAK,WAAU,qBAAf;AACN,0EAAK,WAAU,eAAf,EAA+B,SAAS,KAAKR,gBAA7C,GADM;AAEN;AAAA;AAAA,UAAK,WAAU,OAAf;AACE;AAAA;AAAA,YAAS,WAAU,eAAnB;AACG,eAAKxQ,KAAL,CAAW9L,IAAX,CAAgBkS,IAAhB,IAAwB,qEAAM,WAAY,yBAAwB,KAAKpG,KAAL,CAAW9L,IAAX,CAAgBkS,IAAK,EAA/D,GAD3B;AAEG,eAAKyK,mBAAL;AAFH,SADF;AAKE;AAAA;AAAA,YAAS,WAAU,SAAnB;AACE;AAAA;AAAA,cAAQ,SAAS,KAAKL,gBAAtB;AACE,uEAAC,2DAAD,IAAkB,IAAI,KAAKxQ,KAAL,CAAW9L,IAAX,CAAgB+c,uBAAtC;AADF,WADF;AAIE;AAAA;AAAA,cAAQ,WAAU,MAAlB,EAAyB,SAAS,KAAKR,iBAAvC;AACE,uEAAC,2DAAD,IAAkB,IAAI,KAAKzQ,KAAL,CAAW9L,IAAX,CAAgBgd,wBAAtC;AADF;AAJF;AALF;AAFM,KAAR;AAiBD;AAlDqD;;AAqDjD,MAAMC,gBAAgBlZ,2DAAOA,CAAC+E,SAASA,MAAMoU,MAAvB,EAA+Bb,cAA/B,CAAtB,C;;;;;;;AC7EP;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AACA;;AAEO,MAAMc,qBAAN,SAAoCvR,4CAAKA,CAACC,aAA1C,CAAwD;AAC7D9J,cAAY+J,KAAZ,EAAmB;AACjB,UAAMA,KAAN;AACA,SAAKsR,SAAL,GAAiB,KAAKtR,KAAL,CAAWsR,SAAX,IAAwB9U,MAAzC;AACA,SAAKyJ,OAAL,GAAe,KAAKA,OAAL,CAAahM,IAAb,CAAkB,IAAlB,CAAf;AACD;;AAED;;;;AAIAgM,YAAU;AACR,SAAKqL,SAAL,CAAe9T,QAAf,CAAwB+T,MAAxB,CAA+B,IAA/B;AACD;;AAEDpP,WAAS;AACP,UAAMqP,eAAe,mBAArB;AACA,QAAIxH,SAAJ;AACA,QAAI,eAAe,KAAKhK,KAAxB,EAA+B;AAC7BgK,kBAAa,GAAE,KAAKhK,KAAL,CAAWgK,SAAU,IAAGwH,YAAa,EAApD;AACD,KAFD,MAEO;AACLxH,kBAAYwH,YAAZ;AACD;;AAED;AACA,WACE;AAAA;AAAA,QAAK,WAAWxH,SAAhB;AACE;AAAA;AAAA;AACE,mEAAC,2DAAD;AACE,0BAAe,kDADjB;AAEE,cAAG,6BAFL;AADF,OADF;AAME;AAAA;AAAA;AACE;AAAA;AAAA,YAAG,MAAK,GAAR,EAAY,WAAU,eAAtB,EAAsC,SAAS,KAAK/D,OAApD;AACE,qEAAC,2DAAD;AACE,4BAAe,4BADjB;AAEE,gBAAG,2CAFL;AADF;AADF;AANF,KADF;AAgBD;AAzC4D;AA2C/DoL,sBAAsBjP,YAAtB,GAAqC,EAAC4H,WAAW,mBAAZ,EAArC;;AAEO,MAAMyH,aAAN,SAA4B3R,4CAAKA,CAACC,aAAlC,CAAgD;AACrD9J,cAAY+J,KAAZ,EAAmB;AACjB,UAAMA,KAAN;AACA,SAAKhD,KAAL,GAAa,EAAC0U,UAAU,KAAX,EAAb;AACD;;AAEDC,oBAAkBhZ,KAAlB,EAAyB8W,IAAzB,EAA+B;AAC7B,SAAKxO,QAAL,CAAc,EAACyQ,UAAU,IAAX,EAAd;AACD;;AAEDvP,WAAS;AACP,QAAI,CAAC,KAAKnF,KAAL,CAAW0U,QAAhB,EAA0B;AACxB,aAAQ,KAAK1R,KAAL,CAAW+F,QAAnB;AACD;;AAED,WAAO,gEAAM,KAAN,CAAY,iBAAZ,IAA8B,WAAW,KAAK/F,KAAL,CAAWgK,SAApD,GAAP;AACD;AAhBoD;;AAmBvDyH,cAAcrP,YAAd,GAA6B,EAACwP,mBAAmBP,qBAApB,EAA7B,C;;;;;;;ACnEA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AACA;AACA;AACA;;AAEA;;;;;;;;AAQO,MAAMQ,gBAAN,SAA+B/R,4CAAKA,CAACC,aAArC,CAAmD;AACxD9J,cAAY+J,KAAZ,EAAmB;AACjB,UAAMA,KAAN;AACA,SAAK8R,YAAL,GAAoB,KAAKA,YAAL,CAAkB7X,IAAlB,CAAuB,IAAvB,CAApB;AACA,SAAK8X,YAAL,GAAoB,KAAKA,YAAL,CAAkB9X,IAAlB,CAAuB,IAAvB,CAApB;AACD;;AAED6X,iBAAe;AACb,SAAK9R,KAAL,CAAW1O,QAAX,CAAoBC,iEAAEA,CAACC,UAAH,CAAc,EAACC,MAAMC,8DAAEA,CAACsgB,eAAV,EAAd,CAApB;AACA,SAAKhS,KAAL,CAAW1O,QAAX,CAAoBC,iEAAEA,CAAC0C,SAAH,CAAa,EAACwE,OAAO/G,8DAAEA,CAACsgB,eAAX,EAAb,CAApB;AACD;;AAEDD,iBAAe;AACb,SAAK/R,KAAL,CAAW1O,QAAX,CAAoBC,iEAAEA,CAACC,UAAH,CAAc,EAACC,MAAMC,8DAAEA,CAACugB,gBAAV,EAAd,CAApB;AACA,SAAKjS,KAAL,CAAW1O,QAAX,CAAoBC,iEAAEA,CAAC0C,SAAH,CAAa,EAACwE,OAAO/G,8DAAEA,CAACugB,gBAAX,EAAb,CAApB;AACD;;AAED9P,WAAS;AACP,WAAQ;AAAA;AAAA,QAAK,WAAU,4BAAf;AACJ;AAAA;AAAA;AACE,6EAAM,WAAU,kBAAhB,GADF;AAEE,mEAAC,2DAAD,IAAkB,IAAG,+BAArB;AAFF,OADI;AAKJ;AAAA;AAAA,UAAK,WAAU,kCAAf;AACE;AAAA;AAAA,YAAQ,WAAU,SAAlB,EAA4B,SAAS,KAAK4P,YAA1C;AACE,qEAAC,2DAAD,IAAkB,IAAG,gCAArB;AADF,SADF;AAIE;AAAA;AAAA,YAAQ,SAAS,KAAKD,YAAtB;AACE,qEAAC,2DAAD,IAAkB,IAAG,gCAArB;AADF;AAJF;AALI,KAAR;AAcD;AAhCuD;;AAmCnD,MAAMI,kBAAkBja,2DAAOA,GAAG4Z,gBAAV,CAAxB,C;;;;;;;;;;AChDP,MAAMM,cAAN,CAAqB;AACnBlc,cAAYpD,OAAZ,EAAqB;AACnB,SAAKuf,YAAL,GAAoBvf,QAAQuf,YAA5B;AACA,SAAKC,eAAL,GAAuBxf,QAAQwf,eAA/B;AACA,SAAKC,cAAL,CAAoBzf,QAAQ0f,UAA5B;AACD;;AAED,MAAIA,UAAJ,GAAiB;AACf,WAAO,KAAKC,WAAZ;AACD;;AAED,MAAID,UAAJ,CAAexd,KAAf,EAAsB;AACpB,SAAKud,cAAL,CAAoBvd,KAApB;AACD;;AAED,MAAI0d,iBAAJ,GAAwB;AACtB,WAAO,KAAKC,kBAAZ;AACD;;AAEC;AACFJ,iBAAevd,QAAQ,EAAvB,EAA2B;AACzB,SAAKyd,WAAL,GAAmBzd,KAAnB;AACA,SAAK2d,kBAAL,GAA0B3d,MAAM4d,MAAN,CAAa,CAAC1Z,MAAD,EAASmK,IAAT,KAAkB;AACvD,UAAI,OAAOA,IAAP,KAAgB,QAApB,EAA8B;AAC5BnK,eAAOhC,IAAP,CAAYmM,IAAZ;AACA,eAAOnK,MAAP;AACD,OAHD,MAGO,IAAImK,QAAQA,KAAKwP,KAAjB,EAAwB;AAC7B,eAAO3Z,OAAO8C,MAAP,CAAcqH,KAAKwP,KAAnB,CAAP;AACD,OAFM,MAEA,IAAIxP,QAAQA,KAAKvK,SAAjB,EAA4B;AACjC,eAAOI,OAAO8C,MAAP,CAAcqH,KAAKvK,SAAnB,CAAP;AACD;AACD,YAAM,IAAI5F,KAAJ,CAAU,0DAAV,CAAN;AACD,KAVyB,EAUvB,EAVuB,CAA1B;AAWD;;AAED4X,gBAAcgI,OAAd,EAAuBC,cAAvB,EAAuC;AACrC,SAAK,MAAM3I,KAAX,IAAoB,KAAKoI,UAAzB,EAAqC;AACnC;AACA,UAAIpI,SAASA,MAAMyI,KAAf,IAAwB,CAACzI,MAAMyI,KAAN,CAAYG,IAAZ,CAAiBje,QAAQ+d,QAAQ/d,IAAR,MAAkB,KAAKsd,YAAL,CAAkBtd,IAAlB,CAA3C,CAA7B,EAAkG;AAChG,eAAO,KAAP;;AAEA;AACD,OAJD,MAIO,IAAIge,kBAAkB3I,KAAlB,IAA2BA,MAAMtR,SAArC,EAAgD;AACrD,cAAMma,mBAAmB7I,MAAMtR,SAAN,CAAgBka,IAAhB,CAAqBE,YAAYH,eAAeC,IAAf,CAAoBG,QAAQA,QAAQA,KAAKD,QAAL,CAApC,CAAjC,CAAzB;AACA,YAAID,gBAAJ,EAAsB;AACpB,iBAAO,KAAP;AACD;AACD;AACD,OANM,MAMA,IAAIH,QAAQ1I,KAAR,MAAmB,KAAKiI,YAAL,CAAkBjI,KAAlB,CAAvB,EAAiD;AACtD,eAAO,KAAP;AACD;AACF;AACD,WAAO,IAAP;AACD;AArDkB;oBAwDA,IAAIgI,cAAJ,CAAmB;AACtCC,gBAAc;AACZ,wBAAoB,IADR;AAEZ,sBAAkB,IAFN;AAGZ,kBAAc,IAHF;AAIZ,oBAAgB,CAJJ;AAKZ,gCAA4B,IALhB;AAMZ,gCAA4B,IANhB;AAOZ,oBAAgB,gCAPJ;AAQZ,iBAAa;AARD,GADwB;AAWtC;AACA;AACA;AACA;AACA;AACA;AACAG,cAAY,CACV,gBADU,EAEV,YAFU,EAGV,cAHU,EAIV,cAJU;AAKV;AACA;AACA,IAACK,OAAO,CAAC,0BAAD,EAA6B,0BAA7B,CAAR,EAPU;AAQV;AACA;AACA,IAAC/Z,WAAW,CAAC,WAAD,CAAZ,EAVU,CAjB0B;AA6BtCwZ,mBAAiB,CACf;AACEpH,aAAS,IADX;AAEE7E,UAAM,QAFR;AAGErP,QAAI,YAHN;AAIEoc,WAAO,CAJT;AAKE9M,WAAO,EAACtP,IAAI,uBAAL,EAA8BoG,QAAQ,EAACqD,UAAU,QAAX,EAAtC;AALT,GADe,EAQf;AACEyK,aAAS,IADX;AAEElU,QAAI,YAFN;AAGEqP,UAAM,YAHR;AAIE+M,WAAO,CAJT;AAKE9M,WAAO,EAACtP,IAAI,mBAAL;AALT,GARe;AA7BqB,CAAnB,C;;;;;;;ACxDrB;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AACa;;AAEb;AACA;AACA;AACA;AACA;;AAEO,MAAMqc,OAAN,SAAsBtT,4CAAKA,CAACC,aAA5B,CAA0C;AAC/C9J,cAAY+J,KAAZ,EAAmB;AACjB,UAAMA,KAAN;AACA,SAAKiG,OAAL,GAAe,KAAKA,OAAL,CAAahM,IAAb,CAAkB,IAAlB,CAAf;AACA,SAAKoZ,YAAL,GAAoB,KAAKA,YAAL,CAAkBpZ,IAAlB,CAAuB,IAAvB,CAApB;AACD;;AAEDqZ,cAAY7a,KAAZ,EAAmB;AACjB;AACA,QAAIA,MAAM8a,MAAN,CAAa9hB,IAAb,KAAsB,QAA1B,EAAoC;AAClC,WAAKuO,KAAL,CAAW1O,QAAX,CAAoBC,iEAAEA,CAAC0C,SAAH,CAAa,EAACwE,OAAO,QAAR,EAAb,CAApB;AACD;AACF;;AAEDwN,UAAQxN,KAAR,EAAe;AACb+D,WAAOgX,wBAAP,CAAgCC,MAAhC,CAAuChb,KAAvC;AACD;;AAED6I,yBAAuB;AACrB,WAAO9E,OAAOgX,wBAAd;AACD;;AAEDH,eAAaK,KAAb,EAAoB;AAClB,QAAIA,KAAJ,EAAW;AACT;AACA;AACA;AACA;AACA;AACA,YAAMC,kBAAkBC,mEAASA,GAAG,QAAZ,GAAuB,WAA/C;;AAEA;AACA;AACA;AACA;AACA;AACA,YAAMC,eAAeD,mEAASA,GAAG,QAAZ,GAAuB,UAA5C;;AAEA;AACA;AACA;AACApX,aAAOgX,wBAAP,GAAkC,IAAIM,yBAAJ,CAA8BJ,KAA9B,EAAqCA,MAAM/X,UAA3C,EAChCgY,eADgC,EACfE,YADe,CAAlC;AAEAjO,uBAAiB,qBAAjB,EAAwC,IAAxC;AACD,KArBD,MAqBO;AACLpJ,aAAOgX,wBAAP,GAAkC,IAAlC;AACA7N,0BAAoB,qBAApB,EAA2C,IAA3C;AACD;AACF;;AAED;;;;;AAKAxD,WAAS;AACP,WAAQ;AAAA;AAAA,QAAK,WAAU,gBAAf;AACL,WAAKnC,KAAL,CAAW+T,QAAX,IACC;AAAA;AAAA,UAAK,WAAU,mBAAf;AACE,4EAAK,WAAU,MAAf,GADF;AAEE,4EAAK,WAAU,UAAf;AAFF,OAFI;AAON;AAAA;AAAA,UAAK,WAAU,sBAAf;AACE;AAAA;AAAA,YAAO,SAAQ,oBAAf,EAAoC,WAAU,cAA9C;AACE;AAAA;AAAA,cAAM,WAAU,SAAhB;AAA0B,uEAAC,2DAAD,IAAkB,IAAG,wBAArB;AAA1B;AADF,SADF;AAIE;AACE,cAAG,oBADL;AAEE,qBAAU,KAFZ;AAGE,uBAAa,KAAK/T,KAAL,CAAWyI,IAAX,CAAgBC,aAAhB,CAA8B,EAAC3R,IAAI,wBAAL,EAA9B,CAHf;AAIE,eAAK,KAAKsc,YAJZ;AAKE,iBAAO,KAAKrT,KAAL,CAAWyI,IAAX,CAAgBC,aAAhB,CAA8B,EAAC3R,IAAI,wBAAL,EAA9B,CALT;AAME,gBAAK,QANP,GAJF;AAWE;AAAA;AAAA;AACE,gBAAG,cADL;AAEE,uBAAU,eAFZ;AAGE,qBAAS,KAAKkP,OAHhB;AAIE,mBAAO,KAAKjG,KAAL,CAAWyI,IAAX,CAAgBC,aAAhB,CAA8B,EAAC3R,IAAI,eAAL,EAA9B,CAJT;AAKE;AAAA;AAAA,cAAM,WAAU,SAAhB;AAA0B,uEAAC,2DAAD,IAAkB,IAAG,eAArB;AAA1B;AALF;AAXF;AAPM,KAAR;AA2BD;AAnF8C;;AAsF1C,MAAMid,SAAS/b,2DAAOA,GAAG6Q,6DAAUA,CAACsK,OAAX,CAAV,CAAf,C;;;;;;;AC/FP;AAAA;AAAO,MAAMQ,YAAY5iB,OAAOe,QAAP,IAAmBf,OAAOe,QAAP,CAAgBkiB,WAAhB,KAAgC,cAArE,C;;;;;;;;;;;;;;;;;;;;;;;;;;;;;ACAP;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA,MAAM5O,UAAU,SAAhB;AACA,MAAMC,0BAA0B,kBAAhC;AACA,MAAM4O,wBAAwB,CAA9B;AACA,MAAMC,6BAA6B,CAAnC;;AAEA,SAASC,mBAAT,CAA6BxU,OAA7B,EAAsC;AACpC,SAAO,OAAOA,OAAP,KAAmB,QAAnB,GAA8B;AAAA;AAAA;AAAOA;AAAP,GAA9B,GAAuD,2DAAC,2DAAD,EAAsBA,OAAtB,CAA9D;AACD;;AAEM,MAAMyU,OAAN,SAAsBvU,4CAAKA,CAACC,aAA5B,CAA0C;AAC/C,MAAIuU,OAAJ,GAAc;AACZ,UAAM,EAACC,QAAD,EAAWC,OAAX,EAAoBtX,KAApB,KAA6B,KAAK8C,KAAxC;AACA,WAAOuU,WAAWrX,MAAMC,MAAN,CAAaoX,QAAb,CAAX,GAAoCC,OAA3C;AACD;;AAEDC,6BAA2B;AACzB,UAAM,EAACzU,KAAD,KAAU,IAAhB;AACA,QAAI0U,cAAcR,qBAAlB;AACA,QAAIlU,MAAM2U,YAAN,IAAsB3jB,OAAO4jB,UAAP,CAAmB,qBAAnB,EAAyCC,OAAnE,EAA4E;AAC1E;AACA;AACA;AACAH,oBAAcP,0BAAd;AACD;AACD,UAAMW,WAAWJ,cAAc,KAAKJ,OAApC;AACA,UAAMS,QAAQ/U,MAAMgV,IAAN,CAAW7V,KAAX,CAAiB,CAAjB,EAAoB2V,QAApB,CAAd;;AAEA,QAAI,KAAKG,oBAAL,CAA0BF,KAA1B,CAAJ,EAAsC;AACpC/U,YAAM1O,QAAN,CAAeC,iEAAEA,CAACoD,eAAH,CAAmB;AAChCO,gBAAQ8K,MAAM2Q,WADkB;AAEhCuE,eAAOH,MAAMrO,GAAN,CAAUyO,SAAS,EAACpe,IAAIoe,KAAKC,IAAV,EAAT,CAAV;AAFyB,OAAnB,CAAf;AAIA,WAAKC,mBAAL,GAA2BN,MAAMrO,GAAN,CAAUyO,QAAQA,KAAKC,IAAvB,CAA3B;AACD;AACF;;AAED;AACA;AACA;AACAE,qCAAmC;AACjC,UAAM,EAACtV,KAAD,KAAU,IAAhB;;AAEA,QAAI,CAACA,MAAMuV,yBAAP,IAAoC,CAACvV,MAAM1O,QAA/C,EAAyD;AACvD;AACD;;AAED,QAAI0O,MAAMjO,QAAN,CAAe0T,eAAf,KAAmCJ,OAAvC,EAAgD;AAC9C,WAAKoP,wBAAL;AACD,KAFD,MAEO;AACL;AACA;AACA,UAAI,KAAK/O,mBAAT,EAA8B;AAC5B1F,cAAMjO,QAAN,CAAe4T,mBAAf,CAAmCL,uBAAnC,EAA4D,KAAKI,mBAAjE;AACD;;AAED;AACA,WAAKA,mBAAL,GAA2B,MAAM;AAC/B,YAAI1F,MAAMjO,QAAN,CAAe0T,eAAf,KAAmCJ,OAAvC,EAAgD;AAC9C,cAAI,CAAC,KAAKrF,KAAL,CAAWkT,IAAX,CAAgBsC,SAArB,EAAgC;AAC9B,iBAAKf,wBAAL;AACD;AACDzU,gBAAMjO,QAAN,CAAe4T,mBAAf,CAAmCL,uBAAnC,EAA4D,KAAKI,mBAAjE;AACD;AACF,OAPD;AAQA1F,YAAMjO,QAAN,CAAe6T,gBAAf,CAAgCN,uBAAhC,EAAyD,KAAKI,mBAA9D;AACD;AACF;;AAEDxE,uBAAqB;AACnB,SAAKuU,oBAAL,CAA0B,KAAKzV,KAAL,CAAWrD,WAArC;AACD;;AAED0E,sBAAoB;AAClB,QAAI,KAAKrB,KAAL,CAAWgV,IAAX,CAAgB/P,MAAhB,IAA0B,CAAC,KAAKjF,KAAL,CAAWkT,IAAX,CAAgBsC,SAA/C,EAA0D;AACxD,WAAKF,gCAAL;AACD;AACF;;AAEDxP,qBAAmBnG,SAAnB,EAA8B;AAC5B,UAAM,EAACK,KAAD,KAAU,IAAhB;AACA,UAAM0V,cAAc1V,MAAMkT,IAAN,CAAWsC,SAA/B;AACA,UAAMG,eAAehW,UAAUuT,IAAV,CAAesC,SAApC;AACA;AACE;AACAxV,UAAMgV,IAAN,CAAW/P,MAAX;AAEE;AACA;AACCjF,UAAMgV,IAAN,KAAerV,UAAUqV,IAAzB,IAAiC,CAACU,WAAnC;AACA;AACCC,oBAAgB,CAACD,WANpB,CAFF,EAUE;AACA,WAAKJ,gCAAL;AACD;AACF;;AAED3N,sBAAoBjI,SAApB,EAA+B;AAC7B,SAAK+V,oBAAL,CAA0B/V,UAAU/C,WAApC;AACD;;AAED2E,yBAAuB;AACrB,QAAI,KAAKoE,mBAAT,EAA8B;AAC5B,WAAK1F,KAAL,CAAWjO,QAAX,CAAoB4T,mBAApB,CAAwCL,uBAAxC,EAAiE,KAAKI,mBAAtE;AACD;AACF;;AAEDuP,uBAAqBF,KAArB,EAA4B;AAC1B,QAAI,CAAC,KAAKM,mBAAN,IAA8B,KAAKA,mBAAL,CAAyBpQ,MAAzB,KAAoC8P,MAAM9P,MAA5E,EAAqF;AACnF,aAAO,IAAP;AACD;;AAED,SAAK,IAAIsK,IAAI,CAAb,EAAgBA,IAAIwF,MAAM9P,MAA1B,EAAkCsK,GAAlC,EAAuC;AACrC,UAAIwF,MAAMxF,CAAN,EAAS6F,IAAT,KAAkB,KAAKC,mBAAL,CAAyB9F,CAAzB,CAAtB,EAAmD;AACjD,eAAO,IAAP;AACD;AACF;;AAED,WAAO,KAAP;AACD;;AAED;AACA;AACA;AACAkG,uBAAqB9Y,WAArB,EAAkC;AAChC,QAAIA,eAAe,CAAC,KAAKiZ,cAAzB,EAAyC;AACvC,WAAK5V,KAAL,CAAW1O,QAAX,CAAoBC,iEAAEA,CAACC,UAAH,CAAc,EAACC,MAAMC,8DAAEA,CAACmkB,kBAAV,EAA8B3hB,MAAM,EAApC,EAAd,CAApB;AACA,WAAK0hB,cAAL,GAAsB,IAAtB;AACD;AACF;;AAEDzT,WAAS;AACP,UAAM;AACJpL,QADI,EACA4Z,WADA,EACatK,KADb,EACoBD,IADpB,EAC0B4O,IAD1B,EACgCc,MADhC,EACwCC,MADxC;AAEJC,gBAFI,EAEQ1kB,QAFR,EAEkBqjB,YAFlB,EAEgCsB,kBAFhC;AAGJC,wBAHI,EAGgBvZ,WAHhB,EAG6BwZ,SAH7B;AAIJjD,UAJI,EAIEkD,gBAJF,EAIoBC,OAJpB,EAI6BC;AAJ7B,QAKF,KAAKtW,KALT;;AAOA,UAAMuW,iBAAiBxf,OAAO,YAAP,IAAuB,KAAKiJ,KAAL,CAAW8V,MAAX,CAAkBS,cAAhE;AACA,UAAMC,iBAAiB7B,eAAeR,0BAAf,GAA4CD,qBAAnE;AACA,UAAM,EAACI,OAAD,KAAY,IAAlB;AACA,UAAMQ,WAAW0B,iBAAiBlC,OAAlC;AACA,UAAMmC,mBAAmBvC,wBAAwBI,OAAjD;;AAEA,UAAM,EAACoC,SAAD,EAAYC,cAAZ,KAA8Bb,UAAU,EAA9C;AACA,UAAM,EAACc,MAAD,KAAWF,aAAa,EAA9B;;AAEA;AACA;AACA,UAAMG,0BAA2BF,mBAAmB,IAAnB,IAA2BA,mBAAmB,KAA/E;;AAEA,UAAMG,YAAYf,UAAUA,OAAO9Q,MAAP,GAAgB,CAA5C;;AAEA,UAAM8R,sBAAuBhgB,OAAO,YAAP,IAC3B6f,MAD2B,IACjBD,mBAAmB,KAD/B;;AAGA;AACA;AACA,UAAMK,mBAAoBjgB,OAAO,YAAP,IAAuB+f,SAAvB,KACtBF,UAAUD,mBAAmB,IAA9B,IAAwC,CAACC,MAAD,IAAWC,uBAD5B,CAA1B;;AAGA;AACA,UAAMI,qBAAqBhB,sBAAsBa,SAAjD;;AAEA,UAAMI,WAAWlC,KAAK7V,KAAL,CAAW,CAAX,EAAc2V,QAAd,CAAjB;;AAEA;AACA;AACA,UAAMqC,uBAAuBxa,eAAe,CAACqY,KAAK/P,MAAlD;;AAEA,UAAM8P,QAAQ,EAAd;AACA,QAAI,CAACoC,oBAAL,EAA2B;AACzB,WAAK,IAAI5H,IAAI,CAAb,EAAgBA,IAAIuF,QAApB,EAA8BvF,GAA9B,EAAmC;AACjC,cAAM4F,OAAO+B,SAAS3H,CAAT,CAAb;AACA;AACA;AACA,cAAMvF,YAAauF,KAAKkH,gBAAN,GAA0B,iBAA1B,GAA8C,EAAhE;AACA,YAAIW,iBAAiB,CAACjC,IAAtB;AACA;AACA;AACA,YAAI,CAACiC,cAAD,IAAmB7H,MAAM,CAAzB,IAA8BgH,cAAlC,EAAkD;AAChDa,2BAAiB,IAAjB;AACD;AACDrC,cAAM9d,IAAN,CAAW,CAACmgB,cAAD,GACT,2DAAC,qEAAD,IAAM,KAAK7H,CAAX;AACE,iBAAOA,CADT;AAEE,qBAAWvF,SAFb;AAGE,oBAAU1Y,QAHZ;AAIE,gBAAM6jB,IAJR;AAKE,8BAAoBe,kBALtB;AAME,uBAAavF,WANf;AAOE,qCAA2B,KAAK3Q,KAAL,CAAWuV,yBAPxC;AAQE,0BAAgB,KAAKvV,KAAL,CAAWqX,cAR7B,GADS,GAWT,2DAAC,gFAAD,IAAiB,KAAK9H,CAAtB,EAAyB,WAAWvF,SAApC,GAXF;AAaD;AACF;;AAED,UAAMsN,mBAAmB,CACvB,SADuB,EAEvB3C,eAAe,eAAf,GAAiC,cAFV,EAGvB5K,IAHuB,CAGlB,GAHkB,CAAzB;;AAKA;AACA;AACA,WAAQ;AAAC,qHAAD;AAAwB,WAAK/J,KAA7B;AACN;AAAC,uHAAD;AAAA,UAAoB,WAAWsX,gBAA/B,EAAiD,MAAMlR,IAAvD;AACE,iBAAOC,KADT;AAEE,cAAItP,EAFN;AAGE,uBAAa4Z,WAHf;AAIE,qBAAW,KAAK3Q,KAAL,CAAWkT,IAAX,CAAgBsC,SAJ7B;AAKE,wBAAetC,QAAQA,KAAKqE,IAAd,IAAuBxgB,EALvC;AAME,4BAAkBqf,gBANpB;AAOE,iBAAO,KAAKpW,KAAL,CAAW9C,KAPpB;AAQE,mBAASmZ,OARX;AASE,kBAAQC,MATV;AAUE,qBAAWH,SAVb;AAWE,oBAAU,KAAKnW,KAAL,CAAW1O,QAXvB;AAYE,0BAAgB,KAAK0O,KAAL,CAAWqX,cAZ7B;AAcG,SAACF,oBAAD,IAA0B;AAAA;AAAA,YAAI,WAAU,cAAd,EAA6B,OAAO,EAACK,SAAS,CAAV,EAApC;AACxBzC;AADwB,SAd7B;AAiBGoC,gCACC;AAAA;AAAA,YAAK,WAAU,qBAAf;AACE;AAAA;AAAA,cAAK,WAAU,aAAf;AACGnB,uBAAW5P,IAAX,IAAmB4P,WAAW5P,IAAX,CAAgBqR,UAAhB,CAA2B,kBAA3B,CAAnB,GACC,qEAAM,WAAU,uBAAhB,EAAwC,OAAO,EAAC,oBAAqB,QAAOzB,WAAW5P,IAAK,IAA7C,EAA/C,GADD,GAEC,qEAAM,WAAY,8BAA6B4P,WAAW5P,IAAK,EAA/D,GAHJ;AAIE;AAAA;AAAA,gBAAG,WAAU,qBAAb;AACGgO,kCAAoB4B,WAAWpW,OAA/B;AADH;AAJF;AADF,SAlBJ;AA4BG7I,eAAO,YAAP,IACC;AAAA;AAAA,YAAK,WAAU,8BAAf;AACE;AAAA;AAAA;AACGigB,gCAAoB,2DAAC,2EAAD,IAAQ,QAAQ,KAAKhX,KAAL,CAAW+V,MAA3B,GADvB;AAEGgB,mCAAuB,2DAAC,4GAAD;AAF1B,WADF;AAKE;AAAA;AAAA;AACGE,kCACC,2DAAC,kHAAD,IAAqB,oBAAoBhB,kBAAzC;AAFJ;AALF;AA7BJ;AADM,KAAR;AA0CD;AAhP8C;;AAmPjD5B,QAAQjS,YAAR,GAAuB;AACrBrQ,YAAUf,OAAOe,QADI;AAErBijB,QAAM,EAFe;AAGrBgB,cAAY,EAHS;AAIrB9C,QAAM,EAJe;AAKrB7M,SAAO;AALc,CAAvB;;AAQO,MAAMqR,cAAczf,2DAAOA,CAAC+E,UAAU,EAACE,OAAOF,MAAME,KAAd,EAAqB4Y,QAAQ9Y,MAAM8Y,MAAnC,EAAV,CAAR,EAA+DhN,6DAAUA,CAACuL,OAAX,CAA/D,CAApB;;AAEA,MAAMsD,SAAN,SAAwB7X,4CAAKA,CAACC,aAA9B,CAA4C;AACjD6X,mBAAiB;AACf,UAAMC,WAAW,EAAjB;AACA,UAAMC,kBAAkB,KAAK9X,KAAL,CAAW+K,QAAX,CAAoBlB,MAApB,CAA2BmB,WAAWA,QAAQC,OAA9C,CAAxB;AACA,UAAM,EAAC8M,YAAD,EAAe,kBAAkBC,YAAjC,KAAiD,KAAKhY,KAAL,CAAW9C,KAAX,CAAiBC,MAAxE;AACA;AACA,UAAM8a,gBAAgBH,gBAAgB7S,MAAhB,GAAyB,CAAC,CAAC+S,YAAjD;;AAEA,SAAK,MAAME,SAAX,IAAwBH,aAAaI,KAAb,CAAmB,GAAnB,CAAxB,EAAiD;AAC/C,YAAMC,cAAc;AAClB/hB,aAAK6hB,SADa;AAElB7B,iBAASwB,SAAS5S,MAAT,KAAoB,CAFX;AAGlBqR,gBAAQuB,SAAS5S,MAAT,KAAoBgT,gBAAgB;AAH1B,OAApB;AAKA,UAAIC,cAAc,UAAd,IAA4BF,YAAhC,EAA8C;AAC5CH,iBAAS5gB,IAAT,CAAc,2DAAC,kFAAD,EAAcmhB,WAAd,CAAd;AACD,OAFD,MAEO;AACL,cAAMpN,UAAU8M,gBAAgBvK,IAAhB,CAAqB8K,KAAKA,EAAEthB,EAAF,KAASmhB,SAAnC,CAAhB;AACA,YAAIlN,OAAJ,EAAa;AACX6M,mBAAS5gB,IAAT,CAAc,2DAAC,WAAD,eAAiB+T,OAAjB,EAA8BoN,WAA9B,EAAd;AACD;AACF;AACF;AACD,WAAOP,QAAP;AACD;;AAED1V,WAAS;AACP,WACE;AAAA;AAAA,QAAK,WAAU,eAAf;AACG,WAAKyV,cAAL;AADH,KADF;AAKD;AAhCgD;;AAmC5C,MAAM7M,WAAW9S,2DAAOA,CAAC+E,UAAU,EAAC+N,UAAU/N,MAAM+N,QAAjB,EAA2B7N,OAAOF,MAAME,KAAxC,EAAV,CAAR,EAAmEya,SAAnE,CAAjB,C;;;;;;;;ACrTP;AAAA;AAAA;AAAA;AAAA;;AAEA,MAAMW,uBAAuBC,SAAS;AACpCxhB,MAAI,iCADgC;AAEpCqP,QAAM,oBAF8B;AAGpCxT,UAAQrB,iEAAEA,CAACiC,UAAH,CAAc;AACpB/B,UAAMC,8DAAEA,CAAC8mB,mBADW;AAEpBtkB,UAAM,EAACqL,KAAKgZ,KAAKhZ,GAAX,EAAgBkZ,UAAUF,KAAKE,QAA/B;AAFc,GAAd,CAH4B;AAOpCC,aAAW;AAPyB,CAAT,CAA7B;;AAUO,MAAMC,oBAAoBC,YAAY;AAC3C,UAAQA,QAAR;AACE,SAAK,KAAL;AACE,aAAO,+BAAP;AACF,SAAK,QAAL;AACE,aAAO,8BAAP;AACF,SAAK,OAAL;AACE,aAAO,6BAAP;AACF;AACE,aAAO,+BAAP;AARJ;AAUD,CAXM;;AAaP;;;;;AAKO,MAAMC,kBAAkB;AAC7BC,aAAW,OAAO,EAACrnB,MAAM,WAAP,EAAP,CADkB;AAE7BsnB,aAAW,OAAO,EAACtnB,MAAM,OAAP,EAAP,CAFkB;AAG7BunB,kBAAgBT,SAAS;AACvBxhB,QAAI,6BADmB;AAEvBqP,UAAM,gBAFiB;AAGvBxT,YAAQrB,iEAAEA,CAACC,UAAH,CAAc;AACpBC,YAAMC,8DAAEA,CAACunB,qBADW;AAEpB/kB,YAAMqkB,KAAKW;AAFS,KAAd,CAHe;AAOvBR,eAAW;AAPY,GAAT,CAHa;AAY7BS,eAAaZ,SAAS;AACpBxhB,QAAI,sBADgB;AAEpBqP,UAAM,iBAFc;AAGpBxT,YAAQrB,iEAAEA,CAACC,UAAH,CAAc;AACpBC,YAAMC,8DAAEA,CAAC0nB,YADW;AAEpBllB,YAAM,EAACqL,KAAKgZ,KAAKhZ,GAAX,EAAgB8G,OAAOkS,KAAKlS,KAA5B,EAAmC5U,MAAM8mB,KAAK9mB,IAA9C;AAFc,KAAd,CAHY;AAOpBinB,eAAW;AAPS,GAAT,CAZgB;AAqB7BW,mBAAiBd,SAAS;AACxBxhB,QAAI,6BADoB;AAExBqP,UAAM,YAFkB;AAGxBxT,YAAQrB,iEAAEA,CAACC,UAAH,CAAc;AACpBC,YAAMC,8DAAEA,CAAC4nB,eADW;AAEpBplB,YAAM;AACJukB,kBAAUF,KAAKE,QADX;AAEJc,oBAAYhB,KAAKgB,UAFb;AAGJha,aAAKgZ,KAAKhZ;AAHN;AAFc,KAAd,CAHgB;AAWxBmZ,eAAW;AAXa,GAAT,CArBY;AAkC7Bc,YAAU,CAACjB,IAAD,EAAOkB,KAAP,EAAc9I,WAAd,MAA+B;AACvC5Z,QAAI,qBADmC;AAEvCqP,UAAM,SAFiC;AAGvCxT,YAAQrB,iEAAEA,CAACC,UAAH,CAAc;AACpBC,YAAMC,8DAAEA,CAACgoB,SADW;AAEpBxlB,YAAM,EAACqL,KAAKgZ,KAAKoB,QAAL,IAAiBpB,KAAKhZ,GAA5B,EAAiCqa,WAAWrB,KAAKqB,SAAjD;AAFc,KAAd,CAH+B;AAOvCC,gBAAYtoB,iEAAEA,CAACoD,eAAH,CAAmB;AAC7BO,cAAQyb,WADqB;AAE7BmJ,aAAO,CAFsB;AAG7B5E,aAAO,CAAC,EAACne,IAAIwhB,KAAKnD,IAAV,EAAgB2E,KAAKN,KAArB,EAAD;AAHsB,KAAnB,CAP2B;AAYvCf,eAAW;AAZ4B,GAA/B,CAlCmB;;AAiD7B;AACA;AACAsB,iBAAe,CAACzB,IAAD,EAAOkB,KAAP,EAAc9I,WAAd,MAA+B;AAC5C5Z,QAAI,4BADwC;AAE5CkjB,eAAW,qBAFiC;AAG5C7T,UAAM,SAHsC;AAI5CxT,YAAQrB,iEAAEA,CAAC0D,WAAH,CAAevD,8DAAEA,CAACwoB,cAAlB,EAAkC;AACxChlB,cAAQyb,WADgC;AAExCpR,WAAKgZ,KAAKhZ,GAF8B;AAGxC4a,uBAAiBV;AAHuB,KAAlC;AAJoC,GAA/B,CAnDc;AA6D7BW,aAAW,CAAC7B,IAAD,EAAOkB,KAAP,EAAc9I,WAAd,EAA2B0J,SAA3B,EAAsCC,QAAtC,MAAoD;AAC7DvjB,QAAI,oBADyD;AAE7DqP,UAAM,QAFuD;AAG7DxT,YAAQ;AACNnB,YAAMC,8DAAEA,CAAC6oB,WADH;AAENrmB,YAAM;AACJ0c,mBAAW,CACTrf,iEAAEA,CAACC,UAAH,CAAc,EAACC,MAAMC,8DAAEA,CAAC8oB,kBAAV,EAA8BtmB,MAAM,EAACqL,KAAKgZ,KAAKhZ,GAAX,EAAgBqa,WAAWrB,KAAKqB,SAAhC,EAA2Ca,YAAYlC,KAAKW,YAA5D,EAApC,EAAd,CADS,EAET3nB,iEAAEA,CAAC0C,SAAH,CAAaoI,OAAOC,MAAP,CAAc,EAAC7D,OAAO,QAAR,EAAkBvD,QAAQyb,WAA1B,EAAuCwJ,iBAAiBV,KAAxD,EAAd,EAA8Ea,QAA9E,CAAb,CAFS,CADP;AAKJ3J,mBALI;AAMJI,wBAAgB,CAAC,2BAAD,EAA8B,kCAA9B,CANZ;AAOJG,kCAA0B,oBAPtB;AAQJD,iCAAyB,6BARrB;AASJ7K,cAAM;AATF;AAFA,KAHqD;AAiB7DsS,eAAW;AAjBkD,GAApD,CA7DkB;AAgF7BgC,YAAU,CAACnC,IAAD,EAAOkB,KAAP,EAAc9I,WAAd,EAA2B0J,SAA3B,EAAsCC,QAAtC,EAAgD1B,QAAhD,MAA8D;AACtE7hB,QAAI4hB,kBAAkBC,QAAlB,CADkE;AAEtExS,UAAM,QAFgE;AAGtExT,YAAQrB,iEAAEA,CAACiC,UAAH,CAAc;AACpB/B,YAAMC,8DAAEA,CAACipB,kBADW;AAEpBzmB,YAAM,EAACqL,KAAKgZ,KAAKhZ,GAAX;AAFc,KAAd;AAH8D,GAA9D,CAhFmB;AAwF7Bqb,YAAUrC,SAAS;AACjBxhB,QAAI,uBADa;AAEjBqP,UAAM,WAFW;AAGjBxT,YAAQrB,iEAAEA,CAACiC,UAAH,CAAc;AACpB/B,YAAMC,8DAAEA,CAACmpB,kBADW;AAEpB3mB,YAAM,EAACqL,KAAKgZ,KAAKhZ,GAAX;AAFc,KAAd;AAHS,GAAT,CAxFmB;AAgG7Bub,oBAAkBvC,SAAS;AACzBxhB,QAAI,gCADqB;AAEzBqP,UAAM,MAFmB;AAGzBxT,YAAQrB,iEAAEA,CAACiC,UAAH,CAAc;AACpB/B,YAAMC,8DAAEA,CAACqpB,kBADW;AAEpB7mB,YAAM,EAACqL,KAAKgZ,KAAKhZ,GAAX;AAFc,KAAd;AAHiB,GAAT,CAhGW;AAwG7Byb,oBAAkBzC,SAAS;AACzBxhB,QAAI,iCADqB;AAEzBqP,UAAM,UAFmB;AAGzBxT,YAAQrB,iEAAEA,CAACiC,UAAH,CAAc;AACpB/B,YAAMC,8DAAEA,CAACupB,SADW;AAEpB/mB,YAAM,EAACqL,KAAKgZ,KAAKE,QAAX;AAFc,KAAd,CAHiB;AAOzByC,cAAU,CAAC3C,KAAKE;AAPS,GAAT,CAxGW;AAiH7B0C,kBAAgB5C,SAAS;AACvBxhB,QAAI,6BADmB;AAEvBqP,UAAM,QAFiB;AAGvBxT,YAAQrB,iEAAEA,CAACiC,UAAH,CAAc;AACpB/B,YAAMC,8DAAEA,CAAC0pB,oBADW;AAEpBlnB,YAAM,EAACqL,KAAKgZ,KAAKhZ,GAAX;AAFc,KAAd;AAHe,GAAT,CAjHa;AAyH7B8b,cAAY,CAAC,EAAC9b,GAAD,EAAM+b,aAAN,EAAqB5L,KAArB,EAAD,EAA8B+J,KAA9B,MAAyC;AACnD1iB,QAAI,iBAD+C;AAEnDqP,UAAM,KAF6C;AAGnDxT,YAAQrB,iEAAEA,CAACC,UAAH,CAAc;AACpBC,YAAMC,8DAAEA,CAAC6pB,aADW;AAEpBrnB,YAAM;AACJqkB;AACEhZ;AADF,WAEM+b,iBAAiB,EAACA,aAAD,EAAgB5L,KAAhB,EAFvB,CADI;AAKJ+J;AALI;AAFc,KAAd,CAH2C;AAanDf,eAAW;AAbwC,GAAzC,CAzHiB;AAwI7B8C,gBAAcjD,SAAS;AACrBxhB,QAAI,mBADiB;AAErBqP,UAAM,OAFe;AAGrBxT,YAAQrB,iEAAEA,CAACC,UAAH,CAAc;AACpBC,YAAMC,8DAAEA,CAAC+pB,eADW;AAEpBvnB,YAAM,EAACqkB,MAAM,EAAChZ,KAAKgZ,KAAKhZ,GAAX,EAAP;AAFc,KAAd,CAHa;AAOrBmZ,eAAW;AAPU,GAAT,CAxIe;AAiJ7BgD,gBAAc,CAACnD,IAAD,EAAOkB,KAAP,EAAc9I,WAAd,MAA+B;AAC3C5Z,QAAI,4BADuC;AAE3CqP,UAAM,aAFqC;AAG3CxT,YAAQrB,iEAAEA,CAACC,UAAH,CAAc;AACpBC,YAAMC,8DAAEA,CAACiqB,cADW;AAEpBznB,YAAM,EAACqkB,MAAM,EAAChZ,KAAKgZ,KAAKhZ,GAAX,EAAgB8G,OAAOkS,KAAKlS,KAA5B,EAAP;AAFc,KAAd,CAHmC;AAO3CwT,gBAAYtoB,iEAAEA,CAACoD,eAAH,CAAmB;AAC7BO,cAAQyb,WADqB;AAE7BiL,cAAQ,CAFqB;AAG7B1G,aAAO,CAAC,EAACne,IAAIwhB,KAAKnD,IAAV,EAAgB2E,KAAKN,KAArB,EAAD;AAHsB,KAAnB,CAP+B;AAY3Cf,eAAW;AAZgC,GAA/B,CAjJe;AA+J7BmD,oBAAkBtD,SAAS;AACzBxhB,QAAI,2BADqB;AAEzBqP,UAAM,QAFmB;AAGzBxT,YAAQrB,iEAAEA,CAACC,UAAH,CAAc;AACpBC,YAAMC,8DAAEA,CAACoqB,kBADW;AAEpB5nB,YAAM,EAAC0lB,WAAWrB,KAAKqB,SAAjB;AAFc,KAAd,CAHiB;AAOzBlB,eAAW;AAPc,GAAT,CA/JW;AAwK7BqD,qBAAmBxD,SAAS;AAC1BxhB,QAAI,4BADsB;AAE1BqP,UAAM,OAFoB;AAG1BxT,YAAQrB,iEAAEA,CAACC,UAAH,CAAc;AACpBC,YAAMC,8DAAEA,CAACsqB,mBADW;AAEpB9nB,YAAM,EAAC0lB,WAAWrB,KAAKqB,SAAjB;AAFc,KAAd,CAHkB;AAO1BlB,eAAW;AAPe,GAAT,CAxKU;AAiL7BuD,eAAa,CAAC1D,IAAD,EAAOkB,KAAP,MAAkB;AAC7B1iB,QAAI,2BADyB;AAE7BqP,UAAM,MAFuB;AAG7BxT,YAAQ;AACNnB,YAAMC,8DAAEA,CAACwqB,cADH;AAENhoB,YAAM,EAACulB,KAAD;AAFA;AAHqB,GAAlB,CAjLgB;AAyL7B0C,iBAAe5D,QAASA,KAAKW,YAAL,GAAoBL,gBAAgBG,cAAhB,CAA+BT,IAA/B,CAApB,GAA2DM,gBAAgBM,WAAhB,CAA4BZ,IAA5B,CAzLtD;AA0L7B6D,mBAAiB,CAAC7D,IAAD,EAAOkB,KAAP,KAAkBlB,KAAK8D,QAAL,GAAgBxD,gBAAgB2C,YAAhB,CAA6BjD,IAA7B,CAAhB,GAAqDM,gBAAgBwC,UAAhB,CAA2B9C,IAA3B,EAAiCkB,KAAjC,CA1L3D;AA2L7B6C,sBAAoB,CAAC/D,IAAD,EAAOkB,KAAP,KAAkBlB,KAAKqB,SAAL,GAAiBf,gBAAgBgD,gBAAhB,CAAiCtD,IAAjC,CAAjB,GAA0DM,gBAAgB6C,YAAhB,CAA6BnD,IAA7B,EAAmCkB,KAAnC,CA3LnE;AA4L7B8C,0BAAwBhE,QAASA,KAAKqB,SAAL,GAAiBf,gBAAgBkD,iBAAhB,CAAkCxD,IAAlC,CAAjB,GAA2DM,gBAAgBsD,aAAhB,CAA8B5D,IAA9B,CA5L/D;AA6L7BiE,uBAAqB,CAACjE,IAAD,EAAOkB,KAAP,EAAc9I,WAAd,EAA2B0J,SAA3B,KAA0CA,YAAY/B,qBAAqBC,IAArB,CAAZ,GAAyCM,gBAAgBE,SAAhB;AA7L3E,CAAxB,C;;;;;;;AC9BP;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AACA;AACA;AACA;AACA;AACA;;AAEA,MAAM0D,4BAA4B,CAAC,iBAAD,EAAoB,aAApB,EAAmC,WAAnC,EAAgD,iBAAhD,EAAmE,qBAAnE,EAA0F,WAA1F,EAAuG,UAAvG,CAAlC;;AAEO,MAAMC,SAAN,SAAwB5c,4CAAKA,CAACC,aAA9B,CAA4C;AACjD4c,eAAa;AACX,UAAM,EAAC3c,KAAD,KAAU,IAAhB;AACA,UAAM,EAACuY,IAAD,EAAOkB,KAAP,EAAcvkB,MAAd,EAAsB0nB,wBAAtB,EAAgDtC,QAAhD,EAA0D1B,QAA1D,KAAsE5Y,KAA5E;;AAEA;AACA,UAAM6c,cAAe,CAACtE,KAAKuE,SAAN,IAAmBvE,KAAK+C,aAAzB,GAA0Ctb,MAAMnN,OAAhD,GAA0D4pB,yBAA9E;;AAEA,UAAM5pB,UAAUgqB,YAAYnW,GAAZ,CAAgBvT,KAAK0lB,iFAAeA,CAAC1lB,CAAhB,EAAmBolB,IAAnB,EAAyBkB,KAAzB,EAAgCvkB,MAAhC,EAAwC0nB,wBAAxC,EAAkEtC,QAAlE,EAA4E1B,QAA5E,CAArB,EAA4GlS,GAA5G,CAAgHqW,UAAU;AACxI,YAAM,EAACnqB,MAAD,EAASinB,UAAT,EAAqB9iB,EAArB,EAAyBkjB,SAAzB,EAAoCxoB,IAApC,EAA0CinB,SAA1C,KAAuDqE,MAA7D;AACA,UAAI,CAACtrB,IAAD,IAASsF,EAAb,EAAiB;AACfgmB,eAAOrN,KAAP,GAAe1P,MAAMyI,IAAN,CAAWC,aAAX,CAAyB,EAAC3R,IAAIkjB,aAAaljB,EAAlB,EAAzB,CAAf;AACAgmB,eAAO9W,OAAP,GAAiB,MAAM;AACrBjG,gBAAM1O,QAAN,CAAesB,MAAf;AACA,cAAI8lB,SAAJ,EAAe;AACb,kBAAMsE,gBAAgB3gB,OAAOC,MAAP,CAAc;AAClC7D,qBAAOigB,SAD2B;AAElCxjB,oBAFkC;AAGlCilB,+BAAiBV;AAHiB,aAAd,EAInBa,QAJmB,CAAtB;AAKAta,kBAAM1O,QAAN,CAAeC,iEAAEA,CAAC0C,SAAH,CAAa+oB,aAAb,CAAf;AACD;AACD,cAAInD,cAAc7Z,MAAMuV,yBAAxB,EAAmD;AACjDvV,kBAAM1O,QAAN,CAAeuoB,UAAf;AACD;AACF,SAbD;AAcD;AACD,aAAOkD,MAAP;AACD,KApBe,CAAhB;;AAsBA;AACA;AACA;AACAlqB,YAAQ,CAAR,EAAWoqB,KAAX,GAAmB,IAAnB;AACApqB,YAAQA,QAAQoS,MAAR,GAAiB,CAAzB,EAA4BiY,IAA5B,GAAmC,IAAnC;AACA,WAAOrqB,OAAP;AACD;;AAEDsP,WAAS;AACP,WAAQ,2DAAC,0FAAD;AACN,gBAAU,KAAKnC,KAAL,CAAWmd,QADf;AAEN,eAAS,KAAKR,UAAL,EAFH,GAAR;AAGD;AA1CgD;;AA6CnD,MAAM1f,WAAWD,UAAU,EAAC4f,0BAA0B5f,MAAME,KAAN,CAAYC,MAAZ,CAAmByf,wBAA9C,EAAwEhE,UAAU5b,MAAME,KAAN,CAAYC,MAAZ,CAAmByb,QAArG,EAAV,CAAjB;AACO,MAAMwE,WAAWnlB,2DAAOA,CAACgF,QAAR,EAAkB6L,6DAAUA,CAAC4T,SAAX,CAAlB,CAAjB,C;;;;;;;ACvDP;AAAA;AAAA;AAAA;AAAA;AAAA;;AAEO,MAAMW,WAAN,SAA0Bvd,4CAAKA,CAACC,aAAhC,CAA8C;AACnD9J,cAAY+J,KAAZ,EAAmB;AACjB,UAAMA,KAAN;AACA,SAAKsd,WAAL,GAAmB,KAAKA,WAAL,CAAiBrjB,IAAjB,CAAsB,IAAtB,CAAnB;AACA,SAAKgM,OAAL,GAAe,KAAKA,OAAL,CAAahM,IAAb,CAAkB,IAAlB,CAAf;AACD;;AAEDqjB,gBAAc;AACZ,SAAKtd,KAAL,CAAWmd,QAAX,CAAoB,KAApB;AACD;;AAED9b,sBAAoB;AAClB0G,eAAW,MAAM;AACf/W,aAAO4U,gBAAP,CAAwB,OAAxB,EAAiC,KAAK0X,WAAtC;AACD,KAFD,EAEG,CAFH;AAGD;;AAEDhc,yBAAuB;AACrBtQ,WAAO2U,mBAAP,CAA2B,OAA3B,EAAoC,KAAK2X,WAAzC;AACD;;AAEDrX,UAAQxN,KAAR,EAAe;AACb;AACA;AACA;AACAA,UAAM8kB,eAAN;AACD;;AAEDpb,WAAS;AACP,WAAQ;AAAA;AAAA,QAAM,WAAU,cAAhB,EAA+B,SAAS,KAAK8D,OAA7C;AACN;AAAA;AAAA,UAAI,MAAK,MAAT,EAAgB,WAAU,mBAA1B;AACG,aAAKjG,KAAL,CAAWnN,OAAX,CAAmB6T,GAAnB,CAAuB,CAACqW,MAAD,EAASxN,CAAT,KAAgBwN,OAAOtrB,IAAP,KAAgB,WAAhB,GACrC,mEAAI,KAAK8d,CAAT,EAAY,WAAU,WAAtB,GADqC,GAErCwN,OAAOtrB,IAAP,KAAgB,OAAhB,IAA2B,2DAAC,eAAD,IAAiB,KAAK8d,CAAtB,EAAyB,QAAQwN,MAAjC,EAAyC,aAAa,KAAKO,WAA3D,GAF7B;AADH;AADM,KAAR;AAQD;AArCkD;;AAwC9C,MAAME,eAAN,SAA8B1d,4CAAKA,CAACC,aAApC,CAAkD;AACvD9J,cAAY+J,KAAZ,EAAmB;AACjB,UAAMA,KAAN;AACA,SAAKiG,OAAL,GAAe,KAAKA,OAAL,CAAahM,IAAb,CAAkB,IAAlB,CAAf;AACA,SAAKwjB,SAAL,GAAiB,KAAKA,SAAL,CAAexjB,IAAf,CAAoB,IAApB,CAAjB;AACD;;AAEDgM,YAAU;AACR,SAAKjG,KAAL,CAAWsd,WAAX;AACA,SAAKtd,KAAL,CAAW+c,MAAX,CAAkB9W,OAAlB;AACD;;AAEDwX,YAAUhlB,KAAV,EAAiB;AACf,UAAM,EAACskB,MAAD,KAAW,KAAK/c,KAAtB;AACA,YAAQvH,MAAMpC,GAAd;AACE,WAAK,KAAL;AACE;AACA;AACA;AACA,YAAKoC,MAAMilB,QAAN,IAAkBX,OAAOE,KAA1B,IAAqC,CAACxkB,MAAMilB,QAAP,IAAmBX,OAAOG,IAAnE,EAA0E;AACxE,eAAKld,KAAL,CAAWsd,WAAX;AACD;AACD;AACF,WAAK,OAAL;AACE,aAAKtd,KAAL,CAAWsd,WAAX;AACAP,eAAO9W,OAAP;AACA;AAZJ;AAcD;;AAED9D,WAAS;AACP,UAAM,EAAC4a,MAAD,KAAW,KAAK/c,KAAtB;AACA,WACE;AAAA;AAAA,QAAI,MAAK,UAAT,EAAoB,WAAU,mBAA9B;AACE;AAAA;AAAA,UAAG,SAAS,KAAKiG,OAAjB,EAA0B,WAAW,KAAKwX,SAA1C,EAAqD,UAAS,GAA9D,EAAkE,WAAWV,OAAO7B,QAAP,GAAkB,UAAlB,GAA+B,EAA5G;AACG6B,eAAO3W,IAAP,IAAe,qEAAM,WAAY,yBAAwB2W,OAAO3W,IAAK,EAAtD,GADlB;AAEG2W,eAAOrN;AAFV;AADF,KADF;AAOD;AAvCsD,C;;;;;;;;AC1CzD;AAAA;AAAA;;;;;;;;;;;;AAYO,MAAMiO,kBAAkB;AAC7BC,SAAOC,OAAP,EAAgBC,KAAhB,EAAuB;AACrB,WAAO,CAAC,EAAEA,SAASA,MAAMC,IAAf,KAAyB,CAACF,OAAD,IAAYC,MAAM5pB,IAAnB,IAA6B2pB,WAAWC,MAAMve,GAAtE,CAAF,CAAR;AACD,GAH4B;;AAK7B;AACAye,yBAAuBC,WAAvB,EAAoC;AAClC,QAAI,CAACA,WAAL,EAAkB;AAChB,aAAO,IAAP;AACD;AACD,QAAI,KAAKL,MAAL,CAAY,KAAZ,EAAmBK,WAAnB,CAAJ,EAAqC;AACnC,aAAO,EAAC1e,KAAKvO,OAAOsO,GAAP,CAAW4e,eAAX,CAA2BD,YAAY/pB,IAAvC,CAAN,EAAoD6pB,MAAME,YAAYF,IAAtE,EAAP;AACD;AACD,WAAO,EAACxe,KAAK0e,WAAN,EAAP;AACD,GAd4B;;AAgB7B;AACA;AACAE,2BAAyBC,UAAzB,EAAqC;AACnC,QAAI,KAAKR,MAAL,CAAY,IAAZ,EAAkBQ,UAAlB,CAAJ,EAAmC;AACjCptB,aAAOsO,GAAP,CAAW+e,eAAX,CAA2BD,WAAW7e,GAAtC;AACD;AACF,GAtB4B;;AAwB7B;AACA+e,qBAAmBF,UAAnB,EAA+BH,WAA/B,EAA4C;AAC1C;AACA,QAAIA,eAAeG,UAAnB,EAA+B;AAC7B,aAAO,KAAKR,MAAL,CAAY,KAAZ,EAAmBK,WAAnB,IACAG,WAAWL,IAAX,KAAoBE,YAAYF,IADhC,GAEAK,WAAW7e,GAAX,KAAmB0e,WAF1B;AAGD;;AAED;AACA;AACA,WAAO,CAACA,WAAD,IAAgB,CAACG,UAAxB;AACD;AApC4B,CAAxB,C;;;;;;;;ACZP;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AACA;AACA;AACA;AACA;AACA;;AAEA,MAAM/Y,UAAU,SAAhB;AACA,MAAMC,0BAA0B,kBAAhC;;AAEA,SAAS8O,mBAAT,CAA6BxU,OAA7B,EAAsC;AACpC,SAAO,OAAOA,OAAP,KAAmB,QAAnB,GAA8B;AAAA;AAAA;AAAOA;AAAP,GAA9B,GAAuD,2DAAC,2DAAD,EAAsBA,OAAtB,CAA9D;AACD;;AAEM,MAAM2e,mBAAN,SAAkCze,4CAAKA,CAACC,aAAxC,CAAsD;AAC3D9J,cAAY+J,KAAZ,EAAmB;AACjB,UAAMA,KAAN;AACA,SAAKwe,WAAL,GAAmB,KAAKA,WAAL,CAAiBvkB,IAAjB,CAAsB,IAAtB,CAAnB;AACA,SAAKwkB,aAAL,GAAqB,KAAKA,aAAL,CAAmBxkB,IAAnB,CAAwB,IAAxB,CAArB;AACA,SAAKykB,eAAL,GAAuB,KAAKA,eAAL,CAAqBzkB,IAArB,CAA0B,IAA1B,CAAvB;AACA,SAAK0kB,wBAAL,GAAgC,KAAKA,wBAAL,CAA8B1kB,IAA9B,CAAmC,IAAnC,CAAhC;AACA,SAAK2kB,iBAAL,GAAyB,KAAKA,iBAAL,CAAuB3kB,IAAvB,CAA4B,IAA5B,CAAzB;AACA,SAAK4kB,sBAAL,GAA8B,KAAKA,sBAAL,CAA4B5kB,IAA5B,CAAiC,IAAjC,CAA9B;AACA,SAAK6kB,sBAAL,GAA8B,KAAKA,sBAAL,CAA4B7kB,IAA5B,CAAiC,IAAjC,CAA9B;AACA,SAAK8kB,YAAL,GAAoB,KAAKA,YAAL,CAAkB9kB,IAAlB,CAAuB,IAAvB,CAApB;AACA,SAAK+C,KAAL,GAAa,EAACgiB,iBAAiB,IAAlB,EAAwBC,aAAa,KAArC,EAA4CC,iBAAiB,KAA7D,EAAoEC,iBAAiB,KAArF,EAAb;AACD;;AAEDje,uBAAqB;AACnB,SAAKlB,KAAL,CAAWjO,QAAX,CAAoB6T,gBAApB,CAAqCN,uBAArC,EAA8D,KAAKqZ,wBAAnE;AACD;;AAEDhX,sBAAoBjI,SAApB,EAA+B;AAC7B;AACA,QAAI,CAAC,KAAKM,KAAL,CAAWwV,SAAZ,IAAyB9V,UAAU8V,SAAvC,EAAkD;AAChD;AACA;AACA;AACA;AACA,WAAK4J,WAAL,CAAiBC,YAAjB,CALgD,CAKjB;AAChC;AACF;;AAED/d,yBAAuB;AACrB,SAAKtB,KAAL,CAAWjO,QAAX,CAAoB4T,mBAApB,CAAwCL,uBAAxC,EAAiE,KAAKqZ,wBAAtE;AACD;;AAEDA,6BAA2B;AACzB;AACA,UAAM3N,UAAU,KAAKhR,KAAL,CAAWjO,QAAX,CAAoB0T,eAApB,KAAwCJ,OAAxD;AACA,QAAI,KAAKrI,KAAL,CAAWgiB,eAAX,KAA+BhO,OAAnC,EAA4C;AAC1C,WAAK/P,QAAL,CAAc,EAAC+d,iBAAiBhO,OAAlB,EAAd;AACD;AACF;;AAEDwN,cAAYc,IAAZ,EAAkB;AAChB,SAAKF,WAAL,GAAmBE,IAAnB;AACD;;AAEDb,kBAAgB;AACd;AACA;AACA;AACA;AACA,QAAI,CAAC,KAAKW,WAAN,IAAqB,KAAKpf,KAAL,CAAWwV,SAAX,KAAyBzH,SAAlD,EAA6D;AAC3D;AACD;;AAED;AACA,SAAK9M,QAAL,CAAc;AACZge,mBAAa,IADD;AAEZM,iBAAY,GAAE,KAAKC,qBAAL,EAA6B;AAF/B,KAAd;AAIA,UAAM,EAAC5sB,MAAD,EAAS8lB,SAAT,KAAsB+G,uFAAkBA,CAACC,cAAnB,CAAkC,KAAK1f,KAAvC,CAA5B;AACA,SAAKA,KAAL,CAAW1O,QAAX,CAAoBsB,MAApB;AACA,SAAKoN,KAAL,CAAW1O,QAAX,CAAoBC,iEAAEA,CAAC0C,SAAH,CAAa;AAC/BwE,aAAOigB,SADwB;AAE/BxjB,cAAQ,KAAK8K,KAAL,CAAW9K;AAFY,KAAb,CAApB;AAID;;AAEDsqB,0BAAwB;AACtB,UAAMG,MAAM,KAAKP,WAAjB;AACA,QAAIO,IAAI3jB,KAAJ,CAAUC,OAAV,KAAsB,MAA1B,EAAkC;AAChC;AACA;AACA;AACA0jB,UAAI3jB,KAAJ,CAAUC,OAAV,GAAoB,OAApB;AACD;AACD,WAAO0jB,IAAIN,YAAX;AACD;;AAEDX,kBAAgBjmB,KAAhB,EAAuB;AACrB;AACA,QAAIA,MAAM9E,MAAN,KAAiB8E,MAAMmnB,aAA3B,EAA0C;AACxC,WAAK3e,QAAL,CAAc,EAACge,aAAa,KAAd,EAAd;AACD;AACF;;AAEDY,eAAa;AACX,UAAM,EAACzZ,IAAD,KAAS,KAAKpG,KAApB;AACA,QAAIoG,QAAQA,KAAKqR,UAAL,CAAgB,kBAAhB,CAAZ,EAAiD;AAC/C,aAAO,qEAAM,WAAU,wBAAhB,EAAyC,OAAO,EAACqI,iBAAkB,QAAO1Z,IAAK,IAA/B,EAAhD,GAAP;AACD;AACD,WAAO,qEAAM,WAAY,+BAA8BA,QAAQ,cAAe,EAAvE,GAAP;AACD;;AAEDwY,oBAAkBnmB,KAAlB,EAAyB;AACvBA,UAAM4P,cAAN;AACA,SAAKpH,QAAL,CAAc,EAACke,iBAAiB,IAAlB,EAAd;AACD;;AAEDN,2BAAyB;AACvB,SAAK5d,QAAL,CAAc,EAACie,iBAAiB,IAAlB,EAAd;AACD;;AAEDJ,2BAAyB;AACvB,SAAK7d,QAAL,CAAc,EAACie,iBAAiB,KAAlB,EAAd;AACD;;AAEDH,eAAaI,eAAb,EAA8B;AAC5B,SAAKle,QAAL,CAAc,EAACke,eAAD,EAAd;AACD;;AAEDhd,WAAS;AACP,UAAM4d,gBAAgB,KAAK/f,KAAL,CAAWwV,SAAX,KAAyBzH,SAA/C;AACA,UAAM,EAACiR,eAAD,EAAkBC,WAAlB,EAA+BM,SAA/B,EAA0CL,eAA1C,EAA2DC,eAA3D,KAA8E,KAAKniB,KAAzF;AACA,UAAM,EAACjG,EAAD,EAAK4Z,WAAL,EAAkB6E,SAAlB,EAA6BW,SAA7B,EAAwC9P,KAAxC,EAA+C2Z,gBAA/C,EAAiEC,YAAjE,EAA+E7J,gBAA/E,EAAiG9kB,QAAjG,EAA2G+kB,OAA3G,EAAoHC,MAApH,EAA4He,cAA5H,KAA8I,KAAKrX,KAAzJ;AACA,UAAM4G,SAASsY,mBAAmBC,eAAlC;AACA,QAAIe,SAAJ;AACA,QAAIjB,eAAe,CAACzJ,SAApB,EAA+B;AAC7B0K,kBAAY,EAACX,SAAD,EAAZ;AACD,KAFD,MAEO,IAAI,CAACN,WAAD,IAAgBzJ,SAApB,EAA+B;AACpC0K,kBAAY,EAACjkB,SAAS,MAAV,EAAZ;AACD;AACD,WACE;AAAA;AAAA;AACE,mBAAY,uBAAsB,KAAK+D,KAAL,CAAWgK,SAAU,GAAEgV,kBAAkB,oBAAlB,GAAyC,EAAG,GAAExJ,YAAY,YAAZ,GAA2B,EAAG,GAAE5O,SAAS,SAAT,GAAqB,EAAG;AAC/J;AAFF,UAGE,mBAAiB7P,EAHnB;AAIE;AAAA;AAAA,UAAK,WAAU,iBAAf;AACE;AAAA;AAAA,YAAI,WAAU,eAAd;AACE;AAAA;AAAA,cAAM,WAAU,wBAAhB;AACE;AAAA;AAAA,gBAAM,WAAU,cAAhB,EAA+B,SAAS,KAAK0nB,aAA7C;AACG,mBAAKoB,UAAL,EADH;AAEGzL,kCAAoB/N,KAApB;AAFH,aADF;AAKE;AAAA;AAAA,gBAAM,WAAU,cAAhB,EAA+B,SAAS,KAAKoY,aAA7C;AACGsB,+BAAiB,qEAAM,WAAY,0BAAyBvK,YAAY,8BAAZ,GAA6C,2BAA4B,EAApH;AADpB,aALF;AAQE;AAAA;AAAA;AACGW,2BACC;AAAA;AAAA,kBAAM,WAAU,iBAAhB;AACE;AAAA;AAAA,oBAAG,MAAMA,UAAUhB,IAAV,CAAe1X,IAAxB;AACE,6EAAC,2DAAD,IAAkB,IAAI0Y,UAAUhB,IAAV,CAAepe,EAArC;AADF;AADF;AAFJ;AARF;AADF,SADF;AAqBE;AAAA;AAAA;AACE;AAAA;AAAA;AACE,yBAAU,0BADZ;AAEE,qBAAO,KAAKiJ,KAAL,CAAWyI,IAAX,CAAgBC,aAAhB,CAA8B,EAAC3R,IAAI,oBAAL,EAA9B,CAFT;AAGE,uBAAS,KAAK6nB,iBAHhB;AAIE,4BAAc,KAAKC,sBAJrB;AAKE,4BAAc,KAAKC,sBALrB;AAME;AAAA;AAAA,gBAAM,WAAU,SAAhB;AACE,yEAAC,2DAAD,IAAkB,IAAG,gCAArB;AADF;AANF,WADF;AAWGK,6BACC,2DAAC,0FAAD;AACE,gBAAIpoB,EADN;AAEE,0BAAcipB,gBAFhB;AAGE,yBAAarP,WAHf;AAIE,0BAAcsP,YAJhB;AAKE,8BAAkB7J,gBALpB;AAME,uBAAWZ,SANb;AAOE,sBAAU,KAAKuJ,YAPjB;AAQE,qBAAS1I,OARX;AASE,oBAAQC,MATV;AAUE,sBAAUhlB,QAVZ;AAWE,4BAAgB+lB,cAXlB;AAZJ;AArBF,OAJF;AAoDE;AAAC,wGAAD;AAAA,UAAe,WAAU,uBAAzB;AACE;AAAA;AAAA;AACE,uBAAY,eAAc4H,cAAc,YAAd,GAA6B,EAAG,EAD5D;AAEE,6BAAiB,KAAKP,eAFxB;AAGE,iBAAK,KAAKF,WAHZ;AAIE,mBAAO0B,SAJT;AAKG,eAAKlgB,KAAL,CAAW+F;AALd;AADF;AApDF,KADF;AAgED;AAzL0D;;AA4L7DwY,oBAAoBnc,YAApB,GAAmC;AACjCrQ,YAAUf,OAAOe,QAAP,IAAmB;AAC3B6T,sBAAkB,MAAM,CAAE,CADC;AAE3BD,yBAAqB,MAAM,CAAE,CAFF;AAG3BF,qBAAiB;AAHU,GADI;AAMjCvI,SAAO,EAACC,QAAQ,EAAT;AAN0B,CAAnC;;AASO,MAAMgjB,qBAAqBrX,6DAAUA,CAACyV,mBAAX,CAA3B,C;;;;;;;;ACnNP;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AACA;AACA;AACA;AACA;;AAEA,MAAM6B,+BAA+B,CAAC,QAAD,EAAW,UAAX,EAAuB,WAAvB,EAAoC,eAApC,EAAqD,gBAArD,EAAuE,WAAvE,EAAoF,eAApF,CAArC;AACA,MAAMC,8BAA8B,CAAC,QAAD,EAAW,UAAX,EAAuB,WAAvB,EAAoC,gBAApC,EAAsD,WAAtD,EAAmE,oBAAnE,CAApC;;AAEO,MAAMC,YAAN,SAA2BxgB,4CAAKA,CAACC,aAAjC,CAA+C;AACpD4c,eAAa;AACX,UAAM,EAAC3c,KAAD,KAAU,IAAhB;;AAEA,UAAM6c,cAAc7c,MAAMqX,cAAN,GAAuB,CAAC,GAAGgJ,2BAAJ,CAAvB,GAA0D,CAAC,GAAGD,4BAAJ,CAA9E;AACA;AACA,QAAIpgB,MAAMugB,YAAV,EAAwB;AACtB1D,kBAAY2D,MAAZ,CAAmB,CAAnB,EAAsB,CAAtB,EAAyB,GAAGxgB,MAAMugB,YAAlC,EAAgD,WAAhD;AACD;AACD;AACA,QAAIvgB,MAAMoW,gBAAV,EAA4B;AAC1ByG,kBAAY2D,MAAZ,CAAmB,CAAC,CAApB,EAAuB,CAAvB,EAA0B,eAA1B;AACD;;AAED,UAAM3tB,UAAUgqB,YAAYnW,GAAZ,CAAgBvT,KAAKssB,uFAAkBA,CAACtsB,CAAnB,EAAsB6M,KAAtB,CAArB,EAAmD0G,GAAnD,CAAuDqW,UAAU;AAC/E,YAAM,EAACnqB,MAAD,EAASmE,EAAT,EAAatF,IAAb,EAAmBinB,SAAnB,KAAgCqE,MAAtC;AACA,UAAI,CAACtrB,IAAD,IAASsF,EAAb,EAAiB;AACfgmB,eAAOrN,KAAP,GAAe1P,MAAMyI,IAAN,CAAWC,aAAX,CAAyB,EAAC3R,EAAD,EAAzB,CAAf;AACAgmB,eAAO9W,OAAP,GAAiB,MAAM;AACrBjG,gBAAM1O,QAAN,CAAesB,MAAf;AACA,cAAI8lB,SAAJ,EAAe;AACb1Y,kBAAM1O,QAAN,CAAeC,iEAAEA,CAAC0C,SAAH,CAAa;AAC1BwE,qBAAOigB,SADmB;AAE1BxjB,sBAAQ8K,MAAM9K;AAFY,aAAb,CAAf;AAID;AACF,SARD;AASD;AACD,aAAO6nB,MAAP;AACD,KAfe,CAAhB;;AAiBA;AACA;AACA;AACAlqB,YAAQ,CAAR,EAAWoqB,KAAX,GAAmB,IAAnB;AACApqB,YAAQA,QAAQoS,MAAR,GAAiB,CAAzB,EAA4BiY,IAA5B,GAAmC,IAAnC;AACA,WAAOrqB,OAAP;AACD;;AAEDsP,WAAS;AACP,WAAQ,2DAAC,0FAAD;AACN,gBAAU,KAAKnC,KAAL,CAAWmd,QADf;AAEN,eAAS,KAAKR,UAAL,EAFH,GAAR;AAGD;AA3CmD;;AA8C/C,MAAM8D,cAAc3X,6DAAUA,CAACwX,YAAX,CAApB,C;;;;;;;ACvDP;AAAA;AAAA;AAAA;;AAEA;;;;AAIO,MAAMb,qBAAqB;AAChC3G,aAAW,OAAO,EAACrnB,MAAM,WAAP,EAAP,CADqB;AAEhCivB,UAAQ1V,YAAY;AAClBjU,QAAI,6BADc;AAElBqP,UAAM,cAFY;AAGlBxT,YAAQrB,iEAAEA,CAACiC,UAAH,CAAc;AACpB/B,YAAMC,8DAAEA,CAACivB,YADW;AAEpBzsB,YAAM,EAAC6C,IAAIiU,QAAQjU,EAAb,EAAiB6pB,WAAW,CAAC,CAA7B;AAFc,KAAd,CAHU;AAOlBlI,eAAW,cAPO;AAQlBwC,cAAU,CAAC,CAAClQ,QAAQqL;AARF,GAAZ,CAFwB;AAYhCwK,YAAU7V,YAAY;AACpBjU,QAAI,+BADgB;AAEpBqP,UAAM,gBAFc;AAGpBxT,YAAQrB,iEAAEA,CAACiC,UAAH,CAAc;AACpB/B,YAAMC,8DAAEA,CAACivB,YADW;AAEpBzsB,YAAM,EAAC6C,IAAIiU,QAAQjU,EAAb,EAAiB6pB,WAAW,CAAC,CAA7B;AAFc,KAAd,CAHY;AAOpBlI,eAAW,gBAPS;AAQpBwC,cAAU,CAAC,CAAClQ,QAAQsL;AARA,GAAZ,CAZsB;AAsBhCwK,iBAAe9V,YAAY;AACzBjU,QAAI,oCADqB;AAEzBqP,UAAM,SAFmB;AAGzBxT,YAAQrB,iEAAEA,CAACsD,OAAH,CAAWmW,QAAQiV,YAAnB,EAAiC,KAAjC,CAHiB;AAIzBvH,eAAW;AAJc,GAAZ,CAtBiB;AA4BhCqI,mBAAiB/V,YAAY;AAC3BjU,QAAI,sCADuB;AAE3BqP,UAAM,UAFqB;AAG3BxT,YAAQrB,iEAAEA,CAACiC,UAAH,CAAc,EAAC/B,MAAMC,8DAAEA,CAACsvB,oBAAV,EAAgC9sB,MAAM,EAAC6C,IAAIiU,QAAQjU,EAAb,EAAiBhC,OAAO,EAACygB,WAAW,IAAZ,EAAxB,EAAtC,EAAd,CAHmB;AAI3BkD,eAAW;AAJgB,GAAZ,CA5Be;AAkChCuI,iBAAejW,YAAY;AACzBjU,QAAI,oCADqB;AAEzBqP,UAAM,UAFmB;AAGzBxT,YAAQrB,iEAAEA,CAACiC,UAAH,CAAc,EAAC/B,MAAMC,8DAAEA,CAACsvB,oBAAV,EAAgC9sB,MAAM,EAAC6C,IAAIiU,QAAQjU,EAAb,EAAiBhC,OAAO,EAACygB,WAAW,KAAZ,EAAxB,EAAtC,EAAd,CAHiB;AAIzBkD,eAAW;AAJc,GAAZ,CAlCiB;AAwChCwI,iBAAelW,YAAY;AACzBjU,QAAI,oCADqB;AAEzBqP,UAAM,UAFmB;AAGzBxT,YAAQrB,iEAAEA,CAACiC,UAAH,CAAc,EAAC/B,MAAMC,8DAAEA,CAACgZ,aAAV,EAAd,CAHiB;AAIzBgO,eAAW;AAJc,GAAZ,CAxCiB;AA8ChCyI,sBAAoBnW,YAAY;AAC9BjU,QAAI,mCAD0B;AAE9BqP,UAAM,UAFwB;AAG9BxT,YAAQrB,iEAAEA,CAACiC,UAAH,CAAc,EAAC/B,MAAMC,8DAAEA,CAAC0vB,oBAAV,EAAgCltB,MAAM8W,QAAQjU,EAA9C,EAAd;AAHsB,GAAZ,CA9CY;AAmDhCsqB,cAAYrW,YAAY;AACtBjU,QAAI,iCADkB;AAEtBqP,UAAM,KAFgB;AAGtBxT,YAAQ,EAACnB,MAAMC,8DAAEA,CAACwqB,cAAV,EAA0BhoB,MAAM,EAACulB,OAAO,CAAC,CAAT,EAAhC,EAHc;AAItBf,eAAW;AAJW,GAAZ,CAnDoB;AAyDhC4I,qBAAmBtW,YAAY;AAC7BjU,QAAI,uCADyB;AAE7BqP,UAAM,QAFuB;AAG7BxT,YAAQ,EAACnB,MAAMC,8DAAEA,CAAC6vB,qCAAV,EAHqB;AAI7B7I,eAAW;AAJkB,GAAZ,CAzDa;AA+DhC8I,iBAAexW,YAAY;AACzBjU,QAAI,oCADqB;AAEzBqP,UAAM,MAFmB;AAGzBxT,YAAQrB,iEAAEA,CAACiC,UAAH,CAAc;AACpB/B,YAAMC,8DAAEA,CAACupB,SADW;AAEpB/mB,YAAM,EAACqL,KAAKyL,QAAQoL,gBAAd;AAFc,KAAd,CAHiB;AAOzBsC,eAAW;AAPc,GAAZ,CA/DiB;AAwEhCgH,kBAAgB1U,WAAYA,QAAQwK,SAAR,GAAoBiK,mBAAmBwB,aAAnB,CAAiCjW,OAAjC,CAApB,GAAgEyU,mBAAmBsB,eAAnB,CAAmC/V,OAAnC;AAxE5D,CAA3B,C;;;;;;;ACNP;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AACA;AACA;;AAEA;AACA;AACA,MAAMyW,oBAAoB,CAAC,YAAD,EAAe,UAAf,CAA1B;;AAEO,MAAMC,kBAAN,SAAiC5hB,4CAAKA,CAAC6hB,SAAvC,CAAiD;AACtD1rB,cAAY+J,KAAZ,EAAmB;AACjB,UAAMA,KAAN;AACA;AACA,SAAK4hB,OAAL,GAAe,KAAK5hB,KAAL,CAAW4hB,OAAX,IAAsBA,kEAArC;;AAEA,SAAKC,kBAAL,GAA0B,KAAKA,kBAAL,CAAwB5nB,IAAxB,CAA6B,IAA7B,CAA1B;AACA,SAAK6nB,iBAAL,GAAyB,KAAKA,iBAAL,CAAuB7nB,IAAvB,CAA4B,IAA5B,CAAzB;AACA,SAAK8nB,kBAAL,GAA0B,KAA1B;AACA,SAAKC,iBAAL,GAAyB,KAAzB;AACA,SAAKC,oBAAL,GAA4B,KAA5B;AACD;;AAED5gB,sBAAoB;AAClB,QAAI,CAACogB,kBAAkBzqB,QAAlB,CAA2B,KAAKgJ,KAAL,CAAWjJ,EAAtC,CAAL,EAAgD;AAC9C;AACD;;AAED,SAAKmrB,sBAAL;AACD;;AAEDpc,uBAAqB;AACnB,QAAI,CAAC2b,kBAAkBzqB,QAAlB,CAA2B,KAAKgJ,KAAL,CAAWjJ,EAAtC,CAAL,EAAgD;AAC9C;AACD;;AAED,SAAKmrB,sBAAL;AACD;;AAED;;;;;;;;;;;;;;;;;;;;AAoBAC,mBAAiBC,QAAjB,EAA2B;AACzBC,0BAAsB,MAAMta,WAAWqa,QAAX,EAAqB,CAArB,CAA5B;AACD;;AAEDE,4BAA0B;AACxB;AACA;AACA,QAAI,CAAC,KAAKtiB,KAAL,CAAWrD,WAAhB,EAA6B;AAC3B;AACA,WAAKolB,kBAAL,GAA0B,IAA1B;AACD,KAHD,MAGO,IAAI,KAAKA,kBAAT,EAA6B;AAClC,WAAKA,kBAAL,GAA0B,KAA1B;AACA;AACA,WAAKF,kBAAL;AACD;AACF;;AAEDK,2BAAyB;AACvB;AACA,QAAI,KAAKF,iBAAL,IAA0B,CAAC,KAAKhiB,KAAL,CAAWrD,WAA1C,EAAuD;AACrD;AACD;;AAED;AACA;AACA;AACA;AACA;AACA,SAAKqlB,iBAAL,GAAyB,IAAzB;AACA,SAAKG,gBAAL,CAAsB,KAAKL,iBAA3B;AACD;;AAED;;;;AAIAS,iCAA+B;AAC7B;AACA,QAAI,CAAC,KAAKN,oBAAV,EAAgC;AAC9B,WAAKA,oBAAL,GAA4B,IAA5B;AACA;AACA,YAAM5rB,MAAO,GAAE,KAAK2J,KAAL,CAAWjJ,EAAG,kBAA7B;AACA,WAAK6qB,OAAL,CAAaY,IAAb,CAAkBnsB,GAAlB;AACD;AACF;;AAED;;;;;;AAMAwrB,uBAAqB;AACnB;AACA,UAAMY,eAAgB,GAAE,KAAKziB,KAAL,CAAWjJ,EAAG,gBAAtC;AACA,SAAK6qB,OAAL,CAAaY,IAAb,CAAkBC,YAAlB;;AAEA,QAAI;AACF,YAAMC,iBAAkB,GAAE,KAAK1iB,KAAL,CAAWjJ,EAAG,kBAAxC;AACA;AACA,YAAMhC,QAAQ4tB,SAAS,KAAKf,OAAL,CAAagB,+BAAb,CAA6CH,YAA7C,IACA,KAAKb,OAAL,CAAagB,+BAAb,CAA6CF,cAA7C,CADT,EACuE,EADvE,CAAd;AAEA,WAAK1iB,KAAL,CAAW1O,QAAX,CAAoBC,iEAAEA,CAACiC,UAAH,CAAc;AAChC/B,cAAMC,8DAAEA,CAACoR,sBADuB;AAEhC;AACA5O,cAAM,EAAC,CAAE,GAAE,KAAK8L,KAAL,CAAWjJ,EAAG,kBAAlB,GAAsChC,KAAvC;AAH0B,OAAd,CAApB;AAKD,KAVD,CAUE,OAAOoP,EAAP,EAAW;AACX;AACA;AACD;AACF;;AAED2d,sBAAoB;AAClB;AACA,QAAI,KAAK9hB,KAAL,CAAWjJ,EAAX,KAAkB,UAAtB,EAAkC;AAChC;AACD;;AAED;AACA,UAAMV,MAAO,GAAE,KAAK2J,KAAL,CAAWjJ,EAAG,mBAA7B;AACA,SAAK6qB,OAAL,CAAaY,IAAb,CAAkBnsB,GAAlB;;AAEA,QAAI;AACF,YAAMnC,OAAO,EAAb;AACAA,WAAKmC,GAAL,IAAY,KAAKurB,OAAL,CAAagB,+BAAb,CAA6CvsB,GAA7C,CAAZ;;AAEA,WAAK2J,KAAL,CAAW1O,QAAX,CAAoBC,iEAAEA,CAACiC,UAAH,CAAc;AAChC/B,cAAMC,8DAAEA,CAACoR,sBADuB;AAEhC5O;AAFgC,OAAd,CAApB;AAID,KARD,CAQE,OAAOiQ,EAAP,EAAW;AACX;AACA;AACA;AACD;AACF;;AAEDhC,WAAS;AACP,QAAIsf,kBAAkBzqB,QAAlB,CAA2B,KAAKgJ,KAAL,CAAWjJ,EAAtC,CAAJ,EAA+C;AAC7C,WAAKwrB,4BAAL;AACA,WAAKD,uBAAL;AACD;AACD,WAAO,KAAKtiB,KAAL,CAAW+F,QAAlB;AACD;AAzJqD,C;;;;;;;ACRxD;AAAA;AAAA;AAAA;AACa;;AAEb;;AACA,IAAI,OAAO8c,WAAP,KAAuB,WAA3B,EAAwC;AACtCA,cAAYC,MAAZ,CAAmB,qCAAnB;AACD;;AAED,IAAIC,aAAJ;;AAEA;AACA;AACA,IAAI,OAAOC,QAAP,KAAoB,WAAxB,EAAqC;AACnC;AACAD,kBAAgBC,SAASC,QAAT,CAAkBC,eAAlB,CAAkCC,WAAlD;AACD,CAHD,MAGO,IAAI,OAAOA,WAAP,KAAuB,WAA3B,EAAwC;AAC7C;AACA;AACAJ,kBAAgBI,WAAhB;AACD,CAJM,MAIA;AACL;AACA;AACAJ,kBAAgB;AACdroB,UAAM,CAAE,CADM;AAEd8nB,WAAO,CAAE;AAFK,GAAhB;AAID;;AAED,SAASY,YAAT,CAAsBvwB,OAAtB,EAA+B;AAC7B;AACA;AACA,MAAIA,WAAWA,QAAQwwB,cAAvB,EAAuC;AACrC,SAAKC,KAAL,GAAazwB,QAAQwwB,cAArB;AACD,GAFD,MAEO;AACL,SAAKC,KAAL,GAAaP,aAAb;AACD;AACF;;;AAEDK,aAAaG,SAAb,GAAyB;AACvB;;;;;;;;AAQAf,QAAM,SAASA,IAAT,CAAcgB,GAAd,EAAmB;AACvB,SAAKF,KAAL,CAAWd,IAAX,CAAgBgB,GAAhB;AACD,GAXsB;;AAavB;;;;;;;;AAQAC,oBAAkB,SAASA,gBAAT,CAA0B3uB,IAA1B,EAAgCrD,IAAhC,EAAsC;AACtD,WAAO,KAAK6xB,KAAL,CAAWG,gBAAX,CAA4B3uB,IAA5B,EAAkCrD,IAAlC,CAAP;AACD,GAvBsB;;AAyBvB;;;;;;;;;;;;;;;AAeA,MAAIiyB,UAAJ,GAAiB;AACf,WAAO,KAAKJ,KAAL,CAAWI,UAAlB;AACD,GA1CsB;;AA4CvB;;;;;;;AAOAC,UAAQ,SAASA,MAAT,GAAkB;AACxB,WAAO,KAAKD,UAAL,GAAkB,KAAKJ,KAAL,CAAW5oB,GAAX,EAAzB;AACD,GArDsB;;AAuDvB;;;;;;;;;;;;;;;;;;AAkBAkoB,kCAAgC9tB,IAAhC,EAAsC;AACpC,QAAI8uB,UAAU,KAAKH,gBAAL,CAAsB3uB,IAAtB,EAA4B,MAA5B,CAAd;;AAEA,QAAI,CAAC8uB,QAAQ3e,MAAb,EAAqB;AACnB,YAAM,IAAIhS,KAAJ,CAAW,0BAAyB6B,IAAK,EAAzC,CAAN;AACD;;AAED,QAAI+uB,kBAAkBD,QAAQA,QAAQ3e,MAAR,GAAiB,CAAzB,CAAtB;AACA,WAAO,KAAKqe,KAAL,CAAWI,UAAX,GAAwBG,gBAAgBC,SAA/C;AACD;AAlFsB,CAAzB;;kBAqFmB,IAAIV,YAAJ,E;;;;;;;AC3HnB;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AACA;;AAEO,MAAMW,mBAAN,SAAkCjkB,4CAAKA,CAACC,aAAxC,CAAsD;AAC3DoC,WAAS;AACP,UAAM,EAAC8T,kBAAD,KAAuB,KAAKjW,KAAlC;AACA,QAAIiW,kBAAJ,EAAwB;AACtB,aACE;AAAA;AAAA,UAAG,WAAU,sBAAb,EAAoC,MAAMA,kBAA1C;AACE,mEAAC,2DAAD,IAAkB,IAAG,8BAArB;AADF,OADF;AAKD;AACD,WAAO,IAAP;AACD;AAX0D,C;;;;;;;ACH7D;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AACA;AACA;;AAEO,MAAM+N,kBAAN,SAAiClkB,4CAAKA,CAACC,aAAvC,CAAqD;AAC1DoC,WAAS;AACP,UAAM,EAACuU,SAAD,KAAc,KAAK1W,KAAL,CAAW8V,MAA/B;AACA,WACE;AAAA;AAAA,QAAM,WAAU,sBAAhB;AACE;AAAA;AAAA,UAAG,WAAU,mBAAb,EAAiC,MAAMY,UAAUuN,MAAV,GAAmBvN,UAAUuN,MAA7B,GAAsC,wBAA7E;AACEvN,kBAAUwN,SAAV,GAAsBxN,UAAUwN,SAAhC,GAA4C,2DAAC,2DAAD,IAAkB,IAAG,mBAArB;AAD9C,OADF;AAKE;AAAA;AAAA,UAAG,MAAMxN,UAAUuN,MAAV,GAAmBvN,UAAUuN,MAA7B,GAAsC,wBAA/C;AACE;AAAA;AAAA,YAAM,WAAU,UAAhB;AACEvN,oBAAUyN,OAAV,GAAoBzN,UAAUyN,OAA9B,GAAwC,2DAAC,2DAAD,IAAkB,IAAG,iBAArB;AAD1C;AADF;AALF,KADF;AAaD;AAhByD;;AAmBrD,MAAMC,oBAAoBnsB,2DAAOA,CAAC+E,UAAU,EAAC8Y,QAAQ9Y,MAAM8Y,MAAf,EAAV,CAAR,EAA2CkO,kBAA3C,CAA1B,C;;;;;;;ACvBP;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AACA;;AAEO,MAAMK,KAAN,SAAoBvkB,4CAAKA,CAACC,aAA1B,CAAwC;AAC7CoC,WAAS;AACP,UAAM,EAAC5C,GAAD,EAAMzK,IAAN,KAAc,KAAKkL,KAAzB;AACA,WAAQ;AAAA;AAAA;AAAI;AAAA;AAAA,UAAG,KAAKlL,IAAR,EAAc,MAAMyK,GAApB;AAA0BzK;AAA1B;AAAJ,KAAR;AACD;AAJ4C;;AAOxC,MAAMwvB,MAAN,SAAqBxkB,4CAAKA,CAACC,aAA3B,CAAyC;AAC9CoC,WAAS;AACP,UAAM,EAAC4T,MAAD,KAAW,KAAK/V,KAAtB;AACA,WACE;AAAA;AAAA,QAAM,WAAU,QAAhB;AACE;AAAA;AAAA;AAAM,mEAAC,2DAAD,IAAkB,IAAG,kBAArB;AAAN,OADF;AAEE;AAAA;AAAA;AAAK+V,kBAAUA,OAAOrP,GAAP,CAAW6d,KAAK,2DAAC,KAAD,IAAO,KAAKA,EAAEzvB,IAAd,EAAoB,KAAKyvB,EAAEhlB,GAA3B,EAAgC,MAAMglB,EAAEzvB,IAAxC,GAAhB;AAAf;AAFF,KADF;AAMD;AAT6C,C;;;;;;;;;;;;;;;;;;;;;;;;;;ACVhD;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA,SAAS0vB,eAAT,CAAyBrP,IAAzB,EAA+B;AAC7B,MAAIA,KAAKsP,mBAAT,EAA8B;AAC5B,WAAO,mBAAP;AACD;AACD,MAAItP,KAAKuP,YAAL,IAAqBvP,KAAKwP,UAAL,KAAoB,UAA7C,EAAyD;AACvD,WAAO,UAAP;AACD;AACD,MAAIxP,KAAKyP,WAAL,IAAoBC,wEAAxB,EAA+C;AAC7C,WAAO,WAAP;AACD;AACD,MAAI1P,KAAK2P,UAAL,IAAmB3P,KAAKyP,WAAL,IAAoBG,0EAA3C,EAAoE;AAClE,WAAO,sBAAP;AACD;AACD,MAAI5P,KAAK2P,UAAT,EAAqB;AACnB,WAAO,YAAP;AACD;AACD,SAAO,UAAP;AACD;;AAED;;;;;AAKA,SAASE,uBAAT,CAAiCC,QAAjC,EAA2C;AACzC,QAAMC,qBAAqB,CAACC,GAAD,EAAMhQ,IAAN,KAAe;AACxCgQ,QAAIX,gBAAgBrP,IAAhB,CAAJ;AACA,WAAOgQ,GAAP;AACD,GAHD;;AAKA,SAAOF,SAAStS,MAAT,CAAgBuS,kBAAhB,EAAoC;AACzC,yBAAqB,CADoB;AAEzC,4BAAwB,CAFiB;AAGzC,kBAAc,CAH2B;AAIzC,gBAAY,CAJ6B;AAKzC,iBAAa,CAL4B;AAMzC,gBAAY;AAN6B,GAApC,CAAP;AAQD;;AAEM,MAAME,SAAN,SAAwBtlB,4CAAKA,CAACC,aAA9B,CAA4C;AACjD9J,cAAY+J,KAAZ,EAAmB;AACjB,UAAMA,KAAN;AACA,SAAKqlB,eAAL,GAAuB,KAAKA,eAAL,CAAqBprB,IAArB,CAA0B,IAA1B,CAAvB;AACA,SAAKqrB,0BAAL,GAAkC,KAAKA,0BAAL,CAAgCrrB,IAAhC,CAAqC,IAArC,CAAlC;AACD;;AAED;;;AAGAsrB,2BAAyB;AACvB,UAAMN,WAAW,KAAKO,mBAAL,EAAjB;AACA,UAAMC,qBAAqBT,wBAAwBC,QAAxB,CAA3B;AACA,UAAMS,iBAAiBT,SAASpb,MAAT,CAAgB0O,QAAQ,CAAC,CAACA,KAAK8D,QAA/B,EAAyCpX,MAAhE;AACA,UAAM0gB,kBAAkBV,SAASpb,MAAT,CAAgB0O,QAAQ,CAAC,CAACA,KAAK+C,aAA/B,EAA8CrW,MAAtE;AACA;AACA,SAAKjF,KAAL,CAAW1O,QAAX,CAAoBC,iEAAEA,CAACC,UAAH,CAAc;AAChCC,YAAMC,8DAAEA,CAACoR,sBADuB;AAEhC5O,YAAM;AACJ0xB,6BAAqBH,kBADjB;AAEJI,yBAAiBH,cAFb;AAGJI,mCAA2BH;AAHvB;AAF0B,KAAd,CAApB;AAQD;;AAED;;;AAGAH,wBAAsB;AACpB;AACA,QAAIO,cAAcC,+EAAlB;AACA;AACA,QAAI,CAACh1B,OAAO4jB,UAAP,CAAmB,qBAAnB,EAAyCC,OAA9C,EAAuD;AACrDkR,qBAAe,CAAf;AACD;AACD,WAAO,KAAK/lB,KAAL,CAAWimB,QAAX,CAAoBjR,IAApB,CAAyB7V,KAAzB,CAA+B,CAA/B,EAAkC,KAAKa,KAAL,CAAWkmB,YAAX,GAA0BH,WAA5D,CAAP;AACD;;AAEDjgB,uBAAqB;AACnB,SAAKyf,sBAAL;AACD;;AAEDlkB,sBAAoB;AAClB,SAAKkkB,sBAAL;AACD;;AAEDF,oBAAkB;AAChB,SAAKrlB,KAAL,CAAW1O,QAAX,CAAoBC,iEAAEA,CAAC0C,SAAH,CAAa;AAC/BiB,cAAQixB,mEADuB;AAE/B1tB,aAAO;AAFwB,KAAb,CAApB;AAIA,SAAKuH,KAAL,CAAW1O,QAAX,CAAoB,EAACG,MAAMC,8DAAEA,CAAC00B,qBAAV,EAApB;AACD;;AAEDd,+BAA6B;AAC3B,SAAKtlB,KAAL,CAAW1O,QAAX,CAAoBC,iEAAEA,CAAC0C,SAAH,CAAa;AAC/BiB,cAAQixB,mEADuB;AAE/B1tB,aAAO;AAFwB,KAAb,CAApB;AAIA,SAAKuH,KAAL,CAAW1O,QAAX,CAAoB,EAACG,MAAMC,8DAAEA,CAAC20B,sCAAV,EAApB;AACD;;AAEDlkB,WAAS;AACP,UAAM,EAACnC,KAAD,KAAU,IAAhB;AACA,UAAM,EAACsmB,QAAD,EAAWC,uBAAX,KAAsCvmB,MAAMimB,QAAlD;AACA,UAAMjG,mBAAmB,CAAC,YAAD,CAAzB;AACA,QAAIhgB,MAAM9C,KAAN,CAAYC,MAAZ,CAAmB,sCAAnB,CAAJ,EAAgE;AAC9D6iB,uBAAiB/oB,IAAjB,CAAsB,mBAAtB;AACD;;AAED,WAAQ;AAAC,qHAAD;AAAA,QAAoB,IAAG,UAAvB,EAAkC,aAAa+I,MAAMimB,QAAN,CAAetpB,WAA9D,EAA2E,UAAUqD,MAAM1O,QAA3F;AACN;AAAC,uHAAD;AAAA;AACE,qBAAU,WADZ;AAEE,gBAAK,UAFP;AAGE,cAAG,UAHL;AAIE,iBAAO,EAACyF,IAAI,kBAAL,EAJT;AAKE,4BAAkBipB,gBALpB;AAME,wBAAa,gBANf;AAOE,uBAAamG,mEAPf;AAQE,qBAAWnmB,MAAMimB,QAAN,CAAe/S,IAAf,GAAsBlT,MAAMimB,QAAN,CAAe/S,IAAf,CAAoBsC,SAA1C,GAAsDzH,SARnE;AASE,mBAAS/N,MAAMqW,OATjB;AAUE,kBAAQrW,MAAMsW,MAVhB;AAWE,oBAAUtW,MAAM1O,QAXlB;AAYE,mEAAC,qDAAD,IAAa,UAAU0O,MAAMimB,QAA7B,EAAuC,cAAcjmB,MAAMkmB,YAA3D,EAAyE,UAAUlmB,MAAM1O,QAAzF,EAAmG,MAAM0O,MAAMyI,IAA/G,EAAqH,iBAAiB+b,eAAtI,GAZF;AAaE;AAAA;AAAA,YAAK,WAAU,uBAAf;AACG8B,sBACC;AAAA;AAAA,cAAK,WAAU,eAAf;AACE,gFAAK,WAAU,eAAf,EAA+B,SAAS,KAAKjB,eAA7C,GADF;AAEE;AAAA;AAAA,gBAAK,WAAU,OAAf;AACE,yEAAC,wDAAD;AACE,sBAAMrlB,MAAMimB,QAAN,CAAejR,IAAf,CAAoBsR,SAAS7M,KAA7B,CADR;AAEE,yBAAS,KAAK4L,eAFhB;AAGE,0BAAU,KAAKrlB,KAAL,CAAW1O,QAHvB;AAIE,sBAAM,KAAK0O,KAAL,CAAWyI;AAJnB,iBAKM6d,QALN;AADF;AAFF,WAFJ;AAcGC,qCACC;AAAA;AAAA,cAAK,WAAU,uBAAf;AACE,gFAAK,WAAU,eAAf,EAA+B,SAAS,KAAKjB,0BAA7C,GADF;AAEE;AAAA;AAAA,gBAAK,WAAU,OAAf;AACE,yEAAC,wEAAD;AACE,0BAAUtlB,MAAMimB,QADlB;AAEE,yBAAS,KAAKX,0BAFhB;AAGE,0BAAU,KAAKtlB,KAAL,CAAW1O,QAHvB;AADF;AAFF;AAfJ;AAbF;AADM,KAAR;AA0CD;AAjHgD;;AAoH5C,MAAM20B,WAAWhuB,2DAAOA,CAAC+E,UAAU;AACxCipB,YAAUjpB,MAAMipB,QADwB;AAExC/oB,SAAOF,MAAME,KAF2B;AAGxCgpB,gBAAclpB,MAAME,KAAN,CAAYC,MAAZ,CAAmBqpB;AAHO,CAAV,CAAR,EAIpB1d,6DAAUA,CAACsc,SAAX,CAJoB,CAAjB,C;;;;;;;;ACxKP;AAAA;AAAA;AAAA;AAAA;AAAA;AAAO,MAAMe,mBAAmB,WAAzB;AACA,MAAMM,iCAAiC,CAAC,iBAAD,EAAoB,aAApB,EAAmC,WAAnC,EAC5C,iBAD4C,EACzB,qBADyB,EACF,WADE,EACW,UADX,EACuB,WADvB,CAAvC;AAEP;AACO,MAAMC,kDAAkD,CAAC,iBAAD,EAAoB,WAApB,EAAiC,UAAjC,CAAxD;AACP;AACO,MAAM7B,wBAAwB,EAA9B;AACP;AACO,MAAME,0BAA0B,EAAhC,C;;;;;;;ACRP;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AACA;AACA;AACA;;AAEA,MAAM4B,wBAAN,SAAuC7mB,4CAAKA,CAACC,aAA7C,CAA2D;AACzDoC,WAAS;AACP,UAAM,EAACykB,QAAD,EAAWC,QAAX,KAAuB,KAAK7mB,KAAlC;AACA,UAAM8mB,aAAa,EAAChH,iBAAkB,QAAO8G,SAASlC,YAAa,IAAhD,EAAnB;AACA,WACE;AAAA;AAAA,QAAK,WAAU,gCAAf;AACE,4EAAO,MAAK,UAAZ,EAAuB,IAAIkC,SAASG,OAApC,EAA6C,MAAMH,SAASG,OAA5D,EAAqE,SAASF,QAA9E,EAAwF,UAAU,KAAK7mB,KAAL,CAAWgnB,QAA7G,GADF;AAEE;AAAA;AAAA,UAAO,SAASJ,SAASG,OAAzB;AACE;AAAA;AAAA,YAAK,WAAU,gBAAf;AACE;AAAA;AAAA;AACE;AAAA;AAAA,gBAAK,WAAU,MAAf;AACE,kFAAK,WAAU,yBAAf,EAAyC,OAAOD,UAAhD,EAA4D,iBAAc,GAA1E,GADF;AAEE,kFAAK,WAAU,8BAAf;AAFF,aADF;AAKE;AAAA;AAAA,gBAAK,WAAU,OAAf;AACE;AAAA;AAAA,kBAAM,KAAI,MAAV;AAAkBF,yBAASG;AAA3B;AADF;AALF;AADF;AADF;AAFF,KADF;AAkBD;AAtBwD;;AAyBpD,MAAME,mBAAN,SAAkCnnB,4CAAKA,CAACC,aAAxC,CAAsD;AAC3D9J,cAAY+J,KAAZ,EAAmB;AACjB,UAAMA,KAAN;AACA,SAAKknB,YAAL,GAAoB,KAAKA,YAAL,CAAkBjtB,IAAlB,CAAuB,IAAvB,CAApB;AACA,SAAKktB,mBAAL,GAA2B,KAAKA,mBAAL,CAAyBltB,IAAzB,CAA8B,IAA9B,CAA3B;AACA,SAAKmtB,iBAAL,GAAyB,KAAKA,iBAAL,CAAuBntB,IAAvB,CAA4B,IAA5B,CAAzB;;AAEA;AACA,UAAMotB,YAAY,EAAlB;AACA,UAAM,EAACrS,IAAD,EAAO2Q,eAAP,KAA0B3lB,MAAMimB,QAAtC;AACAN,oBAAgBzyB,OAAhB,CAAwB0zB,YAAY;AAClCS,gBAAUpwB,IAAV,mBACK2vB,QADL;AAEEU,oBAAY,CAAC,CAACtS,KAAKzH,IAAL,CAAUga,OAAOA,OAAOA,IAAIlL,QAAX,IAAuBkL,IAAIjM,aAA3B,IAA4CiM,IAAI7X,KAAJ,KAAckX,SAASG,OAApF;AAFhB;AAID,KALD;AAMA,SAAK/pB,KAAL,GAAa,EAACqqB,SAAD,EAAb;AACD;;AAEDH,eAAazuB,KAAb,EAAoB;AAClB,UAAM,EAAC9E,MAAD,KAAW8E,KAAjB;AACA,UAAM,EAAC3D,IAAD,EAAOgZ,OAAP,KAAkBna,MAAxB;AACA,SAAKsN,QAAL,CAAciC,aAAa;AACzB,YAAMmkB,YAAYnkB,UAAUmkB,SAAV,CAAoBloB,KAApB,EAAlB;AACA,UAAIynB,WAAWS,UAAU9Z,IAAV,CAAe,CAAC,EAACwZ,OAAD,EAAD,KAAeA,YAAYjyB,IAA1C,CAAf;AACA8xB,eAASU,UAAT,GAAsBxZ,OAAtB;AACA,aAAO,EAACuZ,SAAD,EAAP;AACD,KALD;AAMD;;AAEDF,sBAAoBK,EAApB,EAAwB;AACtBA,OAAGnf,cAAH;AACA,SAAKrI,KAAL,CAAWynB,OAAX;AACD;;AAEDL,oBAAkBI,EAAlB,EAAsB;AACpBA,OAAGnf,cAAH;;AAEA;AACA,UAAM,EAAC2M,IAAD,KAAS,KAAKhV,KAAL,CAAWimB,QAA1B;AACA,UAAMyB,WAAW,EAAjB;AACA,UAAMC,aAAa,EAAnB;AACA,SAAK3qB,KAAL,CAAWqqB,SAAX,CAAqBn0B,OAArB,CAA6B0zB,YAAY;AACvC,YAAMgB,gBAAgB5S,KAAKzH,IAAL,CAAUga,OAAOA,OAAOA,IAAIlL,QAAX,IAAuBkL,IAAIjM,aAA3B,IAA4CiM,IAAI7X,KAAJ,KAAckX,SAASG,OAApF,CAAtB;AACA,UAAIH,SAASU,UAAT,IAAuB,CAACM,aAA5B,EAA2C;AACzCF,iBAASzwB,IAAT,CAAc,KAAK4wB,cAAL,CAAoBjB,QAApB,CAAd;AACD,OAFD,MAEO,IAAI,CAACA,SAASU,UAAV,IAAwBM,aAA5B,EAA2C;AAChDD,mBAAW1wB,IAAX,CAAgB,EAACsI,KAAKqoB,cAAcroB,GAApB,EAAyBuoB,cAAclB,SAASmB,QAAhD,EAAhB;AACD;AACF,KAPD;;AASA;AACA,SAAK/nB,KAAL,CAAW1O,QAAX,CAAoBC,iEAAEA,CAACiC,UAAH,CAAc;AAChC/B,YAAMC,8DAAEA,CAACs2B,8BADuB;AAEhC9zB,YAAM;AACJ+zB,wBAAgBP,QADZ;AAEJQ,0BAAkBP;AAFd;AAF0B,KAAd,CAApB;;AAQA;AACAD,aAASx0B,OAAT,CAAiB0zB,YAAY;AAC3B,WAAK5mB,KAAL,CAAW1O,QAAX,CAAoBC,iEAAEA,CAAC0C,SAAH,CAAa;AAC/BiB,gBAAQixB,mEADuB;AAE/B1tB,eAAO,iBAFwB;AAG/B1D,eAAO,EAACozB,eAAevB,SAASkB,YAAzB;AAHwB,OAAb,CAApB;AAKD,KAND;AAOAH,eAAWz0B,OAAX,CAAmB0zB,YAAY;AAC7B,WAAK5mB,KAAL,CAAW1O,QAAX,CAAoBC,iEAAEA,CAAC0C,SAAH,CAAa;AAC/BiB,gBAAQixB,mEADuB;AAE/B1tB,eAAO,oBAFwB;AAG/B1D,eAAO,EAACozB,eAAevB,SAASkB,YAAzB;AAHwB,OAAb,CAApB;AAKD,KAND;;AAQA,SAAK9nB,KAAL,CAAWynB,OAAX;AACD;;AAEDI,iBAAejB,QAAf,EAAyB;AACvB,WAAO;AACLrnB,WAAKqnB,SAASrnB,GADT;AAEL+b,qBAAe,IAFV;AAGL5L,aAAOkX,SAASG,OAHX;AAILe,oBAAclB,SAASmB;AAJlB,KAAP;AAMD;;AAED5lB,WAAS;AACP,WACE;AAAA;AAAA,QAAM,WAAU,cAAhB;AACE;AAAA;AAAA,UAAK,WAAU,4BAAf;AACE;AAAA;AAAA,YAAI,WAAU,eAAd;AACE,qEAAC,2DAAD,IAAkB,IAAG,uCAArB;AADF,SADF;AAIE;AAAA;AAAA;AACG,eAAKnF,KAAL,CAAWqqB,SAAX,CAAqB3gB,GAArB,CAAyBkgB,YAAY,2DAAC,wBAAD,IAA0B,KAAKA,SAASG,OAAxC,EAAiD,UAAUH,QAA3D,EAAqE,UAAUA,SAASU,UAAxF,EAAoG,UAAU,KAAKJ,YAAnH,GAArC;AADH;AAJF,OADF;AASE;AAAA;AAAA,UAAS,WAAU,SAAnB;AACE;AAAA;AAAA,YAAQ,WAAU,QAAlB,EAA2B,MAAK,QAAhC,EAAyC,SAAS,KAAKC,mBAAvD;AACE,qEAAC,2DAAD,IAAkB,IAAG,6BAArB;AADF,SADF;AAIE;AAAA;AAAA,YAAQ,WAAU,MAAlB,EAAyB,MAAK,QAA9B,EAAuC,SAAS,KAAKC,iBAArD;AACE,qEAAC,2DAAD,IAAkB,IAAG,2BAArB;AADF;AAJF;AATF,KADF;AAoBD;AA7G0D,C;;;;;;;;;;;;;;;;;;;;;;;;AC9B7D;AACA;AACA;AAOA;AACA;AACA;AACA;;AAEO,MAAMgB,WAAN,SAA0BtoB,4CAAKA,CAACC,aAAhC,CAA8C;AACnD9J,cAAY+J,KAAZ,EAAmB;AACjB,UAAMA,KAAN;AACA,SAAKhD,KAAL,GAAa,EAACqrB,iBAAiB,IAAlB,EAAb;AACA,SAAKC,WAAL,GAAmB,KAAKA,WAAL,CAAiBruB,IAAjB,CAAsB,IAAtB,CAAnB;AACA,SAAKsuB,UAAL,GAAkB,KAAKA,UAAL,CAAgBtuB,IAAhB,CAAqB,IAArB,CAAlB;AACD;;AAED;;;;AAIAuuB,aAAWvtB,CAAX,EAAc;AACZ,WAAOA,EAAEwtB,YAAF,CAAeC,KAAf,CAAqB1xB,QAArB,CAA8B,oBAA9B,CAAP;AACD;;AAEDsxB,cAAY7vB,KAAZ,EAAmB;AACjB,YAAQA,MAAMhH,IAAd;AACE,WAAK,OAAL;AACE;AACA,YAAI,KAAKk3B,OAAT,EAAkB;AAChBlwB,gBAAM4P,cAAN;AACD;AACD;AACF,WAAK,WAAL;AACE,aAAKsgB,OAAL,GAAe,IAAf;AACAlwB,cAAMgwB,YAAN,CAAmBG,aAAnB,GAAmC,MAAnC;AACAnwB,cAAMgwB,YAAN,CAAmBva,OAAnB,CAA2B,oBAA3B,EAAiD,KAAKlO,KAAL,CAAWyZ,KAA5D;AACAhhB,cAAM9E,MAAN,CAAak1B,IAAb;AACA,aAAK7oB,KAAL,CAAWsoB,WAAX,CAAuB7vB,KAAvB,EAA8B,KAAKuH,KAAL,CAAWyZ,KAAzC,EAAgD,KAAKzZ,KAAL,CAAWmV,IAA3D,EAAiE,KAAKnV,KAAL,CAAWqG,KAA5E;AACA;AACF,WAAK,SAAL;AACE,aAAKrG,KAAL,CAAWsoB,WAAX,CAAuB7vB,KAAvB;AACA;AACF,WAAK,WAAL;AACA,WAAK,UAAL;AACA,WAAK,MAAL;AACE,YAAI,KAAK+vB,UAAL,CAAgB/vB,KAAhB,CAAJ,EAA4B;AAC1BA,gBAAM4P,cAAN;AACA,eAAKrI,KAAL,CAAWsoB,WAAX,CAAuB7vB,KAAvB,EAA8B,KAAKuH,KAAL,CAAWyZ,KAAzC;AACD;AACD;AACF,WAAK,WAAL;AACE;AACA,YAAIhhB,MAAMqwB,MAAN,KAAiB,CAAjB,IAAsB,KAAK9oB,KAAL,CAAWmV,IAAX,CAAgBmG,aAA1C,EAAyD;AACvD7iB,gBAAM4P,cAAN;AACD;AACD;AACA,aAAKsgB,OAAL,GAAe,KAAf;AACA;AAhCJ;AAkCD;;AAED;;;;;;;;;;;AAWA,SAAOI,qBAAP,CAA6BrpB,SAA7B,EAAwCwD,SAAxC,EAAmD;AACjD,UAAM,EAAC4hB,UAAD,KAAeplB,UAAUyV,IAA/B;AACA,UAAM6T,eAAerL,gFAAeA,CAACW,kBAAhB,CAAmCpb,UAAUmlB,eAA7C,EAA8DvD,UAA9D,CAArB;AACA,QAAIkE,YAAJ,EAAkB;AAChB,aAAO,IAAP;AACD;;AAED;AACArL,oFAAeA,CAACQ,wBAAhB,CAAyCjb,UAAUmlB,eAAnD;;AAEA,WAAO,EAACA,iBAAiB1K,gFAAeA,CAACK,sBAAhB,CAAuC8G,UAAvC,CAAlB,EAAP;AACD;;AAED;AACA;AACA;AACA5jB,uBAAqB;AACnB,UAAM+nB,YAAYb,YAAYW,qBAAZ,CAAkC,KAAK/oB,KAAvC,EAA8C,KAAKhD,KAAnD,CAAlB;AACA,QAAIisB,SAAJ,EAAe;AACb,WAAKhoB,QAAL,CAAcgoB,SAAd;AACD;AACF;;AAED;AACA;AACA;AACAC,4BAA0BxpB,SAA1B,EAAqC;AACnC,UAAMupB,YAAYb,YAAYW,qBAAZ,CAAkCrpB,SAAlC,EAA6C,KAAK1C,KAAlD,CAAlB;AACA,QAAIisB,SAAJ,EAAe;AACb,WAAKhoB,QAAL,CAAcgoB,SAAd;AACD;AACF;;AAED3nB,yBAAuB;AACrBqc,oFAAeA,CAACQ,wBAAhB,CAAyC,KAAKnhB,KAAL,CAAWqrB,eAApD;AACD;;AAEDE,aAAW9vB,KAAX,EAAkB;AAChB;AACA;AACA;AACA,QAAI,KAAKuH,KAAL,CAAWmV,IAAX,CAAgBmG,aAAhB,IAAiC7iB,MAAMpC,GAAN,KAAc,OAAnD,EAA4D;AAC1D,WAAK2J,KAAL,CAAWiG,OAAX,CAAmBxN,KAAnB;AACD;AACF;;AAED0J,WAAS;AACP,UAAM,EAAC4D,QAAD,EAAWiE,SAAX,EAAsBmf,YAAtB,EAAoCC,WAApC,EAAiDjU,IAAjD,EAAuDlP,OAAvD,EAAgEI,KAAhE,KAAyE,KAAKrG,KAApF;AACA,UAAMqpB,wBAAyB,iBAAgBrf,YAAa,IAAGA,SAAU,EAA1B,GAA8B,EAAG,GAAEmL,KAAKmU,SAAL,GAAiB,UAAjB,GAA8B,EAAG,GAAEnU,KAAKmG,aAAL,GAAqB,kBAArB,GAA0C,EAAG,EAAlK;AACA,UAAM,EAACoJ,YAAD,EAAeE,WAAf,KAA8BzP,IAApC;AACA,UAAM,CAACoU,cAAD,IAAmBljB,KAAzB;AACA,QAAImjB,cAAJ;AACA,QAAI1C,UAAJ;AACA,QAAI2C,mBAAmB,KAAvB;AACA,QAAIC,iBAAJ;AACA,QAAIC,oBAAJ;AACA,QAAIC,qBAAqB,KAAK5sB,KAAL,CAAWqrB,eAAX,IAA8B,KAAKrrB,KAAL,CAAWqrB,eAAX,CAA2B9oB,GAAlF;AACA,QAAI4pB,YAAJ,EAAkB;AAAE;AAClBQ,6BAAuB,KAAvB;AACD,KAFD,MAEO,IAAIxU,KAAKmG,aAAT,EAAwB;AAC7BkO,uBAAiB,yBAAjB;AACA1C,mBAAa;AACX+C,yBAAiB1U,KAAK0U,eADX;AAEX/J,yBAAkB,OAAM4E,YAAa;AAF1B,OAAb;AAIAgF,0BAAoB,EAAC5J,iBAAmB,OAAM4E,YAAa,GAAvC,EAApB;AACD,KAPM,MAOA,IAAIvP,KAAKsP,mBAAT,EAA8B;AACnC;AACA+E,uBAAiB,yBAAjB;AACA1C,mBAAa;AACX+C,yBAAiB1U,KAAK0U,eADX;AAEX/J,yBAAiB8J,qBAAsB,OAAM,KAAK5sB,KAAL,CAAWqrB,eAAX,CAA2B9oB,GAAI,GAA3D,GAAgE;AAFtE,OAAb;AAID,KAPM,MAOA,IAAImlB,gBAAgBE,eAAeC,wEAAnC,EAA0D;AAC/D;AACA2E,uBAAiB,yBAAjB;AACA1C,mBAAa;AACX+C,yBAAiB1U,KAAK0U,eADX;AAEX/J,yBAAkB,OAAM4E,gBAAgBvP,KAAK2U,OAAQ;AAF1C,OAAb;AAID,KAPM,MAOA;AACL;AACAN,uBAAkB,aAAYI,qBAAqB,SAArB,GAAiC,EAAG,EAAlE;AACA9C,mBAAa,EAAChH,iBAAiB8J,qBAAsB,OAAM,KAAK5sB,KAAL,CAAWqrB,eAAX,CAA2B9oB,GAAI,GAA3D,GAAgE,MAAlF,EAAb;;AAEA;AACA,UAAIqlB,eAAeG,0EAAnB,EAA4C;AAC1C0E,2BAAmB,IAAnB;AACAC,4BAAoB,EAAC5J,iBAAmB,OAAM3K,KAAK2U,OAAQ,GAAvC,EAApB;AACD,OAHD,MAGO,IAAIF,kBAAJ,EAAwB;AAC7B;AACA;AACAH,2BAAmB,IAAnB;AACAE,+BAAuB,IAAvB;AACD;AACF;AACD,QAAII,iBAAiB,EAArB;AACA,QAAIX,WAAJ,EAAiB;AACfW,uBAAiB;AACf9jB,iBAAS,KAAKqiB,WADC;AAEf0B,mBAAW,KAAK1B,WAFD;AAGf2B,qBAAa,KAAK3B,WAHH;AAIf4B,qBAAa,KAAK5B;AAJH,OAAjB;AAMD;AACD,WAAQ;AAAA;AAAA,iBAAI,WAAWe,qBAAf,EAAsC,QAAQ,KAAKf,WAAnD,EAAgE,YAAY,KAAKA,WAAjF,EAA8F,aAAa,KAAKA,WAAhH,EAA6H,aAAa,KAAKA,WAA/I,IAAgKyB,cAAhK;AACN;AAAA;AAAA,UAAK,WAAU,gBAAf;AACG;AAAA;AAAA,YAAG,MAAM5U,KAAKmG,aAAL,GAAqBvN,SAArB,GAAiCoH,KAAK5V,GAA/C,EAAoD,UAAS,GAA7D,EAAiE,YAAY,KAAKgpB,UAAlF,EAA8F,SAAStiB,OAAvG,EAAgH,WAAW,IAA3H;AACG;AAAA;AAAA,cAAK,WAAU,MAAf,EAAsB,eAAa,IAAnC,EAAyC,iBAAesjB,cAAxD;AACE,gFAAK,WAAWC,cAAhB,EAAgC,OAAO1C,UAAvC,GADF;AAEG3R,iBAAKmG,aAAL,IAAsB,oEAAK,WAAU,8BAAf,GAFzB;AAGGmO,gCAAoB;AACnB,yBAAU,4BADS;AAEnB,+BAAeE,wBAAwBJ,cAFpB;AAGnB,qBAAOG,iBAHY;AAHvB,WADH;AASE;AAAA;AAAA,cAAK,WAAY,SAAQvU,KAAKkH,QAAL,GAAgB,QAAhB,GAA2B,EAAG,EAAvD;AACGlH,iBAAKkH,QAAL,IAAiB,oEAAK,WAAU,qBAAf,GADpB;AAEG;AAAA;AAAA,gBAAM,KAAI,MAAV;AAAkBhW;AAAlB;AAFH;AATF,SADH;AAeIN;AAfJ;AADM,KAAR;AAmBD;AA5LkD;AA8LrDqiB,YAAYhmB,YAAZ,GAA2B;AACzBiE,SAAO,EADkB;AAEzB8O,QAAM,EAFmB;AAGzBiU,eAAa;AAHY,CAA3B;;AAMO,MAAMe,OAAN,SAAsBrqB,4CAAKA,CAACC,aAA5B,CAA0C;AAC/C9J,cAAY+J,KAAZ,EAAmB;AACjB,UAAMA,KAAN;AACA,SAAKhD,KAAL,GAAa,EAACmiB,iBAAiB,KAAlB,EAAb;AACA,SAAKiL,WAAL,GAAmB,KAAKA,WAAL,CAAiBnwB,IAAjB,CAAsB,IAAtB,CAAnB;AACA,SAAK2kB,iBAAL,GAAyB,KAAKA,iBAAL,CAAuB3kB,IAAvB,CAA4B,IAA5B,CAAzB;AACA,SAAK8kB,YAAL,GAAoB,KAAKA,YAAL,CAAkB9kB,IAAlB,CAAuB,IAAvB,CAApB;AACD;;AAED;;;AAGAowB,sBAAoB;AAClB,UAAMt1B,QAAQ,EAACu1B,WAAW,KAAKtqB,KAAL,CAAWmV,IAAX,CAAgBoV,QAA5B,EAAd;AACA;AACA,QAAI,KAAKvqB,KAAL,CAAWmV,IAAX,CAAgBkH,QAApB,EAA8B;AAC5BtnB,YAAMy1B,SAAN,GAAkB,QAAlB;AACD;AACD,QAAI,KAAKxqB,KAAL,CAAWmV,IAAX,CAAgBmG,aAApB,EAAmC;AACjC;AACAvmB,YAAMy1B,SAAN,GAAkB,QAAlB;AACAz1B,YAAMozB,aAAN,GAAsB,KAAKnoB,KAAL,CAAWmV,IAAX,CAAgBsV,QAAtC;AACD;AACD,WAAO,EAAC11B,KAAD,EAAP;AACD;;AAED2jB,YAAUjgB,KAAV,EAAiB;AACf,SAAKuH,KAAL,CAAW1O,QAAX,CAAoBC,iEAAEA,CAAC0C,SAAH,CAAaoI,OAAOC,MAAP,CAAc;AAC7C7D,WAD6C;AAE7CvD,cAAQixB,mEAFqC;AAG7ChM,uBAAiB,KAAKna,KAAL,CAAWyZ;AAHiB,KAAd,EAI9B,KAAK4Q,iBAAL,EAJ8B,CAAb,CAApB;AAKD;;AAEDD,cAAY3xB,KAAZ,EAAmB;AACjB,SAAKigB,SAAL,CAAe,OAAf;;AAEA;AACA;AACAjgB,UAAM4P,cAAN;AACA,UAAM,EAACqiB,MAAD,EAAS5B,MAAT,EAAiB6B,OAAjB,EAA0BC,OAA1B,EAAmClN,QAAnC,KAA+CjlB,KAArD;AACA,QAAI,CAAC,KAAKuH,KAAL,CAAWmV,IAAX,CAAgBmG,aAArB,EAAoC;AAClC,WAAKtb,KAAL,CAAW1O,QAAX,CAAoBC,iEAAEA,CAACiC,UAAH,CAAc;AAChC/B,cAAMC,8DAAEA,CAACupB,SADuB;AAEhC/mB,cAAMmI,OAAOC,MAAP,CAAc,KAAK0D,KAAL,CAAWmV,IAAzB,EAA+B,EAAC1c,OAAO,EAACiyB,MAAD,EAAS5B,MAAT,EAAiB6B,OAAjB,EAA0BC,OAA1B,EAAmClN,QAAnC,EAAR,EAA/B;AAF0B,OAAd,CAApB;AAID,KALD,MAKO;AACL,WAAK1d,KAAL,CAAW1O,QAAX,CAAoBC,iEAAEA,CAACiC,UAAH,CAAc;AAChC/B,cAAMC,8DAAEA,CAACm5B,gBADuB;AAEhC32B,cAAM,EAACwb,OAAO,KAAK1P,KAAL,CAAWmV,IAAX,CAAgBzF,KAAxB;AAF0B,OAAd,CAApB;AAID;AACF;;AAEDkP,oBAAkBnmB,KAAlB,EAAyB;AACvBA,UAAM4P,cAAN;AACA,SAAKrI,KAAL,CAAW8qB,UAAX,CAAsB,KAAK9qB,KAAL,CAAWyZ,KAAjC;AACA,SAAKxY,QAAL,CAAc,EAACke,iBAAiB,IAAlB,EAAd;AACD;;AAEDJ,eAAaI,eAAb,EAA8B;AAC5B,SAAKle,QAAL,CAAc,EAACke,eAAD,EAAd;AACD;;AAEDhd,WAAS;AACP,UAAM,EAACnC,KAAD,KAAU,IAAhB;AACA,UAAM,EAACmV,IAAD,KAASnV,KAAf;AACA,UAAM+qB,oBAAoB,KAAK/tB,KAAL,CAAWmiB,eAAX,IAA8Bnf,MAAMgrB,WAAN,KAAsBhrB,MAAMyZ,KAApF;AACA,UAAMpT,QAAQ8O,KAAKzF,KAAL,IAAcyF,KAAKsV,QAAjC;AACA,WAAQ;AAAC,iBAAD;AAAA,mBAAiBzqB,KAAjB,IAAwB,SAAS,KAAKoqB,WAAtC,EAAmD,aAAa,KAAKpqB,KAAL,CAAWsoB,WAA3E,EAAwF,WAAY,GAAEtoB,MAAMgK,SAAN,IAAmB,EAAG,GAAE+gB,oBAAoB,SAApB,GAAgC,EAAG,EAAjK,EAAoK,OAAO1kB,KAA3K;AACJ;AAAA;AAAA;AACE;AAAA;AAAA,YAAQ,WAAU,0BAAlB,EAA6C,OAAO,KAAKrG,KAAL,CAAWyI,IAAX,CAAgBC,aAAhB,CAA8B,EAAC3R,IAAI,oBAAL,EAA9B,CAApD,EAA+G,SAAS,KAAK6nB,iBAA7H;AACE;AAAA;AAAA,cAAM,WAAU,SAAhB;AACE,uEAAC,2DAAD,IAAkB,IAAG,wBAArB,EAA8C,QAAQ,EAACvY,KAAD,EAAtD;AADF;AADF,SADF;AAMG0kB,6BACC,2DAAC,iFAAD;AACE,oBAAU/qB,MAAM1O,QADlB;AAEE,iBAAO0O,MAAMyZ,KAFf;AAGE,oBAAU,KAAKsF,YAHjB;AAIE,mBAAS5J,KAAKmG,aAAL,GAAqBoL,kGAArB,GAAuED,iFAJlF;AAKE,gBAAMtR,IALR;AAME,oBAAU,KAAKkV,iBAAL,EANZ;AAOE,kBAAQlE,mEAPV;AAPJ;AADI,KAAR;AAmBD;AAxF8C;AA0FjDgE,QAAQ/nB,YAAR,GAAuB;AACrB+S,QAAM,EADe;AAErB2V,eAAa,CAAE;AAFM,CAAvB;;AAKO,MAAMG,kBAAN,SAAiCnrB,4CAAKA,CAACC,aAAvC,CAAqD;AAC1D9J,cAAY+J,KAAZ,EAAmB;AACjB,UAAMA,KAAN;AACA,SAAKkrB,iBAAL,GAAyB,KAAKA,iBAAL,CAAuBjxB,IAAvB,CAA4B,IAA5B,CAAzB;AACD;;AAEDixB,sBAAoB;AAClB,SAAKlrB,KAAL,CAAW1O,QAAX,CACE,EAACG,MAAMC,8DAAEA,CAACwqB,cAAV,EAA0BhoB,MAAM,EAACulB,OAAO,KAAKzZ,KAAL,CAAWyZ,KAAnB,EAAhC,EADF;AAED;;AAEDtX,WAAS;AACP,WAAQ;AAAC,iBAAD;AAAA,mBAAiB,KAAKnC,KAAtB,IAA6B,WAAY,eAAc,KAAKA,KAAL,CAAWgK,SAAX,IAAwB,EAAG,EAAlF,EAAqF,aAAa,KAAlG;AACN,6EAAQ,WAAU,sCAAlB;AACC,eAAO,KAAKhK,KAAL,CAAWyI,IAAX,CAAgBC,aAAhB,CAA8B,EAAC3R,IAAI,2BAAL,EAA9B,CADR;AAEC,iBAAS,KAAKm0B,iBAFf;AADM,KAAR;AAKD;AAjByD;;AAoBrD,MAAMC,YAAN,SAA2BrrB,4CAAKA,CAACC,aAAjC,CAA+C;AACpD,aAAWqrB,aAAX,GAA2B;AACzB,WAAO;AACLJ,mBAAa,IADR;AAELK,oBAAc,IAFT;AAGLC,mBAAa,IAHR;AAILC,oBAAc,IAJT;AAKLC,uBAAiB;AALZ,KAAP;AAOD;;AAEDv1B,cAAY+J,KAAZ,EAAmB;AACjB,UAAMA,KAAN;AACA,SAAKhD,KAAL,GAAamuB,aAAaC,aAA1B;AACA,SAAK9C,WAAL,GAAmB,KAAKA,WAAL,CAAiBruB,IAAjB,CAAsB,IAAtB,CAAnB;AACA,SAAK6wB,UAAL,GAAkB,KAAKA,UAAL,CAAgB7wB,IAAhB,CAAqB,IAArB,CAAlB;AACD;;AAEDivB,4BAA0BxpB,SAA1B,EAAqC;AACnC,QAAI,KAAK1C,KAAL,CAAWsuB,WAAf,EAA4B;AAC1B,YAAMG,eAAe,KAAKzrB,KAAL,CAAWimB,QAAX,IAAuB,KAAKjmB,KAAL,CAAWimB,QAAX,CAAoBjR,IAAhE;AACA,YAAM0W,cAAchsB,UAAUumB,QAAV,IAAsBvmB,UAAUumB,QAAV,CAAmBjR,IAA7D;AACA,UAAIyW,gBAAgBA,aAAa,KAAKzuB,KAAL,CAAWquB,YAAxB,CAAhB,IACFI,aAAa,KAAKzuB,KAAL,CAAWquB,YAAxB,EAAsC9rB,GAAtC,KAA8C,KAAKvC,KAAL,CAAWsuB,WAAX,CAAuB/rB,GADnE,KAED,CAACmsB,YAAY,KAAK1uB,KAAL,CAAWquB,YAAvB,CAAD,IAAyCK,YAAY,KAAK1uB,KAAL,CAAWquB,YAAvB,EAAqC9rB,GAArC,KAA6C,KAAKvC,KAAL,CAAWsuB,WAAX,CAAuB/rB,GAF5G,CAAJ,EAEsH;AACpH;AACA,aAAK0B,QAAL,CAAckqB,aAAaC,aAA3B;AACD;AACF;AACF;;AAED1S,YAAUjgB,KAAV,EAAiBghB,KAAjB,EAAwB;AACtB,SAAKzZ,KAAL,CAAW1O,QAAX,CAAoBC,iEAAEA,CAAC0C,SAAH,CAAa;AAC/BwE,WAD+B;AAE/BvD,cAAQixB,mEAFuB;AAG/BhM,uBAAiBV;AAHc,KAAb,CAApB;AAKD;;AAED6O,cAAY7vB,KAAZ,EAAmBghB,KAAnB,EAA0BtE,IAA1B,EAAgC9O,KAAhC,EAAuC;AACrC,YAAQ5N,MAAMhH,IAAd;AACE,WAAK,WAAL;AACE,aAAKk6B,OAAL,GAAe,KAAf;AACA,aAAK1qB,QAAL,CAAc;AACZoqB,wBAAc5R,KADF;AAEZ6R,uBAAanW,IAFD;AAGZoW,wBAAcllB,KAHF;AAIZ2kB,uBAAa;AAJD,SAAd;AAMA,aAAKtS,SAAL,CAAe,MAAf,EAAuBe,KAAvB;AACA;AACF,WAAK,SAAL;AACE,YAAI,CAAC,KAAKkS,OAAV,EAAmB;AACjB;AACA,eAAK1qB,QAAL,CAAckqB,aAAaC,aAA3B;AACD;AACD;AACF,WAAK,WAAL;AACE,YAAI3R,UAAU,KAAKzc,KAAL,CAAWquB,YAAzB,EAAuC;AACrC,eAAKpqB,QAAL,CAAc,EAACuqB,iBAAiB,IAAlB,EAAd;AACD,SAFD,MAEO;AACL,eAAKvqB,QAAL,CAAc,EAACuqB,iBAAiB,KAAKI,oBAAL,CAA0BnS,KAA1B,CAAlB,EAAd;AACD;AACD;AACF,WAAK,MAAL;AACE,YAAIA,UAAU,KAAKzc,KAAL,CAAWquB,YAAzB,EAAuC;AACrC,eAAKM,OAAL,GAAe,IAAf;AACA,eAAK3rB,KAAL,CAAW1O,QAAX,CAAoBC,iEAAEA,CAACC,UAAH,CAAc;AAChCC,kBAAMC,8DAAEA,CAACm6B,gBADuB;AAEhC33B,kBAAM;AACJqkB;AACEhZ,qBAAK,KAAKvC,KAAL,CAAWsuB,WAAX,CAAuB/rB,GAD9B;AAEEmQ,uBAAO,KAAK1S,KAAL,CAAWuuB,YAFpB;AAGE9G,qCAAqB,KAAKznB,KAAL,CAAWsuB,WAAX,CAAuB7G;AAH9C,iBAKM,KAAKznB,KAAL,CAAWsuB,WAAX,CAAuBhQ,aAAvB,IAAwC,EAACA,eAAe,IAAhB,EAL9C,CADI;AAQJ7B,mBARI;AASJqS,gCAAkB,KAAK9uB,KAAL,CAAWquB;AATzB;AAF0B,WAAd,CAApB;AAcA,eAAK3S,SAAL,CAAe,MAAf,EAAuBe,KAAvB;AACD;AACD;AA3CJ;AA6CD;;AAEDsS,iBAAe;AACb;AACA,QAAI9G,WAAW,KAAKjlB,KAAL,CAAWimB,QAAX,CAAoBjR,IAApB,CAAyB7V,KAAzB,EAAf;AACA8lB,aAAShgB,MAAT,GAAkB,KAAKjF,KAAL,CAAWkmB,YAAX,GAA0BF,+EAA5C;AACA,WAAOf,QAAP;AACD;;AAED;;;;AAIA2G,uBAAqBnS,KAArB,EAA4B;AAC1B,UAAMwL,WAAW,KAAK8G,YAAL,EAAjB;AACA9G,aAAS,KAAKjoB,KAAL,CAAWquB,YAApB,IAAoC,IAApC;AACA,UAAMW,aAAa/G,SAASve,GAAT,CAAa6R,QAAUA,QAAQA,KAAK8D,QAAd,GAA0B9D,IAA1B,GAAiC,IAAvD,CAAnB;AACA,UAAM0T,WAAWhH,SAASpb,MAAT,CAAgB0O,QAAQA,QAAQ,CAACA,KAAK8D,QAAtC,CAAjB;AACA,UAAM6P,eAAe7vB,OAAOC,MAAP,CAAc,EAAd,EAAkB,KAAKU,KAAL,CAAWsuB,WAA7B,EAA0C,EAACjP,UAAU,IAAX,EAAiBiN,WAAW,IAA5B,EAA1C,CAArB;AACA,QAAI,CAAC0C,WAAWvS,KAAX,CAAL,EAAwB;AACtBuS,iBAAWvS,KAAX,IAAoByS,YAApB;AACD,KAFD,MAEO;AACL;AACA;AACA,UAAIC,YAAY1S,KAAhB;AACA,YAAM2S,YAAY3S,QAAQ,KAAKzc,KAAL,CAAWquB,YAAnB,GAAkC,CAAC,CAAnC,GAAuC,CAAzD;AACA,aAAOW,WAAWG,SAAX,CAAP,EAA8B;AAC5BA,qBAAaC,SAAb;AACD;;AAED;AACA,YAAMC,eAAe5S,QAAQ,KAAKzc,KAAL,CAAWquB,YAAnB,GAAkC,CAAlC,GAAsC,CAAC,CAA5D;AACA,aAAOc,cAAc1S,KAArB,EAA4B;AAC1B,cAAM6S,YAAYH,YAAYE,YAA9B;AACAL,mBAAWG,SAAX,IAAwBH,WAAWM,SAAX,CAAxB;AACAH,oBAAYG,SAAZ;AACD;AACDN,iBAAWvS,KAAX,IAAoByS,YAApB;AACD;;AAED;AACA,UAAMK,UAAUP,UAAhB;AACA,SAAK,IAAIzc,IAAI,CAAb,EAAgBA,IAAIgd,QAAQtnB,MAA5B,EAAoCsK,GAApC,EAAyC;AACvC,UAAI,CAACgd,QAAQhd,CAAR,CAAL,EAAiB;AACfgd,gBAAQhd,CAAR,IAAa0c,SAASO,KAAT,MAAoB,IAAjC;AACD;AACF;;AAED,WAAOD,OAAP;AACD;;AAEDzB,aAAWrR,KAAX,EAAkB;AAChB,SAAKxY,QAAL,CAAc,EAAC+pB,aAAavR,KAAd,EAAd;AACD;;AAEDtX,WAAS;AACP,UAAM,EAACnC,KAAD,KAAU,IAAhB;AACA,UAAMilB,WAAW,KAAKjoB,KAAL,CAAWwuB,eAAX,IAA8B,KAAKO,YAAL,EAA/C;AACA,UAAMU,aAAa,EAAnB;AACA,UAAMrU,cAAc;AAClBkQ,mBAAa,KAAKA,WADA;AAElBh3B,gBAAU0O,MAAM1O,QAFE;AAGlBmX,YAAMzI,MAAMyI;AAHM,KAApB;AAKA;AACA;AACA;AACA;AACA,QAAI0jB,YAAY,CAAhB;;AAEA;AACA;AACA,UAAMO,wBAAwB1sB,MAAMkmB,YAAN,GAAqB,CAAnD;;AAEA,SAAK,IAAI3W,IAAI,CAAR,EAAWod,IAAI1H,SAAShgB,MAA7B,EAAqCsK,IAAIod,CAAzC,EAA4Cpd,GAA5C,EAAiD;AAC/C,YAAM4F,OAAO8P,SAAS1V,CAAT,KAAelT,OAAOC,MAAP,CAAc,EAAd,EAAkB2oB,SAAS1V,CAAT,CAAlB,EAA+B,EAACgb,UAAU,KAAKvqB,KAAL,CAAWwkB,eAAX,CAA2BS,SAAS1V,CAAT,CAA3B,CAAX,EAA/B,CAA5B;AACA,YAAMqd,YAAY;AAChBv2B,aAAK8e,OAAOA,KAAK5V,GAAZ,GAAkB4sB,WADP;AAEhB1S,eAAOlK;AAFS,OAAlB;AAIA,UAAIA,KAAKmd,qBAAT,EAAgC;AAC9BE,kBAAU5iB,SAAV,GAAsB,iBAAtB;AACD;AACDyiB,iBAAWx1B,IAAX,CAAgB,CAACke,IAAD,GACd,2DAAC,kBAAD,eACMyX,SADN,EAEMxU,WAFN,EADc,GAKd,2DAAC,OAAD;AACE,cAAMjD,IADR;AAEE,qBAAa,KAAKnY,KAAL,CAAWguB,WAF1B;AAGE,oBAAY,KAAKF;AAHnB,SAIM8B,SAJN,EAKMxU,WALN,EALF;AAYD;AACD,WAAQ;AAAA;AAAA,QAAI,WAAY,iBAAgB,KAAKpb,KAAL,CAAWsuB,WAAX,GAAyB,aAAzB,GAAyC,EAAG,EAA5E;AACLmB;AADK,KAAR;AAGD;AAxLmD;;AA2L/C,MAAMI,cAAc/jB,6DAAUA,CAACqiB,YAAX,CAApB,C;;;;;;;AChgBP;AAAA;AAAA;AAAA;AAAA;AACA;;AAEA,MAAM9lB,UAAU,SAAhB;AACA,MAAMC,0BAA0B,kBAAhC;;AAEO,MAAMlU,sBAAN,CAA6B;AAClC6E,cAAYpF,KAAZ,EAAmBgC,UAAU,EAA7B,EAAiC;AAC/B,SAAKi6B,MAAL,GAAcj8B,KAAd;AACA;AACA,SAAKkB,QAAL,GAAgBc,QAAQd,QAAR,IAAoBf,OAAOe,QAA3C;AACA,SAAKg7B,YAAL,GAAoBl6B,QAAQm6B,WAAR,IAAuBpL,kEAA3C;AACA,SAAKlc,mBAAL,GAA2B,KAAKA,mBAAL,CAAyBzL,IAAzB,CAA8B,IAA9B,CAA3B;AACD;;AAED;;;;;;AAMA5I,2BAAyB;AACvB,QAAI,KAAKU,QAAL,CAAc0T,eAAd,KAAkCJ,OAAtC,EAA+C;AAC7C;AACA;AACA,WAAK4nB,UAAL;AACD,KAJD,MAIO;AACL;AACA,WAAKl7B,QAAL,CAAc6T,gBAAd,CAA+BN,uBAA/B,EAAwD,KAAKI,mBAA7D;AACD;AACF;;AAED;;;;;AAKAunB,eAAa;AACX,SAAKF,YAAL,CAAkBvK,IAAlB,CAAuB,0BAAvB;;AAEA,QAAI;AACF,UAAI0K,2BAA2B,KAAKH,YAAL,CAC5BnK,+BAD4B,CACI,0BADJ,CAA/B;;AAGA,WAAKkK,MAAL,CAAYx7B,QAAZ,CAAqBC,iEAAEA,CAACC,UAAH,CAAc;AACjCC,cAAMC,8DAAEA,CAACoR,sBADwB;AAEjC5O,cAAM,EAACg5B,wBAAD;AAF2B,OAAd,CAArB;AAID,KARD,CAQE,OAAO/oB,EAAP,EAAW;AACX;AACA;AACD;AACF;;AAED;;;;AAIAuB,wBAAsB;AACpB,QAAI,KAAK3T,QAAL,CAAc0T,eAAd,KAAkCJ,OAAtC,EAA+C;AAC7C,WAAK4nB,UAAL;AACA,WAAKl7B,QAAL,CAAc4T,mBAAd,CAAkCL,uBAAlC,EAA2D,KAAKI,mBAAhE;AACD;AACF;AAzDiC,C;;;;;;;;ACNpC;AAAA;AAAO,SAAS9T,qBAAT,CAA+Bf,KAA/B,EAAsCK,eAAtC,EAAuD;AAC5D;AACAL,QAAMkM,SAAN,CAAgB,MAAM;AACpB,UAAMC,QAAQnM,MAAMoM,QAAN,EAAd;AACA,QAAI,CAACD,MAAMI,QAAN,CAAeT,WAApB,EAAiC;AAC/B;AACD;;AAED,QAAI,CAACzL,gBAAgByL,WAArB,EAAkC;AAChCzL,sBAAgBkL,IAAhB,CAAqBvL,KAArB;AACD;AACF,GATD;AAUA;AACA,SAAO,EAACK,eAAD,EAAP;AACD,C;;;;;;;;;;;;;;;;ACdD;;AAEA,MAAMi8B,qBAAqB,CAAC,OAAD,EAAU,iBAAV,CAA3B;;AAEO,MAAMC,SAASptB,SAAS;AAC7B,QAAMhE,QAAQ,EAAd;;AAEA;AACA,OAAK,MAAMqxB,GAAX,IAAkBF,kBAAlB,EAAsC;AACpC,QAAI,OAAOntB,MAAMqtB,GAAN,CAAP,KAAsB,WAA1B,EAAuC;AACrCrxB,YAAMqxB,GAAN,IAAartB,MAAMqtB,GAAN,CAAb;AACD;AACF;AACD;AACA,MAAIrxB,MAAM6tB,eAAV,EAA2B;AACzB7tB,UAAMsxB,MAAN,GAAe,GAAf;AACD;;AAED,SAAQ;AAAA;AAAA,MAAQ,SAASttB,MAAMiG,OAAvB;AACN,iBAAWjG,MAAMgK,SAAN,IAAmB,0BADxB;AAEN,aAAOhO,KAFD;AAGLgE,UAAM+F;AAHD,GAAR;AAKD,CAnBM,C;;;;;;;;ACJA,SAASwnB,OAAT,CAAiBhuB,GAAjB,EAAsB;AAC3B,MAAI,CAACA,GAAL,EAAU;AACR,WAAO,EAAP;AACD;AACD,QAAM,EAACiuB,QAAD,KAAa,IAAIluB,GAAJ,CAAQC,GAAR,CAAnB;AACA,QAAMkuB,YAAY,CAChB,OADgB,EAEhB,QAFgB,EAGhB,OAHgB,EAIhB,WAJgB,EAKhB,SALgB,EAMhBz2B,QANgB,CAMPw2B,QANO,CAAlB;AAOA,MAAI,CAACC,SAAL,EAAgB;AACdn0B,YAAQo0B,IAAR,CAAc,gBAAeF,QAAS,oCAAtC,EADc,CAC8D;AAC7E;AACD,SAAOC,YAAYluB,GAAZ,GAAkB,EAAzB;AACD,C;;;;AChBD;AACA;AACA;AACA;;AAEA;AACA,MAAMouB,eAAe;AACnBC,KAAG,iDADgB;AAEnBre,KAAG,iDAFgB;AAGnBse,KAAG,iDAHgB;AAInBC,UAAQ,sDAJW;AAKnBC,MAAI,kDALe;AAMnBC,MAAI;AANe,CAArB;;AASA;;;;AAIO,SAASC,YAAT,CAAsBC,KAAtB,EAA6BhuB,SAA7B,EAAwCiuB,cAAxC,EAAwDC,gBAAgB,KAAxE,EAA+E;AACpF,MAAIF,KAAJ,EAAW;AACT,WAAO7xB,OAAOE,IAAP,CAAY2xB,KAAZ,EAAmBvb,MAAnB,CAA0B,CAACwS,GAAD,EAAMkJ,OAAN,KAAkB;AACjD,YAAM,EAACz7B,MAAD,KAAWs7B,MAAMG,OAAN,CAAjB;AACA;AACA,YAAM9uB,MAAM3M,SAAS,KAAT,GAAiB26B,OAAOA,CAACW,MAAMG,OAAN,EAAe9uB,GAAvB,CAA7B;;AAEA4lB,UAAIkJ,OAAJ,IAAgB,8CAAG,MAAM9uB,GAAT;AACd,gBAAQ6uB,gBAAgB,QAAhB,GAA2B,EADrB;AAEd,uBAAaF,MAAMG,OAAN,EAAe5tB,MAFd;AAGd,uBAAa7N,MAHC;AAId,qBAAWs7B,MAAMG,OAAN,EAAe1tB,IAJZ;AAKd,iCAAuBwtB,cALT;AAMd,iBAASjuB,SANK,GAAhB;AAOA,aAAOilB,GAAP;AACD,KAbM,EAaJ,EAbI,CAAP;AAcD;;AAED,SAAO,IAAP;AACD;;AAED;;;AAGO,SAASmJ,QAAT,CAAkBtuB,KAAlB,EAAyB;AAC9B,MAAI,CAACyE,mCAAcA,CAACzN,QAAf,CAAwBgJ,MAAMuuB,eAA9B,CAAL,EAAqD;AACnD,UAAM,IAAIt7B,KAAJ,CAAW,aAAY+M,MAAMuuB,eAAgB,yHAA7C,CAAN;AACD;AACD,SACE;AAAC,oBAAD;AAAA,eAAW,IAAIvuB,MAAMuuB,eAArB,IAA0CZ,YAA1C,EAA4D3tB,MAAMwuB,cAAlE,EAAsFP,aAAajuB,MAAMkuB,KAAnB,EAA0BluB,MAAME,SAAhC,EAA2CF,MAAMmuB,cAAjD,EAAiEnuB,MAAMouB,aAAvE,CAAtF;AACE;AAAA;AAAA;AAAOpuB,YAAMhF;AAAb;AADF,GADF;AAKD,C;;;;;ACpDD;AACA;;AAEO,MAAMyzB,uBAAN,SAA0B3uB,wBAAKA,CAACC,aAAhC,CAA8C;AACnD9J,cAAY+J,KAAZ,EAAmB;AACjB,UAAMA,KAAN;AACA,SAAK0uB,cAAL,GAAsB,KAAKA,cAAL,CAAoBz0B,IAApB,CAAyB,IAAzB,CAAtB;AACD;;AAEDy0B,mBAAiB;AACf,QAAI,KAAK1uB,KAAL,CAAWQ,QAAX,KAAwB,SAA5B,EAAuC;AACrC,WAAKR,KAAL,CAAWI,uBAAX,CAAmC,EAAC3H,OAAO,OAAR,EAAiB1B,IAAI,KAAKiJ,KAAL,CAAWkG,SAAhC,EAAnC;AACD;;AAED,SAAKlG,KAAL,CAAWiI,OAAX;AACD;;AAED0mB,wBAAsB;AACpB,QAAI,KAAK3uB,KAAL,CAAW4uB,aAAf,EAA8B;AAC5B,aACE;AAAA;AAAA,UAAK,WAAU,QAAf;AACE;AAAA;AAAA,YAAK,WAAU,gBAAf;AACE;AAAA;AAAA;AACE,yBAAU,0BADZ;AAEE,uBAAS,KAAK5uB,KAAL,CAAW6uB,SAFtB;AAGG,iBAAK7uB,KAAL,CAAWY,OAAX,CAAmBkuB;AAHtB;AADF;AADF,OADF;AAWD;;AAED,UAAMC,eAAeC,oBAAMA,CAACC,UAAP,CAAkBC,iBAAlB,CAAoCC,OAAzD;AACA,WACE,mDAAQ,WAAU,aAAlB,EAAgC,OAAO,KAAKnvB,KAAL,CAAWY,OAAX,CAAmBsuB,iBAAnB,IAAwCH,YAA/E,EAA6F,SAAS,KAAKL,cAA3G,GADF;AAGD;;AAEDvsB,WAAS;AACP,UAAM,EAACnC,KAAD,KAAU,IAAhB;;AAEA,UAAMovB,qBAAsB,uBAAsBpvB,MAAMgK,SAAN,GAAmB,IAAGhK,MAAMgK,SAAU,EAAtC,GAA0C,EAAG,EAA/F;;AAEA,WAAQ;AAAA;AAAA,QAAK,WAAWolB,kBAAhB,EAAoC,OAAO,KAAKpvB,KAAL,CAAWqvB,SAAtD;AACN;AAAA;AAAA,UAAK,WAAU,cAAf;AACGrvB,cAAM+F;AADT,OADM;AAIL,WAAK4oB,mBAAL;AAJK,KAAR;AAMD;AA9CkD,C;;;;ACHrD;AACA;AACA;AACA;AACA;;AAEA,MAAMW,oBAAoB,sCAA1B;;AAEO,MAAMC,2BAAN,SAA4BzvB,wBAAKA,CAACC,aAAlC,CAAgD;AACrD9J,cAAY+J,KAAZ,EAAmB;AACjB,UAAMA,KAAN;AACA,SAAKwvB,aAAL,GAAqB,KAAKA,aAAL,CAAmBv1B,IAAnB,CAAwB,IAAxB,CAArB;AACD;;AAEDu1B,kBAAgB;AACd,QAAI,KAAKxvB,KAAL,CAAWQ,QAAX,KAAwB,SAA5B,EAAuC;AACrC,WAAKR,KAAL,CAAWI,uBAAX,CAAmC,EAAC3H,OAAO,cAAR,EAAwB1B,IAAI,KAAKiJ,KAAL,CAAWkG,SAAvC,EAAnC;AACD;AACD,UAAM,EAACupB,UAAD,KAAe,KAAKzvB,KAAL,CAAWY,OAAhC;AACA;AACA,UAAMnP,OAAO,KAAKuO,KAAL,CAAWY,OAAX,CAAmBnC,aAAnB,IAAqCgxB,cAAc,UAAhE;AACA,SAAKzvB,KAAL,CAAWmG,QAAX,CAAoB;AAClB1U,UADkB;AAElByC,YAAM,EAACyM,MAAM,KAAKX,KAAL,CAAWY,OAAX,CAAmB8uB,kBAAnB,IAAyCD,UAAhD;AAFY,KAApB;AAIA,QAAI,CAAC,KAAKzvB,KAAL,CAAWY,OAAX,CAAmBC,gBAAxB,EAA0C;AACxC,WAAKb,KAAL,CAAWiI,OAAX;AACD;AACF;;AAED0nB,wBAAsB;AACpB,WAAO,KAAK3vB,KAAL,CAAWY,OAAX,CAAmBnC,aAAnB,IAAoC,KAAKuB,KAAL,CAAWwvB,aAA/C,IAAgE,KAAKxvB,KAAL,CAAWY,OAAX,CAAmB6uB,UAA1F;AACD;;AAEDG,gBAAc;AACZ,UAAM,EAACvpB,KAAD,KAAU,KAAKrG,KAAL,CAAWY,OAA3B;AACA,WAAOyF,QACL;AAAA;AAAA,QAAI,WAAY,SAAQ,KAAKspB,mBAAL,KAA6B,cAA7B,GAA8C,EAAG,EAAzE;AAA6E,WAAKE,eAAL,EAA7E;AAAA;AAAsGxpB;AAAtG,KADK,GAEL,IAFF;AAGD;;AAEDwpB,oBAAkB;AAChB,UAAMC,YAAYvC,OAAOA,CAAC,KAAKvtB,KAAL,CAAWY,OAAX,CAAmBmvB,UAA3B,CAAlB;AACA,WAAOD,YAAY,iDAAM,WAAU,WAAhB,EAA4B,OAAO,EAAChQ,iBAAkB,QAAOgQ,SAAU,IAApC,EAAnC,GAAZ,GAA8F,IAArG;AACD;;AAEDE,iBAAe;AACb,UAAM,EAAChwB,KAAD,KAAU,IAAhB;AACA,QAAI,CAAC,KAAK2vB,mBAAL,EAAL,EAAiC;AAC/B,aAAO,IAAP;AACD;;AAED,WAAQ;AAAC,YAAD;AAAA;AACN,iBAAS3vB,MAAMwvB,aAAN,IAAuB,KAAKA,aAD/B;AAEN,eAAOxvB,MAAMY,OAAN,CAAcqvB,YAFf;AAGN,yBAAiBjwB,MAAMY,OAAN,CAAcsvB,uBAHzB;AAILlwB,YAAMY,OAAN,CAAc0F;AAJT,KAAR;AAMD;;AAED6pB,eAAa;AACX,UAAM,EAACnwB,KAAD,KAAU,IAAhB;AACA,WAAQ,uCAAC,QAAD,IAAU,MAAMA,MAAMY,OAAN,CAAc5F,IAA9B;AACN,sBAAgB,KAAKgF,KAAL,CAAWwuB,cADrB;AAEN,uBAAgB,MAFV;AAGN,aAAOxuB,MAAMY,OAAN,CAAcstB,KAHf;AAIN,iBAAWluB,MAAME,SAJX,GAAR;AAKD;;AAEDiC,WAAS;AACP,UAAM,EAACnC,KAAD,KAAU,IAAhB;AACA,QAAIgK,YAAY,eAAhB;AACA,QAAIhK,MAAMgK,SAAV,EAAqB;AACnBA,mBAAc,IAAGhK,MAAMgK,SAAU,EAAjC;AACD;AACD,QAAIhK,MAAMY,OAAN,CAAcwvB,IAAlB,EAAwB;AACtBpmB,mBAAa,OAAb;AACD;AACD,WAAQ;AAAC,6BAAD;AAAA,gCAAiBhK,KAAjB,IAAwB,WAAWgK,SAAnC,EAA8C,WAAW,KAAKhK,KAAL,CAAWqvB,SAApE;AACN,sDAAK,KAAK9B,OAAOA,CAACvtB,MAAMY,OAAN,CAAcwF,IAAtB,KAA+BkpB,iBAAzC,EAA4D,WAAU,MAAtE,GADM;AAEN;AAAA;AAAA;AACG,aAAKM,WAAL,EADH;AAAA;AACuB;AAAA;AAAA,YAAG,WAAU,MAAb;AAAqB,eAAKO,UAAL;AAArB,SADvB;AAEG,aAAKnwB,KAAL,CAAWqwB;AAFd,OAFM;AAML;AAAA;AAAA;AAAM,aAAKL,YAAL;AAAN;AANK,KAAR;AAQD;AA9EoD,C;;;;ACRvD;AACA;AACA;;AAEA,MAAMM,yBAAN,SAA6BxwB,wBAAKA,CAACC,aAAnC,CAAiD;AAC/C9J,cAAY+J,KAAZ,EAAmB;AACjB,UAAMA,KAAN;AACA,SAAKuwB,YAAL,GAAoB,KAAKA,YAAL,CAAkBt2B,IAAlB,CAAuB,IAAvB,CAApB;AACD;;AAED;;;;AAIAu2B,sBAAoB;AAClB,UAAMC,oBAAoB,KAAKvjB,IAAL,CAAUwjB,IAAV,CAAeC,aAAf,CAA6B,mBAA7B,CAA1B;AACA,QAAIF,kBAAkB3iB,OAAtB,EAA+B;AAC7B,WAAKZ,IAAL,CAAUwjB,IAAV,CAAeC,aAAf,CAA6B,oBAA7B,EAAmD57B,KAAnD,GAA2D,SAA3D;AACD;AACF;;AAEDw7B,eAAa93B,KAAb,EAAoB;AAClBA,UAAM4P,cAAN;AACA,SAAKmoB,iBAAL;AACA,SAAKtjB,IAAL,CAAUwjB,IAAV,CAAeE,MAAf;AACA,QAAI,CAAC,KAAK5wB,KAAL,CAAWY,OAAX,CAAmBC,gBAAxB,EAA0C;AACxC,WAAKb,KAAL,CAAWiI,OAAX;AACD;AACF;;AAED4oB,oBAAkB;AAChB,UAAMC,aAAa,CAAC,OAAD,EAAU,QAAV,EAAoB,OAApB,EAA6B,QAA7B,CAAnB;AACA,UAAMC,eAAe,IAAIC,KAAKC,YAAT,CAAsB,KAAKjxB,KAAL,CAAWY,OAAX,CAAmBqI,MAAnB,IAA6BioB,UAAUC,QAA7D,EAAuE;AAC1Fn1B,aAAO,UADmF;AAE1Fo1B,gBAAU,KAAKpxB,KAAL,CAAWY,OAAX,CAAmBywB,aAF6D;AAG1FC,6BAAuB;AAHmE,KAAvE,CAArB;AAKA;AACA,UAAM,EAACC,eAAD,KAAoB,KAAKvxB,KAAL,CAAWY,OAArC;AACA,UAAM4wB,WAAW;AACfC,aAAO,KAAKzxB,KAAL,CAAWY,OAAX,CAAmBqvB,YADX;AAEfpG,uBAAiB,KAAK7pB,KAAL,CAAWY,OAAX,CAAmBsvB;AAFrB,KAAjB;;AAKA,WAAQ;AAAA;AAAA,QAAM,WAAU,gBAAhB,EAAiC,QAAQ,KAAKlwB,KAAL,CAAWY,OAAX,CAAmB8wB,iBAA5D,EAA+E,QAAQ,KAAK1xB,KAAL,CAAW2xB,WAAlG,EAA+G,UAAU,KAAKpB,YAA9H,EAA4I,KAAI,MAAhJ;AACLO,iBAAWpqB,GAAX,CAAe,CAACkrB,KAAD,EAAQC,GAAR,KAAgB;AAC9B,cAAMC,cAAe,mBAAkBF,KAAM,EAA7C;AACA,cAAMG,SAAS,KAAK/xB,KAAL,CAAWY,OAAX,CAAmBkxB,WAAnB,CAAf;AACA,eAAQ;AAAC,kCAAD,CAAO,QAAP;AAAA,YAAgB,KAAKD,GAArB;AACJ,4DAAO,MAAK,OAAZ,EAAoB,MAAK,QAAzB,EAAkC,OAAOE,MAAzC,EAAiD,IAAIH,KAArD,EAA4D,gBAAgBE,gBAAgBP,eAA5F,GADI;AAEJ;AAAA;AAAA,cAAO,SAASK,KAAhB,EAAuB,WAAU,iBAAjC;AACGb,yBAAaiB,MAAb,CAAoBD,MAApB;AADH;AAFI,SAAR;AAMD,OATA,CADK;AAYN;AAAA;AAAA,UAAK,WAAU,4BAAf;AACE,0DAAO,IAAG,kBAAV,EAA6B,MAAK,UAAlC,GADF;AAEE;AAAA;AAAA,YAAO,SAAQ,kBAAf;AACG,eAAK/xB,KAAL,CAAWY,OAAX,CAAmBqxB;AADtB;AAFF,OAZM;AAmBN,wDAAO,MAAK,QAAZ,EAAqB,MAAK,WAA1B,EAAsC,OAAM,QAA5C,GAnBM;AAoBN,wDAAO,MAAK,QAAZ,EAAqB,MAAK,UAA1B,EAAqC,OAAO,KAAKjyB,KAAL,CAAWY,OAAX,CAAmBywB,aAA/D,GApBM;AAqBN,wDAAO,MAAK,QAAZ,EAAqB,MAAK,SAA1B,EAAoC,OAAOP,WAAWpqB,GAAX,CAAekrB,SAAS,KAAK5xB,KAAL,CAAWY,OAAX,CAAoB,mBAAkBgxB,KAAM,EAA5C,CAAxB,CAA3C,GArBM;AAsBN;AAAA;AAAA,UAAQ,OAAOJ,QAAf,EAAyB,MAAK,QAA9B,EAAuC,WAAU,0CAAjD;AAA6F,aAAKxxB,KAAL,CAAWY,OAAX,CAAmB0F;AAAhH;AAtBM,KAAR;AAwBD;;AAEDnE,WAAS;AACP,UAAMktB,YAAY;AAChBoC,aAAO,KAAKzxB,KAAL,CAAWY,OAAX,CAAmBsxB,UADV;AAEhBrI,uBAAiB,KAAK7pB,KAAL,CAAWY,OAAX,CAAmBuxB;AAFpB,KAAlB;AAIA,UAAMC,gBAAgB,+CAAI,OAAO,EAACvI,iBAAiB,KAAK7pB,KAAL,CAAWY,OAAX,CAAmByxB,eAArC,EAAX,GAAtB;AACA,WAAQ,uCAAC,2BAAD,yBAAmB,KAAKryB,KAAxB;AACN,iBAAW,KAAKA,KAAL,CAAWY,OAAX,CAAmB0xB,IADxB;AAEN,sBAAgB,EAACvE,IAAIqE,aAAL,EAFV;AAGN,iBAAW/C,SAHL;AAIN,oBAAc,KAAKwB,eAAL,EAJR,IAAR;AAKD;AA7E8C;;AAgF1C,MAAM0B,aAAavyB,SAAS;AACjC,QAAMwyB;AACJP,iCAA6BjD,iBAAMA,CAACC,UAAP,CAAkBgD,2BAAlB,CAA8C9C,OADvE;AAEJlmB,YAAQ+lB,iBAAMA,CAACC,UAAP,CAAkBhmB,MAAlB,CAAyBkmB,OAF7B;AAGJkC,mBAAerC,iBAAMA,CAACC,UAAP,CAAkBoC,aAAlB,CAAgClC,OAH3C;AAIJoC,qBAAiBvC,iBAAMA,CAACC,UAAP,CAAkBsC,eAAlB,CAAkCpC;AAJ/C,KAKDnvB,MAAMY,OALL,CAAN;;AAQA,SAAQ,uCAAC,yBAAD,yBACFZ,KADE;AAEN,aAASwyB,eAFH;AAGN,iBAAY,KAHN,IAAR;AAID,CAbM,C;;;;;;;;;ACpFP;AACA;AACA;AACA;AACA;;AAEO,MAAMC,mCAAN,SAAgC3yB,wBAAKA,CAACC,aAAtC,CAAoD;AACzD9J,cAAY+J,KAAZ,EAAmB;AACjB,UAAMA,KAAN;AACA,SAAK0yB,aAAL,GAAqB,KAAKA,aAAL,CAAmBz4B,IAAnB,CAAwB,IAAxB,CAArB;AACA,SAAKs2B,YAAL,GAAoB,KAAKA,YAAL,CAAkBt2B,IAAlB,CAAuB,IAAvB,CAApB;AACA,SAAK04B,mBAAL,GAA2B,KAAKA,mBAAL,CAAyB14B,IAAzB,CAA8B,IAA9B,CAA3B;AACA,SAAK+M,aAAL,GAAqB,KAAKA,aAAL,CAAmB/M,IAAnB,CAAwB,IAAxB,CAArB;AACA,SAAK+C,KAAL,GAAa;AACX41B,gBAAU,KADC;AAEXC,uBAAiB,KAFN;AAGXC,uBAAiB,KAHN;AAIXC,qBAAe,KAJJ;AAKXC,mBAAa;AALF,KAAb;AAOD;;AAEDL,wBAAsB;AACpB,QAAI,CAAC,KAAK31B,KAAL,CAAW61B,eAAhB,EAAiC;AAC/B,WAAK5xB,QAAL,CAAc,EAAC4xB,iBAAiB,IAAlB,EAAd;AACD;AACF;;AAEKtC,cAAN,CAAmB93B,KAAnB,EAA0B;AAAA;;AAAA;AACxB,UAAIqP,IAAJ;;AAEA,UAAI,MAAK9K,KAAL,CAAWg2B,WAAf,EAA4B;AAC1B;AACD;;AAEDv6B,YAAM4P,cAAN;AACA,YAAKpH,QAAL,CAAc,EAAC+xB,aAAa,IAAd,EAAd;AACA,YAAKhzB,KAAL,CAAWI,uBAAX,CAAmC,EAAC3H,OAAO,cAAR,EAAwB1D,OAAO,iCAA/B,EAAkEgC,IAAI,2BAAtE,EAAnC;;AAEA,UAAI,MAAKiJ,KAAL,CAAW2xB,WAAX,CAAuBsB,WAAvB,OAAyC,KAA7C,EAAoD;AAClD,cAAK/lB,IAAL,CAAUwjB,IAAV,CAAeE,MAAf;AACA;AACD;;AAED,YAAM,EAACrxB,GAAD,EAAM2zB,QAAN,KAAkB,MAAKlzB,KAAL,CAAWmzB,eAAX,GACtB,MAAKnzB,KAAL,CAAWmzB,eAAX,CAA2B,MAAKjmB,IAAL,CAAUkmB,SAArC,EAAgD,MAAKpzB,KAArD,CADsB,GAEtB,EAACT,KAAK,MAAK2N,IAAL,CAAUwjB,IAAV,CAAe99B,MAArB,EAA6BsgC,UAAU,IAAIG,QAAJ,CAAa,MAAKnmB,IAAL,CAAUwjB,IAAvB,CAAvC,EAFF;;AAIA,UAAI;AACF,cAAM4C,eAAe,IAAIC,OAAJ,CAAYh0B,GAAZ,EAAiB,EAACuC,MAAMoxB,QAAP,EAAiBM,QAAQ,MAAzB,EAAjB,CAArB;AACA,cAAM54B,WAAW,MAAMC,MAAMy4B,YAAN,CAAvB;AACAxrB,eAAO,MAAMlN,SAASkN,IAAT,EAAb;AACD,OAJD,CAIE,OAAOzO,GAAP,EAAY;AACZC,gBAAQ6C,GAAR,CAAY9C,GAAZ,EADY,CACM;AACnB;;AAED,UAAIyO,QAAQA,KAAKhN,MAAL,KAAgB,IAA5B,EAAkC;AAChC,cAAKmG,QAAL,CAAc,EAAC8xB,eAAe,IAAhB,EAAsBD,iBAAiB,IAAvC,EAAd;AACA,YAAI,CAAC,MAAK9yB,KAAL,CAAWY,OAAX,CAAmBC,gBAAxB,EAA0C;AACxC,gBAAKb,KAAL,CAAWiI,OAAX,CAAmB,EAACwrB,gBAAgB,IAAjB,EAAnB;AACD;AACD,cAAKzzB,KAAL,CAAWI,uBAAX,CAAmC,EAAC3H,OAAO,cAAR,EAAwB1D,OAAO,mBAA/B,EAAoDgC,IAAI,2BAAxD,EAAnC;AACD,OAND,MAMO;AACLuC,gBAAQX,KAAR,CAAc,yCAAd,EAAyDmP,QAAQ,oBAAjE,EADK,CACmF;AACxF,cAAK7G,QAAL,CAAc,EAAC8xB,eAAe,KAAhB,EAAuBD,iBAAiB,IAAxC,EAAd;AACA,cAAK9yB,KAAL,CAAWI,uBAAX,CAAmC,EAAC3H,OAAO,cAAR,EAAwB1D,OAAO,iBAA/B,EAAkDgC,IAAI,2BAAtD,EAAnC;AACD;;AAED,YAAKkK,QAAL,CAAc,EAAC+xB,aAAa,KAAd,EAAd;AAxCwB;AAyCzB;;AAEDN,kBAAgB;AACd,SAAKzxB,QAAL,CAAc;AACZ2xB,gBAAU,IADE;AAEZG,qBAAe,KAFH;AAGZD,uBAAiB;AAHL,KAAd;AAKD;;AAEDY,2BAAyB;AACvB,UAAM,EAACC,aAAD,KAAkB,KAAK3zB,KAAL,CAAWY,OAAnC;;AAEA,QAAI,CAAC+yB,aAAL,EAAoB;AAClB,aAAO,IAAP;AACD;;AAED,WAAOt3B,OAAOE,IAAP,CAAYo3B,aAAZ,EAA2BjtB,GAA3B,CAA+B,CAACrQ,GAAD,EAAMw7B,GAAN,KAAc,kDAAO,KAAKA,GAAZ,EAAiB,MAAK,QAAtB,EAA+B,MAAMx7B,GAArC,EAA0C,OAAOs9B,cAAct9B,GAAd,CAAjD,GAA7C,CAAP;AACD;;AAEDu9B,qBAAmB;AACjB,UAAM,EAAChzB,OAAD,KAAY,KAAKZ,KAAvB;AACA,QAAI,CAACY,QAAQizB,sBAAb,EAAqC;AACnC,aAAO,IAAP;AACD;AACD,WAAQ;AAAA;AAAA,QAAG,WAAU,gBAAb;AACN,6CAAC,QAAD,IAAU,MAAMjzB,QAAQizB,sBAAxB;AACE,yBAAgB,iBADlB;AAEE,eAAOjzB,QAAQstB,KAFjB;AAGE,wBAAgB,IAHlB;AAIE,uBAAe,IAJjB;AAKE,mBAAW,KAAKluB,KAAL,CAAWE,SALxB;AADM,KAAR;AAQD;;AAED4zB,4BAA0B;AACxB,UAAM,EAAClzB,OAAD,KAAY,KAAKZ,KAAvB;AACA,QAAI,CAACY,QAAQmzB,mBAAb,EAAkC;AAChC,aAAO,IAAP;AACD;AACD,WAAQ;AAAA;AAAA,QAAG,WAAU,eAAb;AACJ,wDAAO,MAAK,UAAZ,EAAuB,IAAG,YAA1B,EAAuC,MAAK,SAA5C,EAAsD,UAAS,UAA/D,GADI;AAEJ;AAAA;AAAA,UAAO,SAAQ,YAAf;AACE,+CAAC,QAAD,IAAU,MAAMnzB,QAAQmzB,mBAAxB;AACA,2BAAgB,cADhB;AAEA,iBAAOnzB,QAAQstB,KAFf;AAGA,0BAAgB,IAHhB;AAIA,yBAAe,IAJf;AAKA,qBAAW,KAAKluB,KAAL,CAAWE,SALtB;AADF;AAFI,KAAR;AAWD;;AAED8zB,0BAAwB;AACtB,UAAM,EAACpzB,OAAD,KAAY,KAAKZ,KAAvB;AACA,UAAMi0B,YAAY,KAAKj3B,KAAL,CAAW+1B,aAA7B;AACA,UAAMmB,eAAeD,aAAarzB,QAAQuzB,aAA1C;AACA,UAAMC,WAAWH,YAAY,EAACI,cAAczzB,QAAQyzB,YAAvB,EAAZ,GAAmD,EAACC,YAAY1zB,QAAQ0zB,UAArB,EAApE;AACA,UAAMC,kBAAkB3zB,QAAQ4zB,mBAAhC;AACA,WAAQ;AAAC,6BAAD;AAAiB,WAAKx0B,KAAtB;AAA6B;AAAA;AAAA,UAAK,WAAU,kBAAf;AAClCk0B,uBAAe;AAAA;AAAA,YAAI,WAAU,mBAAd;AAAmCA;AAAnC,SAAf,GAAuE,IADrC;AAEnC;AAAA;AAAA;AACE,iDAAC,QAAD,gCAAcE,QAAd,IAAwB,iBAAiBH,YAAY,cAAZ,GAA6B,YAAtE,IADF;AAEGA,sBAAY,IAAZ,GAAmB;AAAC,kBAAD;AAAA,cAAQ,SAAS,KAAKvB,aAAtB;AAAsC6B;AAAtC;AAFtB;AAFmC;AAA7B,KAAR;AAOD;;AAEDvtB,gBAAcvO,KAAd,EAAqB;AACnB,QAAI,CAAC,KAAKuH,KAAL,CAAWy0B,aAAhB,EAA+B;AAC7B;AACD;AACD,UAAM/iB,WAAW,KAAK1R,KAAL,CAAWy0B,aAAX,CAAyBh8B,MAAM9E,MAAN,CAAaoB,KAAtC,EAA6C,KAAKiL,KAAL,CAAWY,OAAxD,CAAjB;AACAnI,UAAM9E,MAAN,CAAa+gC,iBAAb,CAA+BhjB,QAA/B;AACD;;AAEDijB,gBAAc;AACZ,UAAMC,aAAa,KAAK50B,KAAL,CAAWY,OAAX,CAAmBi0B,6BAAnB,IAAoD,KAAK70B,KAAL,CAAWY,OAAX,CAAmBk0B,wBAA1F;AACA,WAAQ;AACN,WAAI,WADE;AAEN,YAAM,KAAK90B,KAAL,CAAW+0B,SAAX,IAAwB,OAFxB;AAGN,iBAAY,YAAY,KAAK/3B,KAAL,CAAW61B,eAAX,GAA6B,EAA7B,GAAkC,QAAU,EAH9D;AAIN,YAAK,OAJC;AAKN,gBAAU,IALJ;AAMN,mBAAa+B,UANP;AAON,gBAAU,KAAK50B,KAAL,CAAWy0B,aAAX,GAA2B,KAAKztB,aAAhC,GAAgD,IAPpD;AAQN,iBAAW,IARL,GAAR;AASD;;AAEDguB,qBAAmB;AACjB,UAAM,EAACp0B,OAAD,KAAY,KAAKZ,KAAvB;AACA,UAAMi1B,iBAAkB,qBAAoB,KAAKj1B,KAAL,CAAWgK,SAAU,EAAjE;AACA,WAAQ;AAAC,6BAAD;AAAA,oCAAiB,KAAKhK,KAAtB,IAA6B,WAAWi1B,cAAxC,EAAwD,eAAe,IAAvE;AACHr0B,cAAQs0B,WAAR,GAAsB;AAAA;AAAA,UAAK,WAAU,YAAf;AAA4B,wDAAK,KAAKt0B,QAAQs0B,WAAlB;AAA5B,OAAtB,GAA4F,IADzF;AAEJ;AAAA;AAAA,UAAK,WAAU,SAAf;AACE;AAAA;AAAA;AACGt0B,kBAAQu0B,YAAR,IAAwB;AAAA;AAAA,cAAI,WAAU,aAAd;AAA6Bv0B,oBAAQu0B;AAArC,WAD3B;AAEG,aAFH;AAGGv0B,kBAAQw0B,WAAR,IAAuB,uCAAC,QAAD,IAAU,aAAax0B,QAAQw0B,WAA/B,EAA4C,iBAAgB,aAA5D;AAH1B;AADF,OAFI;AASJ;AAAA;AAAA,UAAM,QAAQ,KAAKp1B,KAAL,CAAWq1B,WAAzB,EAAsC,QAAQ,KAAKr1B,KAAL,CAAW2xB,WAAzD,EAAsE,UAAU,KAAKpB,YAArF,EAAmG,KAAI,MAAvG;AACG,aAAKmD,sBAAL,EADH;AAEE;AAAA;AAAA;AACG,eAAKiB,WAAL,EADH;AAEE;AAAA;AAAA,cAAQ,MAAK,QAAb,EAAsB,WAAU,wBAAhC,EAAyD,SAAS,KAAKhC,mBAAvE,EAA4F,KAAI,eAAhG;AAAiH/xB,oBAAQ00B;AAAzH;AAFF,SAFF;AAMG,aAAKxB,uBAAL,MAAkC,KAAKF,gBAAL;AANrC;AATI,KAAR;AAkBD;;AAED2B,yBAAuB;AACrB,WAAOl5B,OAAOE,IAAP,CAAY,KAAKyD,KAAL,CAAWY,OAAvB,EAAgCiJ,MAAhC,CAAuCxT,OAAOA,IAAIW,QAAJ,CAAa,QAAb,CAA9C,EAAsE2b,MAAtE,CAA6E,CAACwS,GAAD,EAAM9uB,GAAN,KAAc;AAChG8uB,UAAI9uB,IAAIm/B,MAAJ,CAAW,CAAX,CAAJ,IAAqB,KAAKx1B,KAAL,CAAWY,OAAX,CAAmBvK,GAAnB,CAArB;AACA,aAAO8uB,GAAP;AACD,KAHM,EAGJ,EAHI,CAAP;AAID;;AAEDhjB,WAAS;AACP,UAAMvB,4BAAc,KAAKZ,KAAL,CAAWY,OAAzB,EAAqC,KAAK20B,oBAAL,EAArC,CAAN;;AAEA,QAAI,KAAKv4B,KAAL,CAAW81B,eAAf,EAAgC;AAC9B,aAAO,KAAKkB,qBAAL,EAAP;AACD;AACD,QAAI,KAAKh3B,KAAL,CAAW41B,QAAf,EAAyB;AACvB,aAAO,KAAKoC,gBAAL,EAAP;AACD;AACD,WAAO,uCAAC,2BAAD,gCAAmB,KAAKh1B,KAAxB,IAA+B,SAASY,OAAxC,EAAiD,eAAe,KAAK8xB,aAArE,IAAP;AACD;AAhMwD,C;;;;ACN3D;AACA;AACA;;AAEO,MAAM+C,mBAAmBz1B,SAAS;AACvC,QAAM01B,YAAYl5B,OAAO00B,SAAP,CAAiBwE,SAAjB,CAA2BC,KAA3B,CAAiC,qBAAjC,CAAlB;AACA,QAAMC,kBAAkBF,YAAY/S,SAAS+S,UAAU,CAAV,CAAT,EAAuB,EAAvB,CAAZ,GAAyC,CAAjE;AACA,QAAMlD;AACJ6C,iBAAa,+BADT;AAEJb,yBAAqBxF,uBAAMA,CAACC,UAAP,CAAkBuF,mBAAlB,CAAsCrF,OAFvD;AAGJ0F,mCAA+B7F,uBAAMA,CAACC,UAAP,CAAkB4F,6BAAlB,CAAgD1F,OAH3E;AAIJmG,yBAAqBtG,uBAAMA,CAACC,UAAP,CAAkBqG,mBAAlB,CAAsCnG;AAJvD,KAKDnvB,MAAMY,OALL;AAMJ+yB;AACE/gC,cAAQ,OADV;AAEEma,eAAS,eAFX;AAGE8oB,kBAAY,UAHd;AAIEC,eAAS,MAJX;AAKEC,kBAAY,SALd;AAMEC,mBAAaJ,eANf;AAOEK,oBAAcj2B,MAAMY,OAAN,CAAcq1B,YAP9B;AAQEC,gBAAUl2B,MAAMY,OAAN,CAAcs1B;AAR1B,OASKl2B,MAAMY,OAAN,CAAc+yB,aATnB;AANI,IAAN;;AAmBA,SAAQ,uCAAC,mCAAD,+BACF3zB,KADE;AAEN,aAASwyB,eAFH;AAGN,iBAAY,KAHN,IAAR;AAID,CA1BM,C;;;;;;;ACJP;AACA;AACA;;AAEO,MAAM2D,oBAAoBn2B,SAAS;AACxC,QAAMwyB;AACJgC,yBAAqBxF,wBAAMA,CAACC,UAAP,CAAkBuF,mBAAlB,CAAsCrF,OADvD;AAEJ0F,mCAA+B7F,wBAAMA,CAACC,UAAP,CAAkB4F,6BAAlB,CAAgD1F,OAF3E;AAGJmG,yBAAqBtG,wBAAMA,CAACC,UAAP,CAAkBqG,mBAAlB,CAAsCnG,OAHvD;AAIJL,gCAA4BE,wBAAMA,CAACC,UAAP,CAAkBH,0BAAlB,CAA6CK;AAJrE,KAKDnvB,MAAMY,OALL;AAMJ+yB;AACEyC,mBAAap2B,MAAMY,OAAN,CAAcy1B,iBAAd,IAAmCrH,wBAAMA,CAACC,UAAP,CAAkBoH,iBAAlB,CAAoClH,OADtF;AAEEmH,WAAKtH,wBAAMA,CAACC,UAAP,CAAkB0E,aAAlB,CAAgC1E,UAAhC,CAA2CqH,GAA3C,CAA+CnH,OAFtD;AAGEl9B,YAAM+N,MAAMY,OAAN,CAAcqI,MAAd,IAAwB+lB,wBAAMA,CAACC,UAAP,CAAkBhmB,MAAlB,CAAyBkmB,OAHzD;AAIEoH,kBAAa,qCAAoCv2B,MAAMjJ,EAAG;AAJ5D,OAKKiJ,MAAMY,OAAN,CAAc+yB,aALnB;AANI,IAAN;;AAeA,SAAQ,uCAAC,mCAAD,gCACF3zB,KADE;AAEN,aAASwyB,eAFH;AAGN,iBAAa,2CAHP;AAIN,iBAAY,MAJN,IAAR;AAKD,CArBM,C;;ACJP;;;;;;AAMO,SAASgE,oBAAT,CAA8BC,GAA9B,EAAmC71B,OAAnC,EAA4C;AACjD,QAAM,EAACqI,MAAD,KAAWrI,OAAjB;AACA;AACA,QAAM81B,WAAW,sJAAjB;AACA,QAAMC,cAAcD,SAASpE,IAAT,CAAcmE,GAAd,CAApB;AACA,MAAIG,WAAJ,CALiD,CAKhC;AACjB,UAAQ3tB,MAAR;AACE,SAAK,OAAL;AACA,SAAK,OAAL;AACE;AACA2tB,oBAAcH,IAAIxxB,MAAJ,IAAc,EAAd,IAAoBwxB,IAAIxxB,MAAJ,IAAc,EAAlC,IAAwC,CAAC4xB,MAAMJ,GAAN,CAAvD;AACA;AACF,SAAK,IAAL;AACE;AACAG,oBAAcH,IAAIxxB,MAAJ,IAAc,CAAd,IAAmBwxB,IAAIxxB,MAAJ,IAAc,EAAjC,IAAuC,CAAC4xB,MAAMJ,GAAN,CAAtD;AACA;AACF;AACA;AACEG,oBAAc,CAACC,MAAMJ,GAAN,CAAf;AACA;AAbJ;AAeA,MAAIE,WAAJ,EAAiB;AACf,WAAO,OAAP;AACD,GAFD,MAEO,IAAIC,WAAJ,EAAiB;AACtB,WAAO,OAAP;AACD;AACD,SAAO,EAAP;AACD,C;;;;;;;ACjCD;AACA;AACA;AACA;;AAEA,SAASnC,aAAT,CAAuB1/B,KAAvB,EAA8B6L,OAA9B,EAAuC;AACrC,QAAMnP,OAAO+kC,oBAAoBA,CAACzhC,KAArB,EAA4B6L,OAA5B,CAAb;AACA,SAAOnP,OAAO,EAAP,GAAY,qCAAnB;AACD;;AAED,SAAS0hC,eAAT,CAAyBzf,KAAzB,EAAgC9T,OAAhC,EAAyC;AACvC,QAAM,EAACgB,OAAD,KAAYhB,OAAlB;AACA,QAAMnO,OAAOmP,QAAQk2B,WAAR,GAAsBN,oBAAoBA,CAAC9iB,MAAM3e,KAA3B,EAAkC6L,OAAlC,CAAtB,GAAmE,OAAhF;AACA,QAAMsyB,WAAW,IAAIG,QAAJ,EAAjB;AACA,MAAI9zB,GAAJ;AACA,MAAI9N,SAAS,OAAb,EAAsB;AACpB8N,UAAM,gDAAN;AACA2zB,aAAS6D,MAAT,CAAgB,eAAhB,EAAiCrjB,MAAM3e,KAAvC;AACAm+B,aAAS6D,MAAT,CAAgB,UAAhB,EAA4Bn2B,QAAQo2B,cAApC;AACA9D,aAAS6D,MAAT,CAAgB,SAAhB,EAA2Bn2B,QAAQq2B,OAAnC;AACD,GALD,MAKO,IAAIxlC,SAAS,OAAb,EAAsB;AAC3B8N,UAAM,4CAAN;AACA2zB,aAAS6D,MAAT,CAAgB,OAAhB,EAAyBrjB,MAAM3e,KAA/B;AACAm+B,aAAS6D,MAAT,CAAgB,aAAhB,EAA+Bn2B,QAAQs2B,gBAAvC;AACAhE,aAAS6D,MAAT,CAAgB,YAAhB,EAA8BI,mBAAoB,qCAAoCv3B,QAAQ7I,EAAG,EAAnE,CAA9B;AACD;AACDm8B,WAAS6D,MAAT,CAAgB,MAAhB,EAAwBn2B,QAAQqI,MAAhC;AACA,SAAO,EAACiqB,QAAD,EAAW3zB,GAAX,EAAP;AACD;;AAED,SAAS63B,gBAAT,CAA0Bp3B,KAA1B,EAAiC;AAC/B,2BACKA,KADL;AAEEY;AACE4zB,2BAAqBxF,0BAAMA,CAACC,UAAP,CAAkBuF,mBAAlB,CAAsCrF,OAD7D;AAEEL,kCAA4BE,0BAAMA,CAACC,UAAP,CAAkBH,0BAAlB,CAA6CK,OAF3E;AAGEmG,2BAAqBtG,0BAAMA,CAACC,UAAP,CAAkBqG,mBAAlB,CAAsCnG,OAH7D;AAIE2F,gCAA0B9F,0BAAMA,CAACC,UAAP,CAAkB6F,wBAAlB,CAA2C3F,OAJvE;AAKElmB,cAAQ+lB,0BAAMA,CAACC,UAAP,CAAkBhmB,MAAlB,CAAyBkmB,OALnC;AAME8H,eAASjI,0BAAMA,CAACC,UAAP,CAAkBgI,OAAlB,CAA0B9H,OANrC;AAOE+H,wBAAkB,EAPpB;AAQEJ,mBAAa9H,0BAAMA,CAACC,UAAP,CAAkB6H,WAAlB,CAA8B3H;AAR7C,OASKnvB,MAAMY,OATX;AAFF;AAcD;;AAEM,MAAMy2B,sBAAsBr3B,SAAS;AAC1C,QAAMs3B,oBAAoBF,iBAAiBp3B,KAAjB,CAA1B;;AAEA,SAAQ,uCAAC,mCAAD,kCAAuBs3B,iBAAvB;AACN,iBAAY,MADN;AAEN,eAAU,wBAFJ;AAGN,eAAWA,kBAAkB12B,OAAlB,CAA0Bk2B,WAA1B,GAAwC,MAAxC,GAAiD,OAHtD;AAIN,mBAAeQ,kBAAkB12B,OAAlB,CAA0Bk2B,WAA1B,GAAwCrC,aAAxC,GAAwD,IAJjE;AAKN,qBAAiBtB,eALX,IAAR;AAMD,CATM,C;;AC/CP;AAAA;AACA;AACA;AACA;AACA;;AAEA;AACO,MAAMzxB,oBAAoB;AAC/B61B,kBAAgBhI,2BADe;AAE/BiI,sBAAoBrB,iBAFW;AAG/BsB,sBAAoBhC,gBAHW;AAI/BiC,0BAAwBL,mBAJO;AAK/BM,eAAapF,UAAUA;AALQ,CAA1B,C;;;;;;;;;ACPP;;AAEA,MAAMqF,iBAAiB,GAAvB;;AAEA,MAAMC,oBAAoB,2BAA1B;AACA,MAAMC,eAAe,yBAArB;AACA,MAAMC,uBAAuB,kBAA7B;;AAEA;;;;;;;;;;;;;AAaA,MAAMC,aAAN,CAAoB;AAClB;;;;;;;;;AASAC,cAAYjzB,MAAZ,EAAoB;AAClB,SAAKkzB,OAAL,GAAelzB,MAAf;AACA,SAAKmzB,MAAL,GAAc,CAAd;AACA,SAAKC,OAAL,GAAepzB,OAAOC,MAAtB;AACA,SAAK2e,OAAL,GAAe,EAAf;;AAEA,UAAM1T,SAAS,EAAf;;AAEA,SAAKmoB,MAAL;AACA,WAAO,KAAKF,MAAL,GAAc,KAAKC,OAA1B,EAAmC;AACjC,UAAI;AACF,aAAKE,QAAL;AACD,OAFD,CAEE,OAAOr9B,CAAP,EAAU;AACV,YAAIA,aAAas9B,WAAjB,EAA8B;AAC5BroB,iBAAOjZ,IAAP,CAAYgE,CAAZ;;AAEA,eAAKu9B,oBAAL;AACD,SAJD,MAIO;AACL,gBAAMv9B,CAAN;AACD;AACF;AACD,WAAKo9B,MAAL;AACD;;AAED,WAAO,CAAC,KAAKzU,OAAN,EAAe1T,MAAf,CAAP;AACD;;AAED;;;;;;AAMAooB,aAAW;AACT;AACA;AACA,QAAI,KAAKH,MAAL,KAAgB,CAAhB,IACA,KAAKD,OAAL,CAAa,KAAKC,MAAL,GAAc,CAA3B,MAAkC,IADtC,EAC4C;AAC1C,YAAM,KAAKx/B,KAAL,CAAY;uDAAZ,CAAN;AAED;;AAED,UAAM8/B,KAAK,KAAKP,OAAL,CAAa,KAAKC,MAAlB,CAAX;;AAEA;AACA,QAAIM,OAAO,GAAP,IACDA,OAAO,GAAP,IACC,CAAC,GAAD,EAAM,GAAN,EAAW,IAAX,EAAiBzhC,QAAjB,CAA0B,KAAKkhC,OAAL,CAAa,KAAKC,MAAL,GAAc,CAA3B,CAA1B,CAFJ,EAE+D;AAC7D,WAAKO,WAAL;AACA;AACD;;AAED,QAAID,OAAO,GAAX,EAAgB;AACd,WAAKE,WAAL;AACA;AACD;;AAED,SAAKC,UAAL;AACD;;AAED;;;;;AAKAD,gBAAc;AACZ,SAAKR,MAAL,IAAe,CAAf;AACA,QAAI,KAAKD,OAAL,CAAa,KAAKC,MAAlB,MAA8B,GAAlC,EAAuC;AACrC,YAAM,KAAKx/B,KAAL,CAAW,iCAAX,CAAN;AACD;;AAED,SAAKw/B,MAAL,IAAe,CAAf;;AAEA,SAAKU,YAAL;AACA,SAAKC,cAAL;AACA,SAAKD,YAAL;;AAEA,QAAI,KAAKX,OAAL,CAAa,KAAKC,MAAlB,MAA8B,GAA9B,IACA,KAAKD,OAAL,CAAa,KAAKC,MAAL,GAAc,CAA3B,MAAkC,GADtC,EAC2C;AACzC,YAAM,KAAKx/B,KAAL,CAAW,kCAAX,CAAN;AACD;;AAED,SAAKw/B,MAAL,IAAe,CAAf;AACD;;AAED;;;;;;AAMAS,eAAa;AACX,UAAM7hC,KAAK,KAAKgiC,kBAAL,EAAX;;AAEA,SAAKF,YAAL;;AAEA,QAAI,KAAKX,OAAL,CAAa,KAAKC,MAAlB,MAA8B,GAAlC,EAAuC;AACrC,WAAKA,MAAL;AACD;;AAED,SAAKU,YAAL;;AAEA,UAAMpC,MAAM,KAAKuC,UAAL,EAAZ;;AAEA,QAAIjiC,GAAG0gB,UAAH,CAAc,GAAd,KAAsBgf,QAAQ,IAAlC,EAAwC;AACtC,YAAM,KAAK99B,KAAL,CAAW,+BAAX,CAAN;AACD;;AAED,QAAIiM,QAAQ,IAAZ;;AAEA,QAAI,KAAKszB,OAAL,CAAa,KAAKC,MAAlB,MAA8B,GAAlC,EAAuC;AACrC,YAAMc,YAAY,KAAKd,MAAvB;AACA,WAAKU,YAAL;;AAEA,UAAI,KAAKX,OAAL,CAAa,KAAKC,MAAlB,MAA8B,GAAlC,EAAuC;AACrC,aAAKA,MAAL,GAAcc,SAAd;AACAr0B,gBAAQ,KAAKs0B,aAAL,EAAR;AACD;AACF;;AAED,QAAIt0B,UAAU,IAAV,IAAkB,OAAO6xB,GAAP,KAAe,QAArC,EAA+C;AAC7C,WAAK7S,OAAL,CAAa7sB,EAAb,IAAmB0/B,GAAnB;AACD,KAFD,MAEO;AACL,UAAIA,QAAQ,IAAR,IAAgB7xB,UAAU,IAA9B,EAAoC;AAClC,cAAM,KAAKjM,KAAL,CAAW,gDAAX,CAAN;AACD;;AAED,WAAKirB,OAAL,CAAa7sB,EAAb,IAAmB,EAAnB;;AAEA,UAAI0/B,QAAQ,IAAZ,EAAkB;AAChB,aAAK7S,OAAL,CAAa7sB,EAAb,EAAiB0/B,GAAjB,GAAuBA,GAAvB;AACD;;AAED,UAAI7xB,UAAU,IAAd,EAAoB;AAClB,aAAKgf,OAAL,CAAa7sB,EAAb,EAAiB6N,KAAjB,GAAyBA,KAAzB;AACD;AACF;AACF;;AAED;;;;;AAKAyzB,WAAS;AACP,QAAII,KAAK,KAAKP,OAAL,CAAa,KAAKC,MAAlB,CAAT;AACA,WAAOM,OAAO,GAAP,IAAcA,OAAO,IAArB,IAA6BA,OAAO,IAApC,IAA4CA,OAAO,IAA1D,EAAgE;AAC9DA,WAAK,KAAKP,OAAL,CAAa,EAAE,KAAKC,MAApB,CAAL;AACD;AACF;;AAED;;;;;AAKAU,iBAAe;AACb,QAAIJ,KAAK,KAAKP,OAAL,CAAa,KAAKC,MAAlB,CAAT;AACA,WAAOM,OAAO,GAAP,IAAcA,OAAO,IAA5B,EAAkC;AAChCA,WAAK,KAAKP,OAAL,CAAa,EAAE,KAAKC,MAApB,CAAL;AACD;AACF;;AAED;;;;;AAKAgB,mBAAiB;AACf,WAAO,IAAP,EAAa;AACX,YAAMC,MAAM,KAAKjB,MAAjB;;AAEA,WAAKU,YAAL;;AAEA,UAAI,KAAKX,OAAL,CAAa,KAAKC,MAAlB,MAA8B,IAAlC,EAAwC;AACtC,aAAKA,MAAL,IAAe,CAAf;AACD,OAFD,MAEO;AACL,aAAKA,MAAL,GAAciB,GAAd;AACA;AACD;AACF;AACF;;AAED;;;;;;;;;AASAC,gBAAcC,KAAKxB,YAAnB,EAAiC;AAC/BwB,OAAGC,SAAH,GAAe,KAAKpB,MAApB;AACA,UAAMl/B,SAASqgC,GAAGE,IAAH,CAAQ,KAAKtB,OAAb,CAAf;;AAEA,QAAIj/B,WAAW,IAAf,EAAqB;AACnB,WAAKk/B,MAAL,IAAe,CAAf;AACA,YAAM,KAAKx/B,KAAL,CAAY,2BAA0B2gC,GAAGG,QAAH,EAAc,GAApD,CAAN;AACD;;AAED,SAAKtB,MAAL,GAAcmB,GAAGC,SAAjB;AACA,WAAOtgC,OAAO,CAAP,CAAP;AACD;;AAED;;;;;;AAMA8/B,uBAAqB;AACnB,WAAO,KAAKM,aAAL,CAAmBxB,iBAAnB,CAAP;AACD;;AAED;;;;;;AAMAiB,mBAAiB;AACf,QAAIhkC,OAAO,EAAX;;AAEA,UAAM4kC,QAAQ,KAAKvB,MAAnB;AACA,QAAIwB,KAAK,KAAKzB,OAAL,CAAa0B,UAAb,CAAwB,KAAKzB,MAA7B,CAAT;;AAEA,QAAKwB,MAAM,EAAN,IAAYA,MAAM,GAAnB,IAA2B;AAC1BA,UAAM,EAAN,IAAYA,MAAM,EADnB,IAC0B;AAC1BA,WAAO,EAFP,IAEaA,OAAO,EAFxB,EAE4B;AAAE;AAC5BA,WAAK,KAAKzB,OAAL,CAAa0B,UAAb,CAAwB,EAAE,KAAKzB,MAA/B,CAAL;AACD,KAJD,MAIO;AACL,YAAM,KAAKx/B,KAAL,CAAW,8CAAX,CAAN;AACD;;AAED,WAAQghC,MAAM,EAAN,IAAYA,MAAM,GAAnB,IAA2B;AAC1BA,UAAM,EAAN,IAAYA,MAAM,EADnB,IAC0B;AACzBA,UAAM,EAAN,IAAYA,MAAM,EAFnB,IAE0B;AAC1BA,WAAO,EAHP,IAGaA,OAAO,EAHpB,IAG0BA,OAAO,EAHxC,EAG4C;AAAE;AAC5CA,WAAK,KAAKzB,OAAL,CAAa0B,UAAb,CAAwB,EAAE,KAAKzB,MAA/B,CAAL;AACD;;AAED;AACA;AACA;AACA;AACA,WAAO,KAAKD,OAAL,CAAa0B,UAAb,CAAwB,KAAKzB,MAAL,GAAc,CAAtC,MAA6C,EAApD,EAAwD;AACtD,WAAKA,MAAL;AACD;;AAEDrjC,YAAQ,KAAKojC,OAAL,CAAa/4B,KAAb,CAAmBu6B,KAAnB,EAA0B,KAAKvB,MAA/B,CAAR;;AAEA,WAAO,EAAE1mC,MAAM,SAAR,EAAmBqD,IAAnB,EAAP;AACD;;AAED;;;;;;AAMA+kC,cAAY;AACV,UAAMH,QAAQ,KAAKvB,MAAL,GAAc,CAA5B;;AAEA,WAAO,EAAE,KAAKA,MAAP,GAAgB,KAAKC,OAA5B,EAAqC;AACnC,YAAMK,KAAK,KAAKP,OAAL,CAAa,KAAKC,MAAlB,CAAX;;AAEA,UAAIM,OAAO,GAAX,EAAgB;AACd;AACD;;AAED,UAAIA,OAAO,IAAX,EAAiB;AACf,cAAM,KAAK9/B,KAAL,CAAW,gCAAX,CAAN;AACD;AACF;;AAED,WAAO,KAAKu/B,OAAL,CAAa4B,SAAb,CAAuBJ,KAAvB,EAA8B,KAAKvB,MAAL,EAA9B,CAAP;AACD;;AAED;;;;;;;;AAQAa,eAAa;AACX;AACA;AACA;AACA;AACA;AACA,UAAMU,QAAQ,KAAKvB,MAAnB;AACA,QAAI4B,MAAM,KAAK7B,OAAL,CAAa94B,OAAb,CAAqB,IAArB,EAA2B,KAAK+4B,MAAhC,CAAV;;AAEA,QAAI4B,QAAQ,CAAC,CAAb,EAAgB;AACdA,YAAM,KAAK3B,OAAX;AACD;;AAED,UAAM4B,mBAAmBN,UAAUK,GAAV,GACvB,KAAK7B,OAAL,CAAa/4B,KAAb,CAAmBu6B,KAAnB,EAA0BK,GAA1B,CADuB,GACU,IADnC;;AAGA,QAAIC,oBAAoBA,iBAAiBhjC,QAAjB,CAA0B,GAA1B,CAAxB,EAAwD;AACtD,aAAO,KAAKijC,iBAAL,EAAP;AACD;;AAED,SAAK9B,MAAL,GAAc4B,MAAM,CAApB;;AAEA,SAAKZ,cAAL;;AAEA,QAAI,KAAKjB,OAAL,CAAa,KAAKC,MAAlB,MAA8B,GAAlC,EAAuC;AACrC;AACA;AACA;AACA,aAAO6B,gBAAP;AACD;;AAED,UAAMf,YAAY,KAAKd,MAAvB;;AAEA,SAAKU,YAAL;;AAEA,QAAI,KAAKX,OAAL,CAAa,KAAKC,MAAlB,MAA8B,GAAlC,EAAuC;AACrC;AACA;AACA,WAAKA,MAAL,GAAcc,SAAd;AACA,aAAOe,gBAAP;AACD;;AAED,QAAIA,gBAAJ,EAAsB;AACpB;AACA;AACA,WAAK7B,MAAL,GAAcuB,KAAd;AACD;;AAED,WAAO,KAAKO,iBAAL,EAAP;AACD;;AAED;;;;;;;;;AASA;AACAA,sBAAoB;AAClB,QAAIC,SAAS,EAAb;AACA,UAAMt5B,UAAU,EAAhB;AACA,QAAIu5B,aAAa,CAAjB;;AAEA,QAAI1B,KAAK,KAAKP,OAAL,CAAa,KAAKC,MAAlB,CAAT;;AAEA,WAAO,KAAKA,MAAL,GAAc,KAAKC,OAA1B,EAAmC;AACjC;AACA;AACA,UAAIK,OAAO,IAAX,EAAiB;AACf,aAAKN,MAAL;;AAEA;AACA;AACA;AACA;AACA,cAAMiC,kBAAkB,KAAKjC,MAA7B;AACA,aAAKgB,cAAL;AACA,cAAMkB,gBAAgB,KAAKlC,MAA3B;;AAGA,YAAI,KAAKD,OAAL,CAAa,KAAKC,MAAlB,MAA8B,GAAlC,EAAuC;AACrC;AACD;AACD,aAAKU,YAAL;;AAEA,YAAI,KAAKX,OAAL,CAAa,KAAKC,MAAlB,MAA8B,GAA9B,IACA,KAAKD,OAAL,CAAa,KAAKC,MAAlB,MAA8B,GAD9B,IAEA,KAAKD,OAAL,CAAa,KAAKC,MAAlB,MAA8B,GAF9B,IAGA,KAAKD,OAAL,CAAa,KAAKC,MAAlB,MAA8B,GAHlC,EAGuC;AACrC,eAAKA,MAAL,GAAckC,aAAd;AACA;AACD;;AAEDH,kBAAU,KAAKhC,OAAL,CAAa4B,SAAb,CAAuBM,eAAvB,EAAwCC,aAAxC,CAAV;;AAEA,YAAIH,OAAOj1B,MAAP,IAAiBrE,QAAQqE,MAA7B,EAAqC;AACnCi1B,oBAAU,IAAV;AACD;AACDzB,aAAK,KAAKP,OAAL,CAAa,KAAKC,MAAlB,CAAL;AACA;AACD,OAhCD,MAgCO,IAAIM,OAAO,IAAX,EAAiB;AACtB,cAAM6B,MAAM,KAAKpC,OAAL,CAAa,KAAKC,MAAL,GAAc,CAA3B,CAAZ;AACA,YAAImC,QAAQ,GAAR,IAAeA,QAAQ,GAAvB,IAA8BA,QAAQ,IAA1C,EAAgD;AAC9C7B,eAAK6B,GAAL;AACA,eAAKnC,MAAL;AACD;AACF,OANM,MAMA,IAAIM,OAAO,GAAX,EAAgB;AACrB;AACA,YAAIyB,OAAOj1B,MAAX,EAAmB;AACjBrE,kBAAQ3J,IAAR,CAAaijC,MAAb;AACD;AACD,YAAIC,aAAavC,iBAAiB,CAAlC,EAAqC;AACnC,gBAAM,KAAKj/B,KAAL,CACH,2CAA0Ci/B,cAAe,EADtD,CAAN;AAED;AACDsC,iBAAS,EAAT;AACAt5B,gBAAQ3J,IAAR,CAAa,KAAKsjC,YAAL,EAAb;;AAEA,aAAKpC,MAAL;;AAEAM,aAAK,KAAKP,OAAL,CAAa,KAAKC,MAAlB,CAAL;AACAgC;AACA;AACD;;AAED,UAAI1B,EAAJ,EAAQ;AACNyB,kBAAUzB,EAAV;AACD;AACD,WAAKN,MAAL;AACAM,WAAK,KAAKP,OAAL,CAAa,KAAKC,MAAlB,CAAL;AACD;;AAED,QAAIv3B,QAAQqE,MAAR,KAAmB,CAAvB,EAA0B;AACxB,aAAOi1B,OAAOj1B,MAAP,GAAgBi1B,MAAhB,GAAyB,IAAhC;AACD;;AAED,QAAIA,OAAOj1B,MAAX,EAAmB;AACjBrE,cAAQ3J,IAAR,CAAaijC,MAAb;AACD;;AAED,WAAOt5B,OAAP;AACD;AACD;;AAEA;;;;;;;AAOA25B,iBAAe;AACb,UAAMb,QAAQ,EAAE,KAAKvB,MAArB;;AAEA,SAAKE,MAAL;;AAEA,QAAI,KAAKH,OAAL,CAAa,KAAKC,MAAlB,MAA8B,GAA9B,IACA,KAAKD,OAAL,CAAa,KAAKC,MAAlB,MAA8B,GAA9B,IACA,KAAKD,OAAL,CAAa,KAAKC,MAAL,GAAc,CAA3B,MAAkC,GAFtC,EAE4C;AAC1C,YAAMqC,WAAW,KAAKC,WAAL,EAAjB;;AAEA,aAAO;AACLhpC,cAAM,KADD;AAELipC,aAAK,IAFA;AAGLC,cAAMH,SAAS,CAAT,CAHD;AAILI,aAAKJ,SAAS,CAAT;AAJA,OAAP;AAMD;;AAED;AACA,SAAKrC,MAAL,GAAcuB,KAAd;AACA,SAAKb,YAAL;;AAEA,UAAMgC,WAAW,KAAKC,qBAAL,EAAjB;;AAEA,SAAKzC,MAAL;;AAEA,UAAMI,KAAK,KAAKP,OAAL,CAAa,KAAKC,MAAlB,CAAX;;AAEA,QAAIM,OAAO,GAAX,EAAgB;AACd,UAAIoC,SAASppC,IAAT,KAAkB,MAAlB,IAA4BopC,SAAS9jC,EAAT,CAAYjC,IAAZ,CAAiB2iB,UAAjB,CAA4B,GAA5B,CAAhC,EAAkE;AAChE,cAAM,KAAK9e,KAAL,CACJ,wDADI,CAAN;AAGD;;AAED,aAAOkiC,QAAP;AACD;;AAED,QAAIpC,OAAO,GAAP,IAAc,KAAKP,OAAL,CAAa,KAAKC,MAAL,GAAc,CAA3B,MAAkC,GAApD,EAAyD;AACvD,YAAM,KAAKx/B,KAAL,CAAW,sBAAX,CAAN;AACD;;AAED,QAAIkiC,SAASppC,IAAT,KAAkB,KAAtB,EAA6B;AAC3B,YAAM,KAAKkH,KAAL,CAAW,iDAAX,CAAN;AACD;;AAED,QAAIkiC,SAASppC,IAAT,KAAkB,KAAtB,EAA6B;AAC3B,YAAM,KAAKkH,KAAL,CAAW,uCAAX,CAAN;AACD;;AAED,QAAIkiC,SAASppC,IAAT,KAAkB,MAAlB,IAA4B,CAACopC,SAAS9jC,EAAT,CAAYjC,IAAZ,CAAiB2iB,UAAjB,CAA4B,GAA5B,CAAjC,EAAmE;AACjE,YAAM,KAAK9e,KAAL,CACJ,4DADI,CAAN;AAGD;;AAGD,SAAKw/B,MAAL,IAAe,CAAf,CAzDa,CAyDK;;AAElB,SAAKU,YAAL;;AAEA,QAAI,KAAKX,OAAL,CAAa,KAAKC,MAAlB,MAA8B,IAAlC,EAAwC;AACtC,YAAM,KAAKx/B,KAAL,CAAW,yCAAX,CAAN;AACD;;AAED,SAAK0/B,MAAL;;AAEA,UAAMmC,WAAW,KAAKC,WAAL,EAAjB;;AAEA,QAAID,SAAS,CAAT,EAAYv1B,MAAZ,KAAuB,CAA3B,EAA8B;AAC5B,YAAM,KAAKtM,KAAL,CAAW,4CAAX,CAAN;AACD;;AAED,WAAO;AACLlH,YAAM,KADD;AAELipC,WAAKG,QAFA;AAGLF,YAAMH,SAAS,CAAT,CAHD;AAILI,WAAKJ,SAAS,CAAT;AAJA,KAAP;AAMD;;AAED;;;;;;AAMAM,0BAAwB;AACtB,UAAMC,UAAU,KAAKC,UAAL,EAAhB;;AAEA,QAAID,QAAQtpC,IAAR,KAAiB,KAArB,EAA4B;AAC1B,aAAOspC,OAAP;AACD;;AAED,QAAI,KAAK7C,OAAL,CAAa,KAAKC,MAAlB,MAA8B,GAAlC,EAAuC;AACrC,WAAKA,MAAL;;AAEA,YAAMrjC,OAAO,KAAKukC,aAAL,EAAb;AACA,WAAKlB,MAAL;AACA,aAAO;AACL1mC,cAAM,MADD;AAELsF,YAAIgkC,OAFC;AAGLjmC;AAHK,OAAP;AAKD;;AAED,QAAI,KAAKojC,OAAL,CAAa,KAAKC,MAAlB,MAA8B,GAAlC,EAAuC;AACrC,WAAKA,MAAL;;AAEA,YAAM9hC,MAAM,KAAK4kC,aAAL,EAAZ;AACA,WAAK9C,MAAL;AACA,aAAO;AACL1mC,cAAM,KADD;AAELsF,YAAIgkC,OAFC;AAGL1kC;AAHK,OAAP;AAKD;;AAED,QAAI,KAAK6hC,OAAL,CAAa,KAAKC,MAAlB,MAA8B,GAAlC,EAAuC;AACrC,WAAKA,MAAL;AACA,YAAMx3B,OAAO,KAAKu6B,WAAL,EAAb;;AAEA,UAAI,CAACnD,qBAAqBzF,IAArB,CAA0ByI,QAAQjmC,IAAlC,CAAL,EAA8C;AAC5C,cAAM,KAAK6D,KAAL,CAAW,uCAAX,CAAN;AACD;;AAED,WAAKw/B,MAAL;;AAEA4C,cAAQtpC,IAAR,GAAe,KAAf;;AAEA,aAAO;AACLA,cAAM,MADD;AAEL0pC,aAAKJ,OAFA;AAGLp6B;AAHK,OAAP;AAKD;;AAED,WAAOo6B,OAAP;AACD;;AAED;;;;;;AAMAG,gBAAc;AACZ,UAAMv6B,OAAO,EAAb;;AAEA,WAAO,KAAKw3B,MAAL,GAAc,KAAKC,OAA1B,EAAmC;AACjC,WAAKS,YAAL;;AAEA,UAAI,KAAKX,OAAL,CAAa,KAAKC,MAAlB,MAA8B,GAAlC,EAAuC;AACrC,eAAOx3B,IAAP;AACD;;AAED,YAAM+5B,MAAM,KAAKI,qBAAL,EAAZ;;AAEA;AACA;AACA,UAAIJ,IAAIjpC,IAAJ,KAAa,KAAjB,EAAwB;AACtBkP,aAAK1J,IAAL,CAAUyjC,GAAV;AACD,OAFD,MAEO;AACL,aAAK7B,YAAL;;AAEA,YAAI,KAAKX,OAAL,CAAa,KAAKC,MAAlB,MAA8B,GAAlC,EAAuC;AACrC,eAAKA,MAAL;AACA,eAAKU,YAAL;;AAEA,gBAAMpC,MAAM,KAAKqE,qBAAL,EAAZ;;AAEA;AACA;AACA;AACA;AACA;AACA,cAAI,OAAOrE,GAAP,KAAe,QAAf,IACA3xB,MAAMC,OAAN,CAAc0xB,GAAd,CADA,IAEAA,IAAIhlC,IAAJ,KAAa,KAFjB,EAEwB;AACtBkP,iBAAK1J,IAAL,CAAU;AACRxF,oBAAM,MADE;AAERqD,oBAAM4lC,IAAI5lC,IAFF;AAGR2hC;AAHQ,aAAV;AAKD,WARD,MAQO;AACL,iBAAK0B,MAAL,GAAc,KAAKD,OAAL,CAAakD,WAAb,CAAyB,GAAzB,EAA8B,KAAKjD,MAAnC,IAA6C,CAA3D;AACA,kBAAM,KAAKx/B,KAAL,CACJ,oCADI,CAAN;AAED;AAEF,SAzBD,MAyBO;AACLgI,eAAK1J,IAAL,CAAUyjC,GAAV;AACD;AACF;;AAED,WAAK7B,YAAL;;AAEA,UAAI,KAAKX,OAAL,CAAa,KAAKC,MAAlB,MAA8B,GAAlC,EAAuC;AACrC;AACD,OAFD,MAEO,IAAI,KAAKD,OAAL,CAAa,KAAKC,MAAlB,MAA8B,GAAlC,EAAuC;AAC5C,aAAKA,MAAL;AACD,OAFM,MAEA;AACL,cAAM,KAAKx/B,KAAL,CAAW,qBAAX,CAAN;AACD;AACF;;AAED,WAAOgI,IAAP;AACD;;AAED;;;;;;AAMA06B,cAAY;AACV,QAAIC,MAAM,EAAV;AACA,QAAI3B,KAAK,KAAKzB,OAAL,CAAa0B,UAAb,CAAwB,KAAKzB,MAA7B,CAAT;;AAEA;AACA,QAAIwB,OAAO,EAAX,EAAe;AACb2B,aAAO,GAAP;AACA3B,WAAK,KAAKzB,OAAL,CAAa0B,UAAb,CAAwB,EAAE,KAAKzB,MAA/B,CAAL;AACD;;AAED;AACA,QAAIwB,KAAK,EAAL,IAAWA,KAAK,EAApB,EAAwB;AACtB,YAAM,KAAKhhC,KAAL,CAAY,oBAAmB2iC,GAAI,GAAnC,CAAN;AACD;;AAED;AACA,WAAO3B,MAAM,EAAN,IAAYA,MAAM,EAAzB,EAA6B;AAC3B2B,aAAO,KAAKpD,OAAL,CAAa,KAAKC,MAAL,EAAb,CAAP;AACAwB,WAAK,KAAKzB,OAAL,CAAa0B,UAAb,CAAwB,KAAKzB,MAA7B,CAAL;AACD;;AAED;AACA,QAAIwB,OAAO,EAAX,EAAe;AACb2B,aAAO,KAAKpD,OAAL,CAAa,KAAKC,MAAL,EAAb,CAAP;AACAwB,WAAK,KAAKzB,OAAL,CAAa0B,UAAb,CAAwB,KAAKzB,MAA7B,CAAL;;AAEA;AACA,UAAIwB,KAAK,EAAL,IAAWA,KAAK,EAApB,EAAwB;AACtB,cAAM,KAAKhhC,KAAL,CAAY,oBAAmB2iC,GAAI,GAAnC,CAAN;AACD;;AAED;AACA,aAAO3B,MAAM,EAAN,IAAYA,MAAM,EAAzB,EAA6B;AAC3B2B,eAAO,KAAKpD,OAAL,CAAa,KAAKC,MAAL,EAAb,CAAP;AACAwB,aAAK,KAAKzB,OAAL,CAAa0B,UAAb,CAAwB,KAAKzB,MAA7B,CAAL;AACD;AACF;;AAED,WAAO;AACL1mC,YAAM,KADD;AAELglC,WAAK6E;AAFA,KAAP;AAID;;AAED;;;;;;AAMApC,kBAAgB;AACd,UAAMt0B,QAAQ,EAAd;;AAEA,WAAO,KAAKuzB,MAAL,GAAc,KAAKC,OAA1B,EAAmC;AACjC,UAAI,KAAKF,OAAL,CAAa,KAAKC,MAAlB,MAA8B,GAAlC,EAAuC;AACrC;AACD;AACD,WAAKU,YAAL;;AAEA,UAAI,KAAKX,OAAL,CAAa,KAAKC,MAAlB,MAA8B,GAAlC,EAAuC;AACrC;AACD;AACD,WAAKA,MAAL;;AAEA,YAAM9hC,MAAM,KAAKgjC,aAAL,EAAZ;;AAEA,WAAKR,YAAL;;AAEA,UAAI,KAAKX,OAAL,CAAa,KAAKC,MAAlB,MAA8B,GAAlC,EAAuC;AACrC,cAAM,KAAKx/B,KAAL,CAAW,cAAX,CAAN;AACD;AACD,WAAKw/B,MAAL;;AAEA,WAAKU,YAAL;;AAEA,YAAMpC,MAAM,KAAKuC,UAAL,EAAZ;;AAEA,UAAIvC,QAAQ,IAAZ,EAAkB;AAChB,cAAM,KAAK99B,KAAL,CAAW,oCAAX,CAAN;AACD;;AAED,UAAI,OAAO89B,GAAP,KAAe,QAAnB,EAA6B;AAC3B7xB,cAAMvO,GAAN,IAAaogC,GAAb;AACD,OAFD,MAEO;AACL7xB,cAAMvO,GAAN,IAAa;AACXogC;AADW,SAAb;AAGD;;AAED,WAAK0C,cAAL;AACD;;AAED,WAAOv0B,KAAP;AACD;;AAED;;;;;;AAMA61B,gBAAc;AACZ,UAAMD,WAAW,EAAjB;AACA,QAAI/gB,QAAQ,CAAZ;AACA,QAAI8hB,YAAJ;;AAEA,WAAO,KAAKpD,MAAL,GAAc,KAAKC,OAA1B,EAAmC;AACjC,YAAMK,KAAK,KAAKP,OAAL,CAAa,KAAKC,MAAlB,CAAX;;AAEA,UAAI,CAACM,OAAO,GAAP,IAAc,KAAKP,OAAL,CAAa,KAAKC,MAAL,GAAc,CAA3B,MAAkC,GAAjD,KACAM,OAAO,GADX,EACgB;AACd;AACD;AACD,UAAIA,OAAO,GAAX,EAAgB;AACd,aAAKN,MAAL;AACAoD,uBAAe9hB,KAAf;AACD;;AAED,UAAI,KAAKye,OAAL,CAAa,KAAKC,MAAlB,MAA8B,GAAlC,EAAuC;AACrC,cAAM,KAAKx/B,KAAL,CAAW,cAAX,CAAN;AACD;;AAED,WAAKw/B,MAAL;;AAEA,YAAM9hC,MAAM,KAAK4kC,aAAL,EAAZ;;AAEA,WAAKpC,YAAL;;AAEA,YAAMpC,MAAM,KAAKuC,UAAL,EAAZ;;AAEA,UAAIvC,QAAQ,IAAZ,EAAkB;AAChB,cAAM,KAAK99B,KAAL,CAAW,kCAAX,CAAN;AACD;;AAED6hC,eAAS/gB,OAAT,IAAoB,EAACpjB,GAAD,EAAMogC,GAAN,EAApB;;AAEA,WAAK4B,MAAL;AACD;;AAED,WAAO,CAACmC,QAAD,EAAWe,YAAX,CAAP;AACD;;AAED;;;;;;AAMAN,kBAAgB;AACd;;AAEA,UAAMtB,KAAK,KAAKzB,OAAL,CAAa0B,UAAb,CAAwB,KAAKzB,MAA7B,CAAX;AACA,QAAI4C,OAAJ;;AAEA,QAAKpB,MAAM,EAAN,IAAYA,MAAM,EAAnB,IAA0BA,OAAO,EAArC,EAAyC;AACvCoB,gBAAU,KAAKM,SAAL,EAAV;AACD,KAFD,MAEO;AACLN,gBAAU,KAAKjC,cAAL,EAAV;AACD;;AAED,QAAI,KAAKZ,OAAL,CAAa,KAAKC,MAAlB,MAA8B,GAAlC,EAAuC;AACrC,YAAM,KAAKx/B,KAAL,CAAW,cAAX,CAAN;AACD;;AAED,SAAKw/B,MAAL;AACA,WAAO4C,OAAP;AACD;;AAED;;;;;;AAMAC,eAAa;AACX,UAAMQ,MAAM,KAAKtD,OAAL,CAAa0B,UAAb,CAAwB,KAAKzB,MAA7B,CAAZ;;AAEA,QAAIqD,QAAQ,EAAZ,EAAgB;AAAE;AAChB,WAAKrD,MAAL;AACA,aAAO;AACL1mC,cAAM,KADD;AAELqD,cAAM,KAAKukC,aAAL;AAFD,OAAP;AAID;;AAED,UAAMoC,MAAMD,QAAQ,EAAR,CAAW;AACrB;AADU,MAER,KAAKtD,OAAL,CAAa0B,UAAb,CAAwB,KAAKzB,MAAL,GAAc,CAAtC;AACF;AAHU,MAIRqD,GAJJ;;AAMA,QAAKC,OAAO,EAAP,IAAaA,OAAO,GAArB,IAA6B;AAC5BA,WAAO,EAAP,IAAaA,OAAO,EADzB,EAC8B;AAAE;AAC9B,aAAO;AACLhqC,cAAM,KADD;AAELqD,cAAM,KAAKikC,kBAAL;AAFD,OAAP;AAID;;AAED,QAAK0C,OAAO,EAAP,IAAaA,OAAO,EAAzB,EAA8B;AAAE;AAC9B,aAAO,KAAKJ,SAAL,EAAP;AACD;;AAED,QAAIG,QAAQ,EAAZ,EAAgB;AAAE;AAChB,aAAO,KAAK3B,SAAL,EAAP;AACD;;AAED,UAAM,KAAKlhC,KAAL,CAAW,kBAAX,CAAN;AACD;;AAED;;;;;AAKA+/B,gBAAc;AACZ;AACA;AACA,QAAIqB,MAAM,KAAK7B,OAAL,CAAa94B,OAAb,CAAqB,IAArB,EAA2B,KAAK+4B,MAAhC,CAAV;;AAEA,WAAO4B,QAAQ,CAAC,CAAT,KACH,KAAK7B,OAAL,CAAa6B,MAAM,CAAnB,MAA0B,GAA1B,IAAiC,KAAK7B,OAAL,CAAa6B,MAAM,CAAnB,MAA0B,GAA5D,IACC,KAAK7B,OAAL,CAAa6B,MAAM,CAAnB,MAA0B,GAA1B,IACC,CAAC,GAAD,EAAM,GAAN,EAAW/iC,QAAX,CAAoB,KAAKkhC,OAAL,CAAa6B,MAAM,CAAnB,CAApB,CAHE,CAAP,EAGmD;AACjD,WAAK5B,MAAL,GAAc4B,MAAM,CAApB;;AAEAA,YAAM,KAAK7B,OAAL,CAAa94B,OAAb,CAAqB,IAArB,EAA2B,KAAK+4B,MAAhC,CAAN;;AAEA,UAAI4B,QAAQ,CAAC,CAAb,EAAgB;AACd;AACD;AACF;;AAED,QAAIA,QAAQ,CAAC,CAAb,EAAgB;AACd,WAAK5B,MAAL,GAAc,KAAKC,OAAnB;AACD,KAFD,MAEO;AACL,WAAKD,MAAL,GAAc4B,MAAM,CAApB;AACD;AACF;;AAED;;;;;;;AAOAphC,QAAMiH,OAAN,EAAe;AACb,WAAO,IAAI24B,WAAJ,CAAgB34B,OAAhB,CAAP;AACD;;AAED;;;;;;;AAOA44B,yBAAuB;AACrB,QAAIkB,QAAQ,KAAKvB,MAAjB;;AAEA,WAAO,IAAP,EAAa;AACX,UAAIuB,UAAU,CAAV,IAAe,KAAKxB,OAAL,CAAawB,QAAQ,CAArB,MAA4B,IAA/C,EAAqD;AACnD,cAAMC,KAAK,KAAKzB,OAAL,CAAa0B,UAAb,CAAwBF,KAAxB,CAAX;;AAEA,YAAKC,MAAM,EAAN,IAAYA,MAAM,GAAnB,IAA2B;AAC1BA,cAAM,EAAN,IAAYA,MAAM,EADnB,IAC0B;AACzBA,eAAO,EAFR,IAEcA,OAAO,EAFzB,EAE6B;AAAE;AAC7B,eAAKxB,MAAL,GAAcuB,KAAd;AACA;AACD;AACF;;AAEDA,cAAQ,KAAKxB,OAAL,CAAa94B,OAAb,CAAqB,IAArB,EAA2Bs6B,KAA3B,CAAR;;AAEA,UAAIA,UAAU,CAAC,CAAf,EAAkB;AAChB,aAAKvB,MAAL,GAAc,KAAKC,OAAnB;AACA;AACD;AACDsB;AACD;AACF;AAn7BiB;;AAs7BpB;;;;;;;AAOe,SAAS1sB,KAAT,CAAehI,MAAf,EAAuB;AACpC,QAAM02B,SAAS,IAAI1D,aAAJ,EAAf;AACA,SAAO0D,OAAOzD,WAAP,CAAmBjzB,MAAnB,CAAP;AACD,C;;ACr9BD;;AAEA;;;;;;;AAOO,MAAM22B,UAAN,CAAiB;;AAEtB;;;;;;;AAOA1lC,cAAYlB,KAAZ,EAAmB6mC,IAAnB,EAAyB;AACvB,SAAK7mC,KAAL,GAAaA,KAAb;AACA,SAAK6mC,IAAL,GAAYA,IAAZ;AACD;;AAED;;;;;AAKAC,YAAU;AACR,WAAO,KAAK9mC,KAAZ;AACD;;AAED;;;;;;;;;;AAUA0kC,aAAW;AACT,UAAM,IAAIxmC,KAAJ,CAAU,mDAAV,CAAN;AACD;AAnCqB;;AAsCjB,MAAM6oC,UAAN,SAAyBH,UAAzB,CAAoC;AACzClC,aAAW;AACT,WAAO,KAAK1kC,KAAL,IAAc,KAArB;AACD;AAHwC;;AAMpC,MAAMgnC,YAAN,SAA2BJ,UAA3B,CAAsC;AAC3C1lC,cAAYlB,KAAZ,EAAmB6mC,IAAnB,EAAyB;AACvB,UAAMI,WAAWjnC,KAAX,CAAN,EAAyB6mC,IAAzB;AACD;;AAEDnC,WAASwC,GAAT,EAAc;AACZ,QAAI;AACF,YAAMC,KAAKD,IAAIE,kBAAJ,CACTnL,KAAKC,YADI,EACU,KAAK2K,IADf,CAAX;AAGA,aAAOM,GAAGlK,MAAH,CAAU,KAAKj9B,KAAf,CAAP;AACD,KALD,CAKE,OAAOkG,CAAP,EAAU;AACV;AACA,aAAO,KAAKlG,KAAZ;AACD;AACF;;AAED;;;;;;;AAOA4gC,QAAMsG,GAAN,EAAWG,KAAX,EAAkB;AAChB,QAAIA,iBAAiBL,YAArB,EAAmC;AACjC,aAAO,KAAKhnC,KAAL,KAAeqnC,MAAMrnC,KAA5B;AACD;AACD,WAAO,KAAP;AACD;AA7B0C;;AAgCtC,MAAMsnC,cAAN,SAA6BV,UAA7B,CAAwC;AAC7C1lC,cAAYlB,KAAZ,EAAmB6mC,IAAnB,EAAyB;AACvB,UAAM,IAAInhC,IAAJ,CAAS1F,KAAT,CAAN,EAAuB6mC,IAAvB;AACD;;AAEDnC,WAASwC,GAAT,EAAc;AACZ,QAAI;AACF,YAAMK,MAAML,IAAIE,kBAAJ,CACVnL,KAAKuL,cADK,EACW,KAAKX,IADhB,CAAZ;AAGA,aAAOU,IAAItK,MAAJ,CAAW,KAAKj9B,KAAhB,CAAP;AACD,KALD,CAKE,OAAOkG,CAAP,EAAU;AACV;AACA,aAAO,KAAKlG,KAAZ;AACD;AACF;AAf4C;;AAkBxC,MAAMynC,YAAN,SAA2Bb,UAA3B,CAAsC;AAC3ClC,aAAW;AACT,WAAO,KAAK1kC,KAAZ;AACD;;AAED;;;;;;;AAOA4gC,QAAMsG,GAAN,EAAWG,KAAX,EAAkB;AAChB,QAAIA,iBAAiBI,YAArB,EAAmC;AACjC,aAAO,KAAKznC,KAAL,KAAeqnC,MAAMrnC,KAA5B;AACD,KAFD,MAEO,IAAI,OAAOqnC,KAAP,KAAiB,QAArB,EAA+B;AACpC,aAAO,KAAKrnC,KAAL,KAAeqnC,KAAtB;AACD,KAFM,MAEA,IAAIA,iBAAiBL,YAArB,EAAmC;AACxC,YAAMU,KAAKR,IAAIE,kBAAJ,CACTnL,KAAK0L,WADI,EACSN,MAAMR,IADf,CAAX;AAGA,aAAO,KAAK7mC,KAAL,KAAe0nC,GAAGE,MAAH,CAAUP,MAAMrnC,KAAhB,CAAtB;AACD;AACD,WAAO,KAAP;AACD;AAxB0C,C;;ACvG7C;;;;;;;;;;;;;AAaA;;AAEe;AACb,YAAU,CAAC,CAAC6nC,GAAD,CAAD,EAAQhB,IAAR,KACR,IAAIG,YAAJ,CAAiBa,IAAIf,OAAJ,EAAjB,EAAgCgB,MAAMD,IAAIhB,IAAV,EAAgBA,IAAhB,CAAhC,CAFW;AAGb,cAAY,CAAC,CAACgB,GAAD,CAAD,EAAQhB,IAAR,KACV,IAAIS,cAAJ,CAAmBO,IAAIf,OAAJ,EAAnB,EAAkCgB,MAAMD,IAAIhB,IAAV,EAAgBA,IAAhB,CAAlC;AAJW,CAAf;;AAOA,SAASiB,KAAT,CAAeC,OAAf,EAAwBlB,IAAxB,EAA8B;AAC5B,SAAOv/B,OAAOC,MAAP,CAAc,EAAd,EAAkBwgC,OAAlB,EAA2B3/B,OAAOy+B,IAAP,CAA3B,CAAP;AACD;;AAED,SAASz+B,MAAT,CAAgBy+B,IAAhB,EAAsB;AACpB,QAAMmB,YAAY,EAAlB;AACA,OAAK,MAAM,CAACjoC,IAAD,EAAOkoC,GAAP,CAAX,IAA0B3gC,OAAOunB,OAAP,CAAegY,IAAf,CAA1B,EAAgD;AAC9CmB,cAAUjoC,IAAV,IAAkBkoC,IAAInB,OAAJ,EAAlB;AACD;AACD,SAAOkB,SAAP;AACD,C;;AChCD;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AAiDA;AAEA;;AAEA;AACA,MAAME,uBAAuB,IAA7B;;AAEA;AACA,MAAMC,MAAM,QAAZ;AACA,MAAMC,MAAM,QAAZ;;AAGA;;;;;;;;;;;;;;AAcA,SAASC,aAAT,CAAuBC,GAAvB,EAA4BC,OAA5B,EAAqC1C,GAArC,EAA0C;AACxC,MAAI0C,QAAQ1C,GAAR,CAAJ,EAAkB;AAChB,WAAO0C,QAAQ1C,GAAR,CAAP;AACD;;AAED,QAAM,EAAE1qB,MAAF,KAAamtB,GAAnB;AACAntB,SAAOjZ,IAAP,CAAY,IAAIsmC,UAAJ,CAAe,YAAf,CAAZ;AACA,SAAO,IAAIzB,UAAJ,EAAP;AACD;;AAGD;;;;;;;;;;;;AAYA,SAAS0B,gBAAT,CAA0BH,GAA1B,EAA+B,EAACvoC,IAAD,EAA/B,EAAuC;AACrC,QAAM,EAAEmnC,GAAF,EAAO/rB,MAAP,KAAkBmtB,GAAxB;AACA,QAAMz9B,UAAU9K,KAAK2iB,UAAL,CAAgB,GAAhB,IACZwkB,IAAIwB,MAAJ,CAAW5mC,GAAX,CAAe/B,IAAf,CADY,GAEZmnC,IAAIyB,SAAJ,CAAc7mC,GAAd,CAAkB/B,IAAlB,CAFJ;;AAIA,MAAI,CAAC8K,OAAL,EAAc;AACZ,UAAMvG,MAAMvE,KAAK2iB,UAAL,CAAgB,GAAhB,IACR,IAAIkmB,cAAJ,CAAoB,iBAAgB7oC,IAAK,EAAzC,CADQ,GAER,IAAI6oC,cAAJ,CAAoB,oBAAmB7oC,IAAK,EAA5C,CAFJ;AAGAob,WAAOjZ,IAAP,CAAYoC,GAAZ;AACA,WAAO,IAAIyiC,UAAJ,CAAehnC,IAAf,CAAP;AACD;;AAED,SAAO8K,OAAP;AACD;;AAED;;;;;;;;;;;;;;;;AAgBA,SAASg+B,iBAAT,CAA2BP,GAA3B,EAAgC,EAACtmC,EAAD,EAAKV,GAAL,EAAhC,EAA2C;AACzC,QAAMuJ,UAAU49B,iBAAiBH,GAAjB,EAAsBtmC,EAAtB,CAAhB;AACA,MAAI6I,mBAAmBk8B,UAAvB,EAAmC;AACjC,WAAOl8B,OAAP;AACD;;AAED,QAAM,EAAEq8B,GAAF,EAAO/rB,MAAP,KAAkBmtB,GAAxB;AACA,QAAMtW,UAAU8W,KAAKR,GAAL,EAAUhnC,GAAV,CAAhB;;AAEA,WAASynC,aAAT,CAAuBxe,IAAvB,EAA6B;AAC3B,WAAOxa,MAAMC,OAAN,CAAcua,IAAd,KACLA,KAAK,CAAL,EAAQ7tB,IAAR,KAAiB,KADZ,IAEL6tB,KAAK,CAAL,EAAQob,GAAR,KAAgB,IAFlB;AAGD;;AAED,MAAIoD,cAAcl+B,QAAQ62B,GAAtB,CAAJ,EAAgC;AAC9B;AACA,SAAK,MAAMsH,OAAX,IAAsBn+B,QAAQ62B,GAAR,CAAY,CAAZ,EAAekE,IAArC,EAA2C;AACzC,YAAMqD,aAAaH,KAAKR,GAAL,EAAUU,QAAQ1nC,GAAlB,CAAnB;AACA,UAAI0wB,QAAQ4O,KAAR,CAAcsG,GAAd,EAAmB+B,UAAnB,CAAJ,EAAoC;AAClC,eAAOD,OAAP;AACD;AACF;AACF;;AAED7tB,SAAOjZ,IAAP,CAAY,IAAI0mC,cAAJ,CAAoB,oBAAmB5W,QAAQ0S,QAAR,CAAiBwC,GAAjB,CAAsB,EAA7D,CAAZ;AACA,SAAO4B,KAAKR,GAAL,EAAUz9B,OAAV,CAAP;AACD;;AAGD;;;;;;;;;;;;;;AAcA,SAASq+B,mBAAT,CAA6BZ,GAA7B,EAAkC,EAACtmC,EAAD,EAAKjC,IAAL,EAAlC,EAA8C;AAC5C,QAAM8K,UAAU49B,iBAAiBH,GAAjB,EAAsBtmC,EAAtB,CAAhB;AACA,MAAI6I,mBAAmBk8B,UAAvB,EAAmC;AACjC,WAAOl8B,OAAP;AACD;;AAED,MAAIA,QAAQgF,KAAZ,EAAmB;AACjB;AACA,SAAK,MAAMs5B,QAAX,IAAuBt+B,QAAQgF,KAA/B,EAAsC;AACpC,UAAI9P,SAASopC,QAAb,EAAuB;AACrB,eAAOt+B,QAAQgF,KAAR,CAAc9P,IAAd,CAAP;AACD;AACF;AACF;;AAED,QAAM,EAAEob,MAAF,KAAamtB,GAAnB;AACAntB,SAAOjZ,IAAP,CAAY,IAAI0mC,cAAJ,CAAoB,sBAAqB7oC,IAAK,EAA9C,CAAZ;AACA,SAAO+oC,KAAKR,GAAL,EAAUz9B,OAAV,CAAP;AACD;;AAED;;;;;;;;;;;;;;;;AAgBA,SAASu+B,gBAAT,CAA0Bd,GAA1B,EAA+B,EAAC3C,GAAD,EAAMC,IAAN,EAAYC,GAAZ,EAA/B,EAAiD;AAC/C,MAAIF,QAAQ,IAAZ,EAAkB;AAChB,WAAO0C,cAAcC,GAAd,EAAmB1C,IAAnB,EAAyBC,GAAzB,CAAP;AACD;;AAED,QAAMC,WAAWgD,KAAKR,GAAL,EAAU3C,GAAV,CAAjB;AACA,MAAIG,oBAAoBiB,UAAxB,EAAoC;AAClC,WAAOsB,cAAcC,GAAd,EAAmB1C,IAAnB,EAAyBC,GAAzB,CAAP;AACD;;AAED;AACA,OAAK,MAAMmD,OAAX,IAAsBpD,IAAtB,EAA4B;AAC1B,UAAMtkC,MAAMwnC,KAAKR,GAAL,EAAUU,QAAQ1nC,GAAlB,CAAZ;AACA,UAAM+nC,cACJ/nC,eAAe0lC,YAAf,IAA+B1lC,eAAemmC,YADhD;;AAGA,QAAI,CAAC4B,WAAL,EAAkB;AAChB;AACD;;AAED,UAAM,EAAEnC,GAAF,KAAUoB,GAAhB;;AAEA,QAAIhnC,IAAIs/B,KAAJ,CAAUsG,GAAV,EAAepB,QAAf,CAAJ,EAA8B;AAC5B,aAAOkD,OAAP;AACD;AACF;;AAED,SAAOX,cAAcC,GAAd,EAAmB1C,IAAnB,EAAyBC,GAAzB,CAAP;AACD;;AAGD;;;;;;;;;;;;;;AAcA,SAASiD,IAAT,CAAcR,GAAd,EAAmBgB,IAAnB,EAAyB;AACvB;AACA;AACA,MAAI,OAAOA,IAAP,KAAgB,QAAhB,IAA4BA,gBAAgBvC,UAAhD,EAA4D;AAC1D,WAAOuC,IAAP;AACD;;AAED;AACA;AACA,MAAIv5B,MAAMC,OAAN,CAAcs5B,IAAd,CAAJ,EAAyB;AACvB,WAAOC,QAAQjB,GAAR,EAAagB,IAAb,CAAP;AACD;;AAGD,UAAQA,KAAK5sC,IAAb;AACE,SAAK,SAAL;AACE,aAAO,IAAI+qC,YAAJ,CAAiB6B,KAAKvpC,IAAtB,CAAP;AACF,SAAK,KAAL;AACE,aAAO,IAAIinC,YAAJ,CAAiBsC,KAAK5H,GAAtB,CAAP;AACF,SAAK,KAAL;AACE,aAAO8H,iBAAiBlB,GAAjB,EAAsBgB,IAAtB,CAAP;AACF,SAAK,KAAL;AACE,aAAOG,kBAAkBnB,GAAlB,EAAuBgB,IAAvB,CAAP;AACF,SAAK,MAAL;AACE,aAAOI,eAAepB,GAAf,EAAoBgB,IAApB,CAAP;AACF,SAAK,KAAL;AAAY;AACV,cAAMz+B,UAAU49B,iBAAiBH,GAAjB,EAAsBgB,IAAtB,CAAhB;AACA,eAAOR,KAAKR,GAAL,EAAUz9B,OAAV,CAAP;AACD;AACD,SAAK,MAAL;AAAa;AACX,cAAMsF,OAAO+4B,oBAAoBZ,GAApB,EAAyBgB,IAAzB,CAAb;AACA,eAAOR,KAAKR,GAAL,EAAUn4B,IAAV,CAAP;AACD;AACD,SAAK,KAAL;AAAY;AACV,cAAM64B,UAAUH,kBAAkBP,GAAlB,EAAuBgB,IAAvB,CAAhB;AACA,eAAOR,KAAKR,GAAL,EAAUU,OAAV,CAAP;AACD;AACD,SAAK,KAAL;AAAY;AACV,cAAMW,SAASP,iBAAiBd,GAAjB,EAAsBgB,IAAtB,CAAf;AACA,eAAOR,KAAKR,GAAL,EAAUqB,MAAV,CAAP;AACD;AACD,SAAK3wB,SAAL;AAAgB;AACd;AACA,YAAIswB,KAAK5H,GAAL,KAAa,IAAb,IAAqB4H,KAAK5H,GAAL,KAAa1oB,SAAtC,EAAiD;AAC/C,iBAAO8vB,KAAKR,GAAL,EAAUgB,KAAK5H,GAAf,CAAP;AACD;;AAED,cAAM,EAAEvmB,MAAF,KAAamtB,GAAnB;AACAntB,eAAOjZ,IAAP,CAAY,IAAIsmC,UAAJ,CAAe,UAAf,CAAZ;AACA,eAAO,IAAIzB,UAAJ,EAAP;AACD;AACD;AACE,aAAO,IAAIA,UAAJ,EAAP;AAtCJ;AAwCD;;AAED;;;;;;;;;;;;AAYA,SAASyC,gBAAT,CAA0BlB,GAA1B,EAA+B,EAACvoC,IAAD,EAA/B,EAAuC;AACrC,QAAM,EAAE6L,IAAF,EAAQuP,MAAR,KAAmBmtB,GAAzB;;AAEA,MAAI,CAAC18B,IAAD,IAAS,CAACA,KAAKg+B,cAAL,CAAoB7pC,IAApB,CAAd,EAAyC;AACvCob,WAAOjZ,IAAP,CAAY,IAAI0mC,cAAJ,CAAoB,qBAAoB7oC,IAAK,EAA7C,CAAZ;AACA,WAAO,IAAIgnC,UAAJ,CAAehnC,IAAf,CAAP;AACD;;AAED,QAAM8nC,MAAMj8B,KAAK7L,IAAL,CAAZ;;AAEA;AACA,MAAI8nC,eAAejB,UAAnB,EAA+B;AAC7B,WAAOiB,GAAP;AACD;;AAED;AACA,UAAQ,OAAOA,GAAf;AACE,SAAK,QAAL;AACE,aAAOA,GAAP;AACF,SAAK,QAAL;AACE,aAAO,IAAIb,YAAJ,CAAiBa,GAAjB,CAAP;AACF,SAAK,QAAL;AACE,UAAIA,eAAeniC,IAAnB,EAAyB;AACvB,eAAO,IAAI4hC,cAAJ,CAAmBO,GAAnB,CAAP;AACD;AACH;AACE1sB,aAAOjZ,IAAP,CACE,IAAI2nC,SAAJ,CAAe,8BAA6B9pC,IAAK,KAAI,OAAO8nC,GAAI,EAAhE,CADF;AAGA,aAAO,IAAId,UAAJ,CAAehnC,IAAf,CAAP;AAbJ;AAeD;;AAED;;;;;;;;;;;;AAYA,SAAS0pC,iBAAT,CAA2BnB,GAA3B,EAAgC,EAACvoC,IAAD,EAAhC,EAAwC;AACtC;AACA;AACA,QAAM,EAAEmnC,KAAK,EAAE4C,UAAF,EAAP,EAAuB3uB,MAAvB,KAAkCmtB,GAAxC;AACA,QAAMj0B,OAAOy1B,WAAW/pC,IAAX,KAAoBgqC,QAAQA,CAAChqC,IAAT,CAAjC;;AAEA,MAAI,CAACsU,IAAL,EAAW;AACT8G,WAAOjZ,IAAP,CAAY,IAAI0mC,cAAJ,CAAoB,qBAAoB7oC,IAAK,IAA7C,CAAZ;AACA,WAAO,IAAIgnC,UAAJ,CAAgB,GAAEhnC,IAAK,IAAvB,CAAP;AACD;;AAED,MAAI,OAAOsU,IAAP,KAAgB,UAApB,EAAgC;AAC9B8G,WAAOjZ,IAAP,CAAY,IAAI2nC,SAAJ,CAAe,YAAW9pC,IAAK,oBAA/B,CAAZ;AACA,WAAO,IAAIgnC,UAAJ,CAAgB,GAAEhnC,IAAK,IAAvB,CAAP;AACD;;AAED,SAAOsU,IAAP;AACD;;AAED;;;;;;;;;;;;;;AAcA,SAASq1B,cAAT,CAAwBpB,GAAxB,EAA6B,EAAClC,GAAD,EAAMx6B,IAAN,EAA7B,EAA0C;AACxC,QAAMo+B,SAASP,kBAAkBnB,GAAlB,EAAuBlC,GAAvB,CAAf;;AAEA,MAAI4D,kBAAkBjD,UAAtB,EAAkC;AAChC,WAAOiD,MAAP;AACD;;AAED,QAAMC,UAAU,EAAhB;AACA,QAAMC,UAAU,EAAhB;;AAEA,OAAK,MAAMrC,GAAX,IAAkBj8B,IAAlB,EAAwB;AACtB,QAAIi8B,IAAInrC,IAAJ,KAAa,MAAjB,EAAyB;AACvBwtC,cAAQrC,IAAI9nC,IAAZ,IAAoB+oC,KAAKR,GAAL,EAAUT,IAAInG,GAAd,CAApB;AACD,KAFD,MAEO;AACLuI,cAAQ/nC,IAAR,CAAa4mC,KAAKR,GAAL,EAAUT,GAAV,CAAb;AACD;AACF;;AAED,MAAI;AACF,WAAOmC,OAAOC,OAAP,EAAgBC,OAAhB,CAAP;AACD,GAFD,CAEE,OAAOhkC,CAAP,EAAU;AACV;AACA,WAAO,IAAI6gC,UAAJ,EAAP;AACD;AACF;;AAED;;;;;;;;;;AAUA,SAASwC,OAAT,CAAiBjB,GAAjB,EAAsB6B,GAAtB,EAA2B;AACzB,QAAM,EAAEjD,GAAF,EAAOkD,KAAP,EAAcjvB,MAAd,KAAyBmtB,GAA/B;;AAEA,MAAI8B,MAAMC,GAAN,CAAUF,GAAV,CAAJ,EAAoB;AAClBhvB,WAAOjZ,IAAP,CAAY,IAAIsmC,UAAJ,CAAe,kBAAf,CAAZ;AACA,WAAO,IAAIzB,UAAJ,EAAP;AACD;;AAED;AACAqD,QAAMn9B,GAAN,CAAUk9B,GAAV;AACA,QAAMjmC,SAAS,EAAf;;AAEA;AACA;AACA,QAAMomC,eAAepD,IAAIqD,aAAJ,IAAqBJ,IAAIj6B,MAAJ,GAAa,CAAvD;;AAEA,OAAK,MAAMs6B,IAAX,IAAmBL,GAAnB,EAAwB;AACtB,QAAI,OAAOK,IAAP,KAAgB,QAApB,EAA8B;AAC5BtmC,aAAOhC,IAAP,CAAYsoC,IAAZ;AACA;AACD;;AAED,UAAMC,OAAO3B,KAAKR,GAAL,EAAUkC,IAAV,EAAgB9F,QAAhB,CAAyBwC,GAAzB,CAAb;;AAEA,QAAIoD,YAAJ,EAAkB;AAChBpmC,aAAOhC,IAAP,CAAYimC,GAAZ;AACD;;AAED,QAAIsC,KAAKv6B,MAAL,GAAcg4B,oBAAlB,EAAwC;AACtC/sB,aAAOjZ,IAAP,CACE,IAAIsmC,UAAJ,CACE,sCACC,IAAGiC,KAAKv6B,MAAO,oBAAmBg4B,oBAAqB,GAF1D,CADF;AAMAhkC,aAAOhC,IAAP,CAAYuoC,KAAKrgC,KAAL,CAAW89B,oBAAX,CAAZ;AACD,KARD,MAQO;AACLhkC,aAAOhC,IAAP,CAAYuoC,IAAZ;AACD;;AAED,QAAIH,YAAJ,EAAkB;AAChBpmC,aAAOhC,IAAP,CAAYkmC,GAAZ;AACD;AACF;;AAEDgC,QAAM1oC,MAAN,CAAayoC,GAAb;AACA,SAAOjmC,OAAO8Q,IAAP,CAAY,EAAZ,CAAP;AACD;;AAED;;;;;;;;;;;;;;;AAee,SAASvS,OAAT,CAAiBykC,GAAjB,EAAsBt7B,IAAtB,EAA4Bf,OAA5B,EAAqCsQ,SAAS,EAA9C,EAAkD;AAC/D,QAAMmtB,MAAM;AACVpB,OADU,EACLt7B,IADK,EACCuP,MADD,EACSivB,OAAO,IAAIM,OAAJ;AADhB,GAAZ;AAGA,SAAO5B,KAAKR,GAAL,EAAUz9B,OAAV,EAAmB65B,QAAnB,CAA4BwC,GAA5B,CAAP;AACD,C;;AC3fD;AACA;;AAEA;;;;;;;;;;;;;AAaO,MAAMt3B,sBAAN,CAAqB;;AAE1B;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AA+BA1O,cAAYypC,OAAZ,EAAqB,EAAEC,YAAY,EAAd,EAAkBN,eAAe,IAAjC,KAA0C,EAA/D,EAAmE;AACjE,SAAKK,OAAL,GAAe56B,MAAMC,OAAN,CAAc26B,OAAd,IAAyBA,OAAzB,GAAmC,CAACA,OAAD,CAAlD;;AAEA,SAAKjC,MAAL,GAAc,IAAIznC,GAAJ,EAAd;AACA,SAAK0nC,SAAL,GAAiB,IAAI1nC,GAAJ,EAAjB;AACA,SAAK6oC,UAAL,GAAkBc,SAAlB;AACA,SAAKL,aAAL,GAAqBD,YAArB;AACA,SAAKO,MAAL,GAAc,IAAIC,OAAJ,EAAd;AACD;;AAED;;;;;AAKA,MAAIrzB,QAAJ,GAAe;AACb,WAAO,KAAKkxB,SAAL,CAAeoC,OAAOC,QAAtB,GAAP;AACD;;AAED;;;;;;AAMAC,aAAWjpC,EAAX,EAAe;AACb,WAAO,KAAK2mC,SAAL,CAAe0B,GAAf,CAAmBroC,EAAnB,CAAP;AACD;;AAED;;;;;;;;;AASA6hC,aAAW7hC,EAAX,EAAe;AACb,WAAO,KAAK2mC,SAAL,CAAe7mC,GAAf,CAAmBE,EAAnB,CAAP;AACD;;AAED;;;;;;;;;;;;;;;;;;AAkBAqO,cAAYlQ,MAAZ,EAAoB;AAClB,UAAM,CAAC0uB,OAAD,EAAU1T,MAAV,IAAoBlD,KAAKA,CAAC9X,MAAN,CAA1B;AACA,SAAK,MAAM6B,EAAX,IAAiB6sB,OAAjB,EAA0B;AACxB,UAAI7sB,GAAG0gB,UAAH,CAAc,GAAd,CAAJ,EAAwB;AACtB;AACA;AACA,YAAI,KAAKgmB,MAAL,CAAY2B,GAAZ,CAAgBroC,EAAhB,CAAJ,EAAyB;AACvBmZ,iBAAOjZ,IAAP,CAAa,0CAAyCF,EAAG,GAAzD;AACA;AACD;AACD,aAAK0mC,MAAL,CAAYrnC,GAAZ,CAAgBW,EAAhB,EAAoB6sB,QAAQ7sB,EAAR,CAApB;AACD,OARD,MAQO;AACL,YAAI,KAAK2mC,SAAL,CAAe0B,GAAf,CAAmBroC,EAAnB,CAAJ,EAA4B;AAC1BmZ,iBAAOjZ,IAAP,CAAa,6CAA4CF,EAAG,GAA5D;AACA;AACD;AACD,aAAK2mC,SAAL,CAAetnC,GAAf,CAAmBW,EAAnB,EAAuB6sB,QAAQ7sB,EAAR,CAAvB;AACD;AACF;;AAED,WAAOmZ,MAAP;AACD;;AAED;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AA8BA8hB,SAAOpyB,OAAP,EAAgBe,IAAhB,EAAsBuP,MAAtB,EAA8B;AAC5B;AACA,QAAI,OAAOtQ,OAAP,KAAmB,QAAvB,EAAiC;AAC/B,aAAOA,OAAP;AACD;;AAED;AACA,QAAI,OAAOA,QAAQ62B,GAAf,KAAuB,QAA3B,EAAqC;AACnC,aAAO72B,QAAQ62B,GAAf;AACD;;AAED;AACA,QAAI72B,QAAQ62B,GAAR,KAAgB1oB,SAApB,EAA+B;AAC7B,aAAO,IAAP;AACD;;AAED,WAAOvW,OAAOA,CAAC,IAAR,EAAcmJ,IAAd,EAAoBf,OAApB,EAA6BsQ,MAA7B,CAAP;AACD;;AAEDisB,qBAAmB8D,IAAnB,EAAyBrE,IAAzB,EAA+B;AAC7B,UAAMsE,QAAQ,KAAKN,MAAL,CAAY/oC,GAAZ,CAAgBopC,IAAhB,KAAyB,EAAvC;AACA,UAAMlpC,KAAKsN,KAAKC,SAAL,CAAes3B,IAAf,CAAX;;AAEA,QAAI,CAACsE,MAAMnpC,EAAN,CAAL,EAAgB;AACdmpC,YAAMnpC,EAAN,IAAY,IAAIkpC,IAAJ,CAAS,KAAKP,OAAd,EAAuB9D,IAAvB,CAAZ;AACA,WAAKgE,MAAL,CAAYxpC,GAAZ,CAAgB6pC,IAAhB,EAAsBC,KAAtB;AACD;;AAED,WAAOA,MAAMnpC,EAAN,CAAP;AACD;AA/KyB,C;;;;AChB5B;;;;;;AAMe,MAAMopC,cAAN,CAAqB;AAClC;;;;;;AAMAlqC,cAAYmqC,QAAZ,EAAsB;AACpB,QAAIN,OAAOO,aAAP,IAAwBhkC,OAAO+jC,QAAP,CAA5B,EAA8C;AAC5C,WAAKL,QAAL,GAAgBK,SAASN,OAAOO,aAAhB,GAAhB;AACD,KAFD,MAEO,IAAIP,OAAOC,QAAP,IAAmB1jC,OAAO+jC,QAAP,CAAvB,EAAyC;AAC9C,WAAKL,QAAL,GAAgBK,SAASN,OAAOC,QAAhB,GAAhB;AACD,KAFM,MAEA;AACL,YAAM,IAAInB,SAAJ,CAAc,iDAAd,CAAN;AACD;;AAED,SAAK0B,IAAL,GAAY,EAAZ;AACD;;AAED,GAACR,OAAOC,QAAR,IAAoB;AAClB,UAAM,EAAEO,IAAF,EAAQP,QAAR,KAAqB,IAA3B;AACA,QAAIQ,MAAM,CAAV;;AAEA,WAAO;AACLn9B,aAAO;AACL,YAAIk9B,KAAKr7B,MAAL,IAAes7B,GAAnB,EAAwB;AACtBD,eAAKrpC,IAAL,CAAU8oC,SAAS38B,IAAT,EAAV;AACD;AACD,eAAOk9B,KAAKC,KAAL,CAAP;AACD;AANI,KAAP;AAQD;;AAED,GAACT,OAAOO,aAAR,IAAyB;AACvB,UAAM,EAAEC,IAAF,EAAQP,QAAR,KAAqB,IAA3B;AACA,QAAIQ,MAAM,CAAV;;AAEA,WAAO;AACCn9B,UAAN,GAAa;AAAA;AACX,cAAIk9B,KAAKr7B,MAAL,IAAes7B,GAAnB,EAAwB;AACtBD,iBAAKrpC,IAAL,EAAU,MAAM8oC,SAAS38B,IAAT,EAAhB;AACD;AACD,iBAAOk9B,KAAKC,KAAL,CAAP;AAJW;AAKZ;AANI,KAAP;AAQD;;AAED;;;;AAIAC,cAAY;AACV,UAAM,EAAEF,IAAF,EAAQP,QAAR,KAAqB,IAA3B;AACA,QAAIO,KAAKr7B,MAAL,KAAgB,CAAhB,IAAqBq7B,KAAKA,KAAKr7B,MAAL,GAAc,CAAnB,EAAsBw7B,IAAtB,KAA+B,KAAxD,EAA+D;AAC7DH,WAAKrpC,IAAL,CAAU8oC,SAAS38B,IAAT,EAAV;AACD;AACF;AAxDiC,C;;;;;;ACNpC;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AA0CA;;;;;;;;AAQO,SAASs9B,cAAT,CAAwBN,QAAxB,EAAkCO,GAAlC,EAAuC;AAC5C,MAAI,CAAC77B,MAAMC,OAAN,CAAc47B,GAAd,CAAL,EAAyB;AACvB,WAAOC,gBAAgBR,QAAhB,EAA0BO,GAA1B,CAAP;AACD;;AAED,SAAOA,IAAIj6B,GAAJ,CACL3P,MAAM6pC,gBAAgBR,QAAhB,EAA0BrpC,EAA1B,CADD,CAAP;AAGD;;AAED;;;AAGA,SAAS6pC,eAAT,CAAyBR,QAAzB,EAAmCrpC,EAAnC,EAAuC;AACrC,OAAK,MAAMgW,OAAX,IAAsBqzB,QAAtB,EAAgC;AAC9B,QAAIrzB,QAAQizB,UAAR,CAAmBjpC,EAAnB,CAAJ,EAA4B;AAC1B,aAAOgW,OAAP;AACD;AACF;;AAED,SAAO,IAAP;AACD;;AAED;;;;;;;;AAQO;AAAP,uCAAO,WAA+BqzB,QAA/B,EAAyCO,GAAzC,EAA8C;AACnD,QAAI,CAAC77B,MAAMC,OAAN,CAAc47B,GAAd,CAAL,EAAyB;AAAA;AAAA;AAAA;;AAAA;AACvB,4CAA4BP,QAA5B,oLAAsC;AAAA,gBAArBrzB,OAAqB;;AACpC,cAAIA,QAAQizB,UAAR,CAAmBW,GAAnB,CAAJ,EAA6B;AAC3B,mBAAO5zB,OAAP;AACD;AACF;AALsB;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAMxB;;AAED,QAAI8zB,iBAAiBF,IAAI17B,MAAzB;AACA,UAAM67B,gBAAgB,IAAIh8B,KAAJ,CAAU+7B,cAAV,EAA0BE,IAA1B,CAA+B,IAA/B,CAAtB;;AAVmD;AAAA;AAAA;;AAAA;AAYnD,2CAA4BX,QAA5B,8LAAsC;AAAA,cAArBrzB,OAAqB;;AACpC;AACA;AACA,aAAK,IAAI0M,QAAQ,CAAjB,EAAoBA,QAAQknB,IAAI17B,MAAhC,EAAwCwU,OAAxC,EAAiD;AAC/C,gBAAM1iB,KAAK4pC,IAAIlnB,KAAJ,CAAX;AACA,cAAI,CAACqnB,cAAcrnB,KAAd,CAAD,IAAyB1M,QAAQizB,UAAR,CAAmBjpC,EAAnB,CAA7B,EAAqD;AACnD+pC,0BAAcrnB,KAAd,IAAuB1M,OAAvB;AACA8zB;AACD;;AAED;AACA,cAAIA,mBAAmB,CAAvB,EAA0B;AACxB,mBAAOC,aAAP;AACD;AACF;AACF;AA3BkD;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;;AA6BnD,WAAOA,aAAP;AACD,GA9BD;;AAAA,kBAAsBE,eAAtB;AAAA;AAAA;AAAA,K;;ACjFA,SAASC,QAAT,CAAkBC,IAAlB,EAAwB;AACtB,SAAO,CAAC,QAAQ5O,IAAR,CAAa4O,IAAb,CAAR;AACD;;AAED,SAASC,WAAT,CAAqBD,IAArB,EAA2B;AACzB,QAAM,CAACE,MAAD,IAAWF,KAAKvL,KAAL,CAAW,MAAX,CAAjB;AACA,SAAOyL,OAAOn8B,MAAd;AACD;;AAED;;;;;;;AAOO,SAASo8B,GAAT,CAAan3B,OAAb,EAAsB;AAC3B,QAAM,CAACo3B,IAAD,IAASp3B,OAAf;AACA,QAAMq3B,QAAQD,KAAKnpB,KAAL,CAAW,IAAX,EAAiBtO,MAAjB,CAAwBo3B,QAAxB,CAAd;AACA,QAAMO,UAAUD,MAAM76B,GAAN,CAAUy6B,WAAV,CAAhB;AACA,QAAMM,SAASC,KAAKC,GAAL,CAAS,GAAGH,OAAZ,CAAf;AACA,QAAMJ,SAAS,IAAIQ,MAAJ,CAAY,QAAOH,MAAO,GAA1B,CAAf;;AAEA,SAAOF,MAAM76B,GAAN,CACLw6B,QAAQA,KAAKW,OAAL,CAAaT,MAAb,EAAqB,EAArB,CADH,EAELr3B,IAFK,CAEA,IAFA,CAAP;AAGD,C;;AC1BD;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;;;;;;;;;AASA;;AAEA;AACA;;AAMA;AACA;;;;;;;;;;;;;;;;;;;;;ACnBA;;AAEA;;;;;;;;;;;;;;;AAee,MAAM+3B,8BAAN,CAAwB;AACrC7rC,cAAYuW,QAAZ,EAAsB;AACpB,SAAKu1B,QAAL,GAAgB,IAAI5B,qBAAJ,CAAmB3zB,QAAnB,CAAhB;AACA,SAAKw1B,IAAL,GAAY,IAAIC,GAAJ,EAAZ;AACD;;AAED;;;AAGAllC,YAAUmlC,IAAV,EAAgB;AACd,SAAKF,IAAL,CAAUhgC,GAAV,CAAckgC,IAAd;AACD;;AAED;;;AAGAC,cAAYD,IAAZ,EAAkB;AAChB,SAAKF,IAAL,CAAUvrC,MAAV,CAAiByrC,IAAjB;AACD;;AAED;;;AAGAE,cAAY51B,QAAZ,EAAsB;AACpB,SAAKu1B,QAAL,GAAgB,IAAI5B,qBAAJ,CAAmB3zB,QAAnB,CAAhB;;AAEA;AACA,SAAKw1B,IAAL,CAAU9uC,OAAV,CAAkBgvC,QAAQA,KAAKG,UAAL,EAA1B;AACD;;AAEDC,oBAAkBvrC,EAAlB,EAAsB;AACpB,WAAO2pC,6BAAcA,CAAC,KAAKqB,QAApB,EAA8BhrC,EAA9B,CAAP;AACD;;AAEDwrC,iBAAeC,GAAf,EAAoB3mC,GAApB,EAAyB8E,IAAzB,EAA+B;AAC7B,UAAM5L,QAAQytC,IAAIxQ,MAAJ,CAAWn2B,GAAX,EAAgB8E,IAAhB,CAAd;;AAEA,QAAI9E,IAAI+I,KAAR,EAAe;AACb,UAAIA,QAAQ,EAAZ;AACA,WAAK,MAAM9P,IAAX,IAAmBuH,OAAOE,IAAP,CAAYV,IAAI+I,KAAhB,CAAnB,EAA2C;AACzCA,cAAM9P,IAAN,IAAc0tC,IAAIxQ,MAAJ,CAAWn2B,IAAI+I,KAAJ,CAAU9P,IAAV,CAAX,EAA4B6L,IAA5B,CAAd;AACD;AACF;;AAED,WAAO,EAAE5L,KAAF,EAAS6P,KAAT,EAAP;AACD;;AAED;;;AAGAi1B,YAAU9iC,EAAV,EAAc4J,IAAd,EAAoB8hC,QAApB,EAA8B;AAC5B,UAAMD,MAAM,KAAKF,iBAAL,CAAuBvrC,EAAvB,CAAZ;;AAEA,QAAIyrC,QAAQ,IAAZ,EAAkB;AAChB,aAAOC,YAAY1rC,EAAnB;AACD;;AAED,UAAM8E,MAAM2mC,IAAI5J,UAAJ,CAAe7hC,EAAf,CAAZ;AACA,WAAOyrC,IAAIxQ,MAAJ,CAAWn2B,GAAX,EAAgB8E,IAAhB,CAAP;AACD;AA3DoC;;AA8DhC,SAAS+hC,mBAAT,CAA6B1iC,KAA7B,EAAoC2iC,QAApC,EAA8C;AACnD,QAAMC,OAAO5iC,MAAM2iC,QAAN,CAAb;;AAEA,MAAIC,gBAAgBd,8BAApB,EAAuC;AACrC,WAAO,IAAP;AACD;;AAED,SAAO,IAAI7uC,KAAJ,CACJ,OAAM0vC,QAAS,0DADX,CAAP;AAGD,C;;ACzFD;AACA;;AAEA;;AAEA;;;;;;;;;;;;;;;;;;AAkBe,MAAME,6BAAN,SAAmClhB,4BAAnC,CAA6C;AAC1D1rB,cAAY+J,KAAZ,EAAmB;AACjB,UAAMA,KAAN;AACA,UAAM,EAAEwM,QAAF,KAAexM,KAArB;;AAEA,QAAIwM,aAAauB,SAAjB,EAA4B;AAC1B,YAAM,IAAI9a,KAAJ,CAAU,sDAAV,CAAN;AACD;;AAED,QAAI,CAACuZ,SAASszB,OAAOC,QAAhB,CAAL,EAAgC;AAC9B,YAAM,IAAI9sC,KAAJ,CAAU,wCAAV,CAAN;AACD;;AAED,SAAK6vC,IAAL,GAAY,IAAIhB,8BAAJ,CAAsBt1B,QAAtB,CAAZ;AACD;;AAEDu2B,oBAAkB;AAChB,WAAO;AACLD,YAAM,KAAKA;AADN,KAAP;AAGD;;AAED5Z,4BAA0B9lB,IAA1B,EAAgC;AAC9B,UAAM,EAAEoJ,QAAF,KAAepJ,IAArB;;AAEA,QAAIoJ,aAAa,KAAKxM,KAAL,CAAWwM,QAA5B,EAAsC;AACpC,WAAKs2B,IAAL,CAAUV,WAAV,CAAsB51B,QAAtB;AACD;AACF;;AAEDrK,WAAS;AACP,WAAO6gC,2BAAQA,CAACC,IAAT,CAAc,KAAKjjC,KAAL,CAAW+F,QAAzB,CAAP;AACD;AAhCyD;;AAmC5D88B,6BAAoBA,CAACK,iBAArB,GAAyC;AACvCJ,QAAMJ,mBAAmBA;AADc,CAAzC;;AAIAG,6BAAoBA,CAACM,SAArB,GAAiC;AAC/Bp9B,YAAUq9B,4BAASA,CAACC,OAAV,CAAkBC,UADG;AAE/B92B,YAAU+2B;AAFqB,CAAjC;;AAKA,SAASA,UAAT,CAAoBvjC,KAApB,EAA2B2iC,QAA3B,EAAqCa,aAArC,EAAoD;AAClD,QAAMZ,OAAO5iC,MAAM2iC,QAAN,CAAb;;AAEA,MAAI7C,OAAOC,QAAP,IAAmB1jC,OAAOumC,IAAP,CAAvB,EAAqC;AACnC,WAAO,IAAP;AACD;;AAED,SAAO,IAAI3vC,KAAJ,CACJ,OAAM0vC,QAAS,qBAAoBa,aAAc,uBAD7C,CAAP;AAGD,C;;AC7ED;;AAEA;;AAEe,SAASC,gBAAT,CAA0BC,KAA1B,EAAiC;AAC9C,QAAMC,gBAAN,SAA+BhiB,4BAA/B,CAAyC;AACvCtgB,wBAAoB;AAClB,YAAM,EAAEyhC,IAAF,KAAW,KAAK/1B,OAAtB;;AAEA,UAAI+1B,IAAJ,EAAU;AACRA,aAAK/lC,SAAL,CAAe,IAAf;AACD;AACF;;AAEDuE,2BAAuB;AACrB,YAAM,EAAEwhC,IAAF,KAAW,KAAK/1B,OAAtB;;AAEA,UAAI+1B,IAAJ,EAAU;AACRA,aAAKX,WAAL,CAAiB,IAAjB;AACD;AACF;;AAED;;;AAGAE,iBAAa;AACX;AACA;AACA,WAAKuB,WAAL;AACD;;AAED;;;AAGA/J,cAAU9iC,EAAV,EAAc4J,IAAd,EAAoB8hC,QAApB,EAA8B;AAC5B,YAAM,EAAEK,IAAF,KAAW,KAAK/1B,OAAtB;;AAEA,UAAI,CAAC+1B,IAAL,EAAW;AACT,eAAOL,YAAY1rC,EAAnB;AACD;;AAED,aAAO+rC,KAAKjJ,SAAL,CAAe9iC,EAAf,EAAmB4J,IAAnB,EAAyB8hC,QAAzB,CAAP;AACD;;AAEDtgC,aAAS;AACP,aAAOzG,wCAAaA,CAClBgoC,KADK,EAELrnC,OAAOC,MAAP;AACE;AACA,QAAEu9B,WAAW,CAAC,GAAGl5B,IAAJ,KAAa,KAAKk5B,SAAL,CAAe,GAAGl5B,IAAlB,CAA1B,EAFF,EAGE,KAAKX,KAHP,CAFK,CAAP;AAQD;AAhDsC;;AAmDzC2jC,mBAAiBE,WAAjB,GAAgC,oBAAmBA,YAAYH,KAAZ,CAAmB,GAAtE;;AAEAC,mBAAiBG,YAAjB,GAAgC;AAC9BhB,UAAMJ,mBAAmBA;AADK,GAAhC;;AAIA,SAAOiB,gBAAP;AACD;;AAED,SAASE,WAAT,CAAqBE,SAArB,EAAgC;AAC9B,SAAOA,UAAUF,WAAV,IAAyBE,UAAUjvC,IAAnC,IAA2C,WAAlD;AACD,C;;ACnED;;AAEA,MAAMkvC,WAAWjyC,SAAS2J,aAAT,CAAuB,UAAvB,CAAjB;;AAEO,SAASuoC,WAAT,CAAqBzgB,GAArB,EAA0B;AAC/BwgB,WAAS3oC,SAAT,GAAqBmoB,GAArB;AACA,SAAOwgB,SAASpjC,OAAhB;AACD,C;;ACPD;;;;;;;AAOA;AACA;;AAEA,IAAIsjC,mBAAmB;AACrBC,QAAM,IADe;AAErBC,QAAM,IAFe;AAGrBpW,MAAI,IAHiB;AAIrBqW,OAAK,IAJgB;AAKrBC,SAAO,IALc;AAMrBC,MAAI,IANiB;AAOrBC,OAAK,IAPgB;AAQrB9wB,SAAO,IARc;AASrB+wB,UAAQ,IATa;AAUrBtvB,QAAM,IAVe;AAWrBriB,QAAM,IAXe;AAYrBwZ,SAAO,IAZc;AAarBpX,UAAQ,IAba;AAcrBwvC,SAAO,IAdc;AAerBC,OAAK;AACL;AAhBqB,CAAvB;;AAmBeT,4EAAf,E;;AC7BA;;;;;;;AAOA;;AAEA;AACA;;AAEA,IAAIU;AACFC,YAAU;AADR,GAECX,uBAFD,CAAJ;;AAKeU,0EAAf,E;;ACjBA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA,MAAME,WAAW,WAAjB;;AAEA;;;AAGA,SAASC,WAAT,CAAqB/kC,KAArB,EAA4B;AAC1B,QAAMW,OAAO,EAAb;AACA,QAAMqkC,QAAQ,EAAd;;AAEA,OAAK,MAAM,CAACC,QAAD,EAAWC,OAAX,CAAX,IAAkC7oC,OAAOunB,OAAP,CAAe5jB,KAAf,CAAlC,EAAyD;AACvD,QAAIilC,SAASxtB,UAAT,CAAoB,GAApB,CAAJ,EAA8B;AAC5B,YAAM3iB,OAAOmwC,SAASzP,MAAT,CAAgB,CAAhB,CAAb;AACA70B,WAAK7L,IAAL,IAAaowC,OAAb;AACD,KAHD,MAGO,IAAIC,yCAAcA,CAACD,OAAf,CAAJ,EAA6B;AAClC;AACA;AACA,YAAMpwC,OAAOmwC,SAASG,WAAT,EAAb;AACAJ,YAAMlwC,IAAN,IAAcowC,OAAd;AACD;AACF;;AAED,SAAO,CAACvkC,IAAD,EAAOqkC,KAAP,CAAP;AACD;;AAED;;;;;;;;;;;;;;;;;;;;;;AAsBe,MAAMK,mBAAN,SAAwB1jB,4BAAxB,CAAkC;AAC/CtgB,sBAAoB;AAClB,UAAM,EAAEyhC,IAAF,KAAW,KAAK/1B,OAAtB;;AAEA,QAAI+1B,IAAJ,EAAU;AACRA,WAAK/lC,SAAL,CAAe,IAAf;AACD;AACF;;AAEDuE,yBAAuB;AACrB,UAAM,EAAEwhC,IAAF,KAAW,KAAK/1B,OAAtB;;AAEA,QAAI+1B,IAAJ,EAAU;AACRA,WAAKX,WAAL,CAAiB,IAAjB;AACD;AACF;;AAED;;;AAGAE,eAAa;AACX;AACA;AACA,SAAKuB,WAAL;AACD;;AAEDzhC,WAAS;AACP,UAAM,EAAE2gC,IAAF,KAAW,KAAK/1B,OAAtB;AACA,UAAM,EAAEhW,EAAF,EAAM6N,KAAN,EAAamB,QAAb,KAA0B,KAAK/F,KAArC;AACA,UAAMu/B,OAAOyD,2BAAQA,CAACC,IAAT,CAAcl9B,QAAd,CAAb;;AAEA,QAAI,CAAC+8B,IAAL,EAAW;AACT;AACA,aAAOvD,IAAP;AACD;;AAED,UAAMiD,MAAMM,KAAKR,iBAAL,CAAuBvrC,EAAvB,CAAZ;;AAEA,QAAIyrC,QAAQ,IAAZ,EAAkB;AAChB;AACA,aAAOjD,IAAP;AACD;;AAED,UAAM1jC,MAAM2mC,IAAI5J,UAAJ,CAAe7hC,EAAf,CAAZ;AACA,UAAM,CAAC4J,IAAD,EAAOqkC,KAAP,IAAgBD,YAAY,KAAK/kC,KAAjB,CAAtB;AACA,UAAM;AACJjL,aAAOuwC,YADH;AAEJ1gC,aAAO2gC;AAFH,QAGFzC,KAAKP,cAAL,CAAoBC,GAApB,EAAyB3mC,GAAzB,EAA8B8E,IAA9B,CAHJ;;AAKA;AACA;AACA;AACA,QAAIiE,SAAS2gC,YAAb,EAA2B;AACzB,UAAIC,iBAAiB,EAArB;;AAEA,WAAK,MAAM,CAAC1wC,IAAD,EAAOC,KAAP,CAAX,IAA4BsH,OAAOunB,OAAP,CAAe2hB,YAAf,CAA5B,EAA0D;AACxD,YAAI3gC,MAAM9P,IAAN,CAAJ,EAAiB;AACf0wC,yBAAe1wC,IAAf,IAAuBC,KAAvB;AACD;AACF;AACF;;AAED;AACA;AACA;AACA;AACA,QAAIwqC,KAAK9tC,IAAL,IAAag0C,sBAAjB,EAAgC;AAC9B,aAAOC,uCAAYA,CAACnG,IAAb,EAAmBiG,cAAnB,CAAP;AACD;;AAED;AACA;AACA;AACA,QAAIF,iBAAiB,IAArB,EAA2B;AACzB,aAAOI,uCAAYA,CAACnG,IAAb,EAAmBiG,cAAnB,CAAP;AACD;;AAED;AACA;AACA,QAAI,CAACV,SAASxS,IAAT,CAAcgT,YAAd,CAAL,EAAkC;AAChC,aAAOI,uCAAYA,CAACnG,IAAb,EAAmBiG,cAAnB,EAAmCF,YAAnC,CAAP;AACD;;AAED;AACA;AACA,UAAMK,mBAAmB7gC,MAAM/R,IAAN,CAAWkxC,WAAWA,CAACqB,YAAZ,EAA0BM,UAArC,CAAzB;AACA,UAAMC,qBAAqBF,iBAAiBj/B,GAAjB,CAAqBo/B,aAAa;AAC3D,UAAIA,UAAUC,QAAV,KAAuBD,UAAUE,SAArC,EAAgD;AAC9C,eAAOF,UAAUG,WAAjB;AACD;;AAED;AACA,UAAI,CAACjB,MAAMrG,cAAN,CAAqBmH,UAAUI,SAA/B,CAAL,EAAgD;AAC9C,eAAOJ,UAAUG,WAAjB;AACD;;AAED,YAAME,cAAcnB,MAAMc,UAAUI,SAAhB,CAApB;;AAEA;AACA;AACA;AACA;AACA,UAAIC,YAAY10C,IAAZ,IAAoBg0C,sBAAxB,EAAuC;AACrC,eAAOU,WAAP;AACD;;AAED;AACA;AACA;AACA;AACA,aAAOT,uCAAYA,CAACS,WAAb,EAA0B,IAA1B,EAAgCL,UAAUG,WAA1C,CAAP;AACD,KAzB0B,CAA3B;;AA2BA,WAAOP,uCAAYA,CAACnG,IAAb,EAAmBiG,cAAnB,EAAmC,GAAGK,kBAAtC,CAAP;AACD;AAnH8C;;AAsHjDR,mBAASA,CAACvB,YAAV,GAAyB;AACvBhB,QAAMJ,mBAAmBA;AADF,CAAzB;;AAIA2C,mBAASA,CAAClC,SAAV,GAAsB;AACpBp9B,YAAUq9B,4BAASA,CAACC,OAAV,CAAkBC;AADR,CAAtB,C;;ACjLA;AAAA;AAAA;AAAA;AAAA;AAAA;;;;;;;;;;;;;;;;;;;AAmBA;AACA;AACA;;;;;;;;;;;;;ACrBc,MAAM8C,MAAN,CAAa;AACzBnwC,cAAYowC,SAAZ,EAAuB;AACrB,SAAKA,SAAL,GAAiBA,aAAa,KAAKC,gBAAnC;AACD;;AAEDA,mBAAiBC,IAAjB,EAAuB;AACrB,WAAOA,IAAP;AACD;;AAED;;;;;;AAMAC,QAAM,GAAGC,MAAT,EAAiB;AACf,UAAMC,aAAa,IAAIzE,GAAJ,EAAnB;AACA,UAAMhpC,SAAS,EAAf;AACA,SAAK,MAAMkE,MAAX,IAAqBspC,MAArB,EAA6B;AAC3B,YAAME,WAAW,IAAI3wC,GAAJ,EAAjB;AACA,WAAK,MAAMjB,KAAX,IAAoBoI,MAApB,EAA4B;AAC1B,cAAM9G,MAAM,KAAKgwC,SAAL,CAAetxC,KAAf,CAAZ;AACA,YAAI,CAAC2xC,WAAWtH,GAAX,CAAe/oC,GAAf,CAAD,IAAwB,CAACswC,SAASvH,GAAT,CAAa/oC,GAAb,CAA7B,EAAgD;AAC9CswC,mBAASvwC,GAAT,CAAaC,GAAb,EAAkBtB,KAAlB;AACD;AACF;AACDkE,aAAOhC,IAAP,CAAY0vC,QAAZ;AACAA,eAASzzC,OAAT,CAAiB,CAAC6B,KAAD,EAAQsB,GAAR,KAAgBqwC,WAAW1kC,GAAX,CAAe3L,GAAf,CAAjC;AACD;AACD,WAAO4C,OAAOyN,GAAP,CAAWkgC,KAAK9hC,MAAM/R,IAAN,CAAW6zC,EAAEzpC,MAAF,EAAX,CAAhB,CAAP;AACD;AA9BwB,C;;ACA3B;AAAA;AAAA;AAAA;AAAA;AAAA;;;AAGa;;;;AAKb,MAAM0pC,yBAAyB,CAA/B;AACA,MAAM7gB,8BAA8B,CAApC;;;AAEA,MAAM8gB,SAAS,IAAIV,MAAJ,CAAW7tB,QAAQA,QAAQA,KAAKhZ,GAAhC,CAAf;;AAEA,MAAMwnC,gBAAgB;AACpB98B,OAAK;AACH;AACAtN,iBAAa;AAFV,GADe;AAKpBS,YAAU;AACRT,iBAAa,KADL;AAERU,yBAAqB;AAFb,GALU;AASpBE,YAAU,EAACZ,aAAa,KAAd,EATU;AAUpBspB,YAAU;AACR;AACAtpB,iBAAa,KAFL;AAGR;AACAqY,UAAM,EAJE;AAKR;AACAsR,cAAU,IANF;AAOR;AACAC,6BAAyB,KARjB;AASR;AACAZ,qBAAiB;AAVT,GAVU;AAsBpBzoB,SAAO;AACLP,iBAAa,KADR;AAELQ,YAAQ;AAFH,GAtBa;AA0BpBiU,UAAQ;AACNJ,aAAS,KADH;AAEN9c,UAAM;AAFA,GA1BY;AA8BpB6W,YAAU,EA9BU;AA+BpB+K,UAAQ;AACNa,oBAAgB,IADV;AAEND,eAAW,EAFL;AAGNH,oBAAgB;AAHV;AA/BY,CAAtB;;;AAsCA,SAAStM,GAAT,CAAa/G,YAAY6jC,cAAc98B,GAAvC,EAA4CrX,MAA5C,EAAoD;AAClD,UAAQA,OAAOnB,IAAf;AACE,SAAKC,sBAAEA,CAACiS,IAAR;AACE,aAAOtH,OAAOC,MAAP,CAAc,EAAd,EAAkB4G,SAAlB,EAA6BtQ,OAAOsB,IAAP,IAAe,EAA5C,EAAgD,EAACyI,aAAa,IAAd,EAAhD,CAAP;AACF;AACE,aAAOuG,SAAP;AAJJ;AAMD;;AAED,SAAS9F,QAAT,CAAkB8F,YAAY6jC,cAAc3pC,QAA5C,EAAsDxK,MAAtD,EAA8D;AAC5D,UAAQA,OAAOnB,IAAf;AACE,SAAKC,sBAAEA,CAACs1C,qBAAR;AACE,+BAAWp0C,OAAOsB,IAAlB,IAAwByI,aAAa,IAArC;AACF,SAAKjL,sBAAEA,CAACu1C,sBAAR;AACE,+BAAW/jC,SAAX,EAAyBtQ,OAAOsB,IAAhC;AACF;AACE,aAAOgP,SAAP;AANJ;AAQD;;AAED;;;;;;;AAOA,SAASgkC,YAAT,CAAsBhZ,KAAtB,EAA6BiZ,MAA7B,EAAqC;AACnC;AACA,QAAMC,aAAaD,OAAOzgC,GAAP,CAAWyO,QAAQA,QAAQA,KAAK5V,GAAhC,CAAnB;AACA,MAAI8nC,WAAWnZ,MAAMrkB,MAAN,CAAasL,QAASA,OAAO,CAACiyB,WAAWpwC,QAAX,CAAoBme,KAAK5V,GAAzB,CAAR,GAAwC,KAA9D,CAAf;AACA8nC,aAAWA,SAAS3gC,GAAT,CAAayO,QAAQ;AAC9B,QAAIA,QAAQA,KAAKkH,QAAjB,EAA2B;AACzB,aAAOlH,KAAKkH,QAAZ;AACA,aAAOlH,KAAKmyB,QAAZ;AACD;AACD,WAAOnyB,IAAP;AACD,GANU,CAAX;;AAQA;AACAgyB,SAAOj0C,OAAP,CAAe,CAACujC,GAAD,EAAMhd,KAAN,KAAgB;AAC7B,QAAI,CAACgd,GAAL,EAAU;AAAE;AAAS;AACrB,QAAIthB,OAAO9Y,OAAOC,MAAP,CAAc,EAAd,EAAkBm6B,GAAlB,EAAuB,EAACpa,UAAU,IAAX,EAAiBirB,UAAU7tB,KAA3B,EAAvB,CAAX;AACA,QAAIA,QAAQ4tB,SAASpiC,MAArB,EAA6B;AAC3BoiC,eAAS5tB,KAAT,IAAkBtE,IAAlB;AACD,KAFD,MAEO;AACLkyB,eAAS7mB,MAAT,CAAgB/G,KAAhB,EAAuB,CAAvB,EAA0BtE,IAA1B;AACD;AACF,GARD;;AAUA,SAAOkyB,QAAP;AACD;;;AAED,SAASphB,QAAT,CAAkB/iB,YAAY6jC,cAAc9gB,QAA5C,EAAsDrzB,MAAtD,EAA8D;AAC5D,MAAI20C,QAAJ;AACA,MAAIC,OAAJ;AACA,UAAQ50C,OAAOnB,IAAf;AACE,SAAKC,sBAAEA,CAAC+1C,iBAAR;AACE,UAAI,CAAC70C,OAAOsB,IAAR,IAAgB,CAACtB,OAAOsB,IAAP,CAAYg6B,KAAjC,EAAwC;AACtC,eAAOhrB,SAAP;AACD;AACD,aAAO7G,OAAOC,MAAP,CAAc,EAAd,EAAkB4G,SAAlB,EAA6B,EAACvG,aAAa,IAAd,EAAoBqY,MAAMpiB,OAAOsB,IAAP,CAAYg6B,KAAtC,EAA7B,EAA2Et7B,OAAOsB,IAAP,CAAYgf,IAAZ,GAAmB,EAACA,MAAMtgB,OAAOsB,IAAP,CAAYgf,IAAnB,EAAnB,GAA8C,EAAzH,CAAP;AACF,SAAKxhB,sBAAEA,CAACg2C,uBAAR;AACE,aAAOrrC,OAAOC,MAAP,CAAc,EAAd,EAAkB4G,SAAlB,EAA6B,EAACgQ,MAAMtgB,OAAOsB,IAAP,CAAYgf,IAAnB,EAA7B,CAAP;AACF,SAAKxhB,sBAAEA,CAACwqB,cAAR;AACE,aAAO7f,OAAOC,MAAP,CAAc,EAAd,EAAkB4G,SAAlB,EAA6B;AAClCojB,kBAAU;AACR7M,iBAAO7mB,OAAOsB,IAAP,CAAYulB,KADX;AAERkuB,2BAAiB;AAFT;AADwB,OAA7B,CAAP;AAMF,SAAKj2C,sBAAEA,CAAC00B,qBAAR;AACE,aAAO/pB,OAAOC,MAAP,CAAc,EAAd,EAAkB4G,SAAlB,EAA6B,EAACojB,UAAU,IAAX,EAA7B,CAAP;AACF,SAAK50B,sBAAEA,CAAC6vB,qCAAR;AACE,aAAOllB,OAAOC,MAAP,CAAc,EAAd,EAAkB4G,SAAlB,EAA6B,EAACqjB,yBAAyB,IAA1B,EAA7B,CAAP;AACF,SAAK70B,sBAAEA,CAAC20B,sCAAR;AACE,aAAOhqB,OAAOC,MAAP,CAAc,EAAd,EAAkB4G,SAAlB,EAA6B,EAACqjB,yBAAyB,KAA1B,EAA7B,CAAP;AACF,SAAK70B,sBAAEA,CAACk2C,gBAAR;AACE,UAAI,CAAC1kC,UAAUojB,QAAX,IAAuB1zB,OAAOsB,IAAP,CAAYqL,GAAZ,KAAoB2D,UAAUojB,QAAV,CAAmBuhB,UAAlE,EAA8E;AAC5E,eAAO3kC,SAAP;AACD;AACD,aAAO7G,OAAOC,MAAP,CAAc,EAAd,EAAkB4G,SAAlB,EAA6B;AAClCojB,kBAAU;AACR7M,iBAAOvW,UAAUojB,QAAV,CAAmB7M,KADlB;AAERkuB,2BAAiB/0C,OAAOsB,IAAP,CAAYq4B,OAFrB;AAGRsb,sBAAYj1C,OAAOsB,IAAP,CAAYqL;AAHhB;AADwB,OAA7B,CAAP;AAOF,SAAK7N,sBAAEA,CAACo2C,eAAR;AACE,UAAI,CAAC5kC,UAAUojB,QAAf,EAAyB;AACvB,eAAOpjB,SAAP;AACD;AACD,aAAO7G,OAAOC,MAAP,CAAc,EAAd,EAAkB4G,SAAlB,EAA6B;AAClCojB,kBAAU;AACR7M,iBAAOvW,UAAUojB,QAAV,CAAmB7M,KADlB;AAERkuB,2BAAiB,IAFT;AAGRE,sBAAYj1C,OAAOsB,IAAP,CAAYqL;AAHhB;AADwB,OAA7B,CAAP;AAOF,SAAK7N,sBAAEA,CAACq2C,sBAAR;AACE,UAAI,CAAC7kC,UAAUojB,QAAf,EAAyB;AACvB,eAAOpjB,SAAP;AACD;AACD,aAAO7G,OAAOC,MAAP,CAAc,EAAd,EAAkB4G,SAAlB,EAA6B;AAClCojB,kBAAU;AACR7M,iBAAOvW,UAAUojB,QAAV,CAAmB7M,KADlB;AAERkuB,2BAAiB;AAFT;AADwB,OAA7B,CAAP;AAMF,SAAKj2C,sBAAEA,CAACs2C,kBAAR;AACER,gBAAUtkC,UAAU8R,IAAV,CAAetO,GAAf,CAAmB6gB,OAAO;AAClC,YAAIA,OAAOA,IAAIhoB,GAAJ,KAAY3M,OAAOsB,IAAP,CAAYqL,GAAnC,EAAwC;AACtCgoC,qBAAW,IAAX;AACA,iBAAOlrC,OAAOC,MAAP,CAAc,EAAd,EAAkBirB,GAAlB,EAAuB,EAACzC,YAAYlyB,OAAOsB,IAAP,CAAY4wB,UAAzB,EAAvB,CAAP;AACD;AACD,eAAOyC,GAAP;AACD,OANS,CAAV;AAOA,aAAOggB,WAAWlrC,OAAOC,MAAP,CAAc,EAAd,EAAkB4G,SAAlB,EAA6B,EAAC8R,MAAMwyB,OAAP,EAA7B,CAAX,GAA2DtkC,SAAlE;AACF,SAAKxR,sBAAEA,CAACu2C,qBAAR;AACE,UAAI,CAACr1C,OAAOsB,IAAZ,EAAkB;AAChB,eAAOgP,SAAP;AACD;AACDskC,gBAAUtkC,UAAU8R,IAAV,CAAetO,GAAf,CAAmB6R,QAAQ;AACnC,YAAIA,QAAQA,KAAKhZ,GAAL,KAAa3M,OAAOsB,IAAP,CAAYqL,GAArC,EAA0C;AACxC,gBAAM,EAAC2Z,YAAD,EAAegvB,aAAf,EAA8BC,SAA9B,KAA2Cv1C,OAAOsB,IAAxD;AACA,iBAAOmI,OAAOC,MAAP,CAAc,EAAd,EAAkBic,IAAlB,EAAwB,EAACW,YAAD,EAAegvB,aAAf,EAA8BE,qBAAqBD,SAAnD,EAAxB,CAAP;AACD;AACD,eAAO5vB,IAAP;AACD,OANS,CAAV;AAOA,aAAOlc,OAAOC,MAAP,CAAc,EAAd,EAAkB4G,SAAlB,EAA6B,EAAC8R,MAAMwyB,OAAP,EAA7B,CAAP;AACF,SAAK91C,sBAAEA,CAAC22C,uBAAR;AACE,UAAI,CAACz1C,OAAOsB,IAAZ,EAAkB;AAChB,eAAOgP,SAAP;AACD;AACDskC,gBAAUtkC,UAAU8R,IAAV,CAAetO,GAAf,CAAmB6R,QAAQ;AACnC,YAAIA,QAAQA,KAAKhZ,GAAL,KAAa3M,OAAOsB,IAAP,CAAYqL,GAArC,EAA0C;AACxC,gBAAM+oC,UAAUjsC,OAAOC,MAAP,CAAc,EAAd,EAAkBic,IAAlB,CAAhB;AACA,iBAAO+vB,QAAQpvB,YAAf;AACA,iBAAOovB,QAAQJ,aAAf;AACA,iBAAOI,QAAQF,mBAAf;AACA,iBAAOE,OAAP;AACD;AACD,eAAO/vB,IAAP;AACD,OATS,CAAV;AAUA,aAAOlc,OAAOC,MAAP,CAAc,EAAd,EAAkB4G,SAAlB,EAA6B,EAAC8R,MAAMwyB,OAAP,EAA7B,CAAP;AACF,SAAK91C,sBAAEA,CAAC62C,mBAAR;AACE,UAAI,CAAC31C,OAAOsB,IAAZ,EAAkB;AAChB,eAAOgP,SAAP;AACD;AACDskC,gBAAUtkC,UAAU8R,IAAV,CAAenL,MAAf,CAAsB0O,QAAQ3lB,OAAOsB,IAAP,CAAYqL,GAAZ,KAAoBgZ,KAAKhZ,GAAvD,CAAV;AACA,aAAOlD,OAAOC,MAAP,CAAc,EAAd,EAAkB4G,SAAlB,EAA6B,EAAC8R,MAAMwyB,OAAP,EAA7B,CAAP;AACF,SAAK91C,sBAAEA,CAAC82C,uBAAR;AACE,+BAAWtlC,SAAX,IAAsByiB,iBAAiB/yB,OAAOsB,IAAP,CAAYyxB,eAAnD;AACF,SAAKj0B,sBAAEA,CAAC+2C,qBAAR;AACE,+BAAWvlC,SAAX,IAAsB8R,MAAM,EAA5B;AACF;AACE,aAAO9R,SAAP;AApGJ;AAsGD;;AAED,SAASkO,MAAT,CAAgBlO,YAAY6jC,cAAc31B,MAA1C,EAAkDxe,MAAlD,EAA0D;AACxD,UAAQA,OAAOnB,IAAf;AACE,SAAKC,sBAAEA,CAAC6oB,WAAR;AACE,aAAOle,OAAOC,MAAP,CAAc,EAAd,EAAkB4G,SAAlB,EAA6B,EAAC8N,SAAS,IAAV,EAAgB9c,MAAMtB,OAAOsB,IAA7B,EAA7B,CAAP;AACF,SAAKxC,sBAAEA,CAACgf,aAAR;AACE,aAAOrU,OAAOC,MAAP,CAAc,EAAd,EAAkB4G,SAAlB,EAA6B,EAAC8N,SAAS,KAAV,EAA7B,CAAP;AACF,SAAKtf,sBAAEA,CAAC8oB,kBAAR;AACE,aAAOne,OAAOC,MAAP,CAAc,EAAd,EAAkByqC,cAAc31B,MAAhC,CAAP;AACF;AACE,aAAOlO,SAAP;AARJ;AAUD;;AAED,SAAShG,KAAT,CAAegG,YAAY6jC,cAAc7pC,KAAzC,EAAgDtK,MAAhD,EAAwD;AACtD,MAAI81C,SAAJ;AACA,UAAQ91C,OAAOnB,IAAf;AACE,SAAKC,sBAAEA,CAACi3C,oBAAR;AACE,aAAOtsC,OAAOC,MAAP,CAAc,EAAd,EAAkB4G,SAAlB,EAA6B,EAACvG,aAAa,IAAd,EAAoBQ,QAAQvK,OAAOsB,IAAnC,EAA7B,CAAP;AACF,SAAKxC,sBAAEA,CAACk3C,YAAR;AACEF,kBAAYrsC,OAAOC,MAAP,CAAc,EAAd,EAAkB4G,UAAU/F,MAA5B,CAAZ;AACAurC,gBAAU91C,OAAOsB,IAAP,CAAYY,IAAtB,IAA8BlC,OAAOsB,IAAP,CAAYa,KAA1C;AACA,aAAOsH,OAAOC,MAAP,CAAc,EAAd,EAAkB4G,SAAlB,EAA6B,EAAC/F,QAAQurC,SAAT,EAA7B,CAAP;AACF;AACE,aAAOxlC,SAAP;AARJ;AAUD;;AAED,SAAS6H,QAAT,CAAkB7H,YAAY6jC,cAAch8B,QAA5C,EAAsDnY,MAAtD,EAA8D;AAC5D,MAAI20C,QAAJ;AACA,MAAIsB,QAAJ;AACA,UAAQj2C,OAAOnB,IAAf;AACE,SAAKC,sBAAEA,CAACo3C,kBAAR;AACE,aAAO5lC,UAAU2G,MAAV,CAAiBmB,WAAWA,QAAQjU,EAAR,KAAenE,OAAOsB,IAAlD,CAAP;AACF,SAAKxC,sBAAEA,CAACq3C,gBAAR;AACE;AACAF,iBAAW3lC,UAAUwD,GAAV,CAAcsE,WAAW;AAClC,YAAIA,WAAWA,QAAQjU,EAAR,KAAenE,OAAOsB,IAAP,CAAY6C,EAA1C,EAA8C;AAC5CwwC,qBAAW,IAAX;AACA,iBAAOlrC,OAAOC,MAAP,CAAc,EAAd,EAAkB0O,OAAlB,EAA2BpY,OAAOsB,IAAlC,CAAP;AACD;AACD,eAAO8W,OAAP;AACD,OANU,CAAX;AAOA;AACA,UAAI,CAACu8B,QAAL,EAAe;AACb,cAAM5qC,cAAc,CAAC,EAAE/J,OAAOsB,IAAP,CAAY8gB,IAAZ,IAAoBpiB,OAAOsB,IAAP,CAAY8gB,IAAZ,CAAiB/P,MAAjB,GAA0B,CAAhD,CAArB;AACA,cAAM+F,UAAU3O,OAAOC,MAAP,CAAc,EAAC+J,OAAO,EAAR,EAAY2O,MAAM,EAAlB,EAAsB/J,SAAS,KAA/B,EAAd,EAAqDrY,OAAOsB,IAA5D,EAAkE,EAACyI,WAAD,EAAlE,CAAhB;AACAksC,iBAAS5xC,IAAT,CAAc+T,OAAd;AACD;AACD,aAAO69B,QAAP;AACF,SAAKn3C,sBAAEA,CAACs3C,cAAR;AACEH,iBAAW3lC,UAAUwD,GAAV,CAAcsE,WAAW;AAClC,YAAIA,WAAWA,QAAQjU,EAAR,KAAenE,OAAOsB,IAAP,CAAY6C,EAA1C,EAA8C;AAC5C;AACA;AACA,gBAAM4F,cAAc/J,OAAOsB,IAAP,CAAY8gB,IAAZ,GAAmB,EAACrY,aAAa,IAAd,EAAnB,GAAyC,EAA7D;;AAEA;AACA;AACA,cAAI/J,OAAOsB,IAAP,CAAY8gB,IAAZ,IAAoBpiB,OAAOsB,IAAP,CAAY8gB,IAAZ,CAAiB/P,MAAjB,GAA0B,CAA9C,IAAmD+F,QAAQgK,IAAR,CAAazH,IAAb,CAAkB07B,QAAQA,KAAK9B,MAA/B,CAAvD,EAA+F;AAC7F,kBAAMnyB,OAAOlQ,MAAM/R,IAAN,CAAWH,OAAOsB,IAAP,CAAY8gB,IAAvB,CAAb;AACAhK,oBAAQgK,IAAR,CAAa9hB,OAAb,CAAqB,CAAC+1C,IAAD,EAAOxvB,KAAP,KAAiB;AACpC,kBAAIwvB,KAAK9B,MAAT,EAAiB;AACf;AACA,oBAAInyB,KAAKyE,KAAL,EAAYrE,IAAZ,KAAqB6zB,KAAK7zB,IAA9B,EAAoC;AAClCJ,uBAAKwL,MAAL,CAAY/G,KAAZ,EAAmB,CAAnB,EAAsBwvB,IAAtB;AACD;AACF;AACF,aAPD;AAQA,mBAAO5sC,OAAOC,MAAP,CAAc,EAAd,EAAkB0O,OAAlB,EAA2BrO,WAA3B,EAAwCN,OAAOC,MAAP,CAAc,EAAd,EAAkB1J,OAAOsB,IAAzB,EAA+B,EAAC8gB,IAAD,EAA/B,CAAxC,CAAP;AACD;;AAED,iBAAO3Y,OAAOC,MAAP,CAAc,EAAd,EAAkB0O,OAAlB,EAA2BrO,WAA3B,EAAwC/J,OAAOsB,IAA/C,CAAP;AACD;AACD,eAAO8W,OAAP;AACD,OAxBU,CAAX;;AA0BA,UAAI,CAACpY,OAAOsB,IAAP,CAAYg1C,oBAAjB,EAAuC;AACrC,eAAOL,QAAP;AACD;;AAEDj2C,aAAOsB,IAAP,CAAYg1C,oBAAZ,CAAiCh2C,OAAjC,CAAyCi2C,cAAc;AACrDN,mBAAWA,SAASniC,GAAT,CAAasE,WAAW;AACjC,cAAIA,QAAQjU,EAAR,KAAeoyC,WAAWpyC,EAA9B,EAAkC;AAChC,kBAAMqyC,cAAcD,WAAWE,UAAX,CAAsB12B,MAAtB,CAA6B,CAACqC,IAAD,EAAOs0B,eAAP,KAA2B;AAC1E,oBAAMC,gBAAgBV,SAASt7B,IAAT,CAAc8K,KAAKA,EAAEthB,EAAF,KAASuyC,eAA5B,CAAtB;AACA,oBAAM,GAAG9B,OAAH,IAAcV,OAAON,KAAP,CAAa+C,cAAcv0B,IAA3B,EAAiCA,IAAjC,CAApB;AACA,qBAAOwyB,OAAP;AACD,aAJmB,EAIjBx8B,QAAQgK,IAJS,CAApB;;AAMA,mBAAO3Y,OAAOC,MAAP,CAAc,EAAd,EAAkB0O,OAAlB,EAA2B,EAACgK,MAAMo0B,WAAP,EAA3B,CAAP;AACD;;AAED,iBAAOp+B,OAAP;AACD,SAZU,CAAX;AAaD,OAdD;;AAgBA,aAAO69B,QAAP;AACF,SAAKn3C,sBAAEA,CAAC83C,mBAAR;AACE,aAAOtmC,UAAUwD,GAAV,CAAcsE,WAAW;AAC9B,YAAIA,WAAWA,QAAQjU,EAAR,KAAenE,OAAOsB,IAAP,CAAY6C,EAAtC,IAA4CiU,QAAQgK,IAAxD,EAA8D;AAC5D,gBAAMwyB,UAAUx8B,QAAQgK,IAAR,CAAatO,GAAb,CAAiBuiC,QAAQ;AACvC,gBAAIA,KAAK1pC,GAAL,KAAa3M,OAAOsB,IAAP,CAAYqL,GAA7B,EAAkC;AAChC,qBAAOlD,OAAOC,MAAP,CAAc,EAAd,EAAkB2sC,IAAlB,EAAwBr2C,OAAOsB,IAAP,CAAYrB,OAApC,CAAP;AACD;AACD,mBAAOo2C,IAAP;AACD,WALe,CAAhB;AAMA,iBAAO5sC,OAAOC,MAAP,CAAc,EAAd,EAAkB0O,OAAlB,EAA2B,EAACgK,MAAMwyB,OAAP,EAA3B,CAAP;AACD;AACD,eAAOx8B,OAAP;AACD,OAXM,CAAP;AAYF,SAAKtZ,sBAAEA,CAACu2C,qBAAR;AACE,UAAI,CAACr1C,OAAOsB,IAAZ,EAAkB;AAChB,eAAOgP,SAAP;AACD;AACD,aAAOA,UAAUwD,GAAV,CAAcsE,WAAW3O,OAAOC,MAAP,CAAc,EAAd,EAAkB0O,OAAlB,EAA2B;AACzDgK,cAAMhK,QAAQgK,IAAR,CAAatO,GAAb,CAAiB6/B,QAAQ;AAC7B;AACA,cAAIA,KAAKhnC,GAAL,KAAa3M,OAAOsB,IAAP,CAAYqL,GAA7B,EAAkC;AAChC,kBAAM,EAAC2Z,YAAD,EAAegvB,aAAf,EAA8BC,SAA9B,KAA2Cv1C,OAAOsB,IAAxD;AACA,mBAAOmI,OAAOC,MAAP,CAAc,EAAd,EAAkBiqC,IAAlB,EAAwB;AAC7BrtB,0BAD6B;AAE7BgvB,2BAF6B;AAG7BE,mCAAqBD,SAHQ;AAI7B12C,oBAAM;AAJuB,aAAxB,CAAP;AAMD;AACD,iBAAO80C,IAAP;AACD,SAZK;AADmD,OAA3B,CAAzB,CAAP;AAeF,SAAK70C,sBAAEA,CAAC+3C,sBAAR;AACE,UAAI,CAAC72C,OAAOsB,IAAZ,EAAkB;AAChB,eAAOgP,SAAP;AACD;AACD,aAAOA,UAAUwD,GAAV,CAAcsE,WAAW3O,OAAOC,MAAP,CAAc,EAAd,EAAkB0O,OAAlB,EAA2B;AACzDgK,cAAMhK,QAAQgK,IAAR,CAAatO,GAAb,CAAiB6/B,QAAQ;AAC7B,cAAIA,KAAKhnC,GAAL,KAAa3M,OAAOsB,IAAP,CAAYqL,GAA7B,EAAkC;AAChC,mBAAOlD,OAAOC,MAAP,CAAc,EAAd,EAAkBiqC,IAAlB,EAAwB;AAC7B5sB,wBAAU/mB,OAAOsB,IAAP,CAAYylB,QADO;AAE7BC,yBAAWhnB,OAAOsB,IAAP,CAAY0lB,SAFM;AAG7BvT,qBAAOzT,OAAOsB,IAAP,CAAYmS,KAHU;AAI7B5U,oBAAM;AAJuB,aAAxB,CAAP;AAMD;AACD,iBAAO80C,IAAP;AACD,SAVK;AADmD,OAA3B,CAAzB,CAAP;AAaF,SAAK70C,sBAAEA,CAAC22C,uBAAR;AACE,UAAI,CAACz1C,OAAOsB,IAAZ,EAAkB;AAChB,eAAOgP,SAAP;AACD;AACD,aAAOA,UAAUwD,GAAV,CAAcsE,WAAW3O,OAAOC,MAAP,CAAc,EAAd,EAAkB0O,OAAlB,EAA2B;AACzDgK,cAAMhK,QAAQgK,IAAR,CAAatO,GAAb,CAAiB6/B,QAAQ;AAC7B;AACA,cAAIA,KAAKhnC,GAAL,KAAa3M,OAAOsB,IAAP,CAAYqL,GAA7B,EAAkC;AAChC,kBAAM+oC,UAAUjsC,OAAOC,MAAP,CAAc,EAAd,EAAkBiqC,IAAlB,CAAhB;AACA,mBAAO+B,QAAQpvB,YAAf;AACA,mBAAOovB,QAAQJ,aAAf;AACA,mBAAOI,QAAQF,mBAAf;AACA,gBAAI,CAACE,QAAQ72C,IAAT,IAAiB62C,QAAQ72C,IAAR,KAAiB,UAAtC,EAAkD;AAChD62C,sBAAQ72C,IAAR,GAAe,SAAf;AACD;AACD,mBAAO62C,OAAP;AACD;AACD,iBAAO/B,IAAP;AACD,SAbK;AADmD,OAA3B,CAAzB,CAAP;AAgBF,SAAK70C,sBAAEA,CAAC62C,mBAAR;AACA,SAAK72C,sBAAEA,CAACg4C,mBAAR;AACE,UAAI,CAAC92C,OAAOsB,IAAZ,EAAkB;AAChB,eAAOgP,SAAP;AACD;AACD,aAAOA,UAAUwD,GAAV,CAAcsE,WACnB3O,OAAOC,MAAP,CAAc,EAAd,EAAkB0O,OAAlB,EAA2B,EAACgK,MAAMhK,QAAQgK,IAAR,CAAanL,MAAb,CAAoB0O,QAAQA,KAAKhZ,GAAL,KAAa3M,OAAOsB,IAAP,CAAYqL,GAArD,CAAP,EAA3B,CADK,CAAP;AAEF,SAAK7N,sBAAEA,CAACoqB,kBAAR;AACA,SAAKpqB,sBAAEA,CAACsqB,mBAAR;AACE,aAAO9Y,UAAUwD,GAAV,CAAcsE,WACnB3O,OAAOC,MAAP,CAAc,EAAd,EAAkB0O,OAAlB,EAA2B,EAACgK,MAAMhK,QAAQgK,IAAR,CAAanL,MAAb,CAAoB0O,QAAQA,KAAKqB,SAAL,KAAmBhnB,OAAOsB,IAAP,CAAY0lB,SAA3D,CAAP,EAA3B,CADK,CAAP;AAEF,SAAKloB,sBAAEA,CAAC+2C,qBAAR;AACE,aAAOvlC,UAAUwD,GAAV,CAAcsE,6BAAgBA,OAAhB,IAAyBgK,MAAM,EAA/B,GAAd,CAAP;AACF;AACE,aAAO9R,SAAP;AAtJJ;AAwJD;;AAED,SAAS3F,QAAT,CAAkB2F,YAAY6jC,cAAcxpC,QAA5C,EAAsD3K,MAAtD,EAA8D;AAC5D,UAAQA,OAAOnB,IAAf;AACE,SAAKC,sBAAEA,CAACi4C,aAAR;AACE,aAAOttC,OAAOC,MAAP,CAAc,EAAd,EAAkB4G,SAAlB,EAA6B,EAACvG,aAAa,IAAd,EAA7B,EAAkD/J,OAAOsB,IAAzD,CAAP;AACF,SAAKxC,sBAAEA,CAACoK,eAAR;AACE,aAAOO,OAAOC,MAAP,CAAc,EAAd,EAAkB4G,SAAlB,EAA6B,EAACtM,WAAWsM,UAAUtM,SAAV,CAAoBmF,MAApB,CAA2BnJ,OAAOsB,IAAlC,CAAZ,EAA7B,CAAP;AACF,SAAKxC,sBAAEA,CAACiF,0BAAR;AACE,aAAO0F,OAAOC,MAAP,CAAc,EAAd,EAAkB4G,SAAlB,EAA6B,EAACtM,WAAW,EAAZ,EAA7B,CAAP;AACF,SAAKlF,sBAAEA,CAACk4C,cAAR;AACE,aAAO7C,cAAcxpC,QAArB;AACF;AACE,aAAO2F,SAAP;AAVJ;AAYD;;AAED,SAAS4S,MAAT,CAAgB5S,YAAY6jC,cAAcjxB,MAA1C,EAAkDljB,MAAlD,EAA0D;AACxD,UAAQA,OAAOnB,IAAf;AACE,SAAKC,sBAAEA,CAACm4C,uBAAR;AACE,+BAAW3mC,SAAX,IAAsBqT,gBAAgB3jB,OAAOsB,IAA7C;AACF,SAAKxC,sBAAEA,CAACo4C,gBAAR;AACE,+BAAW5mC,SAAX,IAAsByT,gBAAgB,CAAC,CAAC/jB,OAAOsB,IAA/C;AACF,SAAKxC,sBAAEA,CAACq4C,UAAR;AACE,+BACK7mC,SADL;AAEEwT,mBAAW;AACTwN,qBAAWtxB,OAAOsB,IAAP,CAAY81C,UADd;AAET7lB,mBAASvxB,OAAOsB,IAAP,CAAY+1C,QAFZ;AAGThmB,kBAAQrxB,OAAOsB,IAAP,CAAYg2C,OAHX;AAITtzB,kBAAQhkB,OAAOsB,IAAP,CAAYi2C;AAJX;AAFb;AASF;AACE,aAAOjnC,SAAP;AAhBJ;AAkBD;;eAMe,EAAC+iB,QAAD,EAAWhc,GAAX,EAAgB7M,QAAhB,EAA0BG,QAA1B,EAAoCL,KAApC,EAA2CkU,MAA3C,EAAmDrG,QAAnD,EAA6D+K,MAA7D,E;;;;;;;;;;;;;;;ACnbT,MAAMs0B,mBAAmB;AAC9BC,WAAS;AACPC,YAAQ,oBADD;AAEPlkC,UAAM;AAFC,GADqB;AAK9BmkC,YAAU;AACRD,YAAQ,uBADA;AAERlkC,UAAM;AAFE,GALoB;AAS9BokC,YAAU;AACRF,YAAQ,wBADA;AAERlkC,UAAM;AAFE,GAToB;AAa9B1L,OAAK;AACH4vC,YAAQ,gBADL;AAEHlkC,UAAM;AAFH,GAbyB;AAiB9BwV,UAAQ;AACN0uB,YAAQ,mBADF;AAENlkC,UAAM;AAFA,GAjBsB;AAqB9BqkC,YAAU;AACRH,YAAQ,uBADA;AAERlkC,UAAM;AAFE;AArBoB,CAAzB,C;;;;;;;;;;;;;;;;;;;;;;;ACAP;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA,MAAMskC,gBAAgB,IAAI10C,GAAJ,EAAtB;;AAEA;;;;;;;;;AASO,MAAM20C,SAAN,SAAoB7qC,wBAAKA,CAACC,aAA1B,CAAwC;AAC7C9J,cAAY+J,KAAZ,EAAmB;AACjB,UAAMA,KAAN;AACA,SAAKhD,KAAL,GAAa;AACX4tC,kBAAY,IADD;AAEXC,mBAAa,KAFF;AAGX1rB,uBAAiB,KAHN;AAIX2rB,iBAAW;AAJA,KAAb;AAMA,SAAKlsB,iBAAL,GAAyB,KAAKA,iBAAL,CAAuB3kB,IAAvB,CAA4B,IAA5B,CAAzB;AACA,SAAK8kB,YAAL,GAAoB,KAAKA,YAAL,CAAkB9kB,IAAlB,CAAuB,IAAvB,CAApB;AACA,SAAKmwB,WAAL,GAAmB,KAAKA,WAAL,CAAiBnwB,IAAjB,CAAsB,IAAtB,CAAnB;AACD;;AAED;;;AAGM8wC,gBAAN,GAAuB;AAAA;;AAAA;AACrB;AACA,YAAM,EAACD,SAAD,KAAc,MAAK9tC,KAAzB;AACA,UAAI,CAAC8tC,SAAL,EAAgB;AACd;AACD;;AAED,YAAME,WAAWF,UAAUvrC,GAA3B;AACA,UAAI,CAAC,MAAKvC,KAAL,CAAW6tC,WAAhB,EAA6B;AAC3B;AACA,YAAI,CAACH,cAActL,GAAd,CAAkB4L,QAAlB,CAAL,EAAkC;AAChC,gBAAMC,gBAAgB,IAAI1zC,OAAJ,CAAY,UAACC,OAAD,EAAUa,MAAV,EAAqB;AACrD,kBAAM6yC,SAAS,IAAIC,KAAJ,EAAf;AACAD,mBAAOtlC,gBAAP,CAAwB,MAAxB,EAAgCpO,OAAhC;AACA0zC,mBAAOtlC,gBAAP,CAAwB,OAAxB,EAAiCvN,MAAjC;AACA6yC,mBAAOE,GAAP,GAAaJ,QAAb;AACD,WALqB,CAAtB;;AAOA;AACAN,wBAAct0C,GAAd,CAAkB40C,QAAlB,EAA4BC,aAA5B;AACAA,wBAAcI,KAAd,CAAoB;AAAA,mBAAMlnC,EAAN;AAAA,WAApB,EAA8BmnC,IAA9B,CAAmC;AAAA,mBAAMZ,cAAcj0C,MAAd,CAAqBu0C,QAArB,CAAN;AAAA,WAAnC,EAAyEK,KAAzE;AACD;;AAED;AACA,cAAMX,cAAc7zC,GAAd,CAAkBm0C,QAAlB,CAAN;;AAEA;AACA,YAAIrtB,mCAAeA,CAACW,kBAAhB,CAAmC,MAAKthB,KAAL,CAAW8tC,SAA9C,EAAyD,MAAK9qC,KAAL,CAAWmV,IAAX,CAAgB2I,KAAzE,KACA,CAAC,MAAK9gB,KAAL,CAAW6tC,WADhB,EAC6B;AAC3B,gBAAK5pC,QAAL,CAAc,EAAC4pC,aAAa,IAAd,EAAd;AACD;AACF;AA/BoB;AAgCtB;;AAED;;;;;;;;;;;AAWA,SAAO9hB,qBAAP,CAA6BrpB,SAA7B,EAAwCwD,SAAxC,EAAmD;AACjD,UAAM,EAAC4a,KAAD,KAAUpe,UAAUyV,IAA1B;AACA,UAAM6T,eAAerL,mCAAeA,CAACW,kBAAhB,CAAmCpb,UAAU4nC,SAA7C,EAAwDhtB,KAAxD,CAArB;AACA,QAAImL,YAAY,IAAhB;;AAEA;AACA,QAAI,CAACD,YAAD,IAAiBtpB,UAAUyV,IAA/B,EAAqC;AACnC8T,kBAAY,EAAC4hB,aAAa,KAAd,EAAZ;AACD;;AAED,QAAI7hB,YAAJ,EAAkB;AAChB,aAAOC,SAAP;AACD;;AAED;AACAtL,uCAAeA,CAACQ,wBAAhB,CAAyCjb,UAAU4nC,SAAnD;;AAEA7hB,gBAAYA,aAAa,EAAzB;AACAA,cAAU6hB,SAAV,GAAsBntB,mCAAeA,CAACK,sBAAhB,CAAuCF,KAAvC,CAAtB;;AAEA,WAAOmL,SAAP;AACD;;AAEDrK,oBAAkBnmB,KAAlB,EAAyB;AACvBA,UAAM4P,cAAN;AACA,SAAKpH,QAAL,CAAc;AACZ2pC,kBAAY,KAAK5qC,KAAL,CAAWyZ,KADX;AAEZ0F,uBAAiB;AAFL,KAAd;AAID;;AAED;;;AAGAkL,sBAAoB;AAClB;AACA,QAAI,KAAKrqB,KAAL,CAAWmV,IAAX,CAAgB1jB,IAAhB,KAAyB,SAA7B,EAAwC;AACtC,aAAO,EAACsD,OAAO,EAACy1B,WAAW,KAAKxqB,KAAL,CAAWmV,IAAX,CAAgB1jB,IAA5B,EAAR,EAAP;AACD;;AAED,WAAO,IAAP;AACD;;AAED24B,cAAY3xB,KAAZ,EAAmB;AACjBA,UAAM4P,cAAN;AACA,QAAI,KAAKrI,KAAL,CAAWmV,IAAX,CAAgB1jB,IAAhB,KAAyB,UAA7B,EAAyC;AACvC,WAAKuO,KAAL,CAAW1O,QAAX,CAAoBC,yBAAEA,CAACiC,UAAH,CAAc;AAChC/B,cAAMC,sBAAEA,CAACipB,kBADuB;AAEhCzmB,cAAM,KAAK8L,KAAL,CAAWmV;AAFe,OAAd,CAApB;AAID,KALD,MAKO;AACL,YAAM,EAACuV,MAAD,EAAS5B,MAAT,EAAiB6B,OAAjB,EAA0BC,OAA1B,EAAmClN,QAAnC,KAA+CjlB,KAArD;AACA,WAAKuH,KAAL,CAAW1O,QAAX,CAAoBC,yBAAEA,CAACiC,UAAH,CAAc;AAChC/B,cAAMC,sBAAEA,CAACupB,SADuB;AAEhC/mB,cAAMmI,OAAOC,MAAP,CAAc,KAAK0D,KAAL,CAAWmV,IAAzB,EAA+B,EAAC1c,OAAO,EAACiyB,MAAD,EAAS5B,MAAT,EAAiB6B,OAAjB,EAA0BC,OAA1B,EAAmClN,QAAnC,EAAR,EAA/B;AAF0B,OAAd,CAApB;AAID;AACD,QAAI,KAAK1d,KAAL,CAAWqX,cAAf,EAA+B;AAC7B,WAAKrX,KAAL,CAAW1O,QAAX,CAAoBC,yBAAEA,CAAC0D,WAAH,CAAevD,sBAAEA,CAAC65C,YAAlB,EAAgC;AAClDr2C,gBAAQ,KAAK8K,KAAL,CAAW2Q,WAD+B;AAElDpR,aAAK,KAAKS,KAAL,CAAWmV,IAAX,CAAgB5V,GAF6B;AAGlD4a,yBAAiB,KAAKna,KAAL,CAAWyZ;AAHsB,OAAhC,CAApB;AAKD,KAND,MAMO;AACL,WAAKzZ,KAAL,CAAW1O,QAAX,CAAoBC,yBAAEA,CAAC0C,SAAH,CAAaoI,OAAOC,MAAP,CAAc;AAC7C7D,eAAO,OADsC;AAE7CvD,gBAAQ,KAAK8K,KAAL,CAAW2Q,WAF0B;AAG7CwJ,yBAAiB,KAAKna,KAAL,CAAWyZ;AAHiB,OAAd,EAI9B,KAAK4Q,iBAAL,EAJ8B,CAAb,CAApB;;AAMA,UAAI,KAAKrqB,KAAL,CAAWuV,yBAAf,EAA0C;AACxC,aAAKvV,KAAL,CAAW1O,QAAX,CAAoBC,yBAAEA,CAACoD,eAAH,CAAmB;AACrCO,kBAAQ,KAAK8K,KAAL,CAAW2Q,WADkB;AAErC66B,iBAAO,CAF8B;AAGrCt2B,iBAAO,CAAC,EAACne,IAAI,KAAKiJ,KAAL,CAAWmV,IAAX,CAAgBC,IAArB,EAA2B2E,KAAK,KAAK/Z,KAAL,CAAWyZ,KAA3C,EAAD;AAH8B,SAAnB,CAApB;AAKD;AACF;AACF;;AAEDsF,eAAaI,eAAb,EAA8B;AAC5B,SAAKle,QAAL,CAAc,EAACke,eAAD,EAAd;AACD;;AAED9d,sBAAoB;AAClB,SAAK0pC,cAAL;AACD;;AAEDjlC,uBAAqB;AACnB,SAAKilC,cAAL;AACD;;AAED;AACA;AACA;AACA7pC,uBAAqB;AACnB,UAAM+nB,YAAY0hB,SAAKA,CAAC5hB,qBAAN,CAA4B,KAAK/oB,KAAjC,EAAwC,KAAKhD,KAA7C,CAAlB;AACA,QAAIisB,SAAJ,EAAe;AACb,WAAKhoB,QAAL,CAAcgoB,SAAd;AACD;AACF;;AAED;AACA;AACA;AACAC,4BAA0BxpB,SAA1B,EAAqC;AACnC,UAAMupB,YAAY0hB,SAAKA,CAAC5hB,qBAAN,CAA4BrpB,SAA5B,EAAuC,KAAK1C,KAA5C,CAAlB;AACA,QAAIisB,SAAJ,EAAe;AACb,WAAKhoB,QAAL,CAAcgoB,SAAd;AACD;AACF;;AAED3nB,yBAAuB;AACrBqc,uCAAeA,CAACQ,wBAAhB,CAAyC,KAAKnhB,KAAL,CAAW8tC,SAApD;AACD;;AAED3oC,WAAS;AACP,UAAM,EAACsX,KAAD,EAAQzP,SAAR,EAAmBmL,IAAnB,EAAyB7jB,QAAzB,EAAmC4kB,kBAAnC,EAAuDvF,WAAvD,EAAoE4E,yBAApE,KAAiG,KAAKvV,KAA5G;AACA,UAAM,EAACA,KAAD,KAAU,IAAhB;AACA,UAAM+qB,oBAAoB,KAAK/tB,KAAL,CAAWmiB,eAAX,IAA8B,KAAKniB,KAAL,CAAW4tC,UAAX,KAA0BnxB,KAAlF;AACA;AACA,UAAM,EAACrT,IAAD,EAAOkkC,MAAP,KAAiBF,gBAAgBA,CAACj1B,KAAK1jB,IAAL,KAAc,KAAd,GAAsB,UAAtB,GAAmC0jB,KAAK1jB,IAAzD,KAAkE,EAAzF;AACA,UAAMg6C,WAAW,KAAKzuC,KAAL,CAAW8tC,SAAX,IAAwB31B,KAAKs2B,QAA9C;AACA,UAAM3kB,aAAa,EAAChH,iBAAiB,KAAK9iB,KAAL,CAAW8tC,SAAX,GAAwB,OAAM,KAAK9tC,KAAL,CAAW8tC,SAAX,CAAqBvrC,GAAI,GAAvD,GAA4D,MAA9E,EAAnB;AACA,UAAM2L,iBAAiB,CACrB,YADqB,EAErBlB,SAFqB,EAGrB+gB,qBAAqB,QAHA,EAIrB/qB,MAAM0rC,WAAN,IAAqB,aAJA,EAKrB7hC,MALqB,CAKdC,KAAKA,CALS,EAKNC,IALM,CAKD,GALC,CAAvB;;AAOA,WAAQ;AAAA;AAAA,QAAI,WAAWmB,cAAf;AACN;AAAA;AAAA,UAAG,MAAMiK,KAAK1jB,IAAL,KAAc,QAAd,GAAyB0jB,KAAKwE,QAA9B,GAAyCxE,KAAK5V,GAAvD,EAA4D,SAAS,CAACS,MAAM0rC,WAAP,GAAqB,KAAKthB,WAA1B,GAAwCrc,SAA7G;AACE;AAAA;AAAA,YAAK,WAAU,MAAf;AACE;AAAA;AAAA,cAAK,WAAU,0BAAf;AACG09B,wBACC,gDAAK,WAAY,qBAAoB,KAAKzuC,KAAL,CAAW6tC,WAAX,GAAyB,SAAzB,GAAqC,EAAG,EAA7E,EAAgF,OAAO/jB,UAAvF;AAFJ,WADF;AAME;AAAA;AAAA,cAAK,WAAU,cAAf;AACG3R,iBAAK1jB,IAAL,KAAc,UAAd,IAA4B;AAAA;AAAA,gBAAK,WAAU,0BAAf;AAA0C,qDAAC,uCAAD,IAAkB,IAAIknB,8CAAiBA,CAAC,KAAK3Y,KAAL,CAAW4Y,QAA7B,CAAtB;AAA1C,aAD/B;AAEGzD,iBAAKsV,QAAL,IACC;AAAA;AAAA,gBAAK,WAAU,gBAAf;AACGtV,mBAAKsV,QAAL,CAActrB,KAAd,CAAoB,CAApB,EAAuB,GAAvB,CADH;AACgCgW,mBAAK1jB,IAAL,KAAc,UAAd,IAA6B,YAAW0jB,KAAKw2B,WAAY;AADzF,aAHJ;AAOE;AAAA;AAAA,gBAAK,WAAW,CACd,WADc,EAEdvlC,OAAO,EAAP,GAAY,YAFE,EAGd+O,KAAKw2B,WAAL,GAAmB,EAAnB,GAAwB,gBAHV,EAIdx2B,KAAKsV,QAAL,GAAgB,EAAhB,GAAqB,cAJP,EAKd1gB,IALc,CAKT,GALS,CAAhB;AAME;AAAA;AAAA,kBAAI,WAAU,YAAd,EAA2B,KAAI,MAA/B;AAAuCoL,qBAAK9O;AAA5C,eANF;AAOE;AAAA;AAAA,kBAAG,WAAU,kBAAb,EAAgC,KAAI,MAApC;AAA4C8O,qBAAKw2B;AAAjD;AAPF,aAPF;AAgBE;AAAA;AAAA,gBAAK,WAAU,cAAf;AACGvlC,sBAAQ,CAAC+O,KAAKpI,OAAd,IAAyB,iDAAM,WAAY,+BAA8B3G,IAAK,EAArD,GAD5B;AAEG+O,mBAAK/O,IAAL,IAAa+O,KAAKpI,OAAlB,IAA6B,iDAAM,WAAU,wBAAhB,EAAyC,OAAO,EAAC+S,iBAAkB,QAAO3K,KAAK/O,IAAK,IAApC,EAAhD,GAFhC;AAGGkkC,wBAAU,CAACn1B,KAAKpI,OAAhB,IAA2B;AAAA;AAAA,kBAAK,WAAU,oBAAf;AAAoC,uDAAC,uCAAD,IAAkB,IAAIu9B,MAAtB,EAA8B,gBAAe,SAA7C;AAApC,eAH9B;AAIGn1B,mBAAKpI,OAAL,IAAgB;AAAA;AAAA,kBAAK,WAAU,oBAAf;AAAqCoI,qBAAKpI;AAA1C;AAJnB;AAhBF;AANF;AADF,OADM;AAiCL,OAAC/M,MAAM0rC,WAAP,IAAsB;AAAA;AAAA,UAAQ,WAAU,0BAAlB,EAA6C,OAAO,KAAK1rC,KAAL,CAAWyI,IAAX,CAAgBC,aAAhB,CAA8B,EAAC3R,IAAI,oBAAL,EAA9B,CAApD;AACrB,mBAAS,KAAK6nB,iBADO;AAErB;AAAA;AAAA,YAAM,WAAU,SAAhB;AAA4B,mCAAwBzJ,KAAK9O,KAAM;AAA/D;AAFqB,OAjCjB;AAqCL0kB,2BACC,uCAAC,oBAAD;AACE,kBAAUz5B,QADZ;AAEE,eAAOmoB,KAFT;AAGE,gBAAQ9I,WAHV;AAIE,kBAAU,KAAKoO,YAJjB;AAKE,iBAAS5J,KAAKe,kBAAL,IAA2BA,kBALtC;AAME,cAAMf,IANR;AAOE,kBAAU,KAAKkV,iBAAL,EAPZ;AAQE,mCAA2B9U,yBAR7B;AAtCI,KAAR;AAiDD;AAlP4C;AAoP/Co1B,SAAKA,CAACvoC,YAAN,GAAqB,EAAC+S,MAAM,EAAP,EAArB;AACO,MAAMy2B,OAAO3zC,uCAAOA,CAAC+E,UAAU,EAAC4b,UAAU5b,MAAME,KAAN,CAAYC,MAAZ,CAAmByb,QAA9B,EAAV,CAAR,EAA4D9P,yCAAUA,CAAC6hC,SAAX,CAA5D,CAAb;AACA,MAAMkB,kBAAkB7rC,SAAS,uCAAC,IAAD,IAAM,aAAa,IAAnB,EAAyB,WAAWA,MAAMgK,SAA1C,GAAjC,C;;;;;;;;;;;;;;;;;;;;;;AC3QP;AACA;;AAEO,MAAM8hC,iCAAN,SAA+BhsC,wBAAKA,CAACC,aAArC,CAAmD;AACxD9J,cAAY+J,KAAZ,EAAmB;AACjB,UAAMA,KAAN;AACA,SAAKhD,KAAL,GAAa,EAAC+uC,iBAAiB,KAAK/rC,KAAL,CAAW+rC,eAA7B,EAAb;AACA,SAAK/kB,QAAL,GAAgB,KAAKA,QAAL,CAAc/sB,IAAd,CAAmB,IAAnB,CAAhB;AACA,SAAK+xC,OAAL,GAAe,KAAKA,OAAL,CAAa/xC,IAAb,CAAkB,IAAlB,CAAf;AACD;;AAEDivB,4BAA0BxpB,SAA1B,EAAqC;AACnC,QAAIA,UAAUusC,WAAV,IAAyB,CAAC,KAAKjsC,KAAL,CAAWisC,WAAzC,EAAsD;AACpD,WAAKv4B,KAAL,CAAWpL,KAAX;AACD;AACD,QAAI5I,UAAUqsC,eAAV,IAA6B,CAAC,KAAK/rC,KAAL,CAAW+rC,eAA7C,EAA8D;AAC5D,WAAK9qC,QAAL,CAAc,EAAC8qC,iBAAiB,IAAlB,EAAd;AACD;AACD;AACA,QAAI,KAAK/uC,KAAL,CAAW+uC,eAAX,IAA8B,CAACrsC,UAAU3K,KAA7C,EAAoD;AAClD,WAAKkM,QAAL,CAAc,EAAC8qC,iBAAiB,KAAlB,EAAd;AACD;AACF;;AAED/kB,WAASQ,EAAT,EAAa;AACX,QAAI,KAAKxqB,KAAL,CAAW+uC,eAAf,EAAgC;AAC9B,WAAK9qC,QAAL,CAAc,EAAC8qC,iBAAiB,KAAlB,EAAd;AACD;AACD,SAAK/rC,KAAL,CAAWgnB,QAAX,CAAoBQ,EAApB;AACD;;AAEDwkB,UAAQt4B,KAAR,EAAe;AACb,SAAKA,KAAL,GAAaA,KAAb;AACD;;AAEDvR,WAAS;AACP,UAAM+pC,kBAAkB,KAAKlsC,KAAL,CAAWjL,KAAX,IAAoB,KAAKiL,KAAL,CAAWmsC,OAAvD;AACA,UAAM,EAACC,OAAD,KAAY,KAAKpsC,KAAvB;AACA,UAAM,EAAC+rC,eAAD,KAAoB,KAAK/uC,KAA/B;;AAEA,WAAQ;AAAA;AAAA;AAAO,6CAAC,uCAAD,IAAkB,IAAI,KAAKgD,KAAL,CAAWqsC,OAAjC,GAAP;AACN;AAAA;AAAA,UAAK,WAAY,SAAQD,UAAU,KAAV,GAAkB,EAAG,GAAEL,kBAAkB,UAAlB,GAA+B,EAAG,EAAlF;AACG,aAAK/rC,KAAL,CAAWssC,OAAX,GACC;AAAA;AAAA,YAAK,WAAU,mBAAf;AAAmC,0DAAK,WAAU,mBAAf;AAAnC,SADD,GAECJ,mBAAmB,gDAAK,WAAU,uBAAf,EAAuC,SAAS,KAAKlsC,KAAL,CAAWmsC,OAA3D,GAHvB;AAIE,0DAAO,MAAK,MAAZ;AACE,iBAAO,KAAKnsC,KAAL,CAAWjL,KADpB;AAEE,eAAK,KAAKi3C,OAFZ;AAGE,oBAAU,KAAKhlB,QAHjB;AAIE,uBAAa,KAAKhnB,KAAL,CAAWyI,IAAX,CAAgBC,aAAhB,CAA8B,EAAC3R,IAAI,KAAKiJ,KAAL,CAAWusC,aAAhB,EAA9B,CAJf;AAKE,qBAAW,KAAKvsC,KAAL,CAAWisC,WALxB;AAME,oBAAU,KAAKjsC,KAAL,CAAWssC,OANvB,GAJF;AAWGP,2BACC;AAAA;AAAA,YAAO,WAAU,eAAjB;AACE,iDAAC,uCAAD,IAAkB,IAAI,KAAK/rC,KAAL,CAAWwsC,cAAjC;AADF;AAZJ;AADM,KAAR;AAkBD;AAvDuD;;AA0D1DV,iCAAgBA,CAAC1pC,YAAjB,GAAgC;AAC9B8pC,mBAAiB,KADa;AAE9Bn3C,SAAO,EAFuB;AAG9Bg3C,mBAAiB;AAHa,CAAhC,C;;;;;AC7DA;AAAA;AACA;AACA;AACA;AACA;AACA;;AAEO,MAAMU,uBAAN,SAA0B3sC,wBAAKA,CAACC,aAAhC,CAA8C;AACnD9J,cAAY+J,KAAZ,EAAmB;AACjB,UAAMA,KAAN;AACA,UAAM,EAACuY,IAAD,KAASvY,KAAf;AACA,SAAKhD,KAAL,GAAa;AACX0S,aAAO6I,OAAQA,KAAK7I,KAAL,IAAc6I,KAAKkS,QAA3B,GAAuC,EADnC;AAEXlrB,WAAKgZ,OAAOA,KAAKhZ,GAAZ,GAAkB,EAFZ;AAGXwsC,uBAAiB,KAHN;AAIXW,2BAAqBn0B,OAAOA,KAAKkM,mBAAZ,GAAkC,EAJ5C;AAKXkoB,gCAA0Bp0B,OAAOA,KAAKkM,mBAAZ,GAAkC;AALjD,KAAb;AAOA,SAAKmoB,sBAAL,GAA8B,KAAKA,sBAAL,CAA4B3yC,IAA5B,CAAiC,IAAjC,CAA9B;AACA,SAAK4yC,aAAL,GAAqB,KAAKA,aAAL,CAAmB5yC,IAAnB,CAAwB,IAAxB,CAArB;AACA,SAAK6yC,WAAL,GAAmB,KAAKA,WAAL,CAAiB7yC,IAAjB,CAAsB,IAAtB,CAAnB;AACA,SAAKktB,mBAAL,GAA2B,KAAKA,mBAAL,CAAyBltB,IAAzB,CAA8B,IAA9B,CAA3B;AACA,SAAK8yC,eAAL,GAAuB,KAAKA,eAAL,CAAqB9yC,IAArB,CAA0B,IAA1B,CAAvB;AACA,SAAK+yC,iBAAL,GAAyB,KAAKA,iBAAL,CAAuB/yC,IAAvB,CAA4B,IAA5B,CAAzB;AACA,SAAKgzC,2BAAL,GAAmC,KAAKA,2BAAL,CAAiChzC,IAAjC,CAAsC,IAAtC,CAAnC;AACA,SAAKizC,oBAAL,GAA4B,KAAKA,oBAAL,CAA0BjzC,IAA1B,CAA+B,IAA/B,CAA5B;AACA,SAAKkzC,yBAAL,GAAiC,KAAKA,yBAAL,CAA+BlzC,IAA/B,CAAoC,IAApC,CAAjC;AACA,SAAKmzC,WAAL,GAAmB,KAAKA,WAAL,CAAiBnzC,IAAjB,CAAsB,IAAtB,CAAnB;AACD;;AAED4yC,gBAAcp0C,KAAd,EAAqB;AACnB,SAAKwI,QAAL,CAAc,EAAC,SAASxI,MAAM9E,MAAN,CAAaoB,KAAvB,EAAd;AACD;;AAED+3C,cAAYr0C,KAAZ,EAAmB;AACjB,SAAKwI,QAAL,CAAc;AACZ1B,WAAK9G,MAAM9E,MAAN,CAAaoB,KADN;AAEZg3C,uBAAiB;AAFL,KAAd;AAID;;AAEDgB,oBAAkB;AAChB,SAAK9rC,QAAL,CAAc;AACZ1B,WAAK,EADO;AAEZwsC,uBAAiB;AAFL,KAAd;AAID;;AAEDoB,8BAA4B;AAC1B,SAAKlsC,QAAL,CAAc,EAAC0rC,0BAA0B,IAA3B,EAAd;AACD;;AAEDU,+BAA6BX,mBAA7B,EAAkD;AAChD,SAAKzrC,QAAL,CAAc;AACZyrC,yBADY;AAEZX,uBAAiB;AAFL,KAAd;AAIA,SAAK/rC,KAAL,CAAW1O,QAAX,CAAoB,EAACG,MAAMC,sBAAEA,CAACq2C,sBAAV,EAApB;AACD;;AAEDkF,8BAA4Bx0C,KAA5B,EAAmC;AACjC,SAAK40C,4BAAL,CAAkC50C,MAAM9E,MAAN,CAAaoB,KAA/C;AACD;;AAED63C,2BAAyB;AACvB,SAAKS,4BAAL,CAAkC,EAAlC;AACD;;AAEDlmB,sBAAoBK,EAApB,EAAwB;AACtBA,OAAGnf,cAAH;AACA,SAAKrI,KAAL,CAAWynB,OAAX;AACD;;AAEDulB,oBAAkBxlB,EAAlB,EAAsB;AACpBA,OAAGnf,cAAH;;AAEA,QAAI,KAAKilC,YAAL,EAAJ,EAAyB;AACvB,YAAM/0B,OAAO,EAAChZ,KAAK,KAAKguC,QAAL,CAAc,KAAKvwC,KAAL,CAAWuC,GAAzB,CAAN,EAAb;AACA,YAAM,EAACka,KAAD,KAAU,KAAKzZ,KAArB;AACA,UAAI,KAAKhD,KAAL,CAAW0S,KAAX,KAAqB,EAAzB,EAA6B;AAC3B6I,aAAK7I,KAAL,GAAa,KAAK1S,KAAL,CAAW0S,KAAxB;AACD;;AAED,UAAI,KAAK1S,KAAL,CAAW0vC,mBAAf,EAAoC;AAClCn0B,aAAKkM,mBAAL,GAA2B,KAAK8oB,QAAL,CAAc,KAAKvwC,KAAL,CAAW0vC,mBAAzB,CAA3B;AACD,OAFD,MAEO,IAAI,KAAK1sC,KAAL,CAAWuY,IAAX,IAAmB,KAAKvY,KAAL,CAAWuY,IAAX,CAAgBkM,mBAAvC,EAA4D;AACjE;AACAlM,aAAKkM,mBAAL,GAA2B,IAA3B;AACD;AACD,WAAKzkB,KAAL,CAAW1O,QAAX,CAAoBC,yBAAEA,CAACC,UAAH,CAAc;AAChCC,cAAMC,sBAAEA,CAAC6pB,aADuB;AAEhCrnB,cAAM,EAACqkB,IAAD,EAAOkB,KAAP;AAF0B,OAAd,CAApB;AAIA,WAAKzZ,KAAL,CAAW1O,QAAX,CAAoBC,yBAAEA,CAAC0C,SAAH,CAAa;AAC/BiB,gBAAQixB,qCADuB;AAE/B1tB,eAAO,gBAFwB;AAG/B0hB,yBAAiBV;AAHc,OAAb,CAApB;;AAMA,WAAKzZ,KAAL,CAAWynB,OAAX;AACD;AACF;;AAEDylB,uBAAqBz0C,KAArB,EAA4B;AAC1BA,UAAM4P,cAAN;AACA,QAAI,KAAKilC,YAAL,EAAJ,EAAyB;AACvB,WAAKttC,KAAL,CAAW1O,QAAX,CAAoBC,yBAAEA,CAACC,UAAH,CAAc;AAChCC,cAAMC,sBAAEA,CAACo2C,eADuB;AAEhC5zC,cAAM,EAACqL,KAAK,KAAKguC,QAAL,CAAc,KAAKvwC,KAAL,CAAW0vC,mBAAzB,CAAN;AAF0B,OAAd,CAApB;AAIA,WAAK1sC,KAAL,CAAW1O,QAAX,CAAoBC,yBAAEA,CAAC0C,SAAH,CAAa;AAC/BiB,gBAAQixB,qCADuB;AAE/B1tB,eAAO;AAFwB,OAAb,CAApB;AAID;AACF;;AAED80C,WAAShuC,GAAT,EAAc;AACZ;AACA,QAAI,CAACA,IAAIkY,UAAJ,CAAe,OAAf,CAAD,IAA4B,CAAClY,IAAIkY,UAAJ,CAAe,QAAf,CAAjC,EAA2D;AACzD,aAAQ,UAASlY,GAAI,EAArB;AACD;AACD,WAAOA,GAAP;AACD;;AAEDiuC,eAAajuC,GAAb,EAAkB;AAChB,QAAI;AACF,aAAO,IAAID,GAAJ,CAAQC,GAAR,CAAP;AACD,KAFD,CAEE,OAAOtE,CAAP,EAAU;AACV,aAAO,IAAP;AACD;AACF;;AAEDmyC,cAAY7tC,GAAZ,EAAiB;AACf,UAAMkuC,iBAAiB,CAAC,OAAD,EAAU,QAAV,CAAvB;AACA,UAAMC,SAAS,KAAKF,YAAL,CAAkBjuC,GAAlB,KAA0B,KAAKiuC,YAAL,CAAkB,KAAKD,QAAL,CAAchuC,GAAd,CAAlB,CAAzC;;AAEA,WAAOmuC,UAAUD,eAAez2C,QAAf,CAAwB02C,OAAOlgB,QAA/B,CAAjB;AACD;;AAEDmgB,gCAA8B;AAC5B,UAAM,EAACjB,mBAAD,KAAwB,KAAK1vC,KAAnC;AACA,WAAO,CAAC0vC,mBAAD,IAAwB,KAAKU,WAAL,CAAiBV,mBAAjB,CAA/B;AACD;;AAEDY,iBAAe;AACb,UAAMM,WAAW,KAAKR,WAAL,CAAiB,KAAKpwC,KAAL,CAAWuC,GAA5B,KAAoC,KAAKouC,2BAAL,EAArD;;AAEA,QAAI,CAACC,QAAL,EAAe;AACb,WAAK3sC,QAAL,CAAc,EAAC8qC,iBAAiB,IAAlB,EAAd;AACD;;AAED,WAAO6B,QAAP;AACD;;AAEDC,iCAA+B;AAC7B,UAAM,EAACnB,mBAAD,KAAwB,KAAK1vC,KAAnC;AACA,UAAM8wC,gBAAgB,KAAK9tC,KAAL,CAAW2nC,eAAX,KAA+B,EAArD;AACA,UAAMoE,kBAAmB,KAAK/uC,KAAL,CAAW+uC,eAAX,IAA8B,CAAC,KAAK4B,2BAAL,EAAhC,IAAuEG,aAA/F;AACA;AACA,UAAM7B,cAAeF,mBAAmB,KAAKqB,WAAL,CAAiB,KAAKpwC,KAAL,CAAWuC,GAA5B,CAApB,IAAyD,CAACmtC,mBAA9E;AACA,UAAMqB,YAAY,KAAK/tC,KAAL,CAAW2nC,eAAX,KAA+B,IAA/B,IAChB+E,mBADgB,IACO,KAAK1sC,KAAL,CAAW6nC,UAAX,KAA0B,KAAK0F,QAAL,CAAcb,mBAAd,CADnD;;AAGA,QAAI,CAAC,KAAK1vC,KAAL,CAAW2vC,wBAAhB,EAA0C;AACxC,aAAQ;AAAA;AAAA,UAAG,WAAU,2BAAb,EAAyC,SAAS,KAAKQ,yBAAvD;AACN,+CAAC,uCAAD,IAAkB,IAAG,8BAArB;AADM,OAAR;AAGD;AACD,WAAQ;AAAA;AAAA,QAAK,WAAU,8BAAf;AACN,6CAAC,iCAAD;AACE,wBAAgBW,gBAAgB,gCAAhB,GAAmD,8BADrE;AAEE,iBAASC,SAFX;AAGE,kBAAU,KAAKd,2BAHjB;AAIE,iBAAS,KAAKL,sBAJhB;AAKE,qBAAaX,WALf;AAME,iBAAS,IANX;AAOE,eAAOS,mBAPT;AAQE,yBAAiBX,eARnB;AASE,iBAAQ,+BATV;AAUE,uBAAc,+BAVhB;AAWE,cAAM,KAAK/rC,KAAL,CAAWyI,IAXnB;AADM,KAAR;AAcD;;AAEDtG,WAAS;AACP,UAAM,EAACuqC,mBAAD,KAAwB,KAAK1vC,KAAnC;AACA,UAAM8wC,gBAAgB,KAAK9tC,KAAL,CAAW2nC,eAAX,KAA+B,EAArD;AACA;AACA,UAAMqG,YAAY,CAAC,KAAKhuC,KAAL,CAAWuY,IAA9B;AACA,UAAM01B,WAAY,KAAKjuC,KAAL,CAAWuY,IAAX,IAAmB,KAAKvY,KAAL,CAAWuY,IAAX,CAAgBkM,mBAApC,IAA4D,EAA7E;AACA,UAAMypB,UAAUxB,uBAAuB,KAAKa,QAAL,CAAcb,mBAAd,MAAuCuB,QAA9E;AACA;AACA;AACA,UAAME,cAAcD,WAAW,CAAC,KAAKluC,KAAL,CAAW2nC,eAA3C;AACA,UAAMyG,cAAc/xC,OAAOC,MAAP,CAAc,EAAd,EAAkB,KAAK0D,KAAL,CAAWuY,IAA7B,CAApB;AACA,QAAI,KAAKvY,KAAL,CAAW2nC,eAAf,EAAgC;AAC9ByG,kBAAYtpB,UAAZ,GAAyB,KAAK9kB,KAAL,CAAW2nC,eAApC;AACAyG,kBAAY3pB,mBAAZ,GAAkC,KAAKzkB,KAAL,CAAW6nC,UAA7C;AACD;AACD,WACE;AAAA;AAAA,QAAM,WAAU,cAAhB;AACE;AAAA;AAAA,UAAK,WAAU,sBAAf;AACE;AAAA;AAAA,YAAI,WAAU,eAAd;AACE,iDAAC,uCAAD,IAAkB,IAAImG,YAAY,0BAAZ,GAAyC,2BAA/D;AADF,SADF;AAIE;AAAA;AAAA,YAAK,WAAU,oBAAf;AACE;AAAA;AAAA,cAAK,WAAU,cAAf;AACE,mDAAC,iCAAD,IAAkB,UAAU,KAAKnB,aAAjC;AACE,qBAAO,KAAK7vC,KAAL,CAAW0S,KADpB;AAEE,uBAAQ,2BAFV;AAGE,6BAAc,iCAHhB;AAIE,oBAAM,KAAK1P,KAAL,CAAWyI,IAJnB,GADF;AAME,mDAAC,iCAAD,IAAkB,UAAU,KAAKqkC,WAAjC;AACE,2BAAa,KAAK9vC,KAAL,CAAW+uC,eAAX,IAA8B,CAAC,KAAKqB,WAAL,CAAiB,KAAKpwC,KAAL,CAAWuC,GAA5B,CAD9C;AAEE,qBAAO,KAAKvC,KAAL,CAAWuC,GAFpB;AAGE,uBAAS,KAAKwtC,eAHhB;AAIE,+BAAiB,KAAK/vC,KAAL,CAAW+uC,eAAX,IAA8B,CAAC,KAAKqB,WAAL,CAAiB,KAAKpwC,KAAL,CAAWuC,GAA5B,CAJlD;AAKE,uBAAQ,yBALV;AAME,uBAAS,IANX;AAOE,6BAAc,+BAPhB;AAQE,8BAAe,8BARjB;AASE,oBAAM,KAAKS,KAAL,CAAWyI,IATnB,GANF;AAgBG,iBAAKolC,4BAAL;AAhBH,WADF;AAmBE,iDAAC,sBAAD,IAAa,MAAMO,WAAnB;AACE,0BAAcN,aADhB;AAEE,mBAAO,KAAK9wC,KAAL,CAAW0S,KAFpB;AAnBF;AAJF,OADF;AA6BE;AAAA;AAAA,UAAS,WAAU,SAAnB;AACE;AAAA;AAAA,YAAQ,WAAU,QAAlB,EAA2B,MAAK,QAAhC,EAAyC,SAAS,KAAKyX,mBAAvD;AACE,iDAAC,uCAAD,IAAkB,IAAG,6BAArB;AADF,SADF;AAIGgnB,sBACC;AAAA;AAAA,YAAQ,WAAU,cAAlB,EAAiC,MAAK,QAAtC,EAA+C,SAAS,KAAKjB,oBAA7D;AACE,iDAAC,uCAAD,IAAkB,IAAG,8BAArB;AADF,SADD,GAIC;AAAA;AAAA,YAAQ,WAAU,MAAlB,EAAyB,MAAK,QAA9B,EAAuC,SAAS,KAAKF,iBAArD;AACE,iDAAC,uCAAD,IAAkB,IAAIgB,YAAY,0BAAZ,GAAyC,2BAA/D;AADF;AARJ;AA7BF,KADF;AA4CD;AA7OkD;;AAgPrDvB,uBAAWA,CAACrqC,YAAZ,GAA2B;AACzBmW,QAAM,IADmB;AAEzBkB,SAAO,CAAC;AAFiB,CAA3B,C","file":"activity-stream.bundle.js","sourcesContent":[" \t// The module cache\n \tvar installedModules = {};\n\n \t// The require function\n \tfunction __webpack_require__(moduleId) {\n\n \t\t// Check if module is in cache\n \t\tif(installedModules[moduleId]) {\n \t\t\treturn installedModules[moduleId].exports;\n \t\t}\n \t\t// Create a new module (and put it into the cache)\n \t\tvar module = installedModules[moduleId] = {\n \t\t\ti: moduleId,\n \t\t\tl: false,\n \t\t\texports: {}\n \t\t};\n\n \t\t// Execute the module function\n \t\tmodules[moduleId].call(module.exports, module, module.exports, __webpack_require__);\n\n \t\t// Flag the module as loaded\n \t\tmodule.l = true;\n\n \t\t// Return the exports of the module\n \t\treturn module.exports;\n \t}\n\n\n \t// expose the modules object (__webpack_modules__)\n \t__webpack_require__.m = modules;\n\n \t// expose the module cache\n \t__webpack_require__.c = installedModules;\n\n \t// define getter function for harmony exports\n \t__webpack_require__.d = function(exports, name, getter) {\n \t\tif(!__webpack_require__.o(exports, name)) {\n \t\t\tObject.defineProperty(exports, name, { enumerable: true, get: getter });\n \t\t}\n \t};\n\n \t// define __esModule on exports\n \t__webpack_require__.r = function(exports) {\n \t\tif(typeof Symbol !== 'undefined' && Symbol.toStringTag) {\n \t\t\tObject.defineProperty(exports, Symbol.toStringTag, { value: 'Module' });\n \t\t}\n \t\tObject.defineProperty(exports, '__esModule', { value: true });\n \t};\n\n \t// create a fake namespace object\n \t// mode & 1: value is a module id, require it\n \t// mode & 2: merge all properties of value into the ns\n \t// mode & 4: return value when already ns object\n \t// mode & 8|1: behave like require\n \t__webpack_require__.t = function(value, mode) {\n \t\tif(mode & 1) value = __webpack_require__(value);\n \t\tif(mode & 8) return value;\n \t\tif((mode & 4) && typeof value === 'object' && value && value.__esModule) return value;\n \t\tvar ns = Object.create(null);\n \t\t__webpack_require__.r(ns);\n \t\tObject.defineProperty(ns, 'default', { enumerable: true, value: value });\n \t\tif(mode & 2 && typeof value != 'string') for(var key in value) __webpack_require__.d(ns, key, function(key) { return value[key]; }.bind(null, key));\n \t\treturn ns;\n \t};\n\n \t// getDefaultExport function for compatibility with non-harmony modules\n \t__webpack_require__.n = function(module) {\n \t\tvar getter = module && module.__esModule ?\n \t\t\tfunction getDefault() { return module['default']; } :\n \t\t\tfunction getModuleExports() { return module; };\n \t\t__webpack_require__.d(getter, 'a', getter);\n \t\treturn getter;\n \t};\n\n \t// Object.prototype.hasOwnProperty.call\n \t__webpack_require__.o = function(object, property) { return Object.prototype.hasOwnProperty.call(object, property); };\n\n \t// __webpack_public_path__\n \t__webpack_require__.p = \"\";\n\n\n \t// Load entry module and return exports\n \treturn __webpack_require__(__webpack_require__.s = 0);\n","import {actionCreators as ac, actionTypes as at} from \"common/Actions.jsm\";\nimport {addSnippetsSubscriber} from \"content-src/lib/snippets\";\nimport {ASRouterContent} from \"content-src/asrouter/asrouter-content\";\nimport {Base} from \"content-src/components/Base/Base\";\nimport {DetectUserSessionStart} from \"content-src/lib/detect-user-session-start\";\nimport {enableASRouterContent} from \"content-src/lib/asroutercontent\";\nimport {initStore} from \"content-src/lib/init-store\";\nimport {Provider} from \"react-redux\";\nimport React from \"react\";\nimport ReactDOM from \"react-dom\";\nimport {reducers} from \"common/Reducers.jsm\";\n\nconst store = initStore(reducers, global.gActivityStreamPrerenderedState);\nconst asrouterContent = new ASRouterContent();\n\nnew DetectUserSessionStart(store).sendEventOrAddListener();\n\n// If we are starting in a prerendered state, we must wait until the first render\n// to request state rehydration (see Base.jsx). If we are NOT in a prerendered state,\n// we can request it immedately.\nif (!global.gActivityStreamPrerenderedState) {\n  store.dispatch(ac.AlsoToMain({type: at.NEW_TAB_STATE_REQUEST}));\n}\nenableASRouterContent(store, asrouterContent);\n\nReactDOM.hydrate(<Provider store={store}>\n  <Base\n    isPrerendered={!!global.gActivityStreamPrerenderedState}\n    locale={global.document.documentElement.lang}\n    strings={global.gActivityStreamStrings} />\n</Provider>, document.getElementById(\"root\"));\n\naddSnippetsSubscriber(store);\n","var g;\n\n// This works in non-strict mode\ng = (function() {\n\treturn this;\n})();\n\ntry {\n\t// This works if eval is allowed (see CSP)\n\tg = g || Function(\"return this\")() || (1, eval)(\"this\");\n} catch (e) {\n\t// This works if the window reference is available\n\tif (typeof window === \"object\") g = window;\n}\n\n// g can still be undefined, but nothing to do about it...\n// We return undefined, instead of nothing here, so it's\n// easier to handle this case. if(!global) { ...}\n\nmodule.exports = g;\n","/* This Source Code Form is subject to the terms of the Mozilla Public\n * License, v. 2.0. If a copy of the MPL was not distributed with this\n * file, You can obtain one at http://mozilla.org/MPL/2.0/. */\n\"use strict\";\n\nthis.MAIN_MESSAGE_TYPE = \"ActivityStream:Main\";\nthis.CONTENT_MESSAGE_TYPE = \"ActivityStream:Content\";\nthis.PRELOAD_MESSAGE_TYPE = \"ActivityStream:PreloadedBrowser\";\nthis.UI_CODE = 1;\nthis.BACKGROUND_PROCESS = 2;\n\n/**\n * globalImportContext - Are we in UI code (i.e. react, a dom) or some kind of background process?\n *                       Use this in action creators if you need different logic\n *                       for ui/background processes.\n */\nconst globalImportContext = typeof Window === \"undefined\" ? BACKGROUND_PROCESS : UI_CODE;\n// Export for tests\nthis.globalImportContext = globalImportContext;\n\n// Create an object that avoids accidental differing key/value pairs:\n// {\n//   INIT: \"INIT\",\n//   UNINIT: \"UNINIT\"\n// }\nconst actionTypes = {};\nfor (const type of [\n  \"ADDONS_INFO_REQUEST\",\n  \"ADDONS_INFO_RESPONSE\",\n  \"ARCHIVE_FROM_POCKET\",\n  \"AS_ROUTER_INITIALIZED\",\n  \"AS_ROUTER_PREF_CHANGED\",\n  \"AS_ROUTER_TELEMETRY_USER_EVENT\",\n  \"BLOCK_URL\",\n  \"BOOKMARK_URL\",\n  \"COPY_DOWNLOAD_LINK\",\n  \"DELETE_BOOKMARK_BY_ID\",\n  \"DELETE_FROM_POCKET\",\n  \"DELETE_HISTORY_URL\",\n  \"DIALOG_CANCEL\",\n  \"DIALOG_OPEN\",\n  \"DOWNLOAD_CHANGED\",\n  \"FILL_SEARCH_TERM\",\n  \"INIT\",\n  \"MIGRATION_CANCEL\",\n  \"MIGRATION_COMPLETED\",\n  \"MIGRATION_START\",\n  \"NEW_TAB_INIT\",\n  \"NEW_TAB_INITIAL_STATE\",\n  \"NEW_TAB_LOAD\",\n  \"NEW_TAB_REHYDRATED\",\n  \"NEW_TAB_STATE_REQUEST\",\n  \"NEW_TAB_UNLOAD\",\n  \"OPEN_DOWNLOAD_FILE\",\n  \"OPEN_LINK\",\n  \"OPEN_NEW_WINDOW\",\n  \"OPEN_PRIVATE_WINDOW\",\n  \"OPEN_WEBEXT_SETTINGS\",\n  \"PAGE_PRERENDERED\",\n  \"PLACES_BOOKMARK_ADDED\",\n  \"PLACES_BOOKMARK_REMOVED\",\n  \"PLACES_HISTORY_CLEARED\",\n  \"PLACES_LINKS_CHANGED\",\n  \"PLACES_LINK_BLOCKED\",\n  \"PLACES_LINK_DELETED\",\n  \"PLACES_SAVED_TO_POCKET\",\n  \"POCKET_CTA\",\n  \"POCKET_LOGGED_IN\",\n  \"POCKET_WAITING_FOR_SPOC\",\n  \"PREFS_INITIAL_VALUES\",\n  \"PREF_CHANGED\",\n  \"PREVIEW_REQUEST\",\n  \"PREVIEW_REQUEST_CANCEL\",\n  \"PREVIEW_RESPONSE\",\n  \"REMOVE_DOWNLOAD_FILE\",\n  \"RICH_ICON_MISSING\",\n  \"SAVE_SESSION_PERF_DATA\",\n  \"SAVE_TO_POCKET\",\n  \"SCREENSHOT_UPDATED\",\n  \"SECTION_DEREGISTER\",\n  \"SECTION_DISABLE\",\n  \"SECTION_ENABLE\",\n  \"SECTION_MOVE\",\n  \"SECTION_OPTIONS_CHANGED\",\n  \"SECTION_REGISTER\",\n  \"SECTION_UPDATE\",\n  \"SECTION_UPDATE_CARD\",\n  \"SETTINGS_CLOSE\",\n  \"SETTINGS_OPEN\",\n  \"SET_PREF\",\n  \"SHOW_DOWNLOAD_FILE\",\n  \"SHOW_FIREFOX_ACCOUNTS\",\n  \"SKIPPED_SIGNIN\",\n  \"SNIPPETS_BLOCKLIST_CLEARED\",\n  \"SNIPPETS_BLOCKLIST_UPDATED\",\n  \"SNIPPETS_DATA\",\n  \"SNIPPETS_PREVIEW_MODE\",\n  \"SNIPPETS_RESET\",\n  \"SNIPPET_BLOCKED\",\n  \"SUBMIT_EMAIL\",\n  \"SYSTEM_TICK\",\n  \"TELEMETRY_IMPRESSION_STATS\",\n  \"TELEMETRY_PERFORMANCE_EVENT\",\n  \"TELEMETRY_UNDESIRED_EVENT\",\n  \"TELEMETRY_USER_EVENT\",\n  \"TOP_SITES_CANCEL_EDIT\",\n  \"TOP_SITES_CLOSE_SEARCH_SHORTCUTS_MODAL\",\n  \"TOP_SITES_EDIT\",\n  \"TOP_SITES_INSERT\",\n  \"TOP_SITES_OPEN_SEARCH_SHORTCUTS_MODAL\",\n  \"TOP_SITES_PIN\",\n  \"TOP_SITES_PREFS_UPDATED\",\n  \"TOP_SITES_UNPIN\",\n  \"TOP_SITES_UPDATED\",\n  \"TOTAL_BOOKMARKS_REQUEST\",\n  \"TOTAL_BOOKMARKS_RESPONSE\",\n  \"UNINIT\",\n  \"UPDATE_PINNED_SEARCH_SHORTCUTS\",\n  \"UPDATE_SEARCH_SHORTCUTS\",\n  \"UPDATE_SECTION_PREFS\",\n  \"WEBEXT_CLICK\",\n  \"WEBEXT_DISMISS\",\n]) {\n  actionTypes[type] = type;\n}\n\n// These are acceptable actions for AS Router messages to have. They can show up\n// as call-to-action buttons in snippets, onboarding tour, etc.\nconst ASRouterActions = {};\nfor (const type of [\n  \"INSTALL_ADDON_FROM_URL\",\n  \"OPEN_APPLICATIONS_MENU\",\n  \"OPEN_PRIVATE_BROWSER_WINDOW\",\n  \"OPEN_URL\",\n  \"OPEN_ABOUT_PAGE\",\n  \"OPEN_PREFERENCES_PAGE\",\n  \"SHOW_FIREFOX_ACCOUNTS\",\n]) {\n  ASRouterActions[type] = type;\n}\n\n// Helper function for creating routed actions between content and main\n// Not intended to be used by consumers\nfunction _RouteMessage(action, options) {\n  const meta = action.meta ? {...action.meta} : {};\n  if (!options || !options.from || !options.to) {\n    throw new Error(\"Routed Messages must have options as the second parameter, and must at least include a .from and .to property.\");\n  }\n  // For each of these fields, if they are passed as an option,\n  // add them to the action. If they are not defined, remove them.\n  [\"from\", \"to\", \"toTarget\", \"fromTarget\", \"skipMain\", \"skipLocal\"].forEach(o => {\n    if (typeof options[o] !== \"undefined\") {\n      meta[o] = options[o];\n    } else if (meta[o]) {\n      delete meta[o];\n    }\n  });\n  return {...action, meta};\n}\n\n/**\n * AlsoToMain - Creates a message that will be dispatched locally and also sent to the Main process.\n *\n * @param  {object} action Any redux action (required)\n * @param  {object} options\n * @param  {bool}   skipLocal Used by OnlyToMain to skip the main reducer\n * @param  {string} fromTarget The id of the content port from which the action originated. (optional)\n * @return {object} An action with added .meta properties\n */\nfunction AlsoToMain(action, fromTarget, skipLocal) {\n  return _RouteMessage(action, {\n    from: CONTENT_MESSAGE_TYPE,\n    to: MAIN_MESSAGE_TYPE,\n    fromTarget,\n    skipLocal,\n  });\n}\n\n/**\n * OnlyToMain - Creates a message that will be sent to the Main process and skip the local reducer.\n *\n * @param  {object} action Any redux action (required)\n * @param  {object} options\n * @param  {string} fromTarget The id of the content port from which the action originated. (optional)\n * @return {object} An action with added .meta properties\n */\nfunction OnlyToMain(action, fromTarget) {\n  return AlsoToMain(action, fromTarget, true);\n}\n\n/**\n * BroadcastToContent - Creates a message that will be dispatched to main and sent to ALL content processes.\n *\n * @param  {object} action Any redux action (required)\n * @return {object} An action with added .meta properties\n */\nfunction BroadcastToContent(action) {\n  return _RouteMessage(action, {\n    from: MAIN_MESSAGE_TYPE,\n    to: CONTENT_MESSAGE_TYPE,\n  });\n}\n\n/**\n * AlsoToOneContent - Creates a message that will be will be dispatched to the main store\n *                    and also sent to a particular Content process.\n *\n * @param  {object} action Any redux action (required)\n * @param  {string} target The id of a content port\n * @param  {bool} skipMain Used by OnlyToOneContent to skip the main process\n * @return {object} An action with added .meta properties\n */\nfunction AlsoToOneContent(action, target, skipMain) {\n  if (!target) {\n    throw new Error(\"You must provide a target ID as the second parameter of AlsoToOneContent. If you want to send to all content processes, use BroadcastToContent\");\n  }\n  return _RouteMessage(action, {\n    from: MAIN_MESSAGE_TYPE,\n    to: CONTENT_MESSAGE_TYPE,\n    toTarget: target,\n    skipMain,\n  });\n}\n\n/**\n * OnlyToOneContent - Creates a message that will be sent to a particular Content process\n *                    and skip the main reducer.\n *\n * @param  {object} action Any redux action (required)\n * @param  {string} target The id of a content port\n * @return {object} An action with added .meta properties\n */\nfunction OnlyToOneContent(action, target) {\n  return AlsoToOneContent(action, target, true);\n}\n\n/**\n * AlsoToPreloaded - Creates a message that dispatched to the main reducer and also sent to the preloaded tab.\n *\n * @param  {object} action Any redux action (required)\n * @return {object} An action with added .meta properties\n */\nfunction AlsoToPreloaded(action) {\n  return _RouteMessage(action, {\n    from: MAIN_MESSAGE_TYPE,\n    to: PRELOAD_MESSAGE_TYPE,\n  });\n}\n\n/**\n * UserEvent - A telemetry ping indicating a user action. This should only\n *                   be sent from the UI during a user session.\n *\n * @param  {object} data Fields to include in the ping (source, etc.)\n * @return {object} An AlsoToMain action\n */\nfunction UserEvent(data) {\n  return AlsoToMain({\n    type: actionTypes.TELEMETRY_USER_EVENT,\n    data,\n  });\n}\n\n/**\n * ASRouterUserEvent - A telemetry ping indicating a user action from AS router. This should only\n *                     be sent from the UI during a user session.\n *\n * @param  {object} data Fields to include in the ping (source, etc.)\n * @return {object} An AlsoToMain action\n */\nfunction ASRouterUserEvent(data) {\n  return AlsoToMain({\n    type: actionTypes.AS_ROUTER_TELEMETRY_USER_EVENT,\n    data,\n  });\n}\n\n/**\n * UndesiredEvent - A telemetry ping indicating an undesired state.\n *\n * @param  {object} data Fields to include in the ping (value, etc.)\n * @param  {int} importContext (For testing) Override the import context for testing.\n * @return {object} An action. For UI code, a AlsoToMain action.\n */\nfunction UndesiredEvent(data, importContext = globalImportContext) {\n  const action = {\n    type: actionTypes.TELEMETRY_UNDESIRED_EVENT,\n    data,\n  };\n  return importContext === UI_CODE ? AlsoToMain(action) : action;\n}\n\n/**\n * PerfEvent - A telemetry ping indicating a performance-related event.\n *\n * @param  {object} data Fields to include in the ping (value, etc.)\n * @param  {int} importContext (For testing) Override the import context for testing.\n * @return {object} An action. For UI code, a AlsoToMain action.\n */\nfunction PerfEvent(data, importContext = globalImportContext) {\n  const action = {\n    type: actionTypes.TELEMETRY_PERFORMANCE_EVENT,\n    data,\n  };\n  return importContext === UI_CODE ? AlsoToMain(action) : action;\n}\n\n/**\n * ImpressionStats - A telemetry ping indicating an impression stats.\n *\n * @param  {object} data Fields to include in the ping\n * @param  {int} importContext (For testing) Override the import context for testing.\n * #return {object} An action. For UI code, a AlsoToMain action.\n */\nfunction ImpressionStats(data, importContext = globalImportContext) {\n  const action = {\n    type: actionTypes.TELEMETRY_IMPRESSION_STATS,\n    data,\n  };\n  return importContext === UI_CODE ? AlsoToMain(action) : action;\n}\n\nfunction SetPref(name, value, importContext = globalImportContext) {\n  const action = {type: actionTypes.SET_PREF, data: {name, value}};\n  return importContext === UI_CODE ? AlsoToMain(action) : action;\n}\n\nfunction WebExtEvent(type, data, importContext = globalImportContext) {\n  if (!data || !data.source) {\n    throw new Error(\"WebExtEvent actions should include a property \\\"source\\\", the id of the webextension that should receive the event.\");\n  }\n  const action = {type, data};\n  return importContext === UI_CODE ? AlsoToMain(action) : action;\n}\n\nthis.actionTypes = actionTypes;\nthis.ASRouterActions = ASRouterActions;\n\nthis.actionCreators = {\n  BroadcastToContent,\n  UserEvent,\n  ASRouterUserEvent,\n  UndesiredEvent,\n  PerfEvent,\n  ImpressionStats,\n  AlsoToOneContent,\n  OnlyToOneContent,\n  AlsoToMain,\n  OnlyToMain,\n  AlsoToPreloaded,\n  SetPref,\n  WebExtEvent,\n};\n\n// These are helpers to test for certain kinds of actions\nthis.actionUtils = {\n  isSendToMain(action) {\n    if (!action.meta) {\n      return false;\n    }\n    return action.meta.to === MAIN_MESSAGE_TYPE && action.meta.from === CONTENT_MESSAGE_TYPE;\n  },\n  isBroadcastToContent(action) {\n    if (!action.meta) {\n      return false;\n    }\n    if (action.meta.to === CONTENT_MESSAGE_TYPE && !action.meta.toTarget) {\n      return true;\n    }\n    return false;\n  },\n  isSendToOneContent(action) {\n    if (!action.meta) {\n      return false;\n    }\n    if (action.meta.to === CONTENT_MESSAGE_TYPE && action.meta.toTarget) {\n      return true;\n    }\n    return false;\n  },\n  isSendToPreloaded(action) {\n    if (!action.meta) {\n      return false;\n    }\n    return action.meta.to === PRELOAD_MESSAGE_TYPE &&\n      action.meta.from === MAIN_MESSAGE_TYPE;\n  },\n  isFromMain(action) {\n    if (!action.meta) {\n      return false;\n    }\n    return action.meta.from === MAIN_MESSAGE_TYPE &&\n      action.meta.to === CONTENT_MESSAGE_TYPE;\n  },\n  getPortIdOfSender(action) {\n    return (action.meta && action.meta.fromTarget) || null;\n  },\n  _RouteMessage,\n};\n\nconst EXPORTED_SYMBOLS = [\n  \"actionTypes\",\n  \"actionCreators\",\n  \"actionUtils\",\n  \"ASRouterActions\",\n  \"globalImportContext\",\n  \"UI_CODE\",\n  \"BACKGROUND_PROCESS\",\n  \"MAIN_MESSAGE_TYPE\",\n  \"CONTENT_MESSAGE_TYPE\",\n  \"PRELOAD_MESSAGE_TYPE\",\n];\n","const DATABASE_NAME = \"snippets_db\";\nconst DATABASE_VERSION = 1;\nconst SNIPPETS_OBJECTSTORE_NAME = \"snippets\";\nexport const SNIPPETS_UPDATE_INTERVAL_MS = 14400000; // 4 hours.\n\nconst SNIPPETS_ENABLED_EVENT = \"Snippets:Enabled\";\nconst SNIPPETS_DISABLED_EVENT = \"Snippets:Disabled\";\n\nimport {actionCreators as ac, actionTypes as at} from \"common/Actions.jsm\";\n\n/**\n * SnippetsMap - A utility for cacheing values related to the snippet. It has\n *               the same interface as a Map, but is optionally backed by\n *               indexedDB for persistent storage.\n *               Call .connect() to open a database connection and restore any\n *               previously cached data, if necessary.\n *\n */\nexport class SnippetsMap extends Map {\n  constructor(dispatch) {\n    super();\n    this._db = null;\n    this._dispatch = dispatch;\n  }\n\n  set(key, value) {\n    super.set(key, value);\n    return this._dbTransaction(db => db.put(value, key));\n  }\n\n  delete(key) {\n    super.delete(key);\n    return this._dbTransaction(db => db.delete(key));\n  }\n\n  clear() {\n    super.clear();\n    this._dispatch(ac.OnlyToMain({type: at.SNIPPETS_BLOCKLIST_CLEARED}));\n    return this._dbTransaction(db => db.clear());\n  }\n\n  get blockList() {\n    return this.get(\"blockList\") || [];\n  }\n\n  /**\n   * blockSnippetById - Blocks a snippet given an id\n   *\n   * @param  {str|int} id   The id of the snippet\n   * @return {Promise}      Resolves when the id has been written to indexedDB,\n   *                        or immediately if the snippetMap is not connected\n   */\n  async blockSnippetById(id) {\n    if (!id) {\n      return;\n    }\n    const {blockList} = this;\n    if (!blockList.includes(id)) {\n      blockList.push(id);\n      this._dispatch(ac.AlsoToMain({type: at.SNIPPETS_BLOCKLIST_UPDATED, data: id}));\n      await this.set(\"blockList\", blockList);\n    }\n  }\n\n  disableOnboarding() {}\n\n  showFirefoxAccounts() {\n    this._dispatch(ac.AlsoToMain({type: at.SHOW_FIREFOX_ACCOUNTS}));\n  }\n\n  getTotalBookmarksCount() {\n    return new Promise(resolve => {\n      this._dispatch(ac.OnlyToMain({type: at.TOTAL_BOOKMARKS_REQUEST}));\n      global.RPMAddMessageListener(\"ActivityStream:MainToContent\", function onMessage({data: action}) {\n        if (action.type === at.TOTAL_BOOKMARKS_RESPONSE) {\n          resolve(action.data);\n          global.RPMRemoveMessageListener(\"ActivityStream:MainToContent\", onMessage);\n        }\n      });\n    });\n  }\n\n  getAddonsInfo() {\n    return new Promise(resolve => {\n      this._dispatch(ac.OnlyToMain({type: at.ADDONS_INFO_REQUEST}));\n      global.RPMAddMessageListener(\"ActivityStream:MainToContent\", function onMessage({data: action}) {\n        if (action.type === at.ADDONS_INFO_RESPONSE) {\n          resolve(action.data);\n          global.RPMRemoveMessageListener(\"ActivityStream:MainToContent\", onMessage);\n        }\n      });\n    });\n  }\n\n  /**\n   * connect - Attaches an indexedDB back-end to the Map so that any set values\n   *           are also cached in a store. It also restores any existing values\n   *           that are already stored in the indexedDB store.\n   *\n   * @return {type}  description\n   */\n  async connect() {\n    // Open the connection\n    const db = await this._openDB();\n\n    // Restore any existing values\n    await this._restoreFromDb(db);\n\n    // Attach a reference to the db\n    this._db = db;\n  }\n\n  /**\n   * _dbTransaction - Returns a db transaction wrapped with the given modifier\n   *                  function as a Promise. If the db has not been connected,\n   *                  it resolves immediately.\n   *\n   * @param  {func} modifier A function to call with the transaction\n   * @return {obj}           A Promise that resolves when the transaction has\n   *                         completed or errored\n   */\n  _dbTransaction(modifier) {\n    if (!this._db) {\n      return Promise.resolve();\n    }\n    return new Promise((resolve, reject) => {\n      const transaction = modifier(\n        this._db\n          .transaction(SNIPPETS_OBJECTSTORE_NAME, \"readwrite\")\n          .objectStore(SNIPPETS_OBJECTSTORE_NAME)\n      );\n      transaction.onsuccess = event => resolve();\n\n      /* istanbul ignore next */\n      transaction.onerror = event => reject(transaction.error);\n    });\n  }\n\n  _openDB() {\n    return new Promise((resolve, reject) => {\n      const openRequest = indexedDB.open(DATABASE_NAME, DATABASE_VERSION);\n\n      /* istanbul ignore next */\n      openRequest.onerror = event => {\n        // Try to delete the old database so that we can start this process over\n        // next time.\n        indexedDB.deleteDatabase(DATABASE_NAME);\n        reject(event);\n      };\n\n      openRequest.onupgradeneeded = event => {\n        const db = event.target.result;\n        if (!db.objectStoreNames.contains(SNIPPETS_OBJECTSTORE_NAME)) {\n          db.createObjectStore(SNIPPETS_OBJECTSTORE_NAME);\n        }\n      };\n\n      openRequest.onsuccess = event => {\n        let db = event.target.result;\n\n        /* istanbul ignore next */\n        db.onerror = err => console.error(err); // eslint-disable-line no-console\n        /* istanbul ignore next */\n        db.onversionchange = versionChangeEvent => versionChangeEvent.target.close();\n\n        resolve(db);\n      };\n    });\n  }\n\n  _restoreFromDb(db) {\n    return new Promise((resolve, reject) => {\n      let cursorRequest;\n      try {\n        cursorRequest = db.transaction(SNIPPETS_OBJECTSTORE_NAME)\n          .objectStore(SNIPPETS_OBJECTSTORE_NAME).openCursor();\n      } catch (err) {\n        // istanbul ignore next\n        reject(err);\n        // istanbul ignore next\n        return;\n      }\n\n      /* istanbul ignore next */\n      cursorRequest.onerror = event => reject(event);\n\n      cursorRequest.onsuccess = event => {\n        let cursor = event.target.result;\n        // Populate the cache from the persistent storage.\n        if (cursor) {\n          if (cursor.value !== \"blockList\") {\n            this.set(cursor.key, cursor.value);\n          }\n          cursor.continue();\n        } else {\n          // We are done.\n          resolve();\n        }\n      };\n    });\n  }\n}\n\n/**\n * SnippetsProvider - Initializes a SnippetsMap and loads snippets from a\n *                    remote location, or else default snippets if the remote\n *                    snippets cannot be retrieved.\n */\nexport class SnippetsProvider {\n  constructor(dispatch) {\n    // Initialize the Snippets Map and attaches it to a global so that\n    // the snippet payload can interact with it.\n    global.gSnippetsMap = new SnippetsMap(dispatch);\n    this._onAction = this._onAction.bind(this);\n  }\n\n  get snippetsMap() {\n    return global.gSnippetsMap;\n  }\n\n  async _refreshSnippets() {\n    // Check if the cached version of of the snippets in snippetsMap. If it's too\n    // old, blow away the entire snippetsMap.\n    const cachedVersion = this.snippetsMap.get(\"snippets-cached-version\");\n\n    if (cachedVersion !== this.appData.version) {\n      this.snippetsMap.clear();\n    }\n\n    // Has enough time passed for us to require an update?\n    const lastUpdate = this.snippetsMap.get(\"snippets-last-update\");\n    const needsUpdate = !(lastUpdate >= 0) || Date.now() - lastUpdate > SNIPPETS_UPDATE_INTERVAL_MS;\n\n    if (needsUpdate && this.appData.snippetsURL) {\n      this.snippetsMap.set(\"snippets-last-update\", Date.now());\n      try {\n        const response = await fetch(this.appData.snippetsURL);\n        if (response.status === 200) {\n          const payload = await response.text();\n\n          this.snippetsMap.set(\"snippets\", payload);\n          this.snippetsMap.set(\"snippets-cached-version\", this.appData.version);\n        }\n      } catch (e) {\n        console.error(e); // eslint-disable-line no-console\n      }\n    }\n  }\n\n  _showRemoteSnippets() {\n    const snippetsEl = document.getElementById(this.elementId);\n    const payload = this.snippetsMap.get(\"snippets\");\n\n    if (!snippetsEl) {\n      throw new Error(`No element was found with id '${this.elementId}'.`);\n    }\n\n    // This could happen if fetching failed\n    if (!payload) {\n      throw new Error(\"No remote snippets were found in gSnippetsMap.\");\n    }\n\n    if (typeof payload !== \"string\") {\n      throw new Error(\"Snippet payload was incorrectly formatted\");\n    }\n\n    // Note that injecting snippets can throw if they're invalid XML.\n    // eslint-disable-next-line no-unsanitized/property\n    snippetsEl.innerHTML = payload;\n\n    this._logIfDevtools(\"Successfully added snippets.\");\n\n    // Scripts injected by innerHTML are inactive, so we have to relocate them\n    // through DOM manipulation to activate their contents.\n    for (const scriptEl of snippetsEl.getElementsByTagName(\"script\")) {\n      const relocatedScript = document.createElement(\"script\");\n      relocatedScript.text = scriptEl.text;\n      scriptEl.parentNode.replaceChild(relocatedScript, scriptEl);\n    }\n  }\n\n  _onAction(msg) {\n    if (msg.data.type === at.SNIPPET_BLOCKED) {\n      if (!this.snippetsMap.blockList.includes(msg.data.data)) {\n        this.snippetsMap.set(\"blockList\", this.snippetsMap.blockList.concat(msg.data.data));\n        document.getElementById(\"snippets-container\").style.display = \"none\";\n      }\n    }\n  }\n\n  // istanbul ignore next\n  _logIfDevtools(text) {\n    if (this.devtoolsEnabled) {\n      console.log(\"Legacy snippets:\", text); // eslint-disable-line no-console\n    }\n  }\n\n  /**\n   * init - Fetch the snippet payload and show snippets\n   *\n   * @param  {obj} options\n   * @param  {str} options.appData.snippetsURL  The URL from which we fetch snippets\n   * @param  {int} options.appData.version  The current snippets version\n   * @param  {str} options.elementId  The id of the element in which to inject snippets\n   * @param  {bool} options.connect  Should gSnippetsMap connect to indexedDB?\n   */\n  async init(options) {\n    Object.assign(this, {\n      appData: {},\n      elementId: \"snippets\",\n      connect: true,\n      devtoolsEnabled: false,\n    }, options);\n\n    this._logIfDevtools(\"Initializing...\");\n\n    // Add listener so we know when snippets are blocked on other pages\n    if (global.RPMAddMessageListener) {\n      global.RPMAddMessageListener(\"ActivityStream:MainToContent\", this._onAction);\n    }\n\n    // TODO: Requires enabling indexedDB on newtab\n    // Restore the snippets map from indexedDB\n    if (this.connect) {\n      try {\n        await this.snippetsMap.connect();\n      } catch (e) {\n        console.error(e); // eslint-disable-line no-console\n      }\n    }\n\n    // Cache app data values so they can be accessible from gSnippetsMap\n    for (const key of Object.keys(this.appData)) {\n      if (key === \"blockList\") {\n        this.snippetsMap.set(\"blockList\", this.appData[key]);\n      } else {\n        this.snippetsMap.set(`appData.${key}`, this.appData[key]);\n      }\n    }\n\n    // Refresh snippets, if enough time has passed.\n    await this._refreshSnippets();\n\n    // Try showing remote snippets, falling back to defaults if necessary.\n    try {\n      this._showRemoteSnippets();\n    } catch (e) {\n      this._logIfDevtools(\"Problem inserting remote snippets!\");\n      console.error(e); // eslint-disable-line no-console\n    }\n\n    window.dispatchEvent(new Event(SNIPPETS_ENABLED_EVENT));\n\n    this.initialized = true;\n    this._logIfDevtools(\"Finished initializing.\");\n  }\n\n  uninit() {\n    window.dispatchEvent(new Event(SNIPPETS_DISABLED_EVENT));\n    if (global.RPMRemoveMessageListener) {\n      global.RPMRemoveMessageListener(\"ActivityStream:MainToContent\", this._onAction);\n    }\n    this.initialized = false;\n  }\n}\n\n/**\n * addSnippetsSubscriber - Creates a SnippetsProvider that Initializes\n *                         when the store has received the appropriate\n *                         Snippet data.\n *\n * @param  {obj} store   The redux store\n * @return {obj}         Returns the snippets instance, asrouterContent instance and unsubscribe function\n */\nexport function addSnippetsSubscriber(store) {\n  const snippets = new SnippetsProvider(store.dispatch);\n\n  let initializing = false;\n\n  store.subscribe(async () => {\n    const state = store.getState();\n\n    /**\n     * Sorry this code is so complicated. It will be removed soon.\n     * This is what the different values actually mean:\n     *\n     * ASRouter.initialized                   Is ASRouter.jsm initialised?\n     * ASRouter.allowLegacySnippets           Are ASRouter snippets turned OFF (i.e. legacy snippets are allowed)\n     * state.Prefs.values[\"feeds.snippets\"]   User preference for snippets\n     * state.Snippets.initialized             Is SnippetsFeed.jsm initialised?\n     * snippets.initialized                   Is in-content snippets currently initialised?\n     * state.Prefs.values.disableSnippets     This pref is used to disable legacy snippets in an emergency\n     *                                        in a way that is not user-editable (true = disabled)\n     */\n\n    /** If we should initialize snippets... */\n    if (\n      state.Prefs.values[\"feeds.snippets\"] &&\n      state.ASRouter.initialized &&\n      state.ASRouter.allowLegacySnippets &&\n      !state.Prefs.values.disableSnippets &&\n      state.Snippets.initialized &&\n      !snippets.initialized &&\n      // Don't call init multiple times\n      !initializing &&\n      location.href !== \"about:welcome\" &&\n      location.hash !== \"#asrouter\"\n    ) {\n      initializing = true;\n      await snippets.init({appData: state.Snippets, devtoolsEnabled: state.Prefs.values[\"asrouter.devtoolsEnabled\"]});\n      initializing = false;\n\n    /** If we should remove snippets... */\n    } else if (\n      (\n        state.Prefs.values[\"feeds.snippets\"] === false ||\n        state.Prefs.values.disableSnippets === true ||\n        (state.ASRouter.initialized && !state.ASRouter.allowLegacySnippets)\n      ) &&\n      snippets.initialized\n    ) {\n      // Remove snippets\n      snippets.uninit();\n      // istanbul ignore if\n      if (state.Prefs.values[\"asrouter.devtoolsEnabled\"]) {\n        console.log(\"Legacy snippets removed\"); // eslint-disable-line no-console\n      }\n    }\n  });\n\n  // Returned for testing purposes\n  return {snippets};\n}\n","import {addLocaleData, IntlProvider} from \"react-intl\";\nimport {actionCreators as ac} from \"common/Actions.jsm\";\nimport {OUTGOING_MESSAGE_NAME as AS_GENERAL_OUTGOING_MESSAGE_NAME} from \"content-src/lib/init-store\";\nimport {generateMessages} from \"./rich-text-strings\";\nimport {ImpressionsWrapper} from \"./components/ImpressionsWrapper/ImpressionsWrapper\";\nimport {LocalizationProvider} from \"fluent-react\";\nimport {OnboardingMessage} from \"./templates/OnboardingMessage/OnboardingMessage\";\nimport React from \"react\";\nimport ReactDOM from \"react-dom\";\nimport {SnippetsTemplates} from \"./templates/template-manifest\";\nimport {StartupOverlay} from \"./templates/StartupOverlay/StartupOverlay\";\n\nconst INCOMING_MESSAGE_NAME = \"ASRouter:parent-to-child\";\nconst OUTGOING_MESSAGE_NAME = \"ASRouter:child-to-parent\";\nconst ASR_CONTAINER_ID = \"asr-newtab-container\";\n\nexport const ASRouterUtils = {\n  addListener(listener) {\n    global.RPMAddMessageListener(INCOMING_MESSAGE_NAME, listener);\n  },\n  removeListener(listener) {\n    global.RPMRemoveMessageListener(INCOMING_MESSAGE_NAME, listener);\n  },\n  sendMessage(action) {\n    global.RPMSendAsyncMessage(OUTGOING_MESSAGE_NAME, action);\n  },\n  blockById(id, options) {\n    ASRouterUtils.sendMessage({type: \"BLOCK_MESSAGE_BY_ID\", data: {id, ...options}});\n  },\n  dismissById(id) {\n    ASRouterUtils.sendMessage({type: \"DISMISS_MESSAGE_BY_ID\", data: {id}});\n  },\n  blockBundle(bundle) {\n    ASRouterUtils.sendMessage({type: \"BLOCK_BUNDLE\", data: {bundle}});\n  },\n  executeAction(button_action) {\n    ASRouterUtils.sendMessage({\n      type: \"USER_ACTION\",\n      data: button_action,\n    });\n  },\n  unblockById(id) {\n    ASRouterUtils.sendMessage({type: \"UNBLOCK_MESSAGE_BY_ID\", data: {id}});\n  },\n  unblockBundle(bundle) {\n    ASRouterUtils.sendMessage({type: \"UNBLOCK_BUNDLE\", data: {bundle}});\n  },\n  overrideMessage(id) {\n    ASRouterUtils.sendMessage({type: \"OVERRIDE_MESSAGE\", data: {id}});\n  },\n  sendTelemetry(ping) {\n    const payload = ac.ASRouterUserEvent(ping);\n    global.RPMSendAsyncMessage(AS_GENERAL_OUTGOING_MESSAGE_NAME, payload);\n  },\n  getPreviewEndpoint() {\n    if (window.location.href.includes(\"endpoint\")) {\n      const params = new URLSearchParams(window.location.href.slice(window.location.href.indexOf(\"endpoint\")));\n      try {\n        const endpoint = new URL(params.get(\"endpoint\"));\n        return {\n          url: endpoint.href,\n          snippetId: params.get(\"snippetId\"),\n        };\n      } catch (e) {}\n    }\n\n    return null;\n  },\n};\n\n// Note: nextProps/prevProps refer to props passed to <ImpressionsWrapper />, not <ASRouterUISurface />\nfunction shouldSendImpressionOnUpdate(nextProps, prevProps) {\n  return (nextProps.message.id && (!prevProps.message || prevProps.message.id !== nextProps.message.id));\n}\n\nexport class ASRouterUISurface extends React.PureComponent {\n  constructor(props) {\n    super(props);\n    this.onMessageFromParent = this.onMessageFromParent.bind(this);\n    this.sendClick = this.sendClick.bind(this);\n    this.sendImpression = this.sendImpression.bind(this);\n    this.sendUserActionTelemetry = this.sendUserActionTelemetry.bind(this);\n    this.state = {message: {}, bundle: {}};\n  }\n\n  sendUserActionTelemetry(extraProps = {}) {\n    const {message, bundle} = this.state;\n    if (!message && !extraProps.message_id) {\n      throw new Error(`You must provide a message_id for bundled messages`);\n    }\n    const eventType = `${message.provider || bundle.provider}_user_event`;\n    ASRouterUtils.sendTelemetry({\n      message_id: message.id || extraProps.message_id,\n      source: extraProps.id,\n      action: eventType,\n      ...extraProps,\n    });\n  }\n\n  sendImpression(extraProps) {\n    if (this.state.message.provider === \"preview\") {\n      return;\n    }\n\n    ASRouterUtils.sendMessage({type: \"IMPRESSION\", data: this.state.message});\n    this.sendUserActionTelemetry({event: \"IMPRESSION\", ...extraProps});\n  }\n\n  // If link has a `metric` data attribute send it as part of the `value`\n  // telemetry field which can have arbitrary values.\n  // Used for router messages with links as part of the content.\n  sendClick(event) {\n    const metric = {\n      value: event.target.dataset.metric,\n      // Used for the `source` of the event. Needed to differentiate\n      // from other snippet or onboarding events that may occur.\n      id: \"NEWTAB_FOOTER_BAR_CONTENT\",\n    };\n    const action = {\n      type: event.target.dataset.action,\n      data: {args: event.target.dataset.args},\n    };\n    if (action.type) {\n      ASRouterUtils.executeAction(action);\n    }\n    if (!this.state.message.content.do_not_autoblock && !event.target.dataset.do_not_autoblock) {\n      ASRouterUtils.blockById(this.state.message.id);\n    }\n    if (this.state.message.provider !== \"preview\") {\n      this.sendUserActionTelemetry({event: \"CLICK_BUTTON\", ...metric});\n    }\n  }\n\n  onBlockById(id) {\n    return options => ASRouterUtils.blockById(id, options);\n  }\n\n  onDismissById(id) {\n    return () => ASRouterUtils.dismissById(id);\n  }\n\n  clearBundle(bundle) {\n    return () => ASRouterUtils.blockBundle(bundle);\n  }\n\n  onMessageFromParent({data: action}) {\n    switch (action.type) {\n      case \"SET_MESSAGE\":\n        this.setState({message: action.data});\n        break;\n      case \"SET_BUNDLED_MESSAGES\":\n        this.setState({bundle: action.data});\n        break;\n      case \"CLEAR_MESSAGE\":\n        if (action.data.id === this.state.message.id) {\n          this.setState({message: {}});\n        }\n        break;\n      case \"CLEAR_PROVIDER\":\n        if (action.data.id === this.state.message.provider) {\n          this.setState({message: {}});\n        }\n        break;\n      case \"CLEAR_BUNDLE\":\n        if (this.state.bundle.bundle) {\n          this.setState({bundle: {}});\n        }\n        break;\n      case \"CLEAR_ALL\":\n        this.setState({message: {}, bundle: {}});\n    }\n  }\n\n  componentWillMount() {\n    // Add locale data for StartupOverlay because it uses react-intl\n    addLocaleData(global.document.documentElement.lang);\n\n    const endpoint = ASRouterUtils.getPreviewEndpoint();\n    ASRouterUtils.addListener(this.onMessageFromParent);\n\n    // If we are loading about:welcome we want to trigger the onboarding messages\n    if (this.props.document.location.href === \"about:welcome\") {\n      ASRouterUtils.sendMessage({type: \"TRIGGER\", data: {trigger: {id: \"firstRun\"}}});\n    } else {\n      ASRouterUtils.sendMessage({type: \"SNIPPETS_REQUEST\", data: {endpoint}});\n    }\n  }\n\n  componentDidMount() {\n    if (this.props.document.location.href === \"about:welcome\") {\n      // Trigger the onboarding overlay slightly after the startup overlay is mounted,\n      // to ensure we don't flash the onboarding content before hand\n      ASRouterUtils.sendMessage({type: \"TRIGGER\", data: {trigger: {id: \"showOnboarding\"}}});\n    }\n  }\n\n  componentWillUnmount() {\n    ASRouterUtils.removeListener(this.onMessageFromParent);\n  }\n\n  renderSnippets() {\n    if (this.state.bundle.template === \"onboarding\" ||\n        this.state.message.template === \"fxa_overlay\") {\n      return null;\n    }\n    const SnippetComponent = SnippetsTemplates[this.state.message.template];\n    const {content} = this.state.message;\n\n    return (\n      <ImpressionsWrapper\n        id=\"NEWTAB_FOOTER_BAR\"\n        message={this.state.message}\n        sendImpression={this.sendImpression}\n        shouldSendImpressionOnUpdate={shouldSendImpressionOnUpdate}\n        // This helps with testing\n        document={this.props.document}>\n          <LocalizationProvider messages={generateMessages(content)}>\n            <SnippetComponent\n              {...this.state.message}\n              UISurface=\"NEWTAB_FOOTER_BAR\"\n              onBlock={this.onBlockById(this.state.message.id)}\n              onDismiss={this.onDismissById(this.state.message.id)}\n              onAction={ASRouterUtils.executeAction}\n              sendClick={this.sendClick}\n              sendUserActionTelemetry={this.sendUserActionTelemetry} />\n          </LocalizationProvider>\n      </ImpressionsWrapper>);\n  }\n\n  renderOnboarding() {\n    if (this.state.bundle.template === \"onboarding\") {\n      return (\n        <OnboardingMessage\n          {...this.state.bundle}\n          UISurface=\"NEWTAB_OVERLAY\"\n          onAction={ASRouterUtils.executeAction}\n          onDoneButton={this.clearBundle(this.state.bundle.bundle)}\n          sendUserActionTelemetry={this.sendUserActionTelemetry} />);\n    }\n    return null;\n  }\n\n  renderFirstRunOverlay() {\n    if (this.state.message.template === \"fxa_overlay\") {\n      global.document.body.classList.add(\"welcome\", \"hide-main\");\n      return (\n        <IntlProvider locale={global.document.documentElement.lang} messages={global.gActivityStreamStrings}>\n          <StartupOverlay\n            onBlock={this.onBlockById(this.state.message.id)}\n            dispatch={this.props.activityStreamStore.dispatch}\n            store={this.props.activityStreamStore} />\n        </IntlProvider>\n      );\n    }\n    return null;\n  }\n\n  renderPreviewBanner() {\n    if (this.state.message.provider !== \"preview\") {\n      return null;\n    }\n\n    return (\n      <div className=\"snippets-preview-banner\">\n        <span className=\"icon icon-small-spacer icon-info\" />\n        <span>Preview Purposes Only</span>\n      </div>\n    );\n  }\n\n  render() {\n    const {message, bundle} = this.state;\n    if (!message.id && !bundle.template) { return null; }\n    return (\n      <React.Fragment>\n        {this.renderPreviewBanner()}\n        {this.renderFirstRunOverlay()}\n        {this.renderOnboarding()}\n        {this.renderSnippets()}\n      </React.Fragment>\n    );\n  }\n}\n\nASRouterUISurface.defaultProps = {document: global.document};\n\nexport class ASRouterContent {\n  constructor() {\n    this.initialized = false;\n    this.containerElement = null;\n  }\n\n  _mount() {\n    this.containerElement = global.document.getElementById(ASR_CONTAINER_ID);\n    if (!this.containerElement) {\n      this.containerElement = global.document.createElement(\"div\");\n      this.containerElement.id = ASR_CONTAINER_ID;\n      this.containerElement.style.zIndex = 1;\n      global.document.body.appendChild(this.containerElement);\n    }\n\n    ReactDOM.render(<ASRouterUISurface activityStreamStore={this._activityStreamStore} />, this.containerElement);\n  }\n\n  _unmount() {\n    ReactDOM.unmountComponentAtNode(this.containerElement);\n  }\n\n  init(store) {\n    this._activityStreamStore = store;\n    this._mount();\n    this.initialized = true;\n  }\n\n  uninit() {\n    if (this.initialized) {\n      this._unmount();\n      this.initialized = false;\n    }\n  }\n}\n","module.exports = ReactIntl;","/* eslint-env mozilla/frame-script */\n\nimport {actionCreators as ac, actionTypes as at, actionUtils as au} from \"common/Actions.jsm\";\nimport {applyMiddleware, combineReducers, createStore} from \"redux\";\n\nexport const MERGE_STORE_ACTION = \"NEW_TAB_INITIAL_STATE\";\nexport const OUTGOING_MESSAGE_NAME = \"ActivityStream:ContentToMain\";\nexport const INCOMING_MESSAGE_NAME = \"ActivityStream:MainToContent\";\nexport const EARLY_QUEUED_ACTIONS = [at.SAVE_SESSION_PERF_DATA, at.PAGE_PRERENDERED];\n\n/**\n * A higher-order function which returns a reducer that, on MERGE_STORE action,\n * will return the action.data object merged into the previous state.\n *\n * For all other actions, it merely calls mainReducer.\n *\n * Because we want this to merge the entire state object, it's written as a\n * higher order function which takes the main reducer (itself often a call to\n * combineReducers) as a parameter.\n *\n * @param  {function} mainReducer reducer to call if action != MERGE_STORE_ACTION\n * @return {function}             a reducer that, on MERGE_STORE_ACTION action,\n *                                will return the action.data object merged\n *                                into the previous state, and the result\n *                                of calling mainReducer otherwise.\n */\nfunction mergeStateReducer(mainReducer) {\n  return (prevState, action) => {\n    if (action.type === MERGE_STORE_ACTION) {\n      return {...prevState, ...action.data};\n    }\n\n    return mainReducer(prevState, action);\n  };\n}\n\n/**\n * messageMiddleware - Middleware that looks for SentToMain type actions, and sends them if necessary\n */\nconst messageMiddleware = store => next => action => {\n  const skipLocal = action.meta && action.meta.skipLocal;\n  if (au.isSendToMain(action)) {\n    RPMSendAsyncMessage(OUTGOING_MESSAGE_NAME, action);\n  }\n  if (!skipLocal) {\n    next(action);\n  }\n};\n\nexport const rehydrationMiddleware = store => next => action => {\n  if (store._didRehydrate) {\n    return next(action);\n  }\n\n  const isMergeStoreAction = action.type === MERGE_STORE_ACTION;\n  const isRehydrationRequest = action.type === at.NEW_TAB_STATE_REQUEST;\n\n  if (isRehydrationRequest) {\n    store._didRequestInitialState = true;\n    return next(action);\n  }\n\n  if (isMergeStoreAction) {\n    store._didRehydrate = true;\n    return next(action);\n  }\n\n  // If init happened after our request was made, we need to re-request\n  if (store._didRequestInitialState && action.type === at.INIT) {\n    return next(ac.AlsoToMain({type: at.NEW_TAB_STATE_REQUEST}));\n  }\n\n  if (au.isBroadcastToContent(action) || au.isSendToOneContent(action) || au.isSendToPreloaded(action)) {\n    // Note that actions received before didRehydrate will not be dispatched\n    // because this could negatively affect preloading and the the state\n    // will be replaced by rehydration anyway.\n    return null;\n  }\n\n  return next(action);\n};\n\n/**\n * This middleware queues up all the EARLY_QUEUED_ACTIONS until it receives\n * the first action from main. This is useful for those actions for main which\n * require higher reliability, i.e. the action will not be lost in the case\n * that it gets sent before the main is ready to receive it. Conversely, any\n * actions allowed early are accepted to be ignorable or re-sendable.\n */\nexport const queueEarlyMessageMiddleware = store => next => action => {\n  if (store._receivedFromMain) {\n    next(action);\n  } else if (au.isFromMain(action)) {\n    next(action);\n    store._receivedFromMain = true;\n    // Sending out all the early actions as main is ready now\n    if (store._earlyActionQueue) {\n      store._earlyActionQueue.forEach(next);\n      store._earlyActionQueue = [];\n    }\n  } else if (EARLY_QUEUED_ACTIONS.includes(action.type)) {\n    store._earlyActionQueue = store._earlyActionQueue || [];\n    store._earlyActionQueue.push(action);\n  } else {\n    // Let any other type of action go through\n    next(action);\n  }\n};\n\n/**\n * initStore - Create a store and listen for incoming actions\n *\n * @param  {object} reducers An object containing Redux reducers\n * @param  {object} intialState (optional) The initial state of the store, if desired\n * @return {object}          A redux store\n */\nexport function initStore(reducers, initialState) {\n  const store = createStore(\n    mergeStateReducer(combineReducers(reducers)),\n    initialState,\n    global.RPMAddMessageListener && applyMiddleware(rehydrationMiddleware, queueEarlyMessageMiddleware, messageMiddleware)\n  );\n\n  store._didRehydrate = false;\n  store._didRequestInitialState = false;\n\n  if (global.RPMAddMessageListener) {\n    global.RPMAddMessageListener(INCOMING_MESSAGE_NAME, msg => {\n      try {\n        store.dispatch(msg.data);\n      } catch (ex) {\n        console.error(\"Content msg:\", msg, \"Dispatch error: \", ex); // eslint-disable-line no-console\n        dump(`Content msg: ${JSON.stringify(msg)}\\nDispatch error: ${ex}\\n${ex.stack}`);\n      }\n    });\n  }\n\n  return store;\n}\n","module.exports = Redux;","import {MessageContext} from \"fluent\";\n\n/**\n * Properties that allow rich text MUST be added to this list.\n *   key: the localization_id that should be used\n *   value: a property or array of properties on the message.content object\n */\nconst RICH_TEXT_CONFIG = {\n  \"text\": [\"text\", \"scene1_text\"],\n  \"success_text\": \"success_text\",\n  \"error_text\": \"error_text\",\n  \"scene2_text\": \"scene2_text\",\n  \"privacy_html\": \"scene2_privacy_html\",\n  \"disclaimer_html\": \"scene2_disclaimer_html\",\n};\n\nexport const RICH_TEXT_KEYS = Object.keys(RICH_TEXT_CONFIG);\n\n/**\n * Generates an array of messages suitable for fluent's localization provider\n * including all needed strings for rich text.\n * @param {object} content A .content object from an ASR message (i.e. message.content)\n * @returns {MessageContext[]} A array containing the fluent message context\n */\nexport function generateMessages(content) {\n  const cx = new MessageContext(\"en-US\");\n\n  RICH_TEXT_KEYS.forEach(key => {\n    const attrs = RICH_TEXT_CONFIG[key];\n    const attrsToTry = Array.isArray(attrs) ? [...attrs] : [attrs];\n    let string = \"\";\n    while (!string && attrsToTry.length) {\n      const attr = attrsToTry.pop();\n      string = content[attr];\n    }\n    cx.addMessages(`${key} = ${string}`);\n  });\n  return [cx];\n}\n","import React from \"react\";\n\nexport const VISIBLE = \"visible\";\nexport const VISIBILITY_CHANGE_EVENT = \"visibilitychange\";\n\n/**\n * Component wrapper used to send telemetry pings on every impression.\n */\nexport class ImpressionsWrapper extends React.PureComponent {\n  // This sends an event when a user sees a set of new content. If content\n  // changes while the page is hidden (i.e. preloaded or on a hidden tab),\n  // only send the event if the page becomes visible again.\n  sendImpressionOrAddListener() {\n    if (this.props.document.visibilityState === VISIBLE) {\n      this.props.sendImpression({id: this.props.id});\n    } else {\n      // We should only ever send the latest impression stats ping, so remove any\n      // older listeners.\n      if (this._onVisibilityChange) {\n        this.props.document.removeEventListener(VISIBILITY_CHANGE_EVENT, this._onVisibilityChange);\n      }\n\n      // When the page becomes visible, send the impression stats ping if the section isn't collapsed.\n      this._onVisibilityChange = () => {\n        if (this.props.document.visibilityState === VISIBLE) {\n          this.props.sendImpression({id: this.props.id});\n          this.props.document.removeEventListener(VISIBILITY_CHANGE_EVENT, this._onVisibilityChange);\n        }\n      };\n      this.props.document.addEventListener(VISIBILITY_CHANGE_EVENT, this._onVisibilityChange);\n    }\n  }\n\n  componentWillUnmount() {\n    if (this._onVisibilityChange) {\n      this.props.document.removeEventListener(VISIBILITY_CHANGE_EVENT, this._onVisibilityChange);\n    }\n  }\n\n  componentDidMount() {\n    if (this.props.sendOnMount) {\n      this.sendImpressionOrAddListener();\n    }\n  }\n\n  componentDidUpdate(prevProps) {\n    if (this.props.shouldSendImpressionOnUpdate(this.props, prevProps)) {\n      this.sendImpressionOrAddListener();\n    }\n  }\n\n  render() {\n    return this.props.children;\n  }\n}\n\nImpressionsWrapper.defaultProps = {\n  document: global.document,\n  sendOnMount: true,\n};\n","module.exports = React;","module.exports = PropTypes;","import {ModalOverlay} from \"../../components/ModalOverlay/ModalOverlay\";\nimport React from \"react\";\n\nclass OnboardingCard extends React.PureComponent {\n  constructor(props) {\n    super(props);\n    this.onClick = this.onClick.bind(this);\n  }\n\n  onClick() {\n    const {props} = this;\n    const ping = {\n      event: \"CLICK_BUTTON\",\n      message_id: props.id,\n      id: props.UISurface,\n    };\n    props.sendUserActionTelemetry(ping);\n    props.onAction(props.content.button_action);\n  }\n\n  render() {\n    const {content} = this.props;\n    return (\n      <div className=\"onboardingMessage\">\n        <div className={`onboardingMessageImage ${content.icon}`} />\n        <div className=\"onboardingContent\">\n          <span>\n            <h3> {content.title} </h3>\n            <p> {content.text} </p>\n          </span>\n          <span>\n            <button tabIndex=\"1\" className=\"button onboardingButton\" onClick={this.onClick}> {content.button_label} </button>\n          </span>\n        </div>\n      </div>\n    );\n  }\n}\n\nexport class OnboardingMessage extends React.PureComponent {\n  render() {\n    const {props} = this;\n    const {button_label, header} = props.extraTemplateStrings;\n    return (\n      <ModalOverlay {...props} button_label={button_label} title={header}>\n        <div className=\"onboardingMessageContainer\">\n          {props.bundle.map(message => (\n            <OnboardingCard key={message.id}\n              sendUserActionTelemetry={props.sendUserActionTelemetry}\n              onAction={props.onAction}\n              UISurface={props.UISurface}\n              {...message} />\n          ))}\n        </div>\n      </ModalOverlay>\n    );\n  }\n}\n","import React from \"react\";\n\nexport class ModalOverlay extends React.PureComponent {\n  componentWillMount() {\n    this.setState({active: true});\n    document.body.classList.add(\"modal-open\");\n  }\n\n  componentWillUnmount() {\n    document.body.classList.remove(\"modal-open\");\n    this.setState({active: false});\n  }\n\n  render() {\n    const {active} = this.state;\n    const {title, button_label} = this.props;\n    return (\n      <div>\n        <div className={`modalOverlayOuter ${active ? \"active\" : \"\"}`} />\n        <div className={`modalOverlayInner ${active ? \"active\" : \"\"}`}>\n          <h2> {title} </h2>\n          {this.props.children}\n          <div className=\"footer\">\n            <button tabIndex=\"2\" onClick={this.props.onDoneButton} className=\"button primary modalButton\"> {button_label} </button>\n          </div>\n        </div>\n      </div>\n    );\n  }\n}\n","module.exports = ReactDOM;","import {actionCreators as ac, actionTypes as at} from \"common/Actions.jsm\";\nimport {FormattedMessage, injectIntl} from \"react-intl\";\nimport {connect} from \"react-redux\";\nimport React from \"react\";\n\nexport class _StartupOverlay extends React.PureComponent {\n  constructor(props) {\n    super(props);\n    this.onInputChange = this.onInputChange.bind(this);\n    this.onSubmit = this.onSubmit.bind(this);\n    this.clickSkip = this.clickSkip.bind(this);\n    this.initScene = this.initScene.bind(this);\n    this.removeOverlay = this.removeOverlay.bind(this);\n    this.onInputInvalid = this.onInputInvalid.bind(this);\n\n    this.state = {\n      emailInput: \"\",\n      overlayRemoved: false,\n      flowId: \"\",\n      flowBeginTime: 0,\n    };\n    this.didFetch = false;\n  }\n\n  async componentWillUpdate() {\n    if (this.props.fxa_endpoint && !this.didFetch) {\n      try {\n        this.didFetch = true;\n        const fxaParams = \"entrypoint=activity-stream-firstrun&utm_source=activity-stream&utm_campaign=firstrun&form_type=email\";\n        const response = await fetch(`${this.props.fxa_endpoint}/metrics-flow?${fxaParams}`);\n        if (response.status === 200) {\n          const {flowId, flowBeginTime} = await response.json();\n          this.setState({flowId, flowBeginTime});\n        } else {\n          this.props.dispatch(ac.OnlyToMain({type: at.TELEMETRY_UNDESIRED_EVENT, data: {event: \"FXA_METRICS_FETCH_ERROR\", value: response.status}}));\n        }\n      } catch (error) {\n        this.props.dispatch(ac.OnlyToMain({type: at.TELEMETRY_UNDESIRED_EVENT, data: {event: \"FXA_METRICS_ERROR\"}}));\n      }\n    }\n  }\n\n  componentDidMount() {\n    this.initScene();\n  }\n\n  initScene() {\n    // Timeout to allow the scene to render once before attaching the attribute\n    // to trigger the animation.\n    setTimeout(() => {\n      this.setState({show: true});\n    }, 10);\n  }\n\n  removeOverlay() {\n    window.removeEventListener(\"visibilitychange\", this.removeOverlay);\n    document.body.classList.remove(\"hide-main\");\n    this.setState({show: false});\n    this.props.onBlock();\n    setTimeout(() => {\n      // Allow scrolling and fully remove overlay after animation finishes.\n      document.body.classList.remove(\"welcome\");\n      this.setState({overlayRemoved: true});\n    }, 400);\n  }\n\n  onInputChange(e) {\n    let error = e.target.previousSibling;\n    this.setState({emailInput: e.target.value});\n    error.classList.remove(\"active\");\n    e.target.classList.remove(\"invalid\");\n  }\n\n  onSubmit() {\n    this.props.dispatch(ac.UserEvent({event: \"SUBMIT_EMAIL\", ...this._getFormInfo()}));\n\n    window.addEventListener(\"visibilitychange\", this.removeOverlay);\n  }\n\n  clickSkip() {\n    this.props.dispatch(ac.UserEvent({event: \"SKIPPED_SIGNIN\", ...this._getFormInfo()}));\n    this.removeOverlay();\n  }\n\n  /**\n   * Report to telemetry additional information about the form submission.\n   */\n  _getFormInfo() {\n    const value = {has_flow_params: this.state.flowId.length > 0};\n    return {value};\n  }\n\n  onInputInvalid(e) {\n    let error = e.target.previousSibling;\n    error.classList.add(\"active\");\n    e.target.classList.add(\"invalid\");\n    e.preventDefault(); // Override built-in form validation popup\n    e.target.focus();\n  }\n\n  render() {\n    // When skipping the onboarding tour we show AS but we are still on\n    // about:welcome, prop.isFirstrun is true and StartupOverlay is rendered\n    if (this.state.overlayRemoved) {\n      return null;\n    }\n\n    let termsLink = (<a href={`${this.props.fxa_endpoint}/legal/terms`} target=\"_blank\" rel=\"noopener noreferrer\"><FormattedMessage id=\"firstrun_terms_of_service\" /></a>);\n    let privacyLink = (<a href={`${this.props.fxa_endpoint}/legal/privacy`} target=\"_blank\" rel=\"noopener noreferrer\"><FormattedMessage id=\"firstrun_privacy_notice\" /></a>);\n\n    return (\n      <div className={`overlay-wrapper ${this.state.show ? \"show\" : \"\"}`}>\n        <div className=\"background\" />\n        <div className=\"firstrun-scene\">\n          <div className=\"fxaccounts-container\">\n            <div className=\"firstrun-left-divider\">\n              <h1 className=\"firstrun-title\"><FormattedMessage id=\"firstrun_title\" /></h1>\n              <p className=\"firstrun-content\"><FormattedMessage id=\"firstrun_content\" /></p>\n              <a className=\"firstrun-link\" href=\"https://www.mozilla.org/firefox/features/sync/\" target=\"_blank\" rel=\"noopener noreferrer\"><FormattedMessage id=\"firstrun_learn_more_link\" /></a>\n            </div>\n            <div className=\"firstrun-sign-in\">\n              <p className=\"form-header\"><FormattedMessage id=\"firstrun_form_header\" /><span className=\"sub-header\"><FormattedMessage id=\"firstrun_form_sub_header\" /></span></p>\n              <form method=\"get\" action={this.props.fxa_endpoint} target=\"_blank\" rel=\"noopener noreferrer\" onSubmit={this.onSubmit}>\n                <input name=\"service\" type=\"hidden\" value=\"sync\" />\n                <input name=\"action\" type=\"hidden\" value=\"email\" />\n                <input name=\"context\" type=\"hidden\" value=\"fx_desktop_v3\" />\n                <input name=\"entrypoint\" type=\"hidden\" value=\"activity-stream-firstrun\" />\n                <input name=\"utm_source\" type=\"hidden\" value=\"activity-stream\" />\n                <input name=\"utm_campaign\" type=\"hidden\" value=\"firstrun\" />\n                <input name=\"flow_id\" type=\"hidden\" value={this.state.flowId} />\n                <input name=\"flow_begin_time\" type=\"hidden\" value={this.state.flowBeginTime} />\n                <span className=\"error\">{this.props.intl.formatMessage({id: \"firstrun_invalid_input\"})}</span>\n                <input className=\"email-input\" name=\"email\" type=\"email\" required=\"true\" onInvalid={this.onInputInvalid} placeholder={this.props.intl.formatMessage({id: \"firstrun_email_input_placeholder\"})} onChange={this.onInputChange} />\n                <div className=\"extra-links\">\n                  <FormattedMessage\n                    id=\"firstrun_extra_legal_links\"\n                    values={{\n                      terms: termsLink,\n                      privacy: privacyLink,\n                    }} />\n                </div>\n                <button className=\"continue-button\" type=\"submit\"><FormattedMessage id=\"firstrun_continue_to_login\" /></button>\n              </form>\n              <button className=\"skip-button\" disabled={!!this.state.emailInput} onClick={this.clickSkip}><FormattedMessage id=\"firstrun_skip_login\" /></button>\n            </div>\n          </div>\n        </div>\n      </div>\n    );\n  }\n}\n\nconst getState = state => ({fxa_endpoint: state.Prefs.values.fxa_endpoint});\nexport const StartupOverlay = connect(getState)(injectIntl(_StartupOverlay));\n","module.exports = ReactRedux;","import {actionCreators as ac, actionTypes as at} from \"common/Actions.jsm\";\nimport {addLocaleData, injectIntl, IntlProvider} from \"react-intl\";\nimport {ASRouterAdmin} from \"content-src/components/ASRouterAdmin/ASRouterAdmin\";\nimport {ConfirmDialog} from \"content-src/components/ConfirmDialog/ConfirmDialog\";\nimport {connect} from \"react-redux\";\nimport {ErrorBoundary} from \"content-src/components/ErrorBoundary/ErrorBoundary\";\nimport {ManualMigration} from \"content-src/components/ManualMigration/ManualMigration\";\nimport {PrerenderData} from \"common/PrerenderData.jsm\";\nimport React from \"react\";\nimport {Search} from \"content-src/components/Search/Search\";\nimport {Sections} from \"content-src/components/Sections/Sections\";\n\nconst PrefsButton = injectIntl(props => (\n  <div className=\"prefs-button\">\n    <button className=\"icon icon-settings\" onClick={props.onClick} title={props.intl.formatMessage({id: \"settings_pane_button_label\"})} />\n  </div>\n));\n\n// Add the locale data for pluralization and relative-time formatting for now,\n// this just uses english locale data. We can make this more sophisticated if\n// more features are needed.\nfunction addLocaleDataForReactIntl(locale) {\n  addLocaleData([{locale, parentLocale: \"en\"}]);\n}\n\n// Returns a function will not be continuously triggered when called. The\n// function will be triggered if called again after `wait` milliseconds.\nfunction debounce(func, wait) {\n  let timer;\n  return (...args) => {\n    if (timer) { return; }\n\n    let wakeUp = () => { timer = null; };\n\n    timer = setTimeout(wakeUp, wait);\n    func.apply(this, args);\n  };\n}\n\nexport class _Base extends React.PureComponent {\n  componentWillMount() {\n    const {locale} = this.props;\n    addLocaleDataForReactIntl(locale);\n  }\n\n  componentDidMount() {\n    // Request state AFTER the first render to ensure we don't cause the\n    // prerendered DOM to be unmounted. Otherwise, NEW_TAB_STATE_REQUEST is\n    // dispatched right after the store is ready.\n    if (this.props.isPrerendered) {\n      this.props.dispatch(ac.AlsoToMain({type: at.NEW_TAB_STATE_REQUEST}));\n      this.props.dispatch(ac.AlsoToMain({type: at.PAGE_PRERENDERED}));\n    }\n  }\n\n  componentWillUnmount() {\n    this.updateTheme();\n  }\n\n  componentWillUpdate() {\n    this.updateTheme();\n  }\n\n  updateTheme() {\n    const bodyClassName = [\n      \"activity-stream\",\n      // If we skipped the about:welcome overlay and removed the CSS classes\n      // we don't want to add them back to the Activity Stream view\n      document.body.classList.contains(\"welcome\") ? \"welcome\" : \"\",\n      document.body.classList.contains(\"hide-main\") ? \"hide-main\" : \"\",\n    ].filter(v => v).join(\" \");\n    global.document.body.className = bodyClassName;\n  }\n\n  render() {\n    const {props} = this;\n    const {App, locale, strings} = props;\n    const {initialized} = App;\n\n    const prefs = props.Prefs.values;\n    if (prefs[\"asrouter.devtoolsEnabled\"]) {\n      if (window.location.hash === \"#asrouter\") {\n        return (<ASRouterAdmin />);\n      }\n      console.log(\"ASRouter devtools enabled. To access visit %cabout:newtab#asrouter\", \"font-weight: bold\"); // eslint-disable-line no-console\n    }\n\n    if (!props.isPrerendered && !initialized) {\n      return null;\n    }\n\n    return (<IntlProvider locale={locale} messages={strings}>\n        <ErrorBoundary className=\"base-content-fallback\">\n          <BaseContent {...this.props} />\n        </ErrorBoundary>\n      </IntlProvider>);\n  }\n}\n\nexport class BaseContent extends React.PureComponent {\n  constructor(props) {\n    super(props);\n    this.openPreferences = this.openPreferences.bind(this);\n    this.onWindowScroll = debounce(this.onWindowScroll.bind(this), 5);\n    this.state = {fixedSearch: false};\n  }\n\n  componentDidMount() {\n    global.addEventListener(\"scroll\", this.onWindowScroll);\n  }\n\n  componentWillUnmount() {\n    global.removeEventListener(\"scroll\", this.onWindowScroll);\n  }\n\n  onWindowScroll() {\n    const SCROLL_THRESHOLD = 34;\n    if (global.scrollY > SCROLL_THRESHOLD && !this.state.fixedSearch) {\n      this.setState({fixedSearch: true});\n    } else if (global.scrollY <= SCROLL_THRESHOLD && this.state.fixedSearch) {\n      this.setState({fixedSearch: false});\n    }\n  }\n\n  openPreferences() {\n    this.props.dispatch(ac.OnlyToMain({type: at.SETTINGS_OPEN}));\n    this.props.dispatch(ac.UserEvent({event: \"OPEN_NEWTAB_PREFS\"}));\n  }\n\n  render() {\n    const {props} = this;\n    const {App} = props;\n    const {initialized} = App;\n    const prefs = props.Prefs.values;\n\n    const shouldBeFixedToTop = PrerenderData.arePrefsValid(name => prefs[name]);\n    const noSectionsEnabled = !prefs[\"feeds.topsites\"] && props.Sections.filter(section => section.enabled).length === 0;\n\n    const outerClassName = [\n      \"outer-wrapper\",\n      shouldBeFixedToTop && \"fixed-to-top\",\n      prefs.showSearch && this.state.fixedSearch && !noSectionsEnabled && \"fixed-search\",\n      prefs.showSearch && noSectionsEnabled && \"only-search\",\n    ].filter(v => v).join(\" \");\n\n    return (\n      <div>\n        <div className={outerClassName}>\n          <main>\n            {prefs.showSearch &&\n              <div className=\"non-collapsible-section\">\n                <ErrorBoundary>\n                  <Search showLogo={noSectionsEnabled} />\n                </ErrorBoundary>\n              </div>\n            }\n            <div className={`body-wrapper${(initialized ? \" on\" : \"\")}`}>\n              {!prefs.migrationExpired &&\n                <div className=\"non-collapsible-section\">\n                  <ManualMigration />\n                </div>\n                }\n              <Sections />\n              <PrefsButton onClick={this.openPreferences} />\n            </div>\n            <ConfirmDialog />\n          </main>\n        </div>\n      </div>);\n  }\n}\n\nexport const Base = connect(state => ({App: state.App, Prefs: state.Prefs, Sections: state.Sections}))(_Base);\n","import {ASRouterUtils} from \"../../asrouter/asrouter-content\";\nimport {ModalOverlay} from \"../../asrouter/components/ModalOverlay/ModalOverlay\";\nimport React from \"react\";\n\nexport class ASRouterAdmin extends React.PureComponent {\n  constructor(props) {\n    super(props);\n    this.onMessage = this.onMessage.bind(this);\n    this.handleEnabledToggle = this.handleEnabledToggle.bind(this);\n    this.handleUserPrefToggle = this.handleUserPrefToggle.bind(this);\n    this.onChangeMessageFilter = this.onChangeMessageFilter.bind(this);\n    this.findOtherBundledMessagesOfSameTemplate = this.findOtherBundledMessagesOfSameTemplate.bind(this);\n    this.handleExpressionEval = this.handleExpressionEval.bind(this);\n    this.onChangeTargetingParameters = this.onChangeTargetingParameters.bind(this);\n    this.onCopyTargetingParams = this.onCopyTargetingParams.bind(this);\n    this.onPasteTargetingParams = this.onPasteTargetingParams.bind(this);\n    this.onNewTargetingParams = this.onNewTargetingParams.bind(this);\n    this.state = {\n      messageFilter: \"all\",\n      evaluationStatus: {},\n      stringTargetingParameters: null,\n      newStringTargetingParameters: null,\n      copiedToClipboard: false,\n      pasteFromClipboard: false,\n    };\n  }\n\n  onMessage({data: action}) {\n    if (action.type === \"ADMIN_SET_STATE\") {\n      this.setState(action.data);\n      if (!this.state.stringTargetingParameters) {\n        const stringTargetingParameters = {};\n        for (const param of Object.keys(action.data.targetingParameters)) {\n          stringTargetingParameters[param] = JSON.stringify(action.data.targetingParameters[param], null, 2);\n        }\n        this.setState({stringTargetingParameters});\n      }\n    }\n  }\n\n  componentWillMount() {\n    const endpoint = ASRouterUtils.getPreviewEndpoint();\n    ASRouterUtils.sendMessage({type: \"ADMIN_CONNECT_STATE\", data: {endpoint}});\n    ASRouterUtils.addListener(this.onMessage);\n  }\n\n  componentWillUnmount() {\n    ASRouterUtils.removeListener(this.onMessage);\n  }\n\n  findOtherBundledMessagesOfSameTemplate(template) {\n    return this.state.messages.filter(msg => msg.template === template && msg.bundled);\n  }\n\n  handleBlock(msg) {\n    if (msg.bundled) {\n      // If we are blocking a message that belongs to a bundle, block all other messages that are bundled of that same template\n      let bundle = this.findOtherBundledMessagesOfSameTemplate(msg.template);\n      return () => ASRouterUtils.blockBundle(bundle);\n    }\n    return () => ASRouterUtils.blockById(msg.id);\n  }\n\n  handleUnblock(msg) {\n    if (msg.bundled) {\n      // If we are unblocking a message that belongs to a bundle, unblock all other messages that are bundled of that same template\n      let bundle = this.findOtherBundledMessagesOfSameTemplate(msg.template);\n      return () => ASRouterUtils.unblockBundle(bundle);\n    }\n    return () => ASRouterUtils.unblockById(msg.id);\n  }\n\n  handleOverride(id) {\n    return () => ASRouterUtils.overrideMessage(id);\n  }\n\n  expireCache() {\n    ASRouterUtils.sendMessage({type: \"EXPIRE_QUERY_CACHE\"});\n  }\n\n  resetPref() {\n    ASRouterUtils.sendMessage({type: \"RESET_PROVIDER_PREF\"});\n  }\n\n  handleExpressionEval() {\n    const context = {};\n    for (const param of Object.keys(this.state.stringTargetingParameters)) {\n      const value = this.state.stringTargetingParameters[param];\n      context[param] = value ? JSON.parse(value) : null;\n    }\n    ASRouterUtils.sendMessage({\n      type: \"EVALUATE_JEXL_EXPRESSION\",\n      data: {\n        expression: this.refs.expressionInput.value,\n        context,\n      },\n    });\n  }\n\n  onChangeTargetingParameters(event) {\n    const {name} = event.target;\n    const {value} = event.target;\n\n    this.setState(({stringTargetingParameters}) => {\n      let targetingParametersError = null;\n      const updatedParameters = {...stringTargetingParameters};\n      updatedParameters[name] = value;\n      try {\n        JSON.parse(value);\n      } catch (e) {\n        console.log(`Error parsing value of parameter ${name}`); // eslint-disable-line no-console\n        targetingParametersError = {id: name};\n      }\n\n      return {\n        copiedToClipboard: false,\n        evaluationStatus: {},\n        stringTargetingParameters: updatedParameters,\n        targetingParametersError,\n      };\n    });\n  }\n\n  handleEnabledToggle(event) {\n    const provider = this.state.providerPrefs.find(p => p.id === event.target.dataset.provider);\n    const userPrefInfo = this.state.userPrefs;\n\n    const isUserEnabled = provider.id in userPrefInfo ? userPrefInfo[provider.id] : true;\n    const isSystemEnabled = provider.enabled;\n    const isEnabling = event.target.checked;\n\n    if (isEnabling) {\n      if (!isUserEnabled) {\n        ASRouterUtils.sendMessage({type: \"SET_PROVIDER_USER_PREF\", data: {id: provider.id, value: true}});\n      }\n      if (!isSystemEnabled) {\n        ASRouterUtils.sendMessage({type: \"ENABLE_PROVIDER\", data: provider.id});\n      }\n    } else {\n      ASRouterUtils.sendMessage({type: \"DISABLE_PROVIDER\", data: provider.id});\n    }\n\n    this.setState({messageFilter: \"all\"});\n  }\n\n  handleUserPrefToggle(event) {\n    const action = {type: \"SET_PROVIDER_USER_PREF\", data: {id: event.target.dataset.provider, value: event.target.checked}};\n    ASRouterUtils.sendMessage(action);\n    this.setState({messageFilter: \"all\"});\n  }\n\n  onChangeMessageFilter(event) {\n    this.setState({messageFilter: event.target.value});\n  }\n\n  // Simulate a copy event that sets to clipboard all targeting paramters and values\n  onCopyTargetingParams(event) {\n    const stringTargetingParameters = {...this.state.stringTargetingParameters};\n    for (const key of Object.keys(stringTargetingParameters)) {\n      // If the value is not set the parameter will be lost when we stringify\n      if (stringTargetingParameters[key] === undefined) {\n        stringTargetingParameters[key] = null;\n      }\n    }\n    const setClipboardData = e => {\n      e.preventDefault();\n      e.clipboardData.setData(\"text\", JSON.stringify(stringTargetingParameters, null, 2));\n      document.removeEventListener(\"copy\", setClipboardData);\n      this.setState({copiedToClipboard: true});\n    };\n\n    document.addEventListener(\"copy\", setClipboardData);\n\n    document.execCommand(\"copy\");\n  }\n\n  // Copy all clipboard data to targeting parameters\n  onPasteTargetingParams(event) {\n    this.setState(({pasteFromClipboard}) => ({\n      pasteFromClipboard: !pasteFromClipboard,\n      newStringTargetingParameters: \"\",\n    }));\n  }\n\n  onNewTargetingParams(event) {\n    this.setState({newStringTargetingParameters: event.target.value});\n    event.target.classList.remove(\"errorState\");\n    this.refs.targetingParamsEval.innerText = \"\";\n\n    try {\n      const stringTargetingParameters = JSON.parse(event.target.value);\n      this.setState({stringTargetingParameters});\n    } catch (e) {\n      event.target.classList.add(\"errorState\");\n      this.refs.targetingParamsEval.innerText = e.message;\n    }\n  }\n\n  renderMessageItem(msg) {\n    const isCurrent = msg.id === this.state.lastMessageId;\n    const isBlocked = this.state.messageBlockList.includes(msg.id) || this.state.messageBlockList.includes(msg.campaign);\n    const impressions = this.state.messageImpressions[msg.id] ? this.state.messageImpressions[msg.id].length : 0;\n\n    let itemClassName = \"message-item\";\n    if (isCurrent) { itemClassName += \" current\"; }\n    if (isBlocked) { itemClassName += \" blocked\"; }\n\n    return (<tr className={itemClassName} key={msg.id}>\n      <td className=\"message-id\"><span>{msg.id} <br /></span></td>\n      <td>\n        <button className={`button ${(isBlocked ? \"\" : \" primary\")}`} onClick={isBlocked ? this.handleUnblock(msg) : this.handleBlock(msg)}>{isBlocked ? \"Unblock\" : \"Block\"}</button>\n       {isBlocked ? null : <button className=\"button\" onClick={this.handleOverride(msg.id)}>Show</button>}\n       <br />({impressions} impressions)\n      </td>\n      <td className=\"message-summary\">\n        <pre>{JSON.stringify(msg, null, 2)}</pre>\n      </td>\n    </tr>);\n  }\n\n  renderMessages() {\n    if (!this.state.messages) {\n      return null;\n    }\n    const messagesToShow = this.state.messageFilter === \"all\" ? this.state.messages : this.state.messages.filter(message => message.provider === this.state.messageFilter);\n    return (<table><tbody>\n      {messagesToShow.map(msg => this.renderMessageItem(msg))}\n    </tbody></table>);\n  }\n\n  renderMessageFilter() {\n    if (!this.state.providers) {\n      return null;\n    }\n    return (<p>Show messages from <select value={this.state.messageFilter} onChange={this.onChangeMessageFilter}>\n      <option value=\"all\">all providers</option>\n      {this.state.providers.map(provider => (<option key={provider.id} value={provider.id}>{provider.id}</option>))}\n    </select></p>);\n  }\n\n  renderTableHead() {\n    return (<thead>\n      <tr className=\"message-item\">\n        <td className=\"min\" />\n        <td className=\"min\">Provider ID</td>\n        <td>Source</td>\n        <td className=\"min\">Cohort</td>\n        <td className=\"min\">Last Updated</td>\n      </tr>\n    </thead>);\n  }\n\n  renderProviders() {\n    const providersConfig = this.state.providerPrefs;\n    const providerInfo = this.state.providers;\n    const userPrefInfo = this.state.userPrefs;\n\n    return (<table>{this.renderTableHead()}<tbody>\n      {providersConfig.map((provider, i) => {\n        const isTestProvider = provider.id === \"snippets_local_testing\";\n        const info = providerInfo.find(p => p.id === provider.id) || {};\n        const isUserEnabled = provider.id in userPrefInfo ? userPrefInfo[provider.id] : true;\n        const isSystemEnabled = (isTestProvider || provider.enabled);\n\n        let label = \"local\";\n        if (provider.type === \"remote\") {\n          label = (<span>endpoint (<a className=\"providerUrl\" target=\"_blank\" href={info.url}>{info.url}</a>)</span>);\n        } else if (provider.type === \"remote-settings\") {\n          label = `remote settings (${provider.bucket})`;\n        }\n\n        let reasonsDisabled = [];\n        if (!isSystemEnabled) {\n          reasonsDisabled.push(\"system pref\");\n        }\n        if (!isUserEnabled) {\n          reasonsDisabled.push(\"user pref\");\n        }\n        if (reasonsDisabled.length) {\n          label = `disabled via ${reasonsDisabled.join(\", \")}`;\n        }\n\n        return (<tr className=\"message-item\" key={i}>\n\n          <td>{isTestProvider ? <input type=\"checkbox\" disabled={true} readOnly={true} checked={true} /> : <input type=\"checkbox\" data-provider={provider.id} checked={isUserEnabled && isSystemEnabled} onChange={this.handleEnabledToggle} />}</td>\n          <td>{provider.id}</td>\n          <td><span className={`sourceLabel${(isUserEnabled && isSystemEnabled) ? \"\" : \" isDisabled\"}`}>{label}</span></td>\n          <td>{provider.cohort}</td>\n          <td style={{whiteSpace: \"nowrap\"}}>{info.lastUpdated ? new Date(info.lastUpdated).toLocaleString() : \"\"}</td>\n        </tr>);\n      })}\n    </tbody></table>);\n  }\n\n  renderPasteModal() {\n    if (!this.state.pasteFromClipboard) {\n      return null;\n    }\n    const errors = this.refs.targetingParamsEval && this.refs.targetingParamsEval.innerText.length;\n    return (\n      <ModalOverlay title=\"New targeting parameters\" button_label={errors ? \"Cancel\" : \"Done\"} onDoneButton={this.onPasteTargetingParams}>\n        <div className=\"onboardingMessage\">\n          <p>\n            <textarea onChange={this.onNewTargetingParams} value={this.state.newStringTargetingParameters} autoFocus={true} rows=\"20\" cols=\"60\" />\n          </p>\n          <p ref=\"targetingParamsEval\" />\n        </div>\n      </ModalOverlay>\n    );\n  }\n\n  renderTargetingParameters() {\n    // There was no error and the result is truthy\n    const success = this.state.evaluationStatus.success && !!this.state.evaluationStatus.result;\n    const result = JSON.stringify(this.state.evaluationStatus.result, null, 2) || \"(Empty result)\";\n\n    return (<table><tbody>\n      <tr><td><h2>Evaluate JEXL expression</h2></td></tr>\n      <tr>\n        <td>\n          <p><textarea ref=\"expressionInput\" rows=\"10\" cols=\"60\" placeholder=\"Evaluate JEXL expressions and mock parameters by changing their values below\" /></p>\n          <p>Status: <span ref=\"evaluationStatus\">{success ? \"✅\" : \"❌\"}, Result: {result}</span></p>\n        </td>\n        <td>\n           <button className=\"ASRouterButton secondary\" onClick={this.handleExpressionEval}>Evaluate</button>\n        </td>\n      </tr>\n      <tr><td><h2>Modify targeting parameters</h2></td></tr>\n      <tr>\n        <td>\n          <button className=\"ASRouterButton secondary\" onClick={this.onCopyTargetingParams} disabled={this.state.copiedToClipboard}>\n            {this.state.copiedToClipboard ? \"Parameters copied!\" : \"Copy parameters\"}\n          </button>\n          <button className=\"ASRouterButton secondary\" onClick={this.onPasteTargetingParams} disabled={this.state.pasteFromClipboard}>\n            Paste parameters\n          </button>\n        </td>\n      </tr>\n      {this.state.stringTargetingParameters && Object.keys(this.state.stringTargetingParameters).map((param, i) => {\n        const value = this.state.stringTargetingParameters[param];\n        const errorState = this.state.targetingParametersError && this.state.targetingParametersError.id === param;\n        const className = errorState ? \"errorState\" : \"\";\n        const inputComp = (value && value.length) > 30 ?\n          <textarea name={param} className={className} value={value} rows=\"10\" cols=\"60\" onChange={this.onChangeTargetingParameters} /> :\n          <input name={param} className={className} value={value} onChange={this.onChangeTargetingParameters} />;\n\n        return (<tr key={i}>\n          <td>{param}</td>\n          <td>{inputComp}</td>\n          </tr>);\n      })}\n      </tbody></table>);\n  }\n\n  render() {\n    return (<div className=\"asrouter-admin outer-wrapper\">\n      <h1>AS Router Admin</h1>\n      <h2>Targeting Utilities</h2>\n      <button className=\"button\" onClick={this.expireCache}>Expire Cache</button> (This expires the cache in ASR Targeting for bookmarks and top sites)\n      <h2>Message Providers <button title=\"Restore all provider settings that ship with Firefox\" className=\"button\" onClick={this.resetPref}>Restore default prefs</button></h2>\n\n      {this.state.providers ? this.renderProviders() : null}\n      <h2>Messages</h2>\n      {this.renderMessageFilter()}\n      {this.renderMessages()}\n      {this.renderPasteModal()}\n      {this.renderTargetingParameters()}\n    </div>);\n  }\n}\n","import {actionCreators as ac, actionTypes} from \"common/Actions.jsm\";\nimport {connect} from \"react-redux\";\nimport {FormattedMessage} from \"react-intl\";\nimport React from \"react\";\n\n/**\n * ConfirmDialog component.\n * One primary action button, one cancel button.\n *\n * Content displayed is controlled by `data` prop the component receives.\n * Example:\n * data: {\n *   // Any sort of data needed to be passed around by actions.\n *   payload: site.url,\n *   // Primary button AlsoToMain action.\n *   action: \"DELETE_HISTORY_URL\",\n *   // Primary button USerEvent action.\n *   userEvent: \"DELETE\",\n *   // Array of locale ids to display.\n *   message_body: [\"confirm_history_delete_p1\", \"confirm_history_delete_notice_p2\"],\n *   // Text for primary button.\n *   confirm_button_string_id: \"menu_action_delete\"\n * },\n */\nexport class _ConfirmDialog extends React.PureComponent {\n  constructor(props) {\n    super(props);\n    this._handleCancelBtn = this._handleCancelBtn.bind(this);\n    this._handleConfirmBtn = this._handleConfirmBtn.bind(this);\n  }\n\n  _handleCancelBtn() {\n    this.props.dispatch({type: actionTypes.DIALOG_CANCEL});\n    this.props.dispatch(ac.UserEvent({event: actionTypes.DIALOG_CANCEL, source: this.props.data.eventSource}));\n  }\n\n  _handleConfirmBtn() {\n    this.props.data.onConfirm.forEach(this.props.dispatch);\n  }\n\n  _renderModalMessage() {\n    const message_body = this.props.data.body_string_id;\n\n    if (!message_body) {\n      return null;\n    }\n\n    return (<span>\n      {message_body.map(msg => <p key={msg}><FormattedMessage id={msg} /></p>)}\n    </span>);\n  }\n\n  render() {\n    if (!this.props.visible) {\n      return null;\n    }\n\n    return (<div className=\"confirmation-dialog\">\n      <div className=\"modal-overlay\" onClick={this._handleCancelBtn} />\n      <div className=\"modal\">\n        <section className=\"modal-message\">\n          {this.props.data.icon && <span className={`icon icon-spacer icon-${this.props.data.icon}`} />}\n          {this._renderModalMessage()}\n        </section>\n        <section className=\"actions\">\n          <button onClick={this._handleCancelBtn}>\n            <FormattedMessage id={this.props.data.cancel_button_string_id} />\n          </button>\n          <button className=\"done\" onClick={this._handleConfirmBtn}>\n            <FormattedMessage id={this.props.data.confirm_button_string_id} />\n          </button>\n        </section>\n      </div>\n    </div>);\n  }\n}\n\nexport const ConfirmDialog = connect(state => state.Dialog)(_ConfirmDialog);\n","import {FormattedMessage} from \"react-intl\";\nimport React from \"react\";\n\nexport class ErrorBoundaryFallback extends React.PureComponent {\n  constructor(props) {\n    super(props);\n    this.windowObj = this.props.windowObj || window;\n    this.onClick = this.onClick.bind(this);\n  }\n\n  /**\n   * Since we only get here if part of the page has crashed, do a\n   * forced reload to give us the best chance at recovering.\n   */\n  onClick() {\n    this.windowObj.location.reload(true);\n  }\n\n  render() {\n    const defaultClass = \"as-error-fallback\";\n    let className;\n    if (\"className\" in this.props) {\n      className = `${this.props.className} ${defaultClass}`;\n    } else {\n      className = defaultClass;\n    }\n\n    // href=\"#\" to force normal link styling stuff (eg cursor on hover)\n    return (\n      <div className={className}>\n        <div>\n          <FormattedMessage\n            defaultMessage=\"Oops, something went wrong loading this content.\"\n            id=\"error_fallback_default_info\" />\n        </div>\n        <span>\n          <a href=\"#\" className=\"reload-button\" onClick={this.onClick}>\n            <FormattedMessage\n              defaultMessage=\"Refresh page to try again.\"\n              id=\"error_fallback_default_refresh_suggestion\" />\n          </a>\n        </span>\n      </div>\n    );\n  }\n}\nErrorBoundaryFallback.defaultProps = {className: \"as-error-fallback\"};\n\nexport class ErrorBoundary extends React.PureComponent {\n  constructor(props) {\n    super(props);\n    this.state = {hasError: false};\n  }\n\n  componentDidCatch(error, info) {\n    this.setState({hasError: true});\n  }\n\n  render() {\n    if (!this.state.hasError) {\n      return (this.props.children);\n    }\n\n    return <this.props.FallbackComponent className={this.props.className} />;\n  }\n}\n\nErrorBoundary.defaultProps = {FallbackComponent: ErrorBoundaryFallback};\n","import {actionCreators as ac, actionTypes as at} from \"common/Actions.jsm\";\nimport {connect} from \"react-redux\";\nimport {FormattedMessage} from \"react-intl\";\nimport React from \"react\";\n\n/**\n * Manual migration component used to start the profile import wizard.\n * Message is presented temporarily and will go away if:\n * 1.  User clicks \"No Thanks\"\n * 2.  User completed the data import\n * 3.  After 3 active days\n * 4.  User clicks \"Cancel\" on the import wizard (currently not implemented).\n */\nexport class _ManualMigration extends React.PureComponent {\n  constructor(props) {\n    super(props);\n    this.onLaunchTour = this.onLaunchTour.bind(this);\n    this.onCancelTour = this.onCancelTour.bind(this);\n  }\n\n  onLaunchTour() {\n    this.props.dispatch(ac.AlsoToMain({type: at.MIGRATION_START}));\n    this.props.dispatch(ac.UserEvent({event: at.MIGRATION_START}));\n  }\n\n  onCancelTour() {\n    this.props.dispatch(ac.AlsoToMain({type: at.MIGRATION_CANCEL}));\n    this.props.dispatch(ac.UserEvent({event: at.MIGRATION_CANCEL}));\n  }\n\n  render() {\n    return (<div className=\"manual-migration-container\">\n        <p>\n          <span className=\"icon icon-import\" />\n          <FormattedMessage id=\"manual_migration_explanation2\" />\n        </p>\n        <div className=\"manual-migration-actions actions\">\n          <button className=\"dismiss\" onClick={this.onCancelTour}>\n            <FormattedMessage id=\"manual_migration_cancel_button\" />\n          </button>\n          <button onClick={this.onLaunchTour}>\n            <FormattedMessage id=\"manual_migration_import_button\" />\n          </button>\n        </div>\n    </div>);\n  }\n}\n\nexport const ManualMigration = connect()(_ManualMigration);\n","class _PrerenderData {\n  constructor(options) {\n    this.initialPrefs = options.initialPrefs;\n    this.initialSections = options.initialSections;\n    this._setValidation(options.validation);\n  }\n\n  get validation() {\n    return this._validation;\n  }\n\n  set validation(value) {\n    this._setValidation(value);\n  }\n\n  get invalidatingPrefs() {\n    return this._invalidatingPrefs;\n  }\n\n    // This is needed so we can use it in the constructor\n  _setValidation(value = []) {\n    this._validation = value;\n    this._invalidatingPrefs = value.reduce((result, next) => {\n      if (typeof next === \"string\") {\n        result.push(next);\n        return result;\n      } else if (next && next.oneOf) {\n        return result.concat(next.oneOf);\n      } else if (next && next.indexedDB) {\n        return result.concat(next.indexedDB);\n      }\n      throw new Error(\"Your validation configuration is not properly configured\");\n    }, []);\n  }\n\n  arePrefsValid(getPref, indexedDBPrefs) {\n    for (const prefs of this.validation) {\n      // {oneOf: [\"foo\", \"bar\"]}\n      if (prefs && prefs.oneOf && !prefs.oneOf.some(name => getPref(name) === this.initialPrefs[name])) {\n        return false;\n\n        // {indexedDB: [\"foo\", \"bar\"]}\n      } else if (indexedDBPrefs && prefs && prefs.indexedDB) {\n        const anyModifiedPrefs = prefs.indexedDB.some(prefName => indexedDBPrefs.some(pref => pref && pref[prefName]));\n        if (anyModifiedPrefs) {\n          return false;\n        }\n        // \"foo\"\n      } else if (getPref(prefs) !== this.initialPrefs[prefs]) {\n        return false;\n      }\n    }\n    return true;\n  }\n}\n\nthis.PrerenderData = new _PrerenderData({\n  initialPrefs: {\n    \"migrationExpired\": true,\n    \"feeds.topsites\": true,\n    \"showSearch\": true,\n    \"topSitesRows\": 1,\n    \"feeds.section.topstories\": true,\n    \"feeds.section.highlights\": true,\n    \"sectionOrder\": \"topsites,topstories,highlights\",\n    \"collapsed\": false,\n  },\n  // Prefs listed as invalidating will prevent the prerendered version\n  // of AS from being used if their value is something other than what is listed\n  // here. This is required because some preferences cause the page layout to be\n  // too different for the prerendered version to be used. Unfortunately, this\n  // will result in users who have modified some of their preferences not being\n  // able to get the benefits of prerendering.\n  validation: [\n    \"feeds.topsites\",\n    \"showSearch\",\n    \"topSitesRows\",\n    \"sectionOrder\",\n    // This means if either of these are set to their default values,\n    // prerendering can be used.\n    {oneOf: [\"feeds.section.topstories\", \"feeds.section.highlights\"]},\n    // If any component has the following preference set to `true` it will\n    // invalidate the prerendered version.\n    {indexedDB: [\"collapsed\"]},\n  ],\n  initialSections: [\n    {\n      enabled: true,\n      icon: \"pocket\",\n      id: \"topstories\",\n      order: 1,\n      title: {id: \"header_recommended_by\", values: {provider: \"Pocket\"}},\n    },\n    {\n      enabled: true,\n      id: \"highlights\",\n      icon: \"highlights\",\n      order: 2,\n      title: {id: \"header_highlights\"},\n    },\n  ],\n});\n\nthis._PrerenderData = _PrerenderData;\nconst EXPORTED_SYMBOLS = [\"PrerenderData\", \"_PrerenderData\"];\n","/* globals ContentSearchUIController */\n\"use strict\";\n\nimport {FormattedMessage, injectIntl} from \"react-intl\";\nimport {actionCreators as ac} from \"common/Actions.jsm\";\nimport {connect} from \"react-redux\";\nimport {IS_NEWTAB} from \"content-src/lib/constants\";\nimport React from \"react\";\n\nexport class _Search extends React.PureComponent {\n  constructor(props) {\n    super(props);\n    this.onClick = this.onClick.bind(this);\n    this.onInputMount = this.onInputMount.bind(this);\n  }\n\n  handleEvent(event) {\n    // Also track search events with our own telemetry\n    if (event.detail.type === \"Search\") {\n      this.props.dispatch(ac.UserEvent({event: \"SEARCH\"}));\n    }\n  }\n\n  onClick(event) {\n    window.gContentSearchController.search(event);\n  }\n\n  componentWillUnmount() {\n    delete window.gContentSearchController;\n  }\n\n  onInputMount(input) {\n    if (input) {\n      // The \"healthReportKey\" and needs to be \"newtab\" or \"abouthome\" so that\n      // BrowserUsageTelemetry.jsm knows to handle events with this name, and\n      // can add the appropriate telemetry probes for search. Without the correct\n      // name, certain tests like browser_UsageTelemetry_content.js will fail\n      // (See github ticket #2348 for more details)\n      const healthReportKey = IS_NEWTAB ? \"newtab\" : \"abouthome\";\n\n      // The \"searchSource\" needs to be \"newtab\" or \"homepage\" and is sent with\n      // the search data and acts as context for the search request (See\n      // nsISearchEngine.getSubmission). It is necessary so that search engine\n      // plugins can correctly atribute referrals. (See github ticket #3321 for\n      // more details)\n      const searchSource = IS_NEWTAB ? \"newtab\" : \"homepage\";\n\n      // gContentSearchController needs to exist as a global so that tests for\n      // the existing about:home can find it; and so it allows these tests to pass.\n      // In the future, when activity stream is default about:home, this can be renamed\n      window.gContentSearchController = new ContentSearchUIController(input, input.parentNode,\n        healthReportKey, searchSource);\n      addEventListener(\"ContentSearchClient\", this);\n    } else {\n      window.gContentSearchController = null;\n      removeEventListener(\"ContentSearchClient\", this);\n    }\n  }\n\n  /*\n   * Do not change the ID on the input field, as legacy newtab code\n   * specifically looks for the id 'newtab-search-text' on input fields\n   * in order to execute searches in various tests\n   */\n  render() {\n    return (<div className=\"search-wrapper\">\n      {this.props.showLogo &&\n        <div className=\"logo-and-wordmark\">\n          <div className=\"logo\" />\n          <div className=\"wordmark\" />\n        </div>\n      }\n      <div className=\"search-inner-wrapper\">\n        <label htmlFor=\"newtab-search-text\" className=\"search-label\">\n          <span className=\"sr-only\"><FormattedMessage id=\"search_web_placeholder\" /></span>\n        </label>\n        <input\n          id=\"newtab-search-text\"\n          maxLength=\"256\"\n          placeholder={this.props.intl.formatMessage({id: \"search_web_placeholder\"})}\n          ref={this.onInputMount}\n          title={this.props.intl.formatMessage({id: \"search_web_placeholder\"})}\n          type=\"search\" />\n        <button\n          id=\"searchSubmit\"\n          className=\"search-button\"\n          onClick={this.onClick}\n          title={this.props.intl.formatMessage({id: \"search_button\"})}>\n          <span className=\"sr-only\"><FormattedMessage id=\"search_button\" /></span>\n        </button>\n      </div>\n    </div>);\n  }\n}\n\nexport const Search = connect()(injectIntl(_Search));\n","export const IS_NEWTAB = global.document && global.document.documentURI === \"about:newtab\";\n","import {actionCreators as ac, actionTypes as at} from \"common/Actions.jsm\";\nimport {Card, PlaceholderCard} from \"content-src/components/Card/Card\";\nimport {FormattedMessage, injectIntl} from \"react-intl\";\nimport {CollapsibleSection} from \"content-src/components/CollapsibleSection/CollapsibleSection\";\nimport {ComponentPerfTimer} from \"content-src/components/ComponentPerfTimer/ComponentPerfTimer\";\nimport {connect} from \"react-redux\";\nimport {MoreRecommendations} from \"content-src/components/MoreRecommendations/MoreRecommendations\";\nimport {PocketLoggedInCta} from \"content-src/components/PocketLoggedInCta/PocketLoggedInCta\";\nimport React from \"react\";\nimport {Topics} from \"content-src/components/Topics/Topics\";\nimport {TopSites} from \"content-src/components/TopSites/TopSites\";\n\nconst VISIBLE = \"visible\";\nconst VISIBILITY_CHANGE_EVENT = \"visibilitychange\";\nconst CARDS_PER_ROW_DEFAULT = 3;\nconst CARDS_PER_ROW_COMPACT_WIDE = 4;\n\nfunction getFormattedMessage(message) {\n  return typeof message === \"string\" ? <span>{message}</span> : <FormattedMessage {...message} />;\n}\n\nexport class Section extends React.PureComponent {\n  get numRows() {\n    const {rowsPref, maxRows, Prefs} = this.props;\n    return rowsPref ? Prefs.values[rowsPref] : maxRows;\n  }\n\n  _dispatchImpressionStats() {\n    const {props} = this;\n    let cardsPerRow = CARDS_PER_ROW_DEFAULT;\n    if (props.compactCards && global.matchMedia(`(min-width: 1072px)`).matches) {\n      // If the section has compact cards and the viewport is wide enough, we show\n      // 4 columns instead of 3.\n      // $break-point-widest = 1072px (from _variables.scss)\n      cardsPerRow = CARDS_PER_ROW_COMPACT_WIDE;\n    }\n    const maxCards = cardsPerRow * this.numRows;\n    const cards = props.rows.slice(0, maxCards);\n\n    if (this.needsImpressionStats(cards)) {\n      props.dispatch(ac.ImpressionStats({\n        source: props.eventSource,\n        tiles: cards.map(link => ({id: link.guid})),\n      }));\n      this.impressionCardGuids = cards.map(link => link.guid);\n    }\n  }\n\n  // This sends an event when a user sees a set of new content. If content\n  // changes while the page is hidden (i.e. preloaded or on a hidden tab),\n  // only send the event if the page becomes visible again.\n  sendImpressionStatsOrAddListener() {\n    const {props} = this;\n\n    if (!props.shouldSendImpressionStats || !props.dispatch) {\n      return;\n    }\n\n    if (props.document.visibilityState === VISIBLE) {\n      this._dispatchImpressionStats();\n    } else {\n      // We should only ever send the latest impression stats ping, so remove any\n      // older listeners.\n      if (this._onVisibilityChange) {\n        props.document.removeEventListener(VISIBILITY_CHANGE_EVENT, this._onVisibilityChange);\n      }\n\n      // When the page becomes visible, send the impression stats ping if the section isn't collapsed.\n      this._onVisibilityChange = () => {\n        if (props.document.visibilityState === VISIBLE) {\n          if (!this.props.pref.collapsed) {\n            this._dispatchImpressionStats();\n          }\n          props.document.removeEventListener(VISIBILITY_CHANGE_EVENT, this._onVisibilityChange);\n        }\n      };\n      props.document.addEventListener(VISIBILITY_CHANGE_EVENT, this._onVisibilityChange);\n    }\n  }\n\n  componentWillMount() {\n    this.sendNewTabRehydrated(this.props.initialized);\n  }\n\n  componentDidMount() {\n    if (this.props.rows.length && !this.props.pref.collapsed) {\n      this.sendImpressionStatsOrAddListener();\n    }\n  }\n\n  componentDidUpdate(prevProps) {\n    const {props} = this;\n    const isCollapsed = props.pref.collapsed;\n    const wasCollapsed = prevProps.pref.collapsed;\n    if (\n      // Don't send impression stats for the empty state\n      props.rows.length &&\n      (\n        // We only want to send impression stats if the content of the cards has changed\n        // and the section is not collapsed...\n        (props.rows !== prevProps.rows && !isCollapsed) ||\n        // or if we are expanding a section that was collapsed.\n        (wasCollapsed && !isCollapsed)\n      )\n    ) {\n      this.sendImpressionStatsOrAddListener();\n    }\n  }\n\n  componentWillUpdate(nextProps) {\n    this.sendNewTabRehydrated(nextProps.initialized);\n  }\n\n  componentWillUnmount() {\n    if (this._onVisibilityChange) {\n      this.props.document.removeEventListener(VISIBILITY_CHANGE_EVENT, this._onVisibilityChange);\n    }\n  }\n\n  needsImpressionStats(cards) {\n    if (!this.impressionCardGuids || (this.impressionCardGuids.length !== cards.length)) {\n      return true;\n    }\n\n    for (let i = 0; i < cards.length; i++) {\n      if (cards[i].guid !== this.impressionCardGuids[i]) {\n        return true;\n      }\n    }\n\n    return false;\n  }\n\n  // The NEW_TAB_REHYDRATED event is used to inform feeds that their\n  // data has been consumed e.g. for counting the number of tabs that\n  // have rendered that data.\n  sendNewTabRehydrated(initialized) {\n    if (initialized && !this.renderNotified) {\n      this.props.dispatch(ac.AlsoToMain({type: at.NEW_TAB_REHYDRATED, data: {}}));\n      this.renderNotified = true;\n    }\n  }\n\n  render() {\n    const {\n      id, eventSource, title, icon, rows, Pocket, topics,\n      emptyState, dispatch, compactCards, read_more_endpoint,\n      contextMenuOptions, initialized, learnMore,\n      pref, privacyNoticeURL, isFirst, isLast,\n    } = this.props;\n\n    const waitingForSpoc = id === \"topstories\" && this.props.Pocket.waitingForSpoc;\n    const maxCardsPerRow = compactCards ? CARDS_PER_ROW_COMPACT_WIDE : CARDS_PER_ROW_DEFAULT;\n    const {numRows} = this;\n    const maxCards = maxCardsPerRow * numRows;\n    const maxCardsOnNarrow = CARDS_PER_ROW_DEFAULT * numRows;\n\n    const {pocketCta, isUserLoggedIn} = Pocket || {};\n    const {useCta} = pocketCta || {};\n\n    // Don't display anything until we have a definitve result from Pocket,\n    // to avoid a flash of logged out state while we render.\n    const isPocketLoggedInDefined = (isUserLoggedIn === true || isUserLoggedIn === false);\n\n    const hasTopics = topics && topics.length > 0;\n\n    const shouldShowPocketCta = (id === \"topstories\" &&\n      useCta && isUserLoggedIn === false);\n\n    // Show topics only for top stories and if it has loaded with topics.\n    // The classs .top-stories-bottom-container ensures content doesn't shift as things load.\n    const shouldShowTopics = (id === \"topstories\" && hasTopics &&\n      ((useCta && isUserLoggedIn === true) || (!useCta && isPocketLoggedInDefined)));\n\n    // We use topics to determine language support for read more.\n    const shouldShowReadMore = read_more_endpoint && hasTopics;\n\n    const realRows = rows.slice(0, maxCards);\n\n    // The empty state should only be shown after we have initialized and there is no content.\n    // Otherwise, we should show placeholders.\n    const shouldShowEmptyState = initialized && !rows.length;\n\n    const cards = [];\n    if (!shouldShowEmptyState) {\n      for (let i = 0; i < maxCards; i++) {\n        const link = realRows[i];\n        // On narrow viewports, we only show 3 cards per row. We'll mark the rest as\n        // .hide-for-narrow to hide in CSS via @media query.\n        const className = (i >= maxCardsOnNarrow) ? \"hide-for-narrow\" : \"\";\n        let usePlaceholder = !link;\n        // If we are in the third card and waiting for spoc,\n        // use the placeholder.\n        if (!usePlaceholder && i === 2 && waitingForSpoc) {\n          usePlaceholder = true;\n        }\n        cards.push(!usePlaceholder ? (\n          <Card key={i}\n            index={i}\n            className={className}\n            dispatch={dispatch}\n            link={link}\n            contextMenuOptions={contextMenuOptions}\n            eventSource={eventSource}\n            shouldSendImpressionStats={this.props.shouldSendImpressionStats}\n            isWebExtension={this.props.isWebExtension} />\n        ) : (\n          <PlaceholderCard key={i} className={className} />\n        ));\n      }\n    }\n\n    const sectionClassName = [\n      \"section\",\n      compactCards ? \"compact-cards\" : \"normal-cards\",\n    ].join(\" \");\n\n    // <Section> <-- React component\n    // <section> <-- HTML5 element\n    return (<ComponentPerfTimer {...this.props}>\n      <CollapsibleSection className={sectionClassName} icon={icon}\n        title={title}\n        id={id}\n        eventSource={eventSource}\n        collapsed={this.props.pref.collapsed}\n        showPrefName={(pref && pref.feed) || id}\n        privacyNoticeURL={privacyNoticeURL}\n        Prefs={this.props.Prefs}\n        isFirst={isFirst}\n        isLast={isLast}\n        learnMore={learnMore}\n        dispatch={this.props.dispatch}\n        isWebExtension={this.props.isWebExtension}>\n\n        {!shouldShowEmptyState && (<ul className=\"section-list\" style={{padding: 0}}>\n          {cards}\n        </ul>)}\n        {shouldShowEmptyState &&\n          <div className=\"section-empty-state\">\n            <div className=\"empty-state\">\n              {emptyState.icon && emptyState.icon.startsWith(\"moz-extension://\") ?\n                <span className=\"empty-state-icon icon\" style={{\"background-image\": `url('${emptyState.icon}')`}} /> :\n                <span className={`empty-state-icon icon icon-${emptyState.icon}`} />}\n              <p className=\"empty-state-message\">\n                {getFormattedMessage(emptyState.message)}\n              </p>\n            </div>\n          </div>}\n        {id === \"topstories\" &&\n          <div className=\"top-stories-bottom-container\">\n            <div>\n              {shouldShowTopics && <Topics topics={this.props.topics} />}\n              {shouldShowPocketCta && <PocketLoggedInCta />}\n            </div>\n            <div>\n              {shouldShowReadMore &&\n                <MoreRecommendations read_more_endpoint={read_more_endpoint} />}\n            </div>\n          </div>}\n      </CollapsibleSection>\n    </ComponentPerfTimer>);\n  }\n}\n\nSection.defaultProps = {\n  document: global.document,\n  rows: [],\n  emptyState: {},\n  pref: {},\n  title: \"\",\n};\n\nexport const SectionIntl = connect(state => ({Prefs: state.Prefs, Pocket: state.Pocket}))(injectIntl(Section));\n\nexport class _Sections extends React.PureComponent {\n  renderSections() {\n    const sections = [];\n    const enabledSections = this.props.Sections.filter(section => section.enabled);\n    const {sectionOrder, \"feeds.topsites\": showTopSites} = this.props.Prefs.values;\n    // Enabled sections doesn't include Top Sites, so we add it if enabled.\n    const expectedCount = enabledSections.length + ~~showTopSites;\n\n    for (const sectionId of sectionOrder.split(\",\")) {\n      const commonProps = {\n        key: sectionId,\n        isFirst: sections.length === 0,\n        isLast: sections.length === expectedCount - 1,\n      };\n      if (sectionId === \"topsites\" && showTopSites) {\n        sections.push(<TopSites {...commonProps} />);\n      } else {\n        const section = enabledSections.find(s => s.id === sectionId);\n        if (section) {\n          sections.push(<SectionIntl {...section} {...commonProps} />);\n        }\n      }\n    }\n    return sections;\n  }\n\n  render() {\n    return (\n      <div className=\"sections-list\">\n        {this.renderSections()}\n      </div>\n    );\n  }\n}\n\nexport const Sections = connect(state => ({Sections: state.Sections, Prefs: state.Prefs}))(_Sections);\n","import {actionCreators as ac, actionTypes as at} from \"common/Actions.jsm\";\n\nconst _OpenInPrivateWindow = site => ({\n  id: \"menu_action_open_private_window\",\n  icon: \"new-window-private\",\n  action: ac.OnlyToMain({\n    type: at.OPEN_PRIVATE_WINDOW,\n    data: {url: site.url, referrer: site.referrer},\n  }),\n  userEvent: \"OPEN_PRIVATE_WINDOW\",\n});\n\nexport const GetPlatformString = platform => {\n  switch (platform) {\n    case \"win\":\n      return \"menu_action_show_file_windows\";\n    case \"macosx\":\n      return \"menu_action_show_file_mac_os\";\n    case \"linux\":\n      return \"menu_action_show_file_linux\";\n    default:\n      return \"menu_action_show_file_default\";\n  }\n};\n\n/**\n * List of functions that return items that can be included as menu options in a\n * LinkMenu. All functions take the site as the first parameter, and optionally\n * the index of the site.\n */\nexport const LinkMenuOptions = {\n  Separator: () => ({type: \"separator\"}),\n  EmptyItem: () => ({type: \"empty\"}),\n  RemoveBookmark: site => ({\n    id: \"menu_action_remove_bookmark\",\n    icon: \"bookmark-added\",\n    action: ac.AlsoToMain({\n      type: at.DELETE_BOOKMARK_BY_ID,\n      data: site.bookmarkGuid,\n    }),\n    userEvent: \"BOOKMARK_DELETE\",\n  }),\n  AddBookmark: site => ({\n    id: \"menu_action_bookmark\",\n    icon: \"bookmark-hollow\",\n    action: ac.AlsoToMain({\n      type: at.BOOKMARK_URL,\n      data: {url: site.url, title: site.title, type: site.type},\n    }),\n    userEvent: \"BOOKMARK_ADD\",\n  }),\n  OpenInNewWindow: site => ({\n    id: \"menu_action_open_new_window\",\n    icon: \"new-window\",\n    action: ac.AlsoToMain({\n      type: at.OPEN_NEW_WINDOW,\n      data: {\n        referrer: site.referrer,\n        typedBonus: site.typedBonus,\n        url: site.url,\n      },\n    }),\n    userEvent: \"OPEN_NEW_WINDOW\",\n  }),\n  BlockUrl: (site, index, eventSource) => ({\n    id: \"menu_action_dismiss\",\n    icon: \"dismiss\",\n    action: ac.AlsoToMain({\n      type: at.BLOCK_URL,\n      data: {url: site.open_url || site.url, pocket_id: site.pocket_id},\n    }),\n    impression: ac.ImpressionStats({\n      source: eventSource,\n      block: 0,\n      tiles: [{id: site.guid, pos: index}],\n    }),\n    userEvent: \"BLOCK\",\n  }),\n\n  // This is an option for web extentions which will result in remove items from\n  // memory and notify the web extenion, rather than using the built-in block list.\n  WebExtDismiss: (site, index, eventSource) => ({\n    id: \"menu_action_webext_dismiss\",\n    string_id: \"menu_action_dismiss\",\n    icon: \"dismiss\",\n    action: ac.WebExtEvent(at.WEBEXT_DISMISS, {\n      source: eventSource,\n      url: site.url,\n      action_position: index,\n    }),\n  }),\n  DeleteUrl: (site, index, eventSource, isEnabled, siteInfo) => ({\n    id: \"menu_action_delete\",\n    icon: \"delete\",\n    action: {\n      type: at.DIALOG_OPEN,\n      data: {\n        onConfirm: [\n          ac.AlsoToMain({type: at.DELETE_HISTORY_URL, data: {url: site.url, pocket_id: site.pocket_id, forceBlock: site.bookmarkGuid}}),\n          ac.UserEvent(Object.assign({event: \"DELETE\", source: eventSource, action_position: index}, siteInfo)),\n        ],\n        eventSource,\n        body_string_id: [\"confirm_history_delete_p1\", \"confirm_history_delete_notice_p2\"],\n        confirm_button_string_id: \"menu_action_delete\",\n        cancel_button_string_id: \"topsites_form_cancel_button\",\n        icon: \"modal-delete\",\n      },\n    },\n    userEvent: \"DIALOG_OPEN\",\n  }),\n  ShowFile: (site, index, eventSource, isEnabled, siteInfo, platform) => ({\n    id: GetPlatformString(platform),\n    icon: \"search\",\n    action: ac.OnlyToMain({\n      type: at.SHOW_DOWNLOAD_FILE,\n      data: {url: site.url},\n    }),\n  }),\n  OpenFile: site => ({\n    id: \"menu_action_open_file\",\n    icon: \"open-file\",\n    action: ac.OnlyToMain({\n      type: at.OPEN_DOWNLOAD_FILE,\n      data: {url: site.url},\n    }),\n  }),\n  CopyDownloadLink: site => ({\n    id: \"menu_action_copy_download_link\",\n    icon: \"copy\",\n    action: ac.OnlyToMain({\n      type: at.COPY_DOWNLOAD_LINK,\n      data: {url: site.url},\n    }),\n  }),\n  GoToDownloadPage: site => ({\n    id: \"menu_action_go_to_download_page\",\n    icon: \"download\",\n    action: ac.OnlyToMain({\n      type: at.OPEN_LINK,\n      data: {url: site.referrer},\n    }),\n    disabled: !site.referrer,\n  }),\n  RemoveDownload: site => ({\n    id: \"menu_action_remove_download\",\n    icon: \"delete\",\n    action: ac.OnlyToMain({\n      type: at.REMOVE_DOWNLOAD_FILE,\n      data: {url: site.url},\n    }),\n  }),\n  PinTopSite: ({url, searchTopSite, label}, index) => ({\n    id: \"menu_action_pin\",\n    icon: \"pin\",\n    action: ac.AlsoToMain({\n      type: at.TOP_SITES_PIN,\n      data: {\n        site: {\n          url,\n          ...(searchTopSite && {searchTopSite, label}),\n        },\n        index,\n      },\n    }),\n    userEvent: \"PIN\",\n  }),\n  UnpinTopSite: site => ({\n    id: \"menu_action_unpin\",\n    icon: \"unpin\",\n    action: ac.AlsoToMain({\n      type: at.TOP_SITES_UNPIN,\n      data: {site: {url: site.url}},\n    }),\n    userEvent: \"UNPIN\",\n  }),\n  SaveToPocket: (site, index, eventSource) => ({\n    id: \"menu_action_save_to_pocket\",\n    icon: \"pocket-save\",\n    action: ac.AlsoToMain({\n      type: at.SAVE_TO_POCKET,\n      data: {site: {url: site.url, title: site.title}},\n    }),\n    impression: ac.ImpressionStats({\n      source: eventSource,\n      pocket: 0,\n      tiles: [{id: site.guid, pos: index}],\n    }),\n    userEvent: \"SAVE_TO_POCKET\",\n  }),\n  DeleteFromPocket: site => ({\n    id: \"menu_action_delete_pocket\",\n    icon: \"delete\",\n    action: ac.AlsoToMain({\n      type: at.DELETE_FROM_POCKET,\n      data: {pocket_id: site.pocket_id},\n    }),\n    userEvent: \"DELETE_FROM_POCKET\",\n  }),\n  ArchiveFromPocket: site => ({\n    id: \"menu_action_archive_pocket\",\n    icon: \"check\",\n    action: ac.AlsoToMain({\n      type: at.ARCHIVE_FROM_POCKET,\n      data: {pocket_id: site.pocket_id},\n    }),\n    userEvent: \"ARCHIVE_FROM_POCKET\",\n  }),\n  EditTopSite: (site, index) => ({\n    id: \"edit_topsites_button_text\",\n    icon: \"edit\",\n    action: {\n      type: at.TOP_SITES_EDIT,\n      data: {index},\n    },\n  }),\n  CheckBookmark: site => (site.bookmarkGuid ? LinkMenuOptions.RemoveBookmark(site) : LinkMenuOptions.AddBookmark(site)),\n  CheckPinTopSite: (site, index) => (site.isPinned ? LinkMenuOptions.UnpinTopSite(site) : LinkMenuOptions.PinTopSite(site, index)),\n  CheckSavedToPocket: (site, index) => (site.pocket_id ? LinkMenuOptions.DeleteFromPocket(site) : LinkMenuOptions.SaveToPocket(site, index)),\n  CheckBookmarkOrArchive: site => (site.pocket_id ? LinkMenuOptions.ArchiveFromPocket(site) : LinkMenuOptions.CheckBookmark(site)),\n  OpenInPrivateWindow: (site, index, eventSource, isEnabled) => (isEnabled ? _OpenInPrivateWindow(site) : LinkMenuOptions.EmptyItem()),\n};\n","import {actionCreators as ac} from \"common/Actions.jsm\";\nimport {connect} from \"react-redux\";\nimport {ContextMenu} from \"content-src/components/ContextMenu/ContextMenu\";\nimport {injectIntl} from \"react-intl\";\nimport {LinkMenuOptions} from \"content-src/lib/link-menu-options\";\nimport React from \"react\";\n\nconst DEFAULT_SITE_MENU_OPTIONS = [\"CheckPinTopSite\", \"EditTopSite\", \"Separator\", \"OpenInNewWindow\", \"OpenInPrivateWindow\", \"Separator\", \"BlockUrl\"];\n\nexport class _LinkMenu extends React.PureComponent {\n  getOptions() {\n    const {props} = this;\n    const {site, index, source, isPrivateBrowsingEnabled, siteInfo, platform} = props;\n\n    // Handle special case of default site\n    const propOptions = (!site.isDefault || site.searchTopSite) ? props.options : DEFAULT_SITE_MENU_OPTIONS;\n\n    const options = propOptions.map(o => LinkMenuOptions[o](site, index, source, isPrivateBrowsingEnabled, siteInfo, platform)).map(option => {\n      const {action, impression, id, string_id, type, userEvent} = option;\n      if (!type && id) {\n        option.label = props.intl.formatMessage({id: string_id || id});\n        option.onClick = () => {\n          props.dispatch(action);\n          if (userEvent) {\n            const userEventData = Object.assign({\n              event: userEvent,\n              source,\n              action_position: index,\n            }, siteInfo);\n            props.dispatch(ac.UserEvent(userEventData));\n          }\n          if (impression && props.shouldSendImpressionStats) {\n            props.dispatch(impression);\n          }\n        };\n      }\n      return option;\n    });\n\n    // This is for accessibility to support making each item tabbable.\n    // We want to know which item is the first and which item\n    // is the last, so we can close the context menu accordingly.\n    options[0].first = true;\n    options[options.length - 1].last = true;\n    return options;\n  }\n\n  render() {\n    return (<ContextMenu\n      onUpdate={this.props.onUpdate}\n      options={this.getOptions()} />);\n  }\n}\n\nconst getState = state => ({isPrivateBrowsingEnabled: state.Prefs.values.isPrivateBrowsingEnabled, platform: state.Prefs.values.platform});\nexport const LinkMenu = connect(getState)(injectIntl(_LinkMenu));\n","import React from \"react\";\n\nexport class ContextMenu extends React.PureComponent {\n  constructor(props) {\n    super(props);\n    this.hideContext = this.hideContext.bind(this);\n    this.onClick = this.onClick.bind(this);\n  }\n\n  hideContext() {\n    this.props.onUpdate(false);\n  }\n\n  componentDidMount() {\n    setTimeout(() => {\n      global.addEventListener(\"click\", this.hideContext);\n    }, 0);\n  }\n\n  componentWillUnmount() {\n    global.removeEventListener(\"click\", this.hideContext);\n  }\n\n  onClick(event) {\n    // Eat all clicks on the context menu so they don't bubble up to window.\n    // This prevents the context menu from closing when clicking disabled items\n    // or the separators.\n    event.stopPropagation();\n  }\n\n  render() {\n    return (<span className=\"context-menu\" onClick={this.onClick}>\n      <ul role=\"menu\" className=\"context-menu-list\">\n        {this.props.options.map((option, i) => (option.type === \"separator\" ?\n          (<li key={i} className=\"separator\" />) :\n          (option.type !== \"empty\" && <ContextMenuItem key={i} option={option} hideContext={this.hideContext} />)\n        ))}\n      </ul>\n    </span>);\n  }\n}\n\nexport class ContextMenuItem extends React.PureComponent {\n  constructor(props) {\n    super(props);\n    this.onClick = this.onClick.bind(this);\n    this.onKeyDown = this.onKeyDown.bind(this);\n  }\n\n  onClick() {\n    this.props.hideContext();\n    this.props.option.onClick();\n  }\n\n  onKeyDown(event) {\n    const {option} = this.props;\n    switch (event.key) {\n      case \"Tab\":\n        // tab goes down in context menu, shift + tab goes up in context menu\n        // if we're on the last item, one more tab will close the context menu\n        // similarly, if we're on the first item, one more shift + tab will close it\n        if ((event.shiftKey && option.first) || (!event.shiftKey && option.last)) {\n          this.props.hideContext();\n        }\n        break;\n      case \"Enter\":\n        this.props.hideContext();\n        option.onClick();\n        break;\n    }\n  }\n\n  render() {\n    const {option} = this.props;\n    return (\n      <li role=\"menuitem\" className=\"context-menu-item\">\n        <a onClick={this.onClick} onKeyDown={this.onKeyDown} tabIndex=\"0\" className={option.disabled ? \"disabled\" : \"\"}>\n          {option.icon && <span className={`icon icon-spacer icon-${option.icon}`} />}\n          {option.label}\n        </a>\n      </li>);\n  }\n}\n","/**\n * List of helper functions for screenshot-based images.\n *\n * There are two kinds of images:\n * 1. Remote Image: This is the image from the main process and it refers to\n *    the image in the React props. This can either be an object with the `data`\n *    and `path` properties, if it is a blob, or a string, if it is a normal image.\n * 2. Local Image: This is the image object in the content process and it refers\n *    to the image *object* in the React component's state. All local image\n *    objects have the `url` property, and an additional property `path`, if they\n *    are blobs.\n */\nexport const ScreenshotUtils = {\n  isBlob(isLocal, image) {\n    return !!(image && image.path && ((!isLocal && image.data) || (isLocal && image.url)));\n  },\n\n  // This should always be called with a remote image and not a local image.\n  createLocalImageObject(remoteImage) {\n    if (!remoteImage) {\n      return null;\n    }\n    if (this.isBlob(false, remoteImage)) {\n      return {url: global.URL.createObjectURL(remoteImage.data), path: remoteImage.path};\n    }\n    return {url: remoteImage};\n  },\n\n  // Revokes the object URL of the image if the local image is a blob.\n  // This should always be called with a local image and not a remote image.\n  maybeRevokeBlobObjectURL(localImage) {\n    if (this.isBlob(true, localImage)) {\n      global.URL.revokeObjectURL(localImage.url);\n    }\n  },\n\n  // Checks if remoteImage and localImage are the same.\n  isRemoteImageLocal(localImage, remoteImage) {\n    // Both remoteImage and localImage are present.\n    if (remoteImage && localImage) {\n      return this.isBlob(false, remoteImage) ?\n             localImage.path === remoteImage.path :\n             localImage.url === remoteImage;\n    }\n\n    // This will only handle the remaining three possible outcomes.\n    // (i.e. everything except when both image and localImage are present)\n    return !remoteImage && !localImage;\n  },\n};\n","import {FormattedMessage, injectIntl} from \"react-intl\";\nimport {actionCreators as ac} from \"common/Actions.jsm\";\nimport {ErrorBoundary} from \"content-src/components/ErrorBoundary/ErrorBoundary\";\nimport React from \"react\";\nimport {SectionMenu} from \"content-src/components/SectionMenu/SectionMenu\";\nimport {SectionMenuOptions} from \"content-src/lib/section-menu-options\";\n\nconst VISIBLE = \"visible\";\nconst VISIBILITY_CHANGE_EVENT = \"visibilitychange\";\n\nfunction getFormattedMessage(message) {\n  return typeof message === \"string\" ? <span>{message}</span> : <FormattedMessage {...message} />;\n}\n\nexport class _CollapsibleSection extends React.PureComponent {\n  constructor(props) {\n    super(props);\n    this.onBodyMount = this.onBodyMount.bind(this);\n    this.onHeaderClick = this.onHeaderClick.bind(this);\n    this.onTransitionEnd = this.onTransitionEnd.bind(this);\n    this.enableOrDisableAnimation = this.enableOrDisableAnimation.bind(this);\n    this.onMenuButtonClick = this.onMenuButtonClick.bind(this);\n    this.onMenuButtonMouseEnter = this.onMenuButtonMouseEnter.bind(this);\n    this.onMenuButtonMouseLeave = this.onMenuButtonMouseLeave.bind(this);\n    this.onMenuUpdate = this.onMenuUpdate.bind(this);\n    this.state = {enableAnimation: true, isAnimating: false, menuButtonHover: false, showContextMenu: false};\n  }\n\n  componentWillMount() {\n    this.props.document.addEventListener(VISIBILITY_CHANGE_EVENT, this.enableOrDisableAnimation);\n  }\n\n  componentWillUpdate(nextProps) {\n    // Check if we're about to go from expanded to collapsed\n    if (!this.props.collapsed && nextProps.collapsed) {\n      // This next line forces a layout flush of the section body, which has a\n      // max-height style set, so that the upcoming collapse animation can\n      // animate from that height to the collapsed height. Without this, the\n      // update is coalesced and there's no animation from no-max-height to 0.\n      this.sectionBody.scrollHeight; // eslint-disable-line no-unused-expressions\n    }\n  }\n\n  componentWillUnmount() {\n    this.props.document.removeEventListener(VISIBILITY_CHANGE_EVENT, this.enableOrDisableAnimation);\n  }\n\n  enableOrDisableAnimation() {\n    // Only animate the collapse/expand for visible tabs.\n    const visible = this.props.document.visibilityState === VISIBLE;\n    if (this.state.enableAnimation !== visible) {\n      this.setState({enableAnimation: visible});\n    }\n  }\n\n  onBodyMount(node) {\n    this.sectionBody = node;\n  }\n\n  onHeaderClick() {\n    // If this.sectionBody is unset, it means that we're in some sort of error\n    // state, probably displaying the error fallback, so we won't be able to\n    // compute the height, and we don't want to persist the preference.\n    // If props.collapsed is undefined handler shouldn't do anything.\n    if (!this.sectionBody || this.props.collapsed === undefined) {\n      return;\n    }\n\n    // Get the current height of the body so max-height transitions can work\n    this.setState({\n      isAnimating: true,\n      maxHeight: `${this._getSectionBodyHeight()}px`,\n    });\n    const {action, userEvent} = SectionMenuOptions.CheckCollapsed(this.props);\n    this.props.dispatch(action);\n    this.props.dispatch(ac.UserEvent({\n      event: userEvent,\n      source: this.props.source,\n    }));\n  }\n\n  _getSectionBodyHeight() {\n    const div = this.sectionBody;\n    if (div.style.display === \"none\") {\n      // If the div isn't displayed, we can't get it's height. So we display it\n      // to get the height (it doesn't show up because max-height is set to 0px\n      // in CSS). We don't undo this because we are about to expand the section.\n      div.style.display = \"block\";\n    }\n    return div.scrollHeight;\n  }\n\n  onTransitionEnd(event) {\n    // Only update the animating state for our own transition (not a child's)\n    if (event.target === event.currentTarget) {\n      this.setState({isAnimating: false});\n    }\n  }\n\n  renderIcon() {\n    const {icon} = this.props;\n    if (icon && icon.startsWith(\"moz-extension://\")) {\n      return <span className=\"icon icon-small-spacer\" style={{backgroundImage: `url('${icon}')`}} />;\n    }\n    return <span className={`icon icon-small-spacer icon-${icon || \"webextension\"}`} />;\n  }\n\n  onMenuButtonClick(event) {\n    event.preventDefault();\n    this.setState({showContextMenu: true});\n  }\n\n  onMenuButtonMouseEnter() {\n    this.setState({menuButtonHover: true});\n  }\n\n  onMenuButtonMouseLeave() {\n    this.setState({menuButtonHover: false});\n  }\n\n  onMenuUpdate(showContextMenu) {\n    this.setState({showContextMenu});\n  }\n\n  render() {\n    const isCollapsible = this.props.collapsed !== undefined;\n    const {enableAnimation, isAnimating, maxHeight, menuButtonHover, showContextMenu} = this.state;\n    const {id, eventSource, collapsed, learnMore, title, extraMenuOptions, showPrefName, privacyNoticeURL, dispatch, isFirst, isLast, isWebExtension} = this.props;\n    const active = menuButtonHover || showContextMenu;\n    let bodyStyle;\n    if (isAnimating && !collapsed) {\n      bodyStyle = {maxHeight};\n    } else if (!isAnimating && collapsed) {\n      bodyStyle = {display: \"none\"};\n    }\n    return (\n      <section\n        className={`collapsible-section ${this.props.className}${enableAnimation ? \" animation-enabled\" : \"\"}${collapsed ? \" collapsed\" : \"\"}${active ? \" active\" : \"\"}`}\n        // Note: data-section-id is used for web extension api tests in mozilla central\n        data-section-id={id}>\n        <div className=\"section-top-bar\">\n          <h3 className=\"section-title\">\n            <span className=\"click-target-container\">\n              <span className=\"click-target\" onClick={this.onHeaderClick}>\n                {this.renderIcon()}\n                {getFormattedMessage(title)}\n              </span>\n              <span className=\"click-target\" onClick={this.onHeaderClick}>\n                {isCollapsible && <span className={`collapsible-arrow icon ${collapsed ? \"icon-arrowhead-forward-small\" : \"icon-arrowhead-down-small\"}`} />}\n              </span>\n              <span>\n                {learnMore &&\n                  <span className=\"learn-more-link\">\n                    <a href={learnMore.link.href}>\n                      <FormattedMessage id={learnMore.link.id} />\n                    </a>\n                  </span>\n                }\n              </span>\n            </span>\n          </h3>\n          <div>\n            <button\n              className=\"context-menu-button icon\"\n              title={this.props.intl.formatMessage({id: \"context_menu_title\"})}\n              onClick={this.onMenuButtonClick}\n              onMouseEnter={this.onMenuButtonMouseEnter}\n              onMouseLeave={this.onMenuButtonMouseLeave}>\n              <span className=\"sr-only\">\n                <FormattedMessage id=\"section_context_menu_button_sr\" />\n              </span>\n            </button>\n            {showContextMenu &&\n              <SectionMenu\n                id={id}\n                extraOptions={extraMenuOptions}\n                eventSource={eventSource}\n                showPrefName={showPrefName}\n                privacyNoticeURL={privacyNoticeURL}\n                collapsed={collapsed}\n                onUpdate={this.onMenuUpdate}\n                isFirst={isFirst}\n                isLast={isLast}\n                dispatch={dispatch}\n                isWebExtension={isWebExtension} />\n            }\n          </div>\n        </div>\n        <ErrorBoundary className=\"section-body-fallback\">\n          <div\n            className={`section-body${isAnimating ? \" animating\" : \"\"}`}\n            onTransitionEnd={this.onTransitionEnd}\n            ref={this.onBodyMount}\n            style={bodyStyle}>\n            {this.props.children}\n          </div>\n        </ErrorBoundary>\n      </section>\n    );\n  }\n}\n\n_CollapsibleSection.defaultProps = {\n  document: global.document || {\n    addEventListener: () => {},\n    removeEventListener: () => {},\n    visibilityState: \"hidden\",\n  },\n  Prefs: {values: {}},\n};\n\nexport const CollapsibleSection = injectIntl(_CollapsibleSection);\n","import {actionCreators as ac} from \"common/Actions.jsm\";\nimport {ContextMenu} from \"content-src/components/ContextMenu/ContextMenu\";\nimport {injectIntl} from \"react-intl\";\nimport React from \"react\";\nimport {SectionMenuOptions} from \"content-src/lib/section-menu-options\";\n\nconst DEFAULT_SECTION_MENU_OPTIONS = [\"MoveUp\", \"MoveDown\", \"Separator\", \"RemoveSection\", \"CheckCollapsed\", \"Separator\", \"ManageSection\"];\nconst WEBEXT_SECTION_MENU_OPTIONS = [\"MoveUp\", \"MoveDown\", \"Separator\", \"CheckCollapsed\", \"Separator\", \"ManageWebExtension\"];\n\nexport class _SectionMenu extends React.PureComponent {\n  getOptions() {\n    const {props} = this;\n\n    const propOptions = props.isWebExtension ? [...WEBEXT_SECTION_MENU_OPTIONS] : [...DEFAULT_SECTION_MENU_OPTIONS];\n    // Prepend custom options and a separator\n    if (props.extraOptions) {\n      propOptions.splice(0, 0, ...props.extraOptions, \"Separator\");\n    }\n    // Insert privacy notice before the last option (\"ManageSection\")\n    if (props.privacyNoticeURL) {\n      propOptions.splice(-1, 0, \"PrivacyNotice\");\n    }\n\n    const options = propOptions.map(o => SectionMenuOptions[o](props)).map(option => {\n      const {action, id, type, userEvent} = option;\n      if (!type && id) {\n        option.label = props.intl.formatMessage({id});\n        option.onClick = () => {\n          props.dispatch(action);\n          if (userEvent) {\n            props.dispatch(ac.UserEvent({\n              event: userEvent,\n              source: props.source,\n            }));\n          }\n        };\n      }\n      return option;\n    });\n\n    // This is for accessibility to support making each item tabbable.\n    // We want to know which item is the first and which item\n    // is the last, so we can close the context menu accordingly.\n    options[0].first = true;\n    options[options.length - 1].last = true;\n    return options;\n  }\n\n  render() {\n    return (<ContextMenu\n      onUpdate={this.props.onUpdate}\n      options={this.getOptions()} />);\n  }\n}\n\nexport const SectionMenu = injectIntl(_SectionMenu);\n","import {actionCreators as ac, actionTypes as at} from \"common/Actions.jsm\";\n\n/**\n * List of functions that return items that can be included as menu options in a\n * SectionMenu. All functions take the section as the only parameter.\n */\nexport const SectionMenuOptions = {\n  Separator: () => ({type: \"separator\"}),\n  MoveUp: section => ({\n    id: \"section_menu_action_move_up\",\n    icon: \"arrowhead-up\",\n    action: ac.OnlyToMain({\n      type: at.SECTION_MOVE,\n      data: {id: section.id, direction: -1},\n    }),\n    userEvent: \"MENU_MOVE_UP\",\n    disabled: !!section.isFirst,\n  }),\n  MoveDown: section => ({\n    id: \"section_menu_action_move_down\",\n    icon: \"arrowhead-down\",\n    action: ac.OnlyToMain({\n      type: at.SECTION_MOVE,\n      data: {id: section.id, direction: +1},\n    }),\n    userEvent: \"MENU_MOVE_DOWN\",\n    disabled: !!section.isLast,\n  }),\n  RemoveSection: section => ({\n    id: \"section_menu_action_remove_section\",\n    icon: \"dismiss\",\n    action: ac.SetPref(section.showPrefName, false),\n    userEvent: \"MENU_REMOVE\",\n  }),\n  CollapseSection: section => ({\n    id: \"section_menu_action_collapse_section\",\n    icon: \"minimize\",\n    action: ac.OnlyToMain({type: at.UPDATE_SECTION_PREFS, data: {id: section.id, value: {collapsed: true}}}),\n    userEvent: \"MENU_COLLAPSE\",\n  }),\n  ExpandSection: section => ({\n    id: \"section_menu_action_expand_section\",\n    icon: \"maximize\",\n    action: ac.OnlyToMain({type: at.UPDATE_SECTION_PREFS, data: {id: section.id, value: {collapsed: false}}}),\n    userEvent: \"MENU_EXPAND\",\n  }),\n  ManageSection: section => ({\n    id: \"section_menu_action_manage_section\",\n    icon: \"settings\",\n    action: ac.OnlyToMain({type: at.SETTINGS_OPEN}),\n    userEvent: \"MENU_MANAGE\",\n  }),\n  ManageWebExtension: section => ({\n    id: \"section_menu_action_manage_webext\",\n    icon: \"settings\",\n    action: ac.OnlyToMain({type: at.OPEN_WEBEXT_SETTINGS, data: section.id}),\n  }),\n  AddTopSite: section => ({\n    id: \"section_menu_action_add_topsite\",\n    icon: \"add\",\n    action: {type: at.TOP_SITES_EDIT, data: {index: -1}},\n    userEvent: \"MENU_ADD_TOPSITE\",\n  }),\n  AddSearchShortcut: section => ({\n    id: \"section_menu_action_add_search_engine\",\n    icon: \"search\",\n    action: {type: at.TOP_SITES_OPEN_SEARCH_SHORTCUTS_MODAL},\n    userEvent: \"MENU_ADD_SEARCH\",\n  }),\n  PrivacyNotice: section => ({\n    id: \"section_menu_action_privacy_notice\",\n    icon: \"info\",\n    action: ac.OnlyToMain({\n      type: at.OPEN_LINK,\n      data: {url: section.privacyNoticeURL},\n    }),\n    userEvent: \"MENU_PRIVACY_NOTICE\",\n  }),\n  CheckCollapsed: section => (section.collapsed ? SectionMenuOptions.ExpandSection(section) : SectionMenuOptions.CollapseSection(section)),\n};\n","import {actionCreators as ac, actionTypes as at} from \"common/Actions.jsm\";\nimport {perfService as perfSvc} from \"common/PerfService.jsm\";\nimport React from \"react\";\n\n// Currently record only a fixed set of sections. This will prevent data\n// from custom sections from showing up or from topstories.\nconst RECORDED_SECTIONS = [\"highlights\", \"topsites\"];\n\nexport class ComponentPerfTimer extends React.Component {\n  constructor(props) {\n    super(props);\n    // Just for test dependency injection:\n    this.perfSvc = this.props.perfSvc || perfSvc;\n\n    this._sendBadStateEvent = this._sendBadStateEvent.bind(this);\n    this._sendPaintedEvent = this._sendPaintedEvent.bind(this);\n    this._reportMissingData = false;\n    this._timestampHandled = false;\n    this._recordedFirstRender = false;\n  }\n\n  componentDidMount() {\n    if (!RECORDED_SECTIONS.includes(this.props.id)) {\n      return;\n    }\n\n    this._maybeSendPaintedEvent();\n  }\n\n  componentDidUpdate() {\n    if (!RECORDED_SECTIONS.includes(this.props.id)) {\n      return;\n    }\n\n    this._maybeSendPaintedEvent();\n  }\n\n  /**\n   * Call the given callback after the upcoming frame paints.\n   *\n   * @note Both setTimeout and requestAnimationFrame are throttled when the page\n   * is hidden, so this callback may get called up to a second or so after the\n   * requestAnimationFrame \"paint\" for hidden tabs.\n   *\n   * Newtabs hidden while loading will presumably be fairly rare (other than\n   * preloaded tabs, which we will be filtering out on the server side), so such\n   * cases should get lost in the noise.\n   *\n   * If we decide that it's important to find out when something that's hidden\n   * has \"painted\", however, another option is to post a message to this window.\n   * That should happen even faster than setTimeout, and, at least as of this\n   * writing, it's not throttled in hidden windows in Firefox.\n   *\n   * @param {Function} callback\n   *\n   * @returns void\n   */\n  _afterFramePaint(callback) {\n    requestAnimationFrame(() => setTimeout(callback, 0));\n  }\n\n  _maybeSendBadStateEvent() {\n    // Follow up bugs:\n    // https://github.com/mozilla/activity-stream/issues/3691\n    if (!this.props.initialized) {\n      // Remember to report back when data is available.\n      this._reportMissingData = true;\n    } else if (this._reportMissingData) {\n      this._reportMissingData = false;\n      // Report how long it took for component to become initialized.\n      this._sendBadStateEvent();\n    }\n  }\n\n  _maybeSendPaintedEvent() {\n    // If we've already handled a timestamp, don't do it again.\n    if (this._timestampHandled || !this.props.initialized) {\n      return;\n    }\n\n    // And if we haven't, we're doing so now, so remember that. Even if\n    // something goes wrong in the callback, we can't try again, as we'd be\n    // sending back the wrong data, and we have to do it here, so that other\n    // calls to this method while waiting for the next frame won't also try to\n    // handle it.\n    this._timestampHandled = true;\n    this._afterFramePaint(this._sendPaintedEvent);\n  }\n\n  /**\n   * Triggered by call to render. Only first call goes through due to\n   * `_recordedFirstRender`.\n   */\n  _ensureFirstRenderTsRecorded() {\n    // Used as t0 for recording how long component took to initialize.\n    if (!this._recordedFirstRender) {\n      this._recordedFirstRender = true;\n      // topsites_first_render_ts, highlights_first_render_ts.\n      const key = `${this.props.id}_first_render_ts`;\n      this.perfSvc.mark(key);\n    }\n  }\n\n  /**\n   * Creates `TELEMETRY_UNDESIRED_EVENT` with timestamp in ms\n   * of how much longer the data took to be ready for display than it would\n   * have been the ideal case.\n   * https://github.com/mozilla/ping-centre/issues/98\n   */\n  _sendBadStateEvent() {\n    // highlights_data_ready_ts, topsites_data_ready_ts.\n    const dataReadyKey = `${this.props.id}_data_ready_ts`;\n    this.perfSvc.mark(dataReadyKey);\n\n    try {\n      const firstRenderKey = `${this.props.id}_first_render_ts`;\n      // value has to be Int32.\n      const value = parseInt(this.perfSvc.getMostRecentAbsMarkStartByName(dataReadyKey) -\n                             this.perfSvc.getMostRecentAbsMarkStartByName(firstRenderKey), 10);\n      this.props.dispatch(ac.OnlyToMain({\n        type: at.SAVE_SESSION_PERF_DATA,\n        // highlights_data_late_by_ms, topsites_data_late_by_ms.\n        data: {[`${this.props.id}_data_late_by_ms`]: value},\n      }));\n    } catch (ex) {\n      // If this failed, it's likely because the `privacy.resistFingerprinting`\n      // pref is true.\n    }\n  }\n\n  _sendPaintedEvent() {\n    // Record first_painted event but only send if topsites.\n    if (this.props.id !== \"topsites\") {\n      return;\n    }\n\n    // topsites_first_painted_ts.\n    const key = `${this.props.id}_first_painted_ts`;\n    this.perfSvc.mark(key);\n\n    try {\n      const data = {};\n      data[key] = this.perfSvc.getMostRecentAbsMarkStartByName(key);\n\n      this.props.dispatch(ac.OnlyToMain({\n        type: at.SAVE_SESSION_PERF_DATA,\n        data,\n      }));\n    } catch (ex) {\n      // If this failed, it's likely because the `privacy.resistFingerprinting`\n      // pref is true.  We should at least not blow up, and should continue\n      // to set this._timestampHandled to avoid going through this again.\n    }\n  }\n\n  render() {\n    if (RECORDED_SECTIONS.includes(this.props.id)) {\n      this._ensureFirstRenderTsRecorded();\n      this._maybeSendBadStateEvent();\n    }\n    return this.props.children;\n  }\n}\n","/* globals Services */\n\"use strict\";\n\n/* istanbul ignore if */\nif (typeof ChromeUtils !== \"undefined\") {\n  ChromeUtils.import(\"resource://gre/modules/Services.jsm\");\n}\n\nlet usablePerfObj;\n\n/* istanbul ignore if */\n/* istanbul ignore else */\nif (typeof Services !== \"undefined\") {\n  // Borrow the high-resolution timer from the hidden window....\n  usablePerfObj = Services.appShell.hiddenDOMWindow.performance;\n} else if (typeof performance !== \"undefined\") {\n  // we must be running in content space\n  // eslint-disable-next-line no-undef\n  usablePerfObj = performance;\n} else {\n  // This is a dummy object so this file doesn't crash in the node prerendering\n  // task.\n  usablePerfObj = {\n    now() {},\n    mark() {},\n  };\n}\n\nfunction _PerfService(options) {\n  // For testing, so that we can use a fake Window.performance object with\n  // known state.\n  if (options && options.performanceObj) {\n    this._perf = options.performanceObj;\n  } else {\n    this._perf = usablePerfObj;\n  }\n}\n\n_PerfService.prototype = {\n  /**\n   * Calls the underlying mark() method on the appropriate Window.performance\n   * object to add a mark with the given name to the appropriate performance\n   * timeline.\n   *\n   * @param  {String} name  the name to give the current mark\n   * @return {void}\n   */\n  mark: function mark(str) {\n    this._perf.mark(str);\n  },\n\n  /**\n   * Calls the underlying getEntriesByName on the appropriate Window.performance\n   * object.\n   *\n   * @param  {String} name\n   * @param  {String} type eg \"mark\"\n   * @return {Array}       Performance* objects\n   */\n  getEntriesByName: function getEntriesByName(name, type) {\n    return this._perf.getEntriesByName(name, type);\n  },\n\n  /**\n   * The timeOrigin property from the appropriate performance object.\n   * Used to ensure that timestamps from the add-on code and the content code\n   * are comparable.\n   *\n   * @note If this is called from a context without a window\n   * (eg a JSM in chrome), it will return the timeOrigin of the XUL hidden\n   * window, which appears to be the first created window (and thus\n   * timeOrigin) in the browser.  Note also, however, there is also a private\n   * hidden window, presumably for private browsing, which appears to be\n   * created dynamically later.  Exactly how/when that shows up needs to be\n   * investigated.\n   *\n   * @return {Number} A double of milliseconds with a precision of 0.5us.\n   */\n  get timeOrigin() {\n    return this._perf.timeOrigin;\n  },\n\n  /**\n   * Returns the \"absolute\" version of performance.now(), i.e. one that\n   * should ([bug 1401406](https://bugzilla.mozilla.org/show_bug.cgi?id=1401406)\n   * be comparable across both chrome and content.\n   *\n   * @return {Number}\n   */\n  absNow: function absNow() {\n    return this.timeOrigin + this._perf.now();\n  },\n\n  /**\n   * This returns the absolute startTime from the most recent performance.mark()\n   * with the given name.\n   *\n   * @param  {String} name  the name to lookup the start time for\n   *\n   * @return {Number}       the returned start time, as a DOMHighResTimeStamp\n   *\n   * @throws {Error}        \"No Marks with the name ...\" if none are available\n   *\n   * @note Always surround calls to this by try/catch.  Otherwise your code\n   * may fail when the `privacy.resistFingerprinting` pref is true.  When\n   * this pref is set, all attempts to get marks will likely fail, which will\n   * cause this method to throw.\n   *\n   * See [bug 1369303](https://bugzilla.mozilla.org/show_bug.cgi?id=1369303)\n   * for more info.\n   */\n  getMostRecentAbsMarkStartByName(name) {\n    let entries = this.getEntriesByName(name, \"mark\");\n\n    if (!entries.length) {\n      throw new Error(`No marks with the name ${name}`);\n    }\n\n    let mostRecentEntry = entries[entries.length - 1];\n    return this._perf.timeOrigin + mostRecentEntry.startTime;\n  },\n};\n\nthis.perfService = new _PerfService();\nconst EXPORTED_SYMBOLS = [\"_PerfService\", \"perfService\"];\n","import {FormattedMessage} from \"react-intl\";\nimport React from \"react\";\n\nexport class MoreRecommendations extends React.PureComponent {\n  render() {\n    const {read_more_endpoint} = this.props;\n    if (read_more_endpoint) {\n      return (\n        <a className=\"more-recommendations\" href={read_more_endpoint}>\n          <FormattedMessage id=\"pocket_more_reccommendations\" />\n        </a>\n      );\n    }\n    return null;\n  }\n}\n","import {connect} from \"react-redux\";\nimport {FormattedMessage} from \"react-intl\";\nimport React from \"react\";\n\nexport class _PocketLoggedInCta extends React.PureComponent {\n  render() {\n    const {pocketCta} = this.props.Pocket;\n    return (\n      <span className=\"pocket-logged-in-cta\">\n        <a className=\"pocket-cta-button\" href={pocketCta.ctaUrl ? pocketCta.ctaUrl : \"https://getpocket.com/\"}>\n         {pocketCta.ctaButton ? pocketCta.ctaButton : <FormattedMessage id=\"pocket_cta_button\" />}\n        </a>\n\n        <a href={pocketCta.ctaUrl ? pocketCta.ctaUrl : \"https://getpocket.com/\"}>\n          <span className=\"cta-text\">\n           {pocketCta.ctaText ? pocketCta.ctaText : <FormattedMessage id=\"pocket_cta_text\" />}\n          </span>\n        </a>\n      </span>\n    );\n  }\n}\n\nexport const PocketLoggedInCta = connect(state => ({Pocket: state.Pocket}))(_PocketLoggedInCta);\n","import {FormattedMessage} from \"react-intl\";\nimport React from \"react\";\n\nexport class Topic extends React.PureComponent {\n  render() {\n    const {url, name} = this.props;\n    return (<li><a key={name} href={url}>{name}</a></li>);\n  }\n}\n\nexport class Topics extends React.PureComponent {\n  render() {\n    const {topics} = this.props;\n    return (\n      <span className=\"topics\">\n        <span><FormattedMessage id=\"pocket_read_more\" /></span>\n        <ul>{topics && topics.map(t => <Topic key={t.name} url={t.url} name={t.name} />)}</ul>\n      </span>\n    );\n  }\n}\n","import {actionCreators as ac, actionTypes as at} from \"common/Actions.jsm\";\nimport {MIN_CORNER_FAVICON_SIZE, MIN_RICH_FAVICON_SIZE, TOP_SITES_SOURCE} from \"./TopSitesConstants\";\nimport {CollapsibleSection} from \"content-src/components/CollapsibleSection/CollapsibleSection\";\nimport {ComponentPerfTimer} from \"content-src/components/ComponentPerfTimer/ComponentPerfTimer\";\nimport {connect} from \"react-redux\";\nimport {injectIntl} from \"react-intl\";\nimport React from \"react\";\nimport {SearchShortcutsForm} from \"./SearchShortcutsForm\";\nimport {TOP_SITES_MAX_SITES_PER_ROW} from \"common/Reducers.jsm\";\nimport {TopSiteForm} from \"./TopSiteForm\";\nimport {TopSiteList} from \"./TopSite\";\n\nfunction topSiteIconType(link) {\n  if (link.customScreenshotURL) {\n    return \"custom_screenshot\";\n  }\n  if (link.tippyTopIcon || link.faviconRef === \"tippytop\") {\n    return \"tippytop\";\n  }\n  if (link.faviconSize >= MIN_RICH_FAVICON_SIZE) {\n    return \"rich_icon\";\n  }\n  if (link.screenshot && link.faviconSize >= MIN_CORNER_FAVICON_SIZE) {\n    return \"screenshot_with_icon\";\n  }\n  if (link.screenshot) {\n    return \"screenshot\";\n  }\n  return \"no_image\";\n}\n\n/**\n * Iterates through TopSites and counts types of images.\n * @param acc Accumulator for reducer.\n * @param topsite Entry in TopSites.\n */\nfunction countTopSitesIconsTypes(topSites) {\n  const countTopSitesTypes = (acc, link) => {\n    acc[topSiteIconType(link)]++;\n    return acc;\n  };\n\n  return topSites.reduce(countTopSitesTypes, {\n    \"custom_screenshot\": 0,\n    \"screenshot_with_icon\": 0,\n    \"screenshot\": 0,\n    \"tippytop\": 0,\n    \"rich_icon\": 0,\n    \"no_image\": 0,\n  });\n}\n\nexport class _TopSites extends React.PureComponent {\n  constructor(props) {\n    super(props);\n    this.onEditFormClose = this.onEditFormClose.bind(this);\n    this.onSearchShortcutsFormClose = this.onSearchShortcutsFormClose.bind(this);\n  }\n\n  /**\n   * Dispatch session statistics about the quality of TopSites icons and pinned count.\n   */\n  _dispatchTopSitesStats() {\n    const topSites = this._getVisibleTopSites();\n    const topSitesIconsStats = countTopSitesIconsTypes(topSites);\n    const topSitesPinned = topSites.filter(site => !!site.isPinned).length;\n    const searchShortcuts = topSites.filter(site => !!site.searchTopSite).length;\n    // Dispatch telemetry event with the count of TopSites images types.\n    this.props.dispatch(ac.AlsoToMain({\n      type: at.SAVE_SESSION_PERF_DATA,\n      data: {\n        topsites_icon_stats: topSitesIconsStats,\n        topsites_pinned: topSitesPinned,\n        topsites_search_shortcuts: searchShortcuts,\n      },\n    }));\n  }\n\n  /**\n   * Return the TopSites that are visible based on prefs and window width.\n   */\n  _getVisibleTopSites() {\n    // We hide 2 sites per row when not in the wide layout.\n    let sitesPerRow = TOP_SITES_MAX_SITES_PER_ROW;\n    // $break-point-widest = 1072px (from _variables.scss)\n    if (!global.matchMedia(`(min-width: 1072px)`).matches) {\n      sitesPerRow -= 2;\n    }\n    return this.props.TopSites.rows.slice(0, this.props.TopSitesRows * sitesPerRow);\n  }\n\n  componentDidUpdate() {\n    this._dispatchTopSitesStats();\n  }\n\n  componentDidMount() {\n    this._dispatchTopSitesStats();\n  }\n\n  onEditFormClose() {\n    this.props.dispatch(ac.UserEvent({\n      source: TOP_SITES_SOURCE,\n      event: \"TOP_SITES_EDIT_CLOSE\",\n    }));\n    this.props.dispatch({type: at.TOP_SITES_CANCEL_EDIT});\n  }\n\n  onSearchShortcutsFormClose() {\n    this.props.dispatch(ac.UserEvent({\n      source: TOP_SITES_SOURCE,\n      event: \"SEARCH_EDIT_CLOSE\",\n    }));\n    this.props.dispatch({type: at.TOP_SITES_CLOSE_SEARCH_SHORTCUTS_MODAL});\n  }\n\n  render() {\n    const {props} = this;\n    const {editForm, showSearchShortcutsForm} = props.TopSites;\n    const extraMenuOptions = [\"AddTopSite\"];\n    if (props.Prefs.values[\"improvesearch.topSiteSearchShortcuts\"]) {\n      extraMenuOptions.push(\"AddSearchShortcut\");\n    }\n\n    return (<ComponentPerfTimer id=\"topsites\" initialized={props.TopSites.initialized} dispatch={props.dispatch}>\n      <CollapsibleSection\n        className=\"top-sites\"\n        icon=\"topsites\"\n        id=\"topsites\"\n        title={{id: \"header_top_sites\"}}\n        extraMenuOptions={extraMenuOptions}\n        showPrefName=\"feeds.topsites\"\n        eventSource={TOP_SITES_SOURCE}\n        collapsed={props.TopSites.pref ? props.TopSites.pref.collapsed : undefined}\n        isFirst={props.isFirst}\n        isLast={props.isLast}\n        dispatch={props.dispatch}>\n        <TopSiteList TopSites={props.TopSites} TopSitesRows={props.TopSitesRows} dispatch={props.dispatch} intl={props.intl} topSiteIconType={topSiteIconType} />\n        <div className=\"edit-topsites-wrapper\">\n          {editForm &&\n            <div className=\"edit-topsites\">\n              <div className=\"modal-overlay\" onClick={this.onEditFormClose} />\n              <div className=\"modal\">\n                <TopSiteForm\n                  site={props.TopSites.rows[editForm.index]}\n                  onClose={this.onEditFormClose}\n                  dispatch={this.props.dispatch}\n                  intl={this.props.intl}\n                  {...editForm} />\n              </div>\n            </div>\n          }\n          {showSearchShortcutsForm &&\n            <div className=\"edit-search-shortcuts\">\n              <div className=\"modal-overlay\" onClick={this.onSearchShortcutsFormClose} />\n              <div className=\"modal\">\n                <SearchShortcutsForm\n                  TopSites={props.TopSites}\n                  onClose={this.onSearchShortcutsFormClose}\n                  dispatch={this.props.dispatch} />\n              </div>\n            </div>\n          }\n        </div>\n      </CollapsibleSection>\n    </ComponentPerfTimer>);\n  }\n}\n\nexport const TopSites = connect(state => ({\n  TopSites: state.TopSites,\n  Prefs: state.Prefs,\n  TopSitesRows: state.Prefs.values.topSitesRows,\n}))(injectIntl(_TopSites));\n","export const TOP_SITES_SOURCE = \"TOP_SITES\";\nexport const TOP_SITES_CONTEXT_MENU_OPTIONS = [\"CheckPinTopSite\", \"EditTopSite\", \"Separator\",\n  \"OpenInNewWindow\", \"OpenInPrivateWindow\", \"Separator\", \"BlockUrl\", \"DeleteUrl\"];\n// the special top site for search shortcut experiment can only have the option to unpin (which removes) the topsite\nexport const TOP_SITES_SEARCH_SHORTCUTS_CONTEXT_MENU_OPTIONS = [\"CheckPinTopSite\", \"Separator\", \"BlockUrl\"];\n// minimum size necessary to show a rich icon instead of a screenshot\nexport const MIN_RICH_FAVICON_SIZE = 96;\n// minimum size necessary to show any icon in the top left corner with a screenshot\nexport const MIN_CORNER_FAVICON_SIZE = 16;\n","import {actionCreators as ac, actionTypes as at} from \"common/Actions.jsm\";\nimport {FormattedMessage} from \"react-intl\";\nimport React from \"react\";\nimport {TOP_SITES_SOURCE} from \"./TopSitesConstants\";\n\nclass SelectableSearchShortcut extends React.PureComponent {\n  render() {\n    const {shortcut, selected} = this.props;\n    const imageStyle = {backgroundImage: `url(\"${shortcut.tippyTopIcon}\")`};\n    return (\n      <div className=\"top-site-outer search-shortcut\">\n        <input type=\"checkbox\" id={shortcut.keyword} name={shortcut.keyword} checked={selected} onChange={this.props.onChange} />\n        <label htmlFor={shortcut.keyword}>\n          <div className=\"top-site-inner\">\n            <span>\n              <div className=\"tile\">\n                <div className=\"top-site-icon rich-icon\" style={imageStyle} data-fallback=\"@\" />\n                <div className=\"top-site-icon search-topsite\" />\n              </div>\n              <div className=\"title\">\n                <span dir=\"auto\">{shortcut.keyword}</span>\n              </div>\n            </span>\n          </div>\n        </label>\n      </div>\n    );\n  }\n}\n\nexport class SearchShortcutsForm extends React.PureComponent {\n  constructor(props) {\n    super(props);\n    this.handleChange = this.handleChange.bind(this);\n    this.onCancelButtonClick = this.onCancelButtonClick.bind(this);\n    this.onSaveButtonClick = this.onSaveButtonClick.bind(this);\n\n    // clone the shortcuts and add them to the state so we can add isSelected property\n    const shortcuts = [];\n    const {rows, searchShortcuts} = props.TopSites;\n    searchShortcuts.forEach(shortcut => {\n      shortcuts.push({\n        ...shortcut,\n        isSelected: !!rows.find(row => row && row.isPinned && row.searchTopSite && row.label === shortcut.keyword),\n      });\n    });\n    this.state = {shortcuts};\n  }\n\n  handleChange(event) {\n    const {target} = event;\n    const {name, checked} = target;\n    this.setState(prevState => {\n      const shortcuts = prevState.shortcuts.slice();\n      let shortcut = shortcuts.find(({keyword}) => keyword === name);\n      shortcut.isSelected = checked;\n      return {shortcuts};\n    });\n  }\n\n  onCancelButtonClick(ev) {\n    ev.preventDefault();\n    this.props.onClose();\n  }\n\n  onSaveButtonClick(ev) {\n    ev.preventDefault();\n\n    // Check if there were any changes and act accordingly\n    const {rows} = this.props.TopSites;\n    const pinQueue = [];\n    const unpinQueue = [];\n    this.state.shortcuts.forEach(shortcut => {\n      const alreadyPinned = rows.find(row => row && row.isPinned && row.searchTopSite && row.label === shortcut.keyword);\n      if (shortcut.isSelected && !alreadyPinned) {\n        pinQueue.push(this._searchTopSite(shortcut));\n      } else if (!shortcut.isSelected && alreadyPinned) {\n        unpinQueue.push({url: alreadyPinned.url, searchVendor: shortcut.shortURL});\n      }\n    });\n\n    // Tell the feed to do the work.\n    this.props.dispatch(ac.OnlyToMain({\n      type: at.UPDATE_PINNED_SEARCH_SHORTCUTS,\n      data: {\n        addedShortcuts: pinQueue,\n        deletedShortcuts: unpinQueue,\n      },\n    }));\n\n    // Send the Telemetry pings.\n    pinQueue.forEach(shortcut => {\n      this.props.dispatch(ac.UserEvent({\n        source: TOP_SITES_SOURCE,\n        event: \"SEARCH_EDIT_ADD\",\n        value: {search_vendor: shortcut.searchVendor},\n      }));\n    });\n    unpinQueue.forEach(shortcut => {\n      this.props.dispatch(ac.UserEvent({\n        source: TOP_SITES_SOURCE,\n        event: \"SEARCH_EDIT_DELETE\",\n        value: {search_vendor: shortcut.searchVendor},\n      }));\n    });\n\n    this.props.onClose();\n  }\n\n  _searchTopSite(shortcut) {\n    return {\n      url: shortcut.url,\n      searchTopSite: true,\n      label: shortcut.keyword,\n      searchVendor: shortcut.shortURL,\n    };\n  }\n\n  render() {\n    return (\n      <form className=\"topsite-form\">\n        <div className=\"search-shortcuts-container\">\n          <h3 className=\"section-title\">\n            <FormattedMessage id=\"section_menu_action_add_search_engine\" />\n          </h3>\n          <div>\n            {this.state.shortcuts.map(shortcut => <SelectableSearchShortcut key={shortcut.keyword} shortcut={shortcut} selected={shortcut.isSelected} onChange={this.handleChange} />)}\n          </div>\n        </div>\n        <section className=\"actions\">\n          <button className=\"cancel\" type=\"button\" onClick={this.onCancelButtonClick}>\n            <FormattedMessage id=\"topsites_form_cancel_button\" />\n          </button>\n          <button className=\"done\" type=\"submit\" onClick={this.onSaveButtonClick}>\n            <FormattedMessage id=\"topsites_form_save_button\" />\n          </button>\n        </section>\n      </form>\n    );\n  }\n}\n","import {actionCreators as ac, actionTypes as at} from \"common/Actions.jsm\";\nimport {FormattedMessage, injectIntl} from \"react-intl\";\nimport {\n  MIN_CORNER_FAVICON_SIZE,\n  MIN_RICH_FAVICON_SIZE,\n  TOP_SITES_CONTEXT_MENU_OPTIONS,\n  TOP_SITES_SEARCH_SHORTCUTS_CONTEXT_MENU_OPTIONS,\n  TOP_SITES_SOURCE,\n} from \"./TopSitesConstants\";\nimport {LinkMenu} from \"content-src/components/LinkMenu/LinkMenu\";\nimport React from \"react\";\nimport {ScreenshotUtils} from \"content-src/lib/screenshot-utils\";\nimport {TOP_SITES_MAX_SITES_PER_ROW} from \"common/Reducers.jsm\";\n\nexport class TopSiteLink extends React.PureComponent {\n  constructor(props) {\n    super(props);\n    this.state = {screenshotImage: null};\n    this.onDragEvent = this.onDragEvent.bind(this);\n    this.onKeyPress = this.onKeyPress.bind(this);\n  }\n\n  /*\n   * Helper to determine whether the drop zone should allow a drop. We only allow\n   * dropping top sites for now.\n   */\n  _allowDrop(e) {\n    return e.dataTransfer.types.includes(\"text/topsite-index\");\n  }\n\n  onDragEvent(event) {\n    switch (event.type) {\n      case \"click\":\n        // Stop any link clicks if we started any dragging\n        if (this.dragged) {\n          event.preventDefault();\n        }\n        break;\n      case \"dragstart\":\n        this.dragged = true;\n        event.dataTransfer.effectAllowed = \"move\";\n        event.dataTransfer.setData(\"text/topsite-index\", this.props.index);\n        event.target.blur();\n        this.props.onDragEvent(event, this.props.index, this.props.link, this.props.title);\n        break;\n      case \"dragend\":\n        this.props.onDragEvent(event);\n        break;\n      case \"dragenter\":\n      case \"dragover\":\n      case \"drop\":\n        if (this._allowDrop(event)) {\n          event.preventDefault();\n          this.props.onDragEvent(event, this.props.index);\n        }\n        break;\n      case \"mousedown\":\n        // Block the scroll wheel from appearing for middle clicks on search top sites\n        if (event.button === 1 && this.props.link.searchTopSite) {\n          event.preventDefault();\n        }\n        // Reset at the first mouse event of a potential drag\n        this.dragged = false;\n        break;\n    }\n  }\n\n  /**\n   * Helper to obtain the next state based on nextProps and prevState.\n   *\n   * NOTE: Rename this method to getDerivedStateFromProps when we update React\n   *       to >= 16.3. We will need to update tests as well. We cannot rename this\n   *       method to getDerivedStateFromProps now because there is a mismatch in\n   *       the React version that we are using for both testing and production.\n   *       (i.e. react-test-render => \"16.3.2\", react => \"16.2.0\").\n   *\n   * See https://github.com/airbnb/enzyme/blob/master/packages/enzyme-adapter-react-16/package.json#L43.\n   */\n  static getNextStateFromProps(nextProps, prevState) {\n    const {screenshot} = nextProps.link;\n    const imageInState = ScreenshotUtils.isRemoteImageLocal(prevState.screenshotImage, screenshot);\n    if (imageInState) {\n      return null;\n    }\n\n    // Since image was updated, attempt to revoke old image blob URL, if it exists.\n    ScreenshotUtils.maybeRevokeBlobObjectURL(prevState.screenshotImage);\n\n    return {screenshotImage: ScreenshotUtils.createLocalImageObject(screenshot)};\n  }\n\n  // NOTE: Remove this function when we update React to >= 16.3 since React will\n  //       call getDerivedStateFromProps automatically. We will also need to\n  //       rename getNextStateFromProps to getDerivedStateFromProps.\n  componentWillMount() {\n    const nextState = TopSiteLink.getNextStateFromProps(this.props, this.state);\n    if (nextState) {\n      this.setState(nextState);\n    }\n  }\n\n  // NOTE: Remove this function when we update React to >= 16.3 since React will\n  //       call getDerivedStateFromProps automatically. We will also need to\n  //       rename getNextStateFromProps to getDerivedStateFromProps.\n  componentWillReceiveProps(nextProps) {\n    const nextState = TopSiteLink.getNextStateFromProps(nextProps, this.state);\n    if (nextState) {\n      this.setState(nextState);\n    }\n  }\n\n  componentWillUnmount() {\n    ScreenshotUtils.maybeRevokeBlobObjectURL(this.state.screenshotImage);\n  }\n\n  onKeyPress(event) {\n    // If we have tabbed to a search shortcut top site, and we click 'enter',\n    // we should execute the onClick function. This needs to be added because\n    // search top sites are anchor tags without an href. See bug 1483135\n    if (this.props.link.searchTopSite && event.key === \"Enter\") {\n      this.props.onClick(event);\n    }\n  }\n\n  render() {\n    const {children, className, defaultStyle, isDraggable, link, onClick, title} = this.props;\n    const topSiteOuterClassName = `top-site-outer${className ? ` ${className}` : \"\"}${link.isDragged ? \" dragged\" : \"\"}${link.searchTopSite ? \" search-shortcut\" : \"\"}`;\n    const {tippyTopIcon, faviconSize} = link;\n    const [letterFallback] = title;\n    let imageClassName;\n    let imageStyle;\n    let showSmallFavicon = false;\n    let smallFaviconStyle;\n    let smallFaviconFallback;\n    let hasScreenshotImage = this.state.screenshotImage && this.state.screenshotImage.url;\n    if (defaultStyle) { // force no styles (letter fallback) even if the link has imagery\n      smallFaviconFallback = false;\n    } else if (link.searchTopSite) {\n      imageClassName = \"top-site-icon rich-icon\";\n      imageStyle = {\n        backgroundColor: link.backgroundColor,\n        backgroundImage: `url(${tippyTopIcon})`,\n      };\n      smallFaviconStyle = {backgroundImage:  `url(${tippyTopIcon})`};\n    } else if (link.customScreenshotURL) {\n      // assume high quality custom screenshot and use rich icon styles and class names\n      imageClassName = \"top-site-icon rich-icon\";\n      imageStyle = {\n        backgroundColor: link.backgroundColor,\n        backgroundImage: hasScreenshotImage ? `url(${this.state.screenshotImage.url})` : \"none\",\n      };\n    } else if (tippyTopIcon || faviconSize >= MIN_RICH_FAVICON_SIZE) {\n      // styles and class names for top sites with rich icons\n      imageClassName = \"top-site-icon rich-icon\";\n      imageStyle = {\n        backgroundColor: link.backgroundColor,\n        backgroundImage: `url(${tippyTopIcon || link.favicon})`,\n      };\n    } else {\n      // styles and class names for top sites with screenshot + small icon in top left corner\n      imageClassName = `screenshot${hasScreenshotImage ? \" active\" : \"\"}`;\n      imageStyle = {backgroundImage: hasScreenshotImage ? `url(${this.state.screenshotImage.url})` : \"none\"};\n\n      // only show a favicon in top left if it's greater than 16x16\n      if (faviconSize >= MIN_CORNER_FAVICON_SIZE) {\n        showSmallFavicon = true;\n        smallFaviconStyle = {backgroundImage:  `url(${link.favicon})`};\n      } else if (hasScreenshotImage) {\n        // Don't show a small favicon if there is no screenshot, because that\n        // would result in two fallback icons\n        showSmallFavicon = true;\n        smallFaviconFallback = true;\n      }\n    }\n    let draggableProps = {};\n    if (isDraggable) {\n      draggableProps = {\n        onClick: this.onDragEvent,\n        onDragEnd: this.onDragEvent,\n        onDragStart: this.onDragEvent,\n        onMouseDown: this.onDragEvent,\n      };\n    }\n    return (<li className={topSiteOuterClassName} onDrop={this.onDragEvent} onDragOver={this.onDragEvent} onDragEnter={this.onDragEvent} onDragLeave={this.onDragEvent} {...draggableProps}>\n      <div className=\"top-site-inner\">\n         <a href={link.searchTopSite ? undefined : link.url} tabIndex=\"0\" onKeyPress={this.onKeyPress} onClick={onClick} draggable={true}>\n            <div className=\"tile\" aria-hidden={true} data-fallback={letterFallback}>\n              <div className={imageClassName} style={imageStyle} />\n              {link.searchTopSite && <div className=\"top-site-icon search-topsite\" />}\n              {showSmallFavicon && <div\n                className=\"top-site-icon default-icon\"\n                data-fallback={smallFaviconFallback && letterFallback}\n                style={smallFaviconStyle} />}\n           </div>\n           <div className={`title ${link.isPinned ? \"pinned\" : \"\"}`}>\n             {link.isPinned && <div className=\"icon icon-pin-small\" />}\n              <span dir=\"auto\">{title}</span>\n           </div>\n         </a>\n         {children}\n      </div>\n    </li>);\n  }\n}\nTopSiteLink.defaultProps = {\n  title: \"\",\n  link: {},\n  isDraggable: true,\n};\n\nexport class TopSite extends React.PureComponent {\n  constructor(props) {\n    super(props);\n    this.state = {showContextMenu: false};\n    this.onLinkClick = this.onLinkClick.bind(this);\n    this.onMenuButtonClick = this.onMenuButtonClick.bind(this);\n    this.onMenuUpdate = this.onMenuUpdate.bind(this);\n  }\n\n  /**\n   * Report to telemetry additional information about the item.\n   */\n  _getTelemetryInfo() {\n    const value = {icon_type: this.props.link.iconType};\n    // Filter out \"not_pinned\" type for being the default\n    if (this.props.link.isPinned) {\n      value.card_type = \"pinned\";\n    }\n    if (this.props.link.searchTopSite) {\n      // Set the card_type as \"search\" regardless of its pinning status\n      value.card_type = \"search\";\n      value.search_vendor = this.props.link.hostname;\n    }\n    return {value};\n  }\n\n  userEvent(event) {\n    this.props.dispatch(ac.UserEvent(Object.assign({\n      event,\n      source: TOP_SITES_SOURCE,\n      action_position: this.props.index,\n    }, this._getTelemetryInfo())));\n  }\n\n  onLinkClick(event) {\n    this.userEvent(\"CLICK\");\n\n    // Specially handle a top site link click for \"typed\" frecency bonus as\n    // specified as a property on the link.\n    event.preventDefault();\n    const {altKey, button, ctrlKey, metaKey, shiftKey} = event;\n    if (!this.props.link.searchTopSite) {\n      this.props.dispatch(ac.OnlyToMain({\n        type: at.OPEN_LINK,\n        data: Object.assign(this.props.link, {event: {altKey, button, ctrlKey, metaKey, shiftKey}}),\n      }));\n    } else {\n      this.props.dispatch(ac.OnlyToMain({\n        type: at.FILL_SEARCH_TERM,\n        data: {label: this.props.link.label},\n      }));\n    }\n  }\n\n  onMenuButtonClick(event) {\n    event.preventDefault();\n    this.props.onActivate(this.props.index);\n    this.setState({showContextMenu: true});\n  }\n\n  onMenuUpdate(showContextMenu) {\n    this.setState({showContextMenu});\n  }\n\n  render() {\n    const {props} = this;\n    const {link} = props;\n    const isContextMenuOpen = this.state.showContextMenu && props.activeIndex === props.index;\n    const title = link.label || link.hostname;\n    return (<TopSiteLink {...props} onClick={this.onLinkClick} onDragEvent={this.props.onDragEvent} className={`${props.className || \"\"}${isContextMenuOpen ? \" active\" : \"\"}`} title={title}>\n        <div>\n          <button className=\"context-menu-button icon\" title={this.props.intl.formatMessage({id: \"context_menu_title\"})} onClick={this.onMenuButtonClick}>\n            <span className=\"sr-only\">\n              <FormattedMessage id=\"context_menu_button_sr\" values={{title}} />\n            </span>\n          </button>\n          {isContextMenuOpen &&\n            <LinkMenu\n              dispatch={props.dispatch}\n              index={props.index}\n              onUpdate={this.onMenuUpdate}\n              options={link.searchTopSite ? TOP_SITES_SEARCH_SHORTCUTS_CONTEXT_MENU_OPTIONS : TOP_SITES_CONTEXT_MENU_OPTIONS}\n              site={link}\n              siteInfo={this._getTelemetryInfo()}\n              source={TOP_SITES_SOURCE} />\n          }\n        </div>\n    </TopSiteLink>);\n  }\n}\nTopSite.defaultProps = {\n  link: {},\n  onActivate() {},\n};\n\nexport class TopSitePlaceholder extends React.PureComponent {\n  constructor(props) {\n    super(props);\n    this.onEditButtonClick = this.onEditButtonClick.bind(this);\n  }\n\n  onEditButtonClick() {\n    this.props.dispatch(\n      {type: at.TOP_SITES_EDIT, data: {index: this.props.index}});\n  }\n\n  render() {\n    return (<TopSiteLink {...this.props} className={`placeholder ${this.props.className || \"\"}`} isDraggable={false}>\n      <button className=\"context-menu-button edit-button icon\"\n       title={this.props.intl.formatMessage({id: \"edit_topsites_edit_button\"})}\n       onClick={this.onEditButtonClick} />\n    </TopSiteLink>);\n  }\n}\n\nexport class _TopSiteList extends React.PureComponent {\n  static get DEFAULT_STATE() {\n    return {\n      activeIndex: null,\n      draggedIndex: null,\n      draggedSite: null,\n      draggedTitle: null,\n      topSitesPreview: null,\n    };\n  }\n\n  constructor(props) {\n    super(props);\n    this.state = _TopSiteList.DEFAULT_STATE;\n    this.onDragEvent = this.onDragEvent.bind(this);\n    this.onActivate = this.onActivate.bind(this);\n  }\n\n  componentWillReceiveProps(nextProps) {\n    if (this.state.draggedSite) {\n      const prevTopSites = this.props.TopSites && this.props.TopSites.rows;\n      const newTopSites = nextProps.TopSites && nextProps.TopSites.rows;\n      if (prevTopSites && prevTopSites[this.state.draggedIndex] &&\n        prevTopSites[this.state.draggedIndex].url === this.state.draggedSite.url &&\n        (!newTopSites[this.state.draggedIndex] || newTopSites[this.state.draggedIndex].url !== this.state.draggedSite.url)) {\n        // We got the new order from the redux store via props. We can clear state now.\n        this.setState(_TopSiteList.DEFAULT_STATE);\n      }\n    }\n  }\n\n  userEvent(event, index) {\n    this.props.dispatch(ac.UserEvent({\n      event,\n      source: TOP_SITES_SOURCE,\n      action_position: index,\n    }));\n  }\n\n  onDragEvent(event, index, link, title) {\n    switch (event.type) {\n      case \"dragstart\":\n        this.dropped = false;\n        this.setState({\n          draggedIndex: index,\n          draggedSite: link,\n          draggedTitle: title,\n          activeIndex: null,\n        });\n        this.userEvent(\"DRAG\", index);\n        break;\n      case \"dragend\":\n        if (!this.dropped) {\n          // If there was no drop event, reset the state to the default.\n          this.setState(_TopSiteList.DEFAULT_STATE);\n        }\n        break;\n      case \"dragenter\":\n        if (index === this.state.draggedIndex) {\n          this.setState({topSitesPreview: null});\n        } else {\n          this.setState({topSitesPreview: this._makeTopSitesPreview(index)});\n        }\n        break;\n      case \"drop\":\n        if (index !== this.state.draggedIndex) {\n          this.dropped = true;\n          this.props.dispatch(ac.AlsoToMain({\n            type: at.TOP_SITES_INSERT,\n            data: {\n              site: {\n                url: this.state.draggedSite.url,\n                label: this.state.draggedTitle,\n                customScreenshotURL: this.state.draggedSite.customScreenshotURL,\n                // Only if the search topsites experiment is enabled\n                ...(this.state.draggedSite.searchTopSite && {searchTopSite: true}),\n              },\n              index,\n              draggedFromIndex: this.state.draggedIndex,\n            },\n          }));\n          this.userEvent(\"DROP\", index);\n        }\n        break;\n    }\n  }\n\n  _getTopSites() {\n    // Make a copy of the sites to truncate or extend to desired length\n    let topSites = this.props.TopSites.rows.slice();\n    topSites.length = this.props.TopSitesRows * TOP_SITES_MAX_SITES_PER_ROW;\n    return topSites;\n  }\n\n  /**\n   * Make a preview of the topsites that will be the result of dropping the currently\n   * dragged site at the specified index.\n   */\n  _makeTopSitesPreview(index) {\n    const topSites = this._getTopSites();\n    topSites[this.state.draggedIndex] = null;\n    const pinnedOnly = topSites.map(site => ((site && site.isPinned) ? site : null));\n    const unpinned = topSites.filter(site => site && !site.isPinned);\n    const siteToInsert = Object.assign({}, this.state.draggedSite, {isPinned: true, isDragged: true});\n    if (!pinnedOnly[index]) {\n      pinnedOnly[index] = siteToInsert;\n    } else {\n      // Find the hole to shift the pinned site(s) towards. We shift towards the\n      // hole left by the site being dragged.\n      let holeIndex = index;\n      const indexStep = index > this.state.draggedIndex ? -1 : 1;\n      while (pinnedOnly[holeIndex]) {\n        holeIndex += indexStep;\n      }\n\n      // Shift towards the hole.\n      const shiftingStep = index > this.state.draggedIndex ? 1 : -1;\n      while (holeIndex !== index) {\n        const nextIndex = holeIndex + shiftingStep;\n        pinnedOnly[holeIndex] = pinnedOnly[nextIndex];\n        holeIndex = nextIndex;\n      }\n      pinnedOnly[index] = siteToInsert;\n    }\n\n    // Fill in the remaining holes with unpinned sites.\n    const preview = pinnedOnly;\n    for (let i = 0; i < preview.length; i++) {\n      if (!preview[i]) {\n        preview[i] = unpinned.shift() || null;\n      }\n    }\n\n    return preview;\n  }\n\n  onActivate(index) {\n    this.setState({activeIndex: index});\n  }\n\n  render() {\n    const {props} = this;\n    const topSites = this.state.topSitesPreview || this._getTopSites();\n    const topSitesUI = [];\n    const commonProps = {\n      onDragEvent: this.onDragEvent,\n      dispatch: props.dispatch,\n      intl: props.intl,\n    };\n    // We assign a key to each placeholder slot. We need it to be independent\n    // of the slot index (i below) so that the keys used stay the same during\n    // drag and drop reordering and the underlying DOM nodes are reused.\n    // This mostly (only?) affects linux so be sure to test on linux before changing.\n    let holeIndex = 0;\n\n    // On narrow viewports, we only show 6 sites per row. We'll mark the rest as\n    // .hide-for-narrow to hide in CSS via @media query.\n    const maxNarrowVisibleIndex = props.TopSitesRows * 6;\n\n    for (let i = 0, l = topSites.length; i < l; i++) {\n      const link = topSites[i] && Object.assign({}, topSites[i], {iconType: this.props.topSiteIconType(topSites[i])});\n      const slotProps = {\n        key: link ? link.url : holeIndex++,\n        index: i,\n      };\n      if (i >= maxNarrowVisibleIndex) {\n        slotProps.className = \"hide-for-narrow\";\n      }\n      topSitesUI.push(!link ? (\n        <TopSitePlaceholder\n          {...slotProps}\n          {...commonProps} />\n      ) : (\n        <TopSite\n          link={link}\n          activeIndex={this.state.activeIndex}\n          onActivate={this.onActivate}\n          {...slotProps}\n          {...commonProps} />\n      ));\n    }\n    return (<ul className={`top-sites-list${this.state.draggedSite ? \" dnd-active\" : \"\"}`}>\n      {topSitesUI}\n    </ul>);\n  }\n}\n\nexport const TopSiteList = injectIntl(_TopSiteList);\n","import {actionCreators as ac, actionTypes as at} from \"common/Actions.jsm\";\nimport {perfService as perfSvc} from \"common/PerfService.jsm\";\n\nconst VISIBLE = \"visible\";\nconst VISIBILITY_CHANGE_EVENT = \"visibilitychange\";\n\nexport class DetectUserSessionStart {\n  constructor(store, options = {}) {\n    this._store = store;\n    // Overrides for testing\n    this.document = options.document || global.document;\n    this._perfService = options.perfService || perfSvc;\n    this._onVisibilityChange = this._onVisibilityChange.bind(this);\n  }\n\n  /**\n   * sendEventOrAddListener - Notify immediately if the page is already visible,\n   *                    or else set up a listener for when visibility changes.\n   *                    This is needed for accurate session tracking for telemetry,\n   *                    because tabs are pre-loaded.\n   */\n  sendEventOrAddListener() {\n    if (this.document.visibilityState === VISIBLE) {\n      // If the document is already visible, to the user, send a notification\n      // immediately that a session has started.\n      this._sendEvent();\n    } else {\n      // If the document is not visible, listen for when it does become visible.\n      this.document.addEventListener(VISIBILITY_CHANGE_EVENT, this._onVisibilityChange);\n    }\n  }\n\n  /**\n   * _sendEvent - Sends a message to the main process to indicate the current\n   *              tab is now visible to the user, includes the\n   *              visibility_event_rcvd_ts time in ms from the UNIX epoch.\n   */\n  _sendEvent() {\n    this._perfService.mark(\"visibility_event_rcvd_ts\");\n\n    try {\n      let visibility_event_rcvd_ts = this._perfService\n        .getMostRecentAbsMarkStartByName(\"visibility_event_rcvd_ts\");\n\n      this._store.dispatch(ac.AlsoToMain({\n        type: at.SAVE_SESSION_PERF_DATA,\n        data: {visibility_event_rcvd_ts},\n      }));\n    } catch (ex) {\n      // If this failed, it's likely because the `privacy.resistFingerprinting`\n      // pref is true.  We should at least not blow up.\n    }\n  }\n\n  /**\n   * _onVisibilityChange - If the visibility has changed to visible, sends a notification\n   *                      and removes the event listener. This should only be called once per tab.\n   */\n  _onVisibilityChange() {\n    if (this.document.visibilityState === VISIBLE) {\n      this._sendEvent();\n      this.document.removeEventListener(VISIBILITY_CHANGE_EVENT, this._onVisibilityChange);\n    }\n  }\n}\n","export function enableASRouterContent(store, asrouterContent) {\n  // Enable asrouter content\n  store.subscribe(() => {\n    const state = store.getState();\n    if (!state.ASRouter.initialized) {\n      return;\n    }\n\n    if (!asrouterContent.initialized) {\n      asrouterContent.init(store);\n    }\n  });\n  // Return this for testing purposes\n  return {asrouterContent};\n}\n","import React from \"react\";\n\nconst ALLOWED_STYLE_TAGS = [\"color\", \"backgroundColor\"];\n\nexport const Button = props => {\n  const style = {};\n\n  // Add allowed style tags from props, e.g. props.color becomes style={color: props.color}\n  for (const tag of ALLOWED_STYLE_TAGS) {\n    if (typeof props[tag] !== \"undefined\") {\n      style[tag] = props[tag];\n    }\n  }\n  // remove border if bg is set to something custom\n  if (style.backgroundColor) {\n    style.border = \"0\";\n  }\n\n  return (<button onClick={props.onClick}\n    className={props.className || \"ASRouterButton secondary\"}\n    style={style}>\n    {props.children}\n  </button>);\n};\n","export function safeURI(url) {\n  if (!url) {\n    return \"\";\n  }\n  const {protocol} = new URL(url);\n  const isAllowed = [\n    \"http:\",\n    \"https:\",\n    \"data:\",\n    \"resource:\",\n    \"chrome:\",\n  ].includes(protocol);\n  if (!isAllowed) {\n    console.warn(`The protocol ${protocol} is not allowed for template URLs.`); // eslint-disable-line no-console\n  }\n  return isAllowed ? url : \"\";\n}\n","import {Localized} from \"fluent-react\";\nimport React from \"react\";\nimport {RICH_TEXT_KEYS} from \"../../rich-text-strings\";\nimport {safeURI} from \"../../template-utils\";\n\n// Elements allowed in snippet content\nconst ALLOWED_TAGS = {\n  b: <b />,\n  i: <i />,\n  u: <u />,\n  strong: <strong />,\n  em: <em />,\n  br: <br />,\n};\n\n/**\n * Transform an object (tag name: {url}) into (tag name: anchor) where the url\n * is used as href, in order to render links inside a Fluent.Localized component.\n */\nexport function convertLinks(links, sendClick, doNotAutoBlock, openNewWindow = false) {\n  if (links) {\n    return Object.keys(links).reduce((acc, linkTag) => {\n      const {action} = links[linkTag];\n      // Setting the value to false will not include the attribute in the anchor\n      const url = action ? false : safeURI(links[linkTag].url);\n\n      acc[linkTag] = (<a href={url}\n        target={openNewWindow ? \"_blank\" : \"\"}\n        data-metric={links[linkTag].metric}\n        data-action={action}\n        data-args={links[linkTag].args}\n        data-do_not_autoblock={doNotAutoBlock}\n        onClick={sendClick} />);\n      return acc;\n    }, {});\n  }\n\n  return null;\n}\n\n/**\n * Message wrapper used to sanitize markup and render HTML.\n */\nexport function RichText(props) {\n  if (!RICH_TEXT_KEYS.includes(props.localization_id)) {\n    throw new Error(`ASRouter: ${props.localization_id} is not a valid rich text property. If you want it to be processed, you need to add it to asrouter/rich-text-strings.js`);\n  }\n  return (\n    <Localized id={props.localization_id} {...ALLOWED_TAGS} {...props.customElements} {...convertLinks(props.links, props.sendClick, props.doNotAutoBlock, props.openNewWindow)}>\n      <span>{props.text}</span>\n    </Localized>\n  );\n}\n","import React from \"react\";\nimport schema from \"../../templates/SimpleSnippet/SimpleSnippet.schema.json\";\n\nexport class SnippetBase extends React.PureComponent {\n  constructor(props) {\n    super(props);\n    this.onBlockClicked = this.onBlockClicked.bind(this);\n  }\n\n  onBlockClicked() {\n    if (this.props.provider !== \"preview\") {\n      this.props.sendUserActionTelemetry({event: \"BLOCK\", id: this.props.UISurface});\n    }\n\n    this.props.onBlock();\n  }\n\n  renderDismissButton() {\n    if (this.props.footerDismiss) {\n      return (\n        <div className=\"footer\">\n          <div className=\"footer-content\">\n            <button\n              className=\"ASRouterButton secondary\"\n              onClick={this.props.onDismiss}>\n              {this.props.content.scene2_dismiss_button_text}\n            </button>\n          </div>\n        </div>\n      );\n    }\n\n    const defaultTitle = schema.properties.block_button_text.default;\n    return (\n      <button className=\"blockButton\" title={this.props.content.block_button_text || defaultTitle} onClick={this.onBlockClicked} />\n    );\n  }\n\n  render() {\n    const {props} = this;\n\n    const containerClassName = `SnippetBaseContainer${props.className ? ` ${props.className}` : \"\"}`;\n\n    return (<div className={containerClassName} style={this.props.textStyle}>\n      <div className=\"innerWrapper\">\n        {props.children}\n      </div>\n      {this.renderDismissButton()}\n    </div>);\n  }\n}\n","import {Button} from \"../../components/Button/Button\";\nimport React from \"react\";\nimport {RichText} from \"../../components/RichText/RichText\";\nimport {safeURI} from \"../../template-utils\";\nimport {SnippetBase} from \"../../components/SnippetBase/SnippetBase\";\n\nconst DEFAULT_ICON_PATH = \"chrome://branding/content/icon64.png\";\n\nexport class SimpleSnippet extends React.PureComponent {\n  constructor(props) {\n    super(props);\n    this.onButtonClick = this.onButtonClick.bind(this);\n  }\n\n  onButtonClick() {\n    if (this.props.provider !== \"preview\") {\n      this.props.sendUserActionTelemetry({event: \"CLICK_BUTTON\", id: this.props.UISurface});\n    }\n    const {button_url} = this.props.content;\n    // If button_url is defined handle it as OPEN_URL action\n    const type = this.props.content.button_action || (button_url && \"OPEN_URL\");\n    this.props.onAction({\n      type,\n      data: {args: this.props.content.button_action_args || button_url},\n    });\n    if (!this.props.content.do_not_autoblock) {\n      this.props.onBlock();\n    }\n  }\n\n  _shouldRenderButton() {\n    return this.props.content.button_action || this.props.onButtonClick || this.props.content.button_url;\n  }\n\n  renderTitle() {\n    const {title} = this.props.content;\n    return title ?\n      <h3 className={`title ${this._shouldRenderButton() ? \"title-inline\" : \"\"}`}>{this.renderTitleIcon()} {title}</h3> :\n      null;\n  }\n\n  renderTitleIcon() {\n    const titleIcon = safeURI(this.props.content.title_icon);\n    return titleIcon ? <span className=\"titleIcon\" style={{backgroundImage: `url(\"${titleIcon}\")`}} /> : null;\n  }\n\n  renderButton() {\n    const {props} = this;\n    if (!this._shouldRenderButton()) {\n      return null;\n    }\n\n    return (<Button\n      onClick={props.onButtonClick || this.onButtonClick}\n      color={props.content.button_color}\n      backgroundColor={props.content.button_background_color}>\n      {props.content.button_label}\n    </Button>);\n  }\n\n  renderText() {\n    const {props} = this;\n    return (<RichText text={props.content.text}\n      customElements={this.props.customElements}\n      localization_id=\"text\"\n      links={props.content.links}\n      sendClick={props.sendClick} />);\n  }\n\n  render() {\n    const {props} = this;\n    let className = \"SimpleSnippet\";\n    if (props.className) {\n      className += ` ${props.className}`;\n    }\n    if (props.content.tall) {\n      className += \" tall\";\n    }\n    return (<SnippetBase {...props} className={className} textStyle={this.props.textStyle}>\n      <img src={safeURI(props.content.icon) || DEFAULT_ICON_PATH} className=\"icon\" />\n      <div>\n        {this.renderTitle()} <p className=\"body\">{this.renderText()}</p>\n        {this.props.extraContent}\n      </div>\n      {<div>{this.renderButton()}</div>}\n    </SnippetBase>);\n  }\n}\n","import React from \"react\";\nimport schema from \"./EOYSnippet.schema.json\";\nimport {SimpleSnippet} from \"../SimpleSnippet/SimpleSnippet\";\n\nclass EOYSnippetBase extends React.PureComponent {\n  constructor(props) {\n    super(props);\n    this.handleSubmit = this.handleSubmit.bind(this);\n  }\n\n  /**\n   * setFrequencyValue - `frequency` form parameter value should be `monthly`\n   *                     if `monthly-checkbox` is selected or `single` otherwise\n   */\n  setFrequencyValue() {\n    const frequencyCheckbox = this.refs.form.querySelector(\"#monthly-checkbox\");\n    if (frequencyCheckbox.checked) {\n      this.refs.form.querySelector(\"[name='frequency']\").value = \"monthly\";\n    }\n  }\n\n  handleSubmit(event) {\n    event.preventDefault();\n    this.setFrequencyValue();\n    this.refs.form.submit();\n    if (!this.props.content.do_not_autoblock) {\n      this.props.onBlock();\n    }\n  }\n\n  renderDonations() {\n    const fieldNames = [\"first\", \"second\", \"third\", \"fourth\"];\n    const numberFormat = new Intl.NumberFormat(this.props.content.locale || navigator.language, {\n      style: \"currency\",\n      currency: this.props.content.currency_code,\n      minimumFractionDigits: 0,\n    });\n    // Default to `second` button\n    const {selected_button} = this.props.content;\n    const btnStyle = {\n      color: this.props.content.button_color,\n      backgroundColor: this.props.content.button_background_color,\n    };\n\n    return (<form className=\"EOYSnippetForm\" action={this.props.content.donation_form_url} method={this.props.form_method} onSubmit={this.handleSubmit} ref=\"form\">\n      {fieldNames.map((field, idx) => {\n        const button_name = `donation_amount_${field}`;\n        const amount = this.props.content[button_name];\n        return (<React.Fragment key={idx}>\n            <input type=\"radio\" name=\"amount\" value={amount} id={field} defaultChecked={button_name === selected_button} />\n            <label htmlFor={field} className=\"donation-amount\">\n              {numberFormat.format(amount)}\n            </label>\n          </React.Fragment>);\n      })}\n\n      <div className=\"monthly-checkbox-container\">\n        <input id=\"monthly-checkbox\" type=\"checkbox\" />\n        <label htmlFor=\"monthly-checkbox\">\n          {this.props.content.monthly_checkbox_label_text}\n        </label>\n      </div>\n\n      <input type=\"hidden\" name=\"frequency\" value=\"single\" />\n      <input type=\"hidden\" name=\"currency\" value={this.props.content.currency_code} />\n      <input type=\"hidden\" name=\"presets\" value={fieldNames.map(field => this.props.content[`donation_amount_${field}`])} />\n      <button style={btnStyle} type=\"submit\" className=\"ASRouterButton primary donation-form-url\">{this.props.content.button_label}</button>\n    </form>);\n  }\n\n  render() {\n    const textStyle = {\n      color: this.props.content.text_color,\n      backgroundColor: this.props.content.background_color,\n    };\n    const customElement = <em style={{backgroundColor: this.props.content.highlight_color}} />;\n    return (<SimpleSnippet {...this.props}\n      className={this.props.content.test}\n      customElements={{em: customElement}}\n      textStyle={textStyle}\n      extraContent={this.renderDonations()} />);\n  }\n}\n\nexport const EOYSnippet = props => {\n  const extendedContent = {\n    monthly_checkbox_label_text: schema.properties.monthly_checkbox_label_text.default,\n    locale: schema.properties.locale.default,\n    currency_code: schema.properties.currency_code.default,\n    selected_button: schema.properties.selected_button.default,\n    ...props.content,\n  };\n\n  return (<EOYSnippetBase\n    {...props}\n    content={extendedContent}\n    form_method=\"GET\" />);\n};\n","import {Button} from \"../../components/Button/Button\";\nimport React from \"react\";\nimport {RichText} from \"../../components/RichText/RichText\";\nimport {SimpleSnippet} from \"../SimpleSnippet/SimpleSnippet\";\nimport {SnippetBase} from \"../../components/SnippetBase/SnippetBase\";\n\nexport class SubmitFormSnippet extends React.PureComponent {\n  constructor(props) {\n    super(props);\n    this.expandSnippet = this.expandSnippet.bind(this);\n    this.handleSubmit = this.handleSubmit.bind(this);\n    this.handleSubmitAttempt = this.handleSubmitAttempt.bind(this);\n    this.onInputChange = this.onInputChange.bind(this);\n    this.state = {\n      expanded: false,\n      submitAttempted: false,\n      signupSubmitted: false,\n      signupSuccess: false,\n      disableForm: false,\n    };\n  }\n\n  handleSubmitAttempt() {\n    if (!this.state.submitAttempted) {\n      this.setState({submitAttempted: true});\n    }\n  }\n\n  async handleSubmit(event) {\n    let json;\n\n    if (this.state.disableForm) {\n      return;\n    }\n\n    event.preventDefault();\n    this.setState({disableForm: true});\n    this.props.sendUserActionTelemetry({event: \"CLICK_BUTTON\", value: \"conversion-subscribe-activation\", id: \"NEWTAB_FOOTER_BAR_CONTENT\"});\n\n    if (this.props.form_method.toUpperCase() === \"GET\") {\n      this.refs.form.submit();\n      return;\n    }\n\n    const {url, formData} = this.props.processFormData ?\n      this.props.processFormData(this.refs.mainInput, this.props) :\n      {url: this.refs.form.action, formData: new FormData(this.refs.form)};\n\n    try {\n      const fetchRequest = new Request(url, {body: formData, method: \"POST\"});\n      const response = await fetch(fetchRequest);\n      json = await response.json();\n    } catch (err) {\n      console.log(err); // eslint-disable-line no-console\n    }\n\n    if (json && json.status === \"ok\") {\n      this.setState({signupSuccess: true, signupSubmitted: true});\n      if (!this.props.content.do_not_autoblock) {\n        this.props.onBlock({preventDismiss: true});\n      }\n      this.props.sendUserActionTelemetry({event: \"CLICK_BUTTON\", value: \"subscribe-success\", id: \"NEWTAB_FOOTER_BAR_CONTENT\"});\n    } else {\n      console.error(\"There was a problem submitting the form\", json || \"[No JSON response]\"); // eslint-disable-line no-console\n      this.setState({signupSuccess: false, signupSubmitted: true});\n      this.props.sendUserActionTelemetry({event: \"CLICK_BUTTON\", value: \"subscribe-error\", id: \"NEWTAB_FOOTER_BAR_CONTENT\"});\n    }\n\n    this.setState({disableForm: false});\n  }\n\n  expandSnippet() {\n    this.setState({\n      expanded: true,\n      signupSuccess: false,\n      signupSubmitted: false,\n    });\n  }\n\n  renderHiddenFormInputs() {\n    const {hidden_inputs} = this.props.content;\n\n    if (!hidden_inputs) {\n      return null;\n    }\n\n    return Object.keys(hidden_inputs).map((key, idx) => <input key={idx} type=\"hidden\" name={key} value={hidden_inputs[key]} />);\n  }\n\n  renderDisclaimer() {\n    const {content} = this.props;\n    if (!content.scene2_disclaimer_html) {\n      return null;\n    }\n    return (<p className=\"disclaimerText\">\n      <RichText text={content.scene2_disclaimer_html}\n        localization_id=\"disclaimer_html\"\n        links={content.links}\n        doNotAutoBlock={true}\n        openNewWindow={true}\n        sendClick={this.props.sendClick} />\n    </p>);\n  }\n\n  renderFormPrivacyNotice() {\n    const {content} = this.props;\n    if (!content.scene2_privacy_html) {\n      return null;\n    }\n    return (<p className=\"privacyNotice\">\n        <input type=\"checkbox\" id=\"id_privacy\" name=\"privacy\" required=\"required\" />\n        <label htmlFor=\"id_privacy\">\n          <RichText text={content.scene2_privacy_html}\n          localization_id=\"privacy_html\"\n          links={content.links}\n          doNotAutoBlock={true}\n          openNewWindow={true}\n          sendClick={this.props.sendClick} />\n        </label>\n      </p>);\n  }\n\n  renderSignupSubmitted() {\n    const {content} = this.props;\n    const isSuccess = this.state.signupSuccess;\n    const successTitle = isSuccess && content.success_title;\n    const bodyText = isSuccess ? {success_text: content.success_text} : {error_text: content.error_text};\n    const retryButtonText = content.scene1_button_label;\n    return (<SnippetBase {...this.props}><div className=\"submissionStatus\">\n      {successTitle ? <h2 className=\"submitStatusTitle\">{successTitle}</h2> : null}\n      <p>\n        <RichText {...bodyText} localization_id={isSuccess ? \"success_text\" : \"error_text\"} />\n        {isSuccess ? null : <Button onClick={this.expandSnippet}>{retryButtonText}</Button>}\n      </p>\n    </div></SnippetBase>);\n  }\n\n  onInputChange(event) {\n    if (!this.props.validateInput) {\n      return;\n    }\n    const hasError = this.props.validateInput(event.target.value, this.props.content);\n    event.target.setCustomValidity(hasError);\n  }\n\n  renderInput() {\n    const placholder = this.props.content.scene2_email_placeholder_text || this.props.content.scene2_input_placeholder;\n    return (<input\n      ref=\"mainInput\"\n      type={this.props.inputType || \"email\"}\n      className={`mainInput${(this.state.submitAttempted ? \"\" : \" clean\")}`}\n      name=\"email\"\n      required={true}\n      placeholder={placholder}\n      onChange={this.props.validateInput ? this.onInputChange : null}\n      autoFocus={true} />);\n  }\n\n  renderSignupView() {\n    const {content} = this.props;\n    const containerClass = `SubmitFormSnippet ${this.props.className}`;\n    return (<SnippetBase {...this.props} className={containerClass} footerDismiss={true}>\n        {content.scene2_icon ? <div className=\"scene2Icon\"><img src={content.scene2_icon} /></div> : null}\n        <div className=\"message\">\n          <p>\n            {content.scene2_title && <h3 className=\"scene2Title\">{content.scene2_title}</h3>}\n            {\" \"}\n            {content.scene2_text && <RichText scene2_text={content.scene2_text} localization_id=\"scene2_text\" />}\n          </p>\n        </div>\n        <form action={this.props.form_action} method={this.props.form_method} onSubmit={this.handleSubmit} ref=\"form\">\n          {this.renderHiddenFormInputs()}\n          <div>\n            {this.renderInput()}\n            <button type=\"submit\" className=\"ASRouterButton primary\" onClick={this.handleSubmitAttempt} ref=\"formSubmitBtn\">{content.scene2_button_label}</button>\n          </div>\n          {this.renderFormPrivacyNotice() || this.renderDisclaimer()}\n        </form>\n      </SnippetBase>);\n  }\n\n  getFirstSceneContent() {\n    return Object.keys(this.props.content).filter(key => key.includes(\"scene1\")).reduce((acc, key) => {\n      acc[key.substr(7)] = this.props.content[key];\n      return acc;\n    }, {});\n  }\n\n  render() {\n    const content = {...this.props.content, ...this.getFirstSceneContent()};\n\n    if (this.state.signupSubmitted) {\n      return this.renderSignupSubmitted();\n    }\n    if (this.state.expanded) {\n      return this.renderSignupView();\n    }\n    return <SimpleSnippet {...this.props} content={content} onButtonClick={this.expandSnippet} />;\n  }\n}\n","import React from \"react\";\nimport schema from \"./FXASignupSnippet.schema.json\";\nimport {SubmitFormSnippet} from \"../SubmitFormSnippet/SubmitFormSnippet.jsx\";\n\nexport const FXASignupSnippet = props => {\n  const userAgent = window.navigator.userAgent.match(/Firefox\\/([0-9]+)\\./);\n  const firefox_version = userAgent ? parseInt(userAgent[1], 10) : 0;\n  const extendedContent = {\n    form_action: \"https://accounts.firefox.com/\",\n    scene1_button_label: schema.properties.scene1_button_label.default,\n    scene2_email_placeholder_text: schema.properties.scene2_email_placeholder_text.default,\n    scene2_button_label: schema.properties.scene2_button_label.default,\n    ...props.content,\n    hidden_inputs: {\n      action: \"email\",\n      context: \"fx_desktop_v3\",\n      entrypoint: \"snippets\",\n      service: \"sync\",\n      utm_source: \"snippet\",\n      utm_content: firefox_version,\n      utm_campaign: props.content.utm_campaign,\n      utm_term: props.content.utm_term,\n      ...props.content.hidden_inputs,\n    },\n  };\n\n  return (<SubmitFormSnippet\n    {...props}\n    content={extendedContent}\n    form_method=\"GET\" />);\n};\n","import React from \"react\";\nimport schema from \"./NewsletterSnippet.schema.json\";\nimport {SubmitFormSnippet} from \"../SubmitFormSnippet/SubmitFormSnippet.jsx\";\n\nexport const NewsletterSnippet = props => {\n  const extendedContent = {\n    scene1_button_label: schema.properties.scene1_button_label.default,\n    scene2_email_placeholder_text: schema.properties.scene2_email_placeholder_text.default,\n    scene2_button_label: schema.properties.scene2_button_label.default,\n    scene2_dismiss_button_text: schema.properties.scene2_dismiss_button_text.default,\n    ...props.content,\n    hidden_inputs: {\n      newsletters: props.content.scene2_newsletter || schema.properties.scene2_newsletter.default,\n      fmt: schema.properties.hidden_inputs.properties.fmt.default,\n      lang: props.content.locale || schema.properties.locale.default,\n      source_url: `https://snippets.mozilla.com/show/${props.id}`,\n      ...props.content.hidden_inputs,\n    },\n  };\n\n  return (<SubmitFormSnippet\n    {...props}\n    content={extendedContent}\n    form_action={\"https://basket.mozilla.org/subscribe.json\"}\n    form_method=\"POST\" />);\n};\n","/**\n * Checks if a given string is an email or phone number or neither\n * @param {string} val The user input\n * @param {ASRMessageContent} content .content property on ASR message\n * @returns {\"email\"|\"phone\"|\"\"} The type of the input\n */\nexport function isEmailOrPhoneNumber(val, content) {\n  const {locale} = content;\n  // http://emailregex.com/\n  const email_re = /^(([^<>()[\\]\\\\.,;:\\s@\"]+(\\.[^<>()[\\]\\\\.,;:\\s@\"]+)*)|(\".+\"))@((\\[[0-9]{1,3}\\.[0-9]{1,3}\\.[0-9]{1,3}\\.[0-9]{1,3}])|(([a-zA-Z\\-0-9]+\\.)+[a-zA-Z]{2,}))$/;\n  const check_email = email_re.test(val);\n  let check_phone; // depends on locale\n  switch (locale) {\n    case \"en-US\":\n    case \"en-CA\":\n      // allow 10-11 digits in case user wants to enter country code\n      check_phone = val.length >= 10 && val.length <= 11 && !isNaN(val);\n      break;\n    case \"de\":\n      // allow between 2 and 12 digits for german phone numbers\n      check_phone = val.length >= 2 && val.length <= 12 && !isNaN(val);\n      break;\n    // this case should never be hit, but good to have a fallback just in case\n    default:\n      check_phone = !isNaN(val);\n      break;\n  }\n  if (check_email) {\n    return \"email\";\n  } else if (check_phone) {\n    return \"phone\";\n  }\n  return \"\";\n}\n","import {isEmailOrPhoneNumber} from \"./isEmailOrPhoneNumber\";\nimport React from \"react\";\nimport schema from \"./SendToDeviceSnippet.schema.json\";\nimport {SubmitFormSnippet} from \"../SubmitFormSnippet/SubmitFormSnippet.jsx\";\n\nfunction validateInput(value, content) {\n  const type = isEmailOrPhoneNumber(value, content);\n  return type ? \"\" : \"Must be an email or a phone number.\";\n}\n\nfunction processFormData(input, message) {\n  const {content} = message;\n  const type = content.include_sms ? isEmailOrPhoneNumber(input.value, content) : \"email\";\n  const formData = new FormData();\n  let url;\n  if (type === \"phone\") {\n    url = \"https://basket.mozilla.org/news/subscribe_sms/\";\n    formData.append(\"mobile_number\", input.value);\n    formData.append(\"msg_name\", content.message_id_sms);\n    formData.append(\"country\", content.country);\n  } else if (type === \"email\") {\n    url = \"https://basket.mozilla.org/news/subscribe/\";\n    formData.append(\"email\", input.value);\n    formData.append(\"newsletters\", content.message_id_email);\n    formData.append(\"source_url\", encodeURIComponent(`https://snippets.mozilla.com/show/${message.id}`));\n  }\n  formData.append(\"lang\", content.locale);\n  return {formData, url};\n}\n\nfunction addDefaultValues(props) {\n  return {\n    ...props,\n    content: {\n      scene1_button_label: schema.properties.scene1_button_label.default,\n      scene2_dismiss_button_text: schema.properties.scene2_dismiss_button_text.default,\n      scene2_button_label: schema.properties.scene2_button_label.default,\n      scene2_input_placeholder: schema.properties.scene2_input_placeholder.default,\n      locale: schema.properties.locale.default,\n      country: schema.properties.country.default,\n      message_id_email: \"\",\n      include_sms: schema.properties.include_sms.default,\n      ...props.content,\n    },\n  };\n}\n\nexport const SendToDeviceSnippet = props => {\n  const propsWithDefaults = addDefaultValues(props);\n\n  return (<SubmitFormSnippet {...propsWithDefaults}\n    form_method=\"POST\"\n    className=\"send_to_device_snippet\"\n    inputType={propsWithDefaults.content.include_sms ? \"text\" : \"email\"}\n    validateInput={propsWithDefaults.content.include_sms ? validateInput : null}\n    processFormData={processFormData} />);\n};\n","import {EOYSnippet} from \"./EOYSnippet/EOYSnippet\";\nimport {FXASignupSnippet} from \"./FXASignupSnippet/FXASignupSnippet\";\nimport {NewsletterSnippet} from \"./NewsletterSnippet/NewsletterSnippet\";\nimport {SendToDeviceSnippet} from \"./SendToDeviceSnippet/SendToDeviceSnippet\";\nimport {SimpleSnippet} from \"./SimpleSnippet/SimpleSnippet\";\n\n// Key names matching schema name of templates\nexport const SnippetsTemplates = {\n  simple_snippet: SimpleSnippet,\n  newsletter_snippet: NewsletterSnippet,\n  fxa_signup_snippet: FXASignupSnippet,\n  send_to_device_snippet: SendToDeviceSnippet,\n  eoy_snippet: EOYSnippet,\n};\n","/*  eslint no-magic-numbers: [0]  */\n\nconst MAX_PLACEABLES = 100;\n\nconst entryIdentifierRe = /-?[a-zA-Z][a-zA-Z0-9_-]*/y;\nconst identifierRe = /[a-zA-Z][a-zA-Z0-9_-]*/y;\nconst functionIdentifierRe = /^[A-Z][A-Z_?-]*$/;\n\n/**\n * The `Parser` class is responsible for parsing FTL resources.\n *\n * It's only public method is `getResource(source)` which takes an FTL string\n * and returns a two element Array with an Object of entries generated from the\n * source as the first element and an array of SyntaxError objects as the\n * second.\n *\n * This parser is optimized for runtime performance.\n *\n * There is an equivalent of this parser in syntax/parser which is\n * generating full AST which is useful for FTL tools.\n */\nclass RuntimeParser {\n  /**\n   * Parse FTL code into entries formattable by the MessageContext.\n   *\n   * Given a string of FTL syntax, return a map of entries that can be passed\n   * to MessageContext.format and a list of errors encountered during parsing.\n   *\n   * @param {String} string\n   * @returns {Array<Object, Array>}\n   */\n  getResource(string) {\n    this._source = string;\n    this._index = 0;\n    this._length = string.length;\n    this.entries = {};\n\n    const errors = [];\n\n    this.skipWS();\n    while (this._index < this._length) {\n      try {\n        this.getEntry();\n      } catch (e) {\n        if (e instanceof SyntaxError) {\n          errors.push(e);\n\n          this.skipToNextEntryStart();\n        } else {\n          throw e;\n        }\n      }\n      this.skipWS();\n    }\n\n    return [this.entries, errors];\n  }\n\n  /**\n   * Parse the source string from the current index as an FTL entry\n   * and add it to object's entries property.\n   *\n   * @private\n   */\n  getEntry() {\n    // The index here should either be at the beginning of the file\n    // or right after new line.\n    if (this._index !== 0 &&\n        this._source[this._index - 1] !== \"\\n\") {\n      throw this.error(`Expected an entry to start\n        at the beginning of the file or on a new line.`);\n    }\n\n    const ch = this._source[this._index];\n\n    // We don't care about comments or sections at runtime\n    if (ch === \"/\" ||\n      (ch === \"#\" &&\n        [\" \", \"#\", \"\\n\"].includes(this._source[this._index + 1]))) {\n      this.skipComment();\n      return;\n    }\n\n    if (ch === \"[\") {\n      this.skipSection();\n      return;\n    }\n\n    this.getMessage();\n  }\n\n  /**\n   * Skip the section entry from the current index.\n   *\n   * @private\n   */\n  skipSection() {\n    this._index += 1;\n    if (this._source[this._index] !== \"[\") {\n      throw this.error('Expected \"[[\" to open a section');\n    }\n\n    this._index += 1;\n\n    this.skipInlineWS();\n    this.getVariantName();\n    this.skipInlineWS();\n\n    if (this._source[this._index] !== \"]\" ||\n        this._source[this._index + 1] !== \"]\") {\n      throw this.error('Expected \"]]\" to close a section');\n    }\n\n    this._index += 2;\n  }\n\n  /**\n   * Parse the source string from the current index as an FTL message\n   * and add it to the entries property on the Parser.\n   *\n   * @private\n   */\n  getMessage() {\n    const id = this.getEntryIdentifier();\n\n    this.skipInlineWS();\n\n    if (this._source[this._index] === \"=\") {\n      this._index++;\n    }\n\n    this.skipInlineWS();\n\n    const val = this.getPattern();\n\n    if (id.startsWith(\"-\") && val === null) {\n      throw this.error(\"Expected term to have a value\");\n    }\n\n    let attrs = null;\n\n    if (this._source[this._index] === \" \") {\n      const lineStart = this._index;\n      this.skipInlineWS();\n\n      if (this._source[this._index] === \".\") {\n        this._index = lineStart;\n        attrs = this.getAttributes();\n      }\n    }\n\n    if (attrs === null && typeof val === \"string\") {\n      this.entries[id] = val;\n    } else {\n      if (val === null && attrs === null) {\n        throw this.error(\"Expected message to have a value or attributes\");\n      }\n\n      this.entries[id] = {};\n\n      if (val !== null) {\n        this.entries[id].val = val;\n      }\n\n      if (attrs !== null) {\n        this.entries[id].attrs = attrs;\n      }\n    }\n  }\n\n  /**\n   * Skip whitespace.\n   *\n   * @private\n   */\n  skipWS() {\n    let ch = this._source[this._index];\n    while (ch === \" \" || ch === \"\\n\" || ch === \"\\t\" || ch === \"\\r\") {\n      ch = this._source[++this._index];\n    }\n  }\n\n  /**\n   * Skip inline whitespace (space and \\t).\n   *\n   * @private\n   */\n  skipInlineWS() {\n    let ch = this._source[this._index];\n    while (ch === \" \" || ch === \"\\t\") {\n      ch = this._source[++this._index];\n    }\n  }\n\n  /**\n   * Skip blank lines.\n   *\n   * @private\n   */\n  skipBlankLines() {\n    while (true) {\n      const ptr = this._index;\n\n      this.skipInlineWS();\n\n      if (this._source[this._index] === \"\\n\") {\n        this._index += 1;\n      } else {\n        this._index = ptr;\n        break;\n      }\n    }\n  }\n\n  /**\n   * Get identifier using the provided regex.\n   *\n   * By default this will get identifiers of public messages, attributes and\n   * external arguments (without the $).\n   *\n   * @returns {String}\n   * @private\n   */\n  getIdentifier(re = identifierRe) {\n    re.lastIndex = this._index;\n    const result = re.exec(this._source);\n\n    if (result === null) {\n      this._index += 1;\n      throw this.error(`Expected an identifier [${re.toString()}]`);\n    }\n\n    this._index = re.lastIndex;\n    return result[0];\n  }\n\n  /**\n   * Get identifier of a Message or a Term (staring with a dash).\n   *\n   * @returns {String}\n   * @private\n   */\n  getEntryIdentifier() {\n    return this.getIdentifier(entryIdentifierRe);\n  }\n\n  /**\n   * Get Variant name.\n   *\n   * @returns {Object}\n   * @private\n   */\n  getVariantName() {\n    let name = \"\";\n\n    const start = this._index;\n    let cc = this._source.charCodeAt(this._index);\n\n    if ((cc >= 97 && cc <= 122) || // a-z\n        (cc >= 65 && cc <= 90) || // A-Z\n        cc === 95 || cc === 32) { // _ <space>\n      cc = this._source.charCodeAt(++this._index);\n    } else {\n      throw this.error(\"Expected a keyword (starting with [a-zA-Z_])\");\n    }\n\n    while ((cc >= 97 && cc <= 122) || // a-z\n           (cc >= 65 && cc <= 90) || // A-Z\n           (cc >= 48 && cc <= 57) || // 0-9\n           cc === 95 || cc === 45 || cc === 32) { // _- <space>\n      cc = this._source.charCodeAt(++this._index);\n    }\n\n    // If we encountered the end of name, we want to test if the last\n    // collected character is a space.\n    // If it is, we will backtrack to the last non-space character because\n    // the keyword cannot end with a space character.\n    while (this._source.charCodeAt(this._index - 1) === 32) {\n      this._index--;\n    }\n\n    name += this._source.slice(start, this._index);\n\n    return { type: \"varname\", name };\n  }\n\n  /**\n   * Get simple string argument enclosed in `\"`.\n   *\n   * @returns {String}\n   * @private\n   */\n  getString() {\n    const start = this._index + 1;\n\n    while (++this._index < this._length) {\n      const ch = this._source[this._index];\n\n      if (ch === '\"') {\n        break;\n      }\n\n      if (ch === \"\\n\") {\n        throw this.error(\"Unterminated string expression\");\n      }\n    }\n\n    return this._source.substring(start, this._index++);\n  }\n\n  /**\n   * Parses a Message pattern.\n   * Message Pattern may be a simple string or an array of strings\n   * and placeable expressions.\n   *\n   * @returns {String|Array}\n   * @private\n   */\n  getPattern() {\n    // We're going to first try to see if the pattern is simple.\n    // If it is we can just look for the end of the line and read the string.\n    //\n    // Then, if either the line contains a placeable opening `{` or the\n    // next line starts an indentation, we switch to complex pattern.\n    const start = this._index;\n    let eol = this._source.indexOf(\"\\n\", this._index);\n\n    if (eol === -1) {\n      eol = this._length;\n    }\n\n    const firstLineContent = start !== eol ?\n      this._source.slice(start, eol) : null;\n\n    if (firstLineContent && firstLineContent.includes(\"{\")) {\n      return this.getComplexPattern();\n    }\n\n    this._index = eol + 1;\n\n    this.skipBlankLines();\n\n    if (this._source[this._index] !== \" \") {\n      // No indentation means we're done with this message. Callers should check\n      // if the return value here is null. It may be OK for messages, but not OK\n      // for terms, attributes and variants.\n      return firstLineContent;\n    }\n\n    const lineStart = this._index;\n\n    this.skipInlineWS();\n\n    if (this._source[this._index] === \".\") {\n      // The pattern is followed by an attribute. Rewind _index to the first\n      // column of the current line as expected by getAttributes.\n      this._index = lineStart;\n      return firstLineContent;\n    }\n\n    if (firstLineContent) {\n      // It's a multiline pattern which started on the same line as the\n      // identifier. Reparse the whole pattern to make sure we get all of it.\n      this._index = start;\n    }\n\n    return this.getComplexPattern();\n  }\n\n  /**\n   * Parses a complex Message pattern.\n   * This function is called by getPattern when the message is multiline,\n   * or contains escape chars or placeables.\n   * It does full parsing of complex patterns.\n   *\n   * @returns {Array}\n   * @private\n   */\n  /* eslint-disable complexity */\n  getComplexPattern() {\n    let buffer = \"\";\n    const content = [];\n    let placeables = 0;\n\n    let ch = this._source[this._index];\n\n    while (this._index < this._length) {\n      // This block handles multi-line strings combining strings separated\n      // by new line.\n      if (ch === \"\\n\") {\n        this._index++;\n\n        // We want to capture the start and end pointers\n        // around blank lines and add them to the buffer\n        // but only if the blank lines are in the middle\n        // of the string.\n        const blankLinesStart = this._index;\n        this.skipBlankLines();\n        const blankLinesEnd = this._index;\n\n\n        if (this._source[this._index] !== \" \") {\n          break;\n        }\n        this.skipInlineWS();\n\n        if (this._source[this._index] === \"}\" ||\n            this._source[this._index] === \"[\" ||\n            this._source[this._index] === \"*\" ||\n            this._source[this._index] === \".\") {\n          this._index = blankLinesEnd;\n          break;\n        }\n\n        buffer += this._source.substring(blankLinesStart, blankLinesEnd);\n\n        if (buffer.length || content.length) {\n          buffer += \"\\n\";\n        }\n        ch = this._source[this._index];\n        continue;\n      } else if (ch === \"\\\\\") {\n        const ch2 = this._source[this._index + 1];\n        if (ch2 === '\"' || ch2 === \"{\" || ch2 === \"\\\\\") {\n          ch = ch2;\n          this._index++;\n        }\n      } else if (ch === \"{\") {\n        // Push the buffer to content array right before placeable\n        if (buffer.length) {\n          content.push(buffer);\n        }\n        if (placeables > MAX_PLACEABLES - 1) {\n          throw this.error(\n            `Too many placeables, maximum allowed is ${MAX_PLACEABLES}`);\n        }\n        buffer = \"\";\n        content.push(this.getPlaceable());\n\n        this._index++;\n\n        ch = this._source[this._index];\n        placeables++;\n        continue;\n      }\n\n      if (ch) {\n        buffer += ch;\n      }\n      this._index++;\n      ch = this._source[this._index];\n    }\n\n    if (content.length === 0) {\n      return buffer.length ? buffer : null;\n    }\n\n    if (buffer.length) {\n      content.push(buffer);\n    }\n\n    return content;\n  }\n  /* eslint-enable complexity */\n\n  /**\n   * Parses a single placeable in a Message pattern and returns its\n   * expression.\n   *\n   * @returns {Object}\n   * @private\n   */\n  getPlaceable() {\n    const start = ++this._index;\n\n    this.skipWS();\n\n    if (this._source[this._index] === \"*\" ||\n       (this._source[this._index] === \"[\" &&\n        this._source[this._index + 1] !== \"]\")) {\n      const variants = this.getVariants();\n\n      return {\n        type: \"sel\",\n        exp: null,\n        vars: variants[0],\n        def: variants[1]\n      };\n    }\n\n    // Rewind the index and only support in-line white-space now.\n    this._index = start;\n    this.skipInlineWS();\n\n    const selector = this.getSelectorExpression();\n\n    this.skipWS();\n\n    const ch = this._source[this._index];\n\n    if (ch === \"}\") {\n      if (selector.type === \"attr\" && selector.id.name.startsWith(\"-\")) {\n        throw this.error(\n          \"Attributes of private messages cannot be interpolated.\"\n        );\n      }\n\n      return selector;\n    }\n\n    if (ch !== \"-\" || this._source[this._index + 1] !== \">\") {\n      throw this.error('Expected \"}\" or \"->\"');\n    }\n\n    if (selector.type === \"ref\") {\n      throw this.error(\"Message references cannot be used as selectors.\");\n    }\n\n    if (selector.type === \"var\") {\n      throw this.error(\"Variants cannot be used as selectors.\");\n    }\n\n    if (selector.type === \"attr\" && !selector.id.name.startsWith(\"-\")) {\n      throw this.error(\n        \"Attributes of public messages cannot be used as selectors.\"\n      );\n    }\n\n\n    this._index += 2; // ->\n\n    this.skipInlineWS();\n\n    if (this._source[this._index] !== \"\\n\") {\n      throw this.error(\"Variants should be listed in a new line\");\n    }\n\n    this.skipWS();\n\n    const variants = this.getVariants();\n\n    if (variants[0].length === 0) {\n      throw this.error(\"Expected members for the select expression\");\n    }\n\n    return {\n      type: \"sel\",\n      exp: selector,\n      vars: variants[0],\n      def: variants[1]\n    };\n  }\n\n  /**\n   * Parses a selector expression.\n   *\n   * @returns {Object}\n   * @private\n   */\n  getSelectorExpression() {\n    const literal = this.getLiteral();\n\n    if (literal.type !== \"ref\") {\n      return literal;\n    }\n\n    if (this._source[this._index] === \".\") {\n      this._index++;\n\n      const name = this.getIdentifier();\n      this._index++;\n      return {\n        type: \"attr\",\n        id: literal,\n        name\n      };\n    }\n\n    if (this._source[this._index] === \"[\") {\n      this._index++;\n\n      const key = this.getVariantKey();\n      this._index++;\n      return {\n        type: \"var\",\n        id: literal,\n        key\n      };\n    }\n\n    if (this._source[this._index] === \"(\") {\n      this._index++;\n      const args = this.getCallArgs();\n\n      if (!functionIdentifierRe.test(literal.name)) {\n        throw this.error(\"Function names must be all upper-case\");\n      }\n\n      this._index++;\n\n      literal.type = \"fun\";\n\n      return {\n        type: \"call\",\n        fun: literal,\n        args\n      };\n    }\n\n    return literal;\n  }\n\n  /**\n   * Parses call arguments for a CallExpression.\n   *\n   * @returns {Array}\n   * @private\n   */\n  getCallArgs() {\n    const args = [];\n\n    while (this._index < this._length) {\n      this.skipInlineWS();\n\n      if (this._source[this._index] === \")\") {\n        return args;\n      }\n\n      const exp = this.getSelectorExpression();\n\n      // MessageReference in this place may be an entity reference, like:\n      // `call(foo)`, or, if it's followed by `:` it will be a key-value pair.\n      if (exp.type !== \"ref\") {\n        args.push(exp);\n      } else {\n        this.skipInlineWS();\n\n        if (this._source[this._index] === \":\") {\n          this._index++;\n          this.skipInlineWS();\n\n          const val = this.getSelectorExpression();\n\n          // If the expression returned as a value of the argument\n          // is not a quote delimited string or number, throw.\n          //\n          // We don't have to check here if the pattern is quote delimited\n          // because that's the only type of string allowed in expressions.\n          if (typeof val === \"string\" ||\n              Array.isArray(val) ||\n              val.type === \"num\") {\n            args.push({\n              type: \"narg\",\n              name: exp.name,\n              val\n            });\n          } else {\n            this._index = this._source.lastIndexOf(\":\", this._index) + 1;\n            throw this.error(\n              \"Expected string in quotes, number.\");\n          }\n\n        } else {\n          args.push(exp);\n        }\n      }\n\n      this.skipInlineWS();\n\n      if (this._source[this._index] === \")\") {\n        break;\n      } else if (this._source[this._index] === \",\") {\n        this._index++;\n      } else {\n        throw this.error('Expected \",\" or \")\"');\n      }\n    }\n\n    return args;\n  }\n\n  /**\n   * Parses an FTL Number.\n   *\n   * @returns {Object}\n   * @private\n   */\n  getNumber() {\n    let num = \"\";\n    let cc = this._source.charCodeAt(this._index);\n\n    // The number literal may start with negative sign `-`.\n    if (cc === 45) {\n      num += \"-\";\n      cc = this._source.charCodeAt(++this._index);\n    }\n\n    // next, we expect at least one digit\n    if (cc < 48 || cc > 57) {\n      throw this.error(`Unknown literal \"${num}\"`);\n    }\n\n    // followed by potentially more digits\n    while (cc >= 48 && cc <= 57) {\n      num += this._source[this._index++];\n      cc = this._source.charCodeAt(this._index);\n    }\n\n    // followed by an optional decimal separator `.`\n    if (cc === 46) {\n      num += this._source[this._index++];\n      cc = this._source.charCodeAt(this._index);\n\n      // followed by at least one digit\n      if (cc < 48 || cc > 57) {\n        throw this.error(`Unknown literal \"${num}\"`);\n      }\n\n      // and optionally more digits\n      while (cc >= 48 && cc <= 57) {\n        num += this._source[this._index++];\n        cc = this._source.charCodeAt(this._index);\n      }\n    }\n\n    return {\n      type: \"num\",\n      val: num\n    };\n  }\n\n  /**\n   * Parses a list of Message attributes.\n   *\n   * @returns {Object}\n   * @private\n   */\n  getAttributes() {\n    const attrs = {};\n\n    while (this._index < this._length) {\n      if (this._source[this._index] !== \" \") {\n        break;\n      }\n      this.skipInlineWS();\n\n      if (this._source[this._index] !== \".\") {\n        break;\n      }\n      this._index++;\n\n      const key = this.getIdentifier();\n\n      this.skipInlineWS();\n\n      if (this._source[this._index] !== \"=\") {\n        throw this.error('Expected \"=\"');\n      }\n      this._index++;\n\n      this.skipInlineWS();\n\n      const val = this.getPattern();\n\n      if (val === null) {\n        throw this.error(\"Expected attribute to have a value\");\n      }\n\n      if (typeof val === \"string\") {\n        attrs[key] = val;\n      } else {\n        attrs[key] = {\n          val\n        };\n      }\n\n      this.skipBlankLines();\n    }\n\n    return attrs;\n  }\n\n  /**\n   * Parses a list of Selector variants.\n   *\n   * @returns {Array}\n   * @private\n   */\n  getVariants() {\n    const variants = [];\n    let index = 0;\n    let defaultIndex;\n\n    while (this._index < this._length) {\n      const ch = this._source[this._index];\n\n      if ((ch !== \"[\" || this._source[this._index + 1] === \"[\") &&\n          ch !== \"*\") {\n        break;\n      }\n      if (ch === \"*\") {\n        this._index++;\n        defaultIndex = index;\n      }\n\n      if (this._source[this._index] !== \"[\") {\n        throw this.error('Expected \"[\"');\n      }\n\n      this._index++;\n\n      const key = this.getVariantKey();\n\n      this.skipInlineWS();\n\n      const val = this.getPattern();\n\n      if (val === null) {\n        throw this.error(\"Expected variant to have a value\");\n      }\n\n      variants[index++] = {key, val};\n\n      this.skipWS();\n    }\n\n    return [variants, defaultIndex];\n  }\n\n  /**\n   * Parses a Variant key.\n   *\n   * @returns {String}\n   * @private\n   */\n  getVariantKey() {\n    // VariantKey may be a Keyword or Number\n\n    const cc = this._source.charCodeAt(this._index);\n    let literal;\n\n    if ((cc >= 48 && cc <= 57) || cc === 45) {\n      literal = this.getNumber();\n    } else {\n      literal = this.getVariantName();\n    }\n\n    if (this._source[this._index] !== \"]\") {\n      throw this.error('Expected \"]\"');\n    }\n\n    this._index++;\n    return literal;\n  }\n\n  /**\n   * Parses an FTL literal.\n   *\n   * @returns {Object}\n   * @private\n   */\n  getLiteral() {\n    const cc0 = this._source.charCodeAt(this._index);\n\n    if (cc0 === 36) { // $\n      this._index++;\n      return {\n        type: \"ext\",\n        name: this.getIdentifier()\n      };\n    }\n\n    const cc1 = cc0 === 45 // -\n      // Peek at the next character after the dash.\n      ? this._source.charCodeAt(this._index + 1)\n      // Or keep using the character at the current index.\n      : cc0;\n\n    if ((cc1 >= 97 && cc1 <= 122) || // a-z\n        (cc1 >= 65 && cc1 <= 90)) { // A-Z\n      return {\n        type: \"ref\",\n        name: this.getEntryIdentifier()\n      };\n    }\n\n    if ((cc1 >= 48 && cc1 <= 57)) { // 0-9\n      return this.getNumber();\n    }\n\n    if (cc0 === 34) { // \"\n      return this.getString();\n    }\n\n    throw this.error(\"Expected literal\");\n  }\n\n  /**\n   * Skips an FTL comment.\n   *\n   * @private\n   */\n  skipComment() {\n    // At runtime, we don't care about comments so we just have\n    // to parse them properly and skip their content.\n    let eol = this._source.indexOf(\"\\n\", this._index);\n\n    while (eol !== -1 &&\n      ((this._source[eol + 1] === \"/\" && this._source[eol + 2] === \"/\") ||\n       (this._source[eol + 1] === \"#\" &&\n         [\" \", \"#\"].includes(this._source[eol + 2])))) {\n      this._index = eol + 3;\n\n      eol = this._source.indexOf(\"\\n\", this._index);\n\n      if (eol === -1) {\n        break;\n      }\n    }\n\n    if (eol === -1) {\n      this._index = this._length;\n    } else {\n      this._index = eol + 1;\n    }\n  }\n\n  /**\n   * Creates a new SyntaxError object with a given message.\n   *\n   * @param {String} message\n   * @returns {Object}\n   * @private\n   */\n  error(message) {\n    return new SyntaxError(message);\n  }\n\n  /**\n   * Skips to the beginning of a next entry after the current position.\n   * This is used to mark the boundary of junk entry in case of error,\n   * and recover from the returned position.\n   *\n   * @private\n   */\n  skipToNextEntryStart() {\n    let start = this._index;\n\n    while (true) {\n      if (start === 0 || this._source[start - 1] === \"\\n\") {\n        const cc = this._source.charCodeAt(start);\n\n        if ((cc >= 97 && cc <= 122) || // a-z\n            (cc >= 65 && cc <= 90) || // A-Z\n             cc === 47 || cc === 91) { // /[\n          this._index = start;\n          return;\n        }\n      }\n\n      start = this._source.indexOf(\"\\n\", start);\n\n      if (start === -1) {\n        this._index = this._length;\n        return;\n      }\n      start++;\n    }\n  }\n}\n\n/**\n * Parses an FTL string using RuntimeParser and returns the generated\n * object with entries and a list of errors.\n *\n * @param {String} string\n * @returns {Array<Object, Array>}\n */\nexport default function parse(string) {\n  const parser = new RuntimeParser();\n  return parser.getResource(string);\n}\n","/* global Intl */\n\n/**\n * The `FluentType` class is the base of Fluent's type system.\n *\n * Fluent types wrap JavaScript values and store additional configuration for\n * them, which can then be used in the `toString` method together with a proper\n * `Intl` formatter.\n */\nexport class FluentType {\n\n  /**\n   * Create an `FluentType` instance.\n   *\n   * @param   {Any}    value - JavaScript value to wrap.\n   * @param   {Object} opts  - Configuration.\n   * @returns {FluentType}\n   */\n  constructor(value, opts) {\n    this.value = value;\n    this.opts = opts;\n  }\n\n  /**\n   * Unwrap the raw value stored by this `FluentType`.\n   *\n   * @returns {Any}\n   */\n  valueOf() {\n    return this.value;\n  }\n\n  /**\n   * Format this instance of `FluentType` to a string.\n   *\n   * Formatted values are suitable for use outside of the `MessageContext`.\n   * This method can use `Intl` formatters memoized by the `MessageContext`\n   * instance passed as an argument.\n   *\n   * @param   {MessageContext} [ctx]\n   * @returns {string}\n   */\n  toString() {\n    throw new Error(\"Subclasses of FluentType must implement toString.\");\n  }\n}\n\nexport class FluentNone extends FluentType {\n  toString() {\n    return this.value || \"???\";\n  }\n}\n\nexport class FluentNumber extends FluentType {\n  constructor(value, opts) {\n    super(parseFloat(value), opts);\n  }\n\n  toString(ctx) {\n    try {\n      const nf = ctx._memoizeIntlObject(\n        Intl.NumberFormat, this.opts\n      );\n      return nf.format(this.value);\n    } catch (e) {\n      // XXX Report the error.\n      return this.value;\n    }\n  }\n\n  /**\n   * Compare the object with another instance of a FluentType.\n   *\n   * @param   {MessageContext} ctx\n   * @param   {FluentType}     other\n   * @returns {bool}\n   */\n  match(ctx, other) {\n    if (other instanceof FluentNumber) {\n      return this.value === other.value;\n    }\n    return false;\n  }\n}\n\nexport class FluentDateTime extends FluentType {\n  constructor(value, opts) {\n    super(new Date(value), opts);\n  }\n\n  toString(ctx) {\n    try {\n      const dtf = ctx._memoizeIntlObject(\n        Intl.DateTimeFormat, this.opts\n      );\n      return dtf.format(this.value);\n    } catch (e) {\n      // XXX Report the error.\n      return this.value;\n    }\n  }\n}\n\nexport class FluentSymbol extends FluentType {\n  toString() {\n    return this.value;\n  }\n\n  /**\n   * Compare the object with another instance of a FluentType.\n   *\n   * @param   {MessageContext} ctx\n   * @param   {FluentType}     other\n   * @returns {bool}\n   */\n  match(ctx, other) {\n    if (other instanceof FluentSymbol) {\n      return this.value === other.value;\n    } else if (typeof other === \"string\") {\n      return this.value === other;\n    } else if (other instanceof FluentNumber) {\n      const pr = ctx._memoizeIntlObject(\n        Intl.PluralRules, other.opts\n      );\n      return this.value === pr.select(other.value);\n    }\n    return false;\n  }\n}\n","/**\n * @overview\n *\n * The FTL resolver ships with a number of functions built-in.\n *\n * Each function take two arguments:\n *   - args - an array of positional args\n *   - opts - an object of key-value args\n *\n * Arguments to functions are guaranteed to already be instances of\n * `FluentType`.  Functions must return `FluentType` objects as well.\n */\n\nimport { FluentNumber, FluentDateTime } from \"./types\";\n\nexport default {\n  \"NUMBER\": ([arg], opts) =>\n    new FluentNumber(arg.valueOf(), merge(arg.opts, opts)),\n  \"DATETIME\": ([arg], opts) =>\n    new FluentDateTime(arg.valueOf(), merge(arg.opts, opts)),\n};\n\nfunction merge(argopts, opts) {\n  return Object.assign({}, argopts, values(opts));\n}\n\nfunction values(opts) {\n  const unwrapped = {};\n  for (const [name, opt] of Object.entries(opts)) {\n    unwrapped[name] = opt.valueOf();\n  }\n  return unwrapped;\n}\n","/**\n * @overview\n *\n * The role of the Fluent resolver is to format a translation object to an\n * instance of `FluentType` or an array of instances.\n *\n * Translations can contain references to other messages or external arguments,\n * conditional logic in form of select expressions, traits which describe their\n * grammatical features, and can use Fluent builtins which make use of the\n * `Intl` formatters to format numbers, dates, lists and more into the\n * context's language.  See the documentation of the Fluent syntax for more\n * information.\n *\n * In case of errors the resolver will try to salvage as much of the\n * translation as possible.  In rare situations where the resolver didn't know\n * how to recover from an error it will return an instance of `FluentNone`.\n *\n * `MessageReference`, `VariantExpression`, `AttributeExpression` and\n * `SelectExpression` resolve to raw Runtime Entries objects and the result of\n * the resolution needs to be passed into `Type` to get their real value.\n * This is useful for composing expressions.  Consider:\n *\n *     brand-name[nominative]\n *\n * which is a `VariantExpression` with properties `id: MessageReference` and\n * `key: Keyword`.  If `MessageReference` was resolved eagerly, it would\n * instantly resolve to the value of the `brand-name` message.  Instead, we\n * want to get the message object and look for its `nominative` variant.\n *\n * All other expressions (except for `FunctionReference` which is only used in\n * `CallExpression`) resolve to an instance of `FluentType`.  The caller should\n * use the `toString` method to convert the instance to a native value.\n *\n *\n * All functions in this file pass around a special object called `env`.\n * This object stores a set of elements used by all resolve functions:\n *\n *  * {MessageContext} ctx\n *      context for which the given resolution is happening\n *  * {Object} args\n *      list of developer provided arguments that can be used\n *  * {Array} errors\n *      list of errors collected while resolving\n *  * {WeakSet} dirty\n *      Set of patterns already encountered during this resolution.\n *      This is used to prevent cyclic resolutions.\n */\n\n\nimport { FluentType, FluentNone, FluentNumber, FluentDateTime, FluentSymbol }\n  from \"./types\";\nimport builtins from \"./builtins\";\n\n// Prevent expansion of too long placeables.\nconst MAX_PLACEABLE_LENGTH = 2500;\n\n// Unicode bidi isolation characters.\nconst FSI = \"\\u2068\";\nconst PDI = \"\\u2069\";\n\n\n/**\n * Helper for choosing the default value from a set of members.\n *\n * Used in SelectExpressions and Type.\n *\n * @param   {Object} env\n *    Resolver environment object.\n * @param   {Object} members\n *    Hash map of variants from which the default value is to be selected.\n * @param   {Number} def\n *    The index of the default variant.\n * @returns {FluentType}\n * @private\n */\nfunction DefaultMember(env, members, def) {\n  if (members[def]) {\n    return members[def];\n  }\n\n  const { errors } = env;\n  errors.push(new RangeError(\"No default\"));\n  return new FluentNone();\n}\n\n\n/**\n * Resolve a reference to another message.\n *\n * @param   {Object} env\n *    Resolver environment object.\n * @param   {Object} id\n *    The identifier of the message to be resolved.\n * @param   {String} id.name\n *    The name of the identifier.\n * @returns {FluentType}\n * @private\n */\nfunction MessageReference(env, {name}) {\n  const { ctx, errors } = env;\n  const message = name.startsWith(\"-\")\n    ? ctx._terms.get(name)\n    : ctx._messages.get(name);\n\n  if (!message) {\n    const err = name.startsWith(\"-\")\n      ? new ReferenceError(`Unknown term: ${name}`)\n      : new ReferenceError(`Unknown message: ${name}`);\n    errors.push(err);\n    return new FluentNone(name);\n  }\n\n  return message;\n}\n\n/**\n * Resolve a variant expression to the variant object.\n *\n * @param   {Object} env\n *    Resolver environment object.\n * @param   {Object} expr\n *    An expression to be resolved.\n * @param   {Object} expr.id\n *    An Identifier of a message for which the variant is resolved.\n * @param   {Object} expr.id.name\n *    Name a message for which the variant is resolved.\n * @param   {Object} expr.key\n *    Variant key to be resolved.\n * @returns {FluentType}\n * @private\n */\nfunction VariantExpression(env, {id, key}) {\n  const message = MessageReference(env, id);\n  if (message instanceof FluentNone) {\n    return message;\n  }\n\n  const { ctx, errors } = env;\n  const keyword = Type(env, key);\n\n  function isVariantList(node) {\n    return Array.isArray(node) &&\n      node[0].type === \"sel\" &&\n      node[0].exp === null;\n  }\n\n  if (isVariantList(message.val)) {\n    // Match the specified key against keys of each variant, in order.\n    for (const variant of message.val[0].vars) {\n      const variantKey = Type(env, variant.key);\n      if (keyword.match(ctx, variantKey)) {\n        return variant;\n      }\n    }\n  }\n\n  errors.push(new ReferenceError(`Unknown variant: ${keyword.toString(ctx)}`));\n  return Type(env, message);\n}\n\n\n/**\n * Resolve an attribute expression to the attribute object.\n *\n * @param   {Object} env\n *    Resolver environment object.\n * @param   {Object} expr\n *    An expression to be resolved.\n * @param   {String} expr.id\n *    An ID of a message for which the attribute is resolved.\n * @param   {String} expr.name\n *    Name of the attribute to be resolved.\n * @returns {FluentType}\n * @private\n */\nfunction AttributeExpression(env, {id, name}) {\n  const message = MessageReference(env, id);\n  if (message instanceof FluentNone) {\n    return message;\n  }\n\n  if (message.attrs) {\n    // Match the specified name against keys of each attribute.\n    for (const attrName in message.attrs) {\n      if (name === attrName) {\n        return message.attrs[name];\n      }\n    }\n  }\n\n  const { errors } = env;\n  errors.push(new ReferenceError(`Unknown attribute: ${name}`));\n  return Type(env, message);\n}\n\n/**\n * Resolve a select expression to the member object.\n *\n * @param   {Object} env\n *    Resolver environment object.\n * @param   {Object} expr\n *    An expression to be resolved.\n * @param   {String} expr.exp\n *    Selector expression\n * @param   {Array} expr.vars\n *    List of variants for the select expression.\n * @param   {Number} expr.def\n *    Index of the default variant.\n * @returns {FluentType}\n * @private\n */\nfunction SelectExpression(env, {exp, vars, def}) {\n  if (exp === null) {\n    return DefaultMember(env, vars, def);\n  }\n\n  const selector = Type(env, exp);\n  if (selector instanceof FluentNone) {\n    return DefaultMember(env, vars, def);\n  }\n\n  // Match the selector against keys of each variant, in order.\n  for (const variant of vars) {\n    const key = Type(env, variant.key);\n    const keyCanMatch =\n      key instanceof FluentNumber || key instanceof FluentSymbol;\n\n    if (!keyCanMatch) {\n      continue;\n    }\n\n    const { ctx } = env;\n\n    if (key.match(ctx, selector)) {\n      return variant;\n    }\n  }\n\n  return DefaultMember(env, vars, def);\n}\n\n\n/**\n * Resolve expression to a Fluent type.\n *\n * JavaScript strings are a special case.  Since they natively have the\n * `toString` method they can be used as if they were a Fluent type without\n * paying the cost of creating a instance of one.\n *\n * @param   {Object} env\n *    Resolver environment object.\n * @param   {Object} expr\n *    An expression object to be resolved into a Fluent type.\n * @returns {FluentType}\n * @private\n */\nfunction Type(env, expr) {\n  // A fast-path for strings which are the most common case, and for\n  // `FluentNone` which doesn't require any additional logic.\n  if (typeof expr === \"string\" || expr instanceof FluentNone) {\n    return expr;\n  }\n\n  // The Runtime AST (Entries) encodes patterns (complex strings with\n  // placeables) as Arrays.\n  if (Array.isArray(expr)) {\n    return Pattern(env, expr);\n  }\n\n\n  switch (expr.type) {\n    case \"varname\":\n      return new FluentSymbol(expr.name);\n    case \"num\":\n      return new FluentNumber(expr.val);\n    case \"ext\":\n      return ExternalArgument(env, expr);\n    case \"fun\":\n      return FunctionReference(env, expr);\n    case \"call\":\n      return CallExpression(env, expr);\n    case \"ref\": {\n      const message = MessageReference(env, expr);\n      return Type(env, message);\n    }\n    case \"attr\": {\n      const attr = AttributeExpression(env, expr);\n      return Type(env, attr);\n    }\n    case \"var\": {\n      const variant = VariantExpression(env, expr);\n      return Type(env, variant);\n    }\n    case \"sel\": {\n      const member = SelectExpression(env, expr);\n      return Type(env, member);\n    }\n    case undefined: {\n      // If it's a node with a value, resolve the value.\n      if (expr.val !== null && expr.val !== undefined) {\n        return Type(env, expr.val);\n      }\n\n      const { errors } = env;\n      errors.push(new RangeError(\"No value\"));\n      return new FluentNone();\n    }\n    default:\n      return new FluentNone();\n  }\n}\n\n/**\n * Resolve a reference to an external argument.\n *\n * @param   {Object} env\n *    Resolver environment object.\n * @param   {Object} expr\n *    An expression to be resolved.\n * @param   {String} expr.name\n *    Name of an argument to be returned.\n * @returns {FluentType}\n * @private\n */\nfunction ExternalArgument(env, {name}) {\n  const { args, errors } = env;\n\n  if (!args || !args.hasOwnProperty(name)) {\n    errors.push(new ReferenceError(`Unknown external: ${name}`));\n    return new FluentNone(name);\n  }\n\n  const arg = args[name];\n\n  // Return early if the argument already is an instance of FluentType.\n  if (arg instanceof FluentType) {\n    return arg;\n  }\n\n  // Convert the argument to a Fluent type.\n  switch (typeof arg) {\n    case \"string\":\n      return arg;\n    case \"number\":\n      return new FluentNumber(arg);\n    case \"object\":\n      if (arg instanceof Date) {\n        return new FluentDateTime(arg);\n      }\n    default:\n      errors.push(\n        new TypeError(`Unsupported external type: ${name}, ${typeof arg}`)\n      );\n      return new FluentNone(name);\n  }\n}\n\n/**\n * Resolve a reference to a function.\n *\n * @param   {Object}  env\n *    Resolver environment object.\n * @param   {Object} expr\n *    An expression to be resolved.\n * @param   {String} expr.name\n *    Name of the function to be returned.\n * @returns {Function}\n * @private\n */\nfunction FunctionReference(env, {name}) {\n  // Some functions are built-in.  Others may be provided by the runtime via\n  // the `MessageContext` constructor.\n  const { ctx: { _functions }, errors } = env;\n  const func = _functions[name] || builtins[name];\n\n  if (!func) {\n    errors.push(new ReferenceError(`Unknown function: ${name}()`));\n    return new FluentNone(`${name}()`);\n  }\n\n  if (typeof func !== \"function\") {\n    errors.push(new TypeError(`Function ${name}() is not callable`));\n    return new FluentNone(`${name}()`);\n  }\n\n  return func;\n}\n\n/**\n * Resolve a call to a Function with positional and key-value arguments.\n *\n * @param   {Object} env\n *    Resolver environment object.\n * @param   {Object} expr\n *    An expression to be resolved.\n * @param   {Object} expr.fun\n *    FTL Function object.\n * @param   {Array} expr.args\n *    FTL Function argument list.\n * @returns {FluentType}\n * @private\n */\nfunction CallExpression(env, {fun, args}) {\n  const callee = FunctionReference(env, fun);\n\n  if (callee instanceof FluentNone) {\n    return callee;\n  }\n\n  const posargs = [];\n  const keyargs = {};\n\n  for (const arg of args) {\n    if (arg.type === \"narg\") {\n      keyargs[arg.name] = Type(env, arg.val);\n    } else {\n      posargs.push(Type(env, arg));\n    }\n  }\n\n  try {\n    return callee(posargs, keyargs);\n  } catch (e) {\n    // XXX Report errors.\n    return new FluentNone();\n  }\n}\n\n/**\n * Resolve a pattern (a complex string with placeables).\n *\n * @param   {Object} env\n *    Resolver environment object.\n * @param   {Array} ptn\n *    Array of pattern elements.\n * @returns {Array}\n * @private\n */\nfunction Pattern(env, ptn) {\n  const { ctx, dirty, errors } = env;\n\n  if (dirty.has(ptn)) {\n    errors.push(new RangeError(\"Cyclic reference\"));\n    return new FluentNone();\n  }\n\n  // Tag the pattern as dirty for the purpose of the current resolution.\n  dirty.add(ptn);\n  const result = [];\n\n  // Wrap interpolations with Directional Isolate Formatting characters\n  // only when the pattern has more than one element.\n  const useIsolating = ctx._useIsolating && ptn.length > 1;\n\n  for (const elem of ptn) {\n    if (typeof elem === \"string\") {\n      result.push(elem);\n      continue;\n    }\n\n    const part = Type(env, elem).toString(ctx);\n\n    if (useIsolating) {\n      result.push(FSI);\n    }\n\n    if (part.length > MAX_PLACEABLE_LENGTH) {\n      errors.push(\n        new RangeError(\n          \"Too many characters in placeable \" +\n          `(${part.length}, max allowed is ${MAX_PLACEABLE_LENGTH})`\n        )\n      );\n      result.push(part.slice(MAX_PLACEABLE_LENGTH));\n    } else {\n      result.push(part);\n    }\n\n    if (useIsolating) {\n      result.push(PDI);\n    }\n  }\n\n  dirty.delete(ptn);\n  return result.join(\"\");\n}\n\n/**\n * Format a translation into a string.\n *\n * @param   {MessageContext} ctx\n *    A MessageContext instance which will be used to resolve the\n *    contextual information of the message.\n * @param   {Object}         args\n *    List of arguments provided by the developer which can be accessed\n *    from the message.\n * @param   {Object}         message\n *    An object with the Message to be resolved.\n * @param   {Array}          errors\n *    An error array that any encountered errors will be appended to.\n * @returns {FluentType}\n */\nexport default function resolve(ctx, args, message, errors = []) {\n  const env = {\n    ctx, args, errors, dirty: new WeakSet()\n  };\n  return Type(env, message).toString(ctx);\n}\n","import resolve from \"./resolver\";\nimport parse from \"./parser\";\n\n/**\n * Message contexts are single-language stores of translations.  They are\n * responsible for parsing translation resources in the Fluent syntax and can\n * format translation units (entities) to strings.\n *\n * Always use `MessageContext.format` to retrieve translation units from\n * a context.  Translations can contain references to other entities or\n * external arguments, conditional logic in form of select expressions, traits\n * which describe their grammatical features, and can use Fluent builtins which\n * make use of the `Intl` formatters to format numbers, dates, lists and more\n * into the context's language.  See the documentation of the Fluent syntax for\n * more information.\n */\nexport class MessageContext {\n\n  /**\n   * Create an instance of `MessageContext`.\n   *\n   * The `locales` argument is used to instantiate `Intl` formatters used by\n   * translations.  The `options` object can be used to configure the context.\n   *\n   * Examples:\n   *\n   *     const ctx = new MessageContext(locales);\n   *\n   *     const ctx = new MessageContext(locales, { useIsolating: false });\n   *\n   *     const ctx = new MessageContext(locales, {\n   *       useIsolating: true,\n   *       functions: {\n   *         NODE_ENV: () => process.env.NODE_ENV\n   *       }\n   *     });\n   *\n   * Available options:\n   *\n   *   - `functions` - an object of additional functions available to\n   *                   translations as builtins.\n   *\n   *   - `useIsolating` - boolean specifying whether to use Unicode isolation\n   *                    marks (FSI, PDI) for bidi interpolations.\n   *\n   * @param   {string|Array<string>} locales - Locale or locales of the context\n   * @param   {Object} [options]\n   * @returns {MessageContext}\n   */\n  constructor(locales, { functions = {}, useIsolating = true } = {}) {\n    this.locales = Array.isArray(locales) ? locales : [locales];\n\n    this._terms = new Map();\n    this._messages = new Map();\n    this._functions = functions;\n    this._useIsolating = useIsolating;\n    this._intls = new WeakMap();\n  }\n\n  /*\n   * Return an iterator over public `[id, message]` pairs.\n   *\n   * @returns {Iterator}\n   */\n  get messages() {\n    return this._messages[Symbol.iterator]();\n  }\n\n  /*\n   * Check if a message is present in the context.\n   *\n   * @param {string} id - The identifier of the message to check.\n   * @returns {bool}\n   */\n  hasMessage(id) {\n    return this._messages.has(id);\n  }\n\n  /*\n   * Return the internal representation of a message.\n   *\n   * The internal representation should only be used as an argument to\n   * `MessageContext.format`.\n   *\n   * @param {string} id - The identifier of the message to check.\n   * @returns {Any}\n   */\n  getMessage(id) {\n    return this._messages.get(id);\n  }\n\n  /**\n   * Add a translation resource to the context.\n   *\n   * The translation resource must use the Fluent syntax.  It will be parsed by\n   * the context and each translation unit (message) will be available in the\n   * context by its identifier.\n   *\n   *     ctx.addMessages('foo = Foo');\n   *     ctx.getMessage('foo');\n   *\n   *     // Returns a raw representation of the 'foo' message.\n   *\n   * Parsed entities should be formatted with the `format` method in case they\n   * contain logic (references, select expressions etc.).\n   *\n   * @param   {string} source - Text resource with translations.\n   * @returns {Array<Error>}\n   */\n  addMessages(source) {\n    const [entries, errors] = parse(source);\n    for (const id in entries) {\n      if (id.startsWith(\"-\")) {\n        // Identifiers starting with a dash (-) define terms. Terms are private\n        // and cannot be retrieved from MessageContext.\n        if (this._terms.has(id)) {\n          errors.push(`Attempt to override an existing term: \"${id}\"`);\n          continue;\n        }\n        this._terms.set(id, entries[id]);\n      } else {\n        if (this._messages.has(id)) {\n          errors.push(`Attempt to override an existing message: \"${id}\"`);\n          continue;\n        }\n        this._messages.set(id, entries[id]);\n      }\n    }\n\n    return errors;\n  }\n\n  /**\n   * Format a message to a string or null.\n   *\n   * Format a raw `message` from the context into a string (or a null if it has\n   * a null value).  `args` will be used to resolve references to external\n   * arguments inside of the translation.\n   *\n   * In case of errors `format` will try to salvage as much of the translation\n   * as possible and will still return a string.  For performance reasons, the\n   * encountered errors are not returned but instead are appended to the\n   * `errors` array passed as the third argument.\n   *\n   *     const errors = [];\n   *     ctx.addMessages('hello = Hello, { $name }!');\n   *     const hello = ctx.getMessage('hello');\n   *     ctx.format(hello, { name: 'Jane' }, errors);\n   *\n   *     // Returns 'Hello, Jane!' and `errors` is empty.\n   *\n   *     ctx.format(hello, undefined, errors);\n   *\n   *     // Returns 'Hello, name!' and `errors` is now:\n   *\n   *     [<ReferenceError: Unknown external: name>]\n   *\n   * @param   {Object | string}    message\n   * @param   {Object | undefined} args\n   * @param   {Array}              errors\n   * @returns {?string}\n   */\n  format(message, args, errors) {\n    // optimize entities which are simple strings with no attributes\n    if (typeof message === \"string\") {\n      return message;\n    }\n\n    // optimize simple-string entities with attributes\n    if (typeof message.val === \"string\") {\n      return message.val;\n    }\n\n    // optimize entities with null values\n    if (message.val === undefined) {\n      return null;\n    }\n\n    return resolve(this, args, message, errors);\n  }\n\n  _memoizeIntlObject(ctor, opts) {\n    const cache = this._intls.get(ctor) || {};\n    const id = JSON.stringify(opts);\n\n    if (!cache[id]) {\n      cache[id] = new ctor(this.locales, opts);\n      this._intls.set(ctor, cache);\n    }\n\n    return cache[id];\n  }\n}\n","/*\n * CachedIterable caches the elements yielded by an iterable.\n *\n * It can be used to iterate over an iterable many times without depleting the\n * iterable.\n */\nexport default class CachedIterable {\n  /**\n   * Create an `CachedIterable` instance.\n   *\n   * @param {Iterable} iterable\n   * @returns {CachedIterable}\n   */\n  constructor(iterable) {\n    if (Symbol.asyncIterator in Object(iterable)) {\n      this.iterator = iterable[Symbol.asyncIterator]();\n    } else if (Symbol.iterator in Object(iterable)) {\n      this.iterator = iterable[Symbol.iterator]();\n    } else {\n      throw new TypeError(\"Argument must implement the iteration protocol.\");\n    }\n\n    this.seen = [];\n  }\n\n  [Symbol.iterator]() {\n    const { seen, iterator } = this;\n    let cur = 0;\n\n    return {\n      next() {\n        if (seen.length <= cur) {\n          seen.push(iterator.next());\n        }\n        return seen[cur++];\n      }\n    };\n  }\n\n  [Symbol.asyncIterator]() {\n    const { seen, iterator } = this;\n    let cur = 0;\n\n    return {\n      async next() {\n        if (seen.length <= cur) {\n          seen.push(await iterator.next());\n        }\n        return seen[cur++];\n      }\n    };\n  }\n\n  /**\n   * This method allows user to consume the next element from the iterator\n   * into the cache.\n   */\n  touchNext() {\n    const { seen, iterator } = this;\n    if (seen.length === 0 || seen[seen.length - 1].done === false) {\n      seen.push(iterator.next());\n    }\n  }\n}\n","/*\n * @overview\n *\n * Functions for managing ordered sequences of MessageContexts.\n *\n * An ordered iterable of MessageContext instances can represent the current\n * negotiated fallback chain of languages.  This iterable can be used to find\n * the best existing translation for a given identifier.\n *\n * The mapContext* methods can be used to find the first MessageContext in the\n * given iterable which contains the translation with the given identifier.  If\n * the iterable is ordered according to the result of a language negotiation\n * the returned MessageContext contains the best available translation.\n *\n * A simple function which formats translations based on the identifier might\n * be implemented as follows:\n *\n *     formatString(id, args) {\n *         const ctx = mapContextSync(contexts, id);\n *\n *         if (ctx === null) {\n *             return id;\n *         }\n *\n *         const msg = ctx.getMessage(id);\n *         return ctx.format(msg, args);\n *     }\n *\n * In order to pass an iterator to mapContext*, wrap it in CachedIterable.\n * This allows multiple calls to mapContext* without advancing and eventually\n * depleting the iterator.\n *\n *     function *generateMessages() {\n *         // Some lazy logic for yielding MessageContexts.\n *         yield *[ctx1, ctx2];\n *     }\n *\n *     const contexts = new CachedIterable(generateMessages());\n *     const ctx = mapContextSync(contexts, id);\n *\n */\n\n/*\n * Synchronously map an identifier or an array of identifiers to the best\n * `MessageContext` instance(s).\n *\n * @param {Iterable} iterable\n * @param {string|Array<string>} ids\n * @returns {MessageContext|Array<MessageContext>}\n */\nexport function mapContextSync(iterable, ids) {\n  if (!Array.isArray(ids)) {\n    return getContextForId(iterable, ids);\n  }\n\n  return ids.map(\n    id => getContextForId(iterable, id)\n  );\n}\n\n/*\n * Find the best `MessageContext` with the translation for `id`.\n */\nfunction getContextForId(iterable, id) {\n  for (const context of iterable) {\n    if (context.hasMessage(id)) {\n      return context;\n    }\n  }\n\n  return null;\n}\n\n/*\n * Asynchronously map an identifier or an array of identifiers to the best\n * `MessageContext` instance(s).\n *\n * @param {AsyncIterable} iterable\n * @param {string|Array<string>} ids\n * @returns {Promise<MessageContext|Array<MessageContext>>}\n */\nexport async function mapContextAsync(iterable, ids) {\n  if (!Array.isArray(ids)) {\n    for await (const context of iterable) {\n      if (context.hasMessage(ids)) {\n        return context;\n      }\n    }\n  }\n\n  let remainingCount = ids.length;\n  const foundContexts = new Array(remainingCount).fill(null);\n\n  for await (const context of iterable) {\n    // XXX Switch to const [index, id] of id.entries() when we move to Babel 7.\n    // See https://github.com/babel/babel/issues/5880.\n    for (let index = 0; index < ids.length; index++) {\n      const id = ids[index];\n      if (!foundContexts[index] && context.hasMessage(id)) {\n        foundContexts[index] = context;\n        remainingCount--;\n      }\n\n      // Return early when all ids have been mapped to contexts.\n      if (remainingCount === 0) {\n        return foundContexts;\n      }\n    }\n  }\n\n  return foundContexts;\n}\n","function nonBlank(line) {\n  return !/^\\s*$/.test(line);\n}\n\nfunction countIndent(line) {\n  const [indent] = line.match(/^\\s*/);\n  return indent.length;\n}\n\n/**\n * Template literal tag for dedenting FTL code.\n *\n * Strip the common indent of non-blank lines. Remove blank lines.\n *\n * @param {Array<string>} strings\n */\nexport function ftl(strings) {\n  const [code] = strings;\n  const lines = code.split(\"\\n\").filter(nonBlank);\n  const indents = lines.map(countIndent);\n  const common = Math.min(...indents);\n  const indent = new RegExp(`^\\\\s{${common}}`);\n\n  return lines.map(\n    line => line.replace(indent, \"\")\n  ).join(\"\\n\");\n}\n","/*\n * @module fluent\n * @overview\n *\n * `fluent` is a JavaScript implementation of Project Fluent, a localization\n * framework designed to unleash the expressive power of the natural language.\n *\n */\n\nexport { default as _parse } from \"./parser\";\n\nexport { MessageContext } from \"./context\";\nexport {\n  FluentType as MessageArgument,\n  FluentNumber as MessageNumberArgument,\n  FluentDateTime as MessageDateTimeArgument,\n} from \"./types\";\n\nexport { default as CachedIterable } from \"./cached_iterable\";\nexport { mapContextSync, mapContextAsync } from \"./fallback\";\n\nexport { ftl } from \"./util\";\n","import { CachedIterable, mapContextSync } from \"fluent\";\n\n/*\n * `ReactLocalization` handles translation formatting and fallback.\n *\n * The current negotiated fallback chain of languages is stored in the\n * `ReactLocalization` instance in form of an iterable of `MessageContext`\n * instances.  This iterable is used to find the best existing translation for\n * a given identifier.\n *\n * `Localized` components must subscribe to the changes of the\n * `ReactLocalization`'s fallback chain.  When the fallback chain changes (the\n * `messages` iterable is set anew), all subscribed compontent must relocalize.\n *\n * The `ReactLocalization` class instances are exposed to `Localized` elements\n * via the `LocalizationProvider` component.\n */\nexport default class ReactLocalization {\n  constructor(messages) {\n    this.contexts = new CachedIterable(messages);\n    this.subs = new Set();\n  }\n\n  /*\n   * Subscribe a `Localized` component to changes of `messages`.\n   */\n  subscribe(comp) {\n    this.subs.add(comp);\n  }\n\n  /*\n   * Unsubscribe a `Localized` component from `messages` changes.\n   */\n  unsubscribe(comp) {\n    this.subs.delete(comp);\n  }\n\n  /*\n   * Set a new `messages` iterable and trigger the retranslation.\n   */\n  setMessages(messages) {\n    this.contexts = new CachedIterable(messages);\n\n    // Update all subscribed Localized components.\n    this.subs.forEach(comp => comp.relocalize());\n  }\n\n  getMessageContext(id) {\n    return mapContextSync(this.contexts, id);\n  }\n\n  formatCompound(mcx, msg, args) {\n    const value = mcx.format(msg, args);\n\n    if (msg.attrs) {\n      var attrs = {};\n      for (const name of Object.keys(msg.attrs)) {\n        attrs[name] = mcx.format(msg.attrs[name], args);\n      }\n    }\n\n    return { value, attrs };\n  }\n\n  /*\n   * Find a translation by `id` and format it to a string using `args`.\n   */\n  getString(id, args, fallback) {\n    const mcx = this.getMessageContext(id);\n\n    if (mcx === null) {\n      return fallback || id;\n    }\n\n    const msg = mcx.getMessage(id);\n    return mcx.format(msg, args);\n  }\n}\n\nexport function isReactLocalization(props, propName) {\n  const prop = props[propName];\n\n  if (prop instanceof ReactLocalization) {\n    return null;\n  }\n\n  return new Error(\n    `The ${propName} context field must be an instance of ReactLocalization.`\n  );\n}\n","import { Component, Children } from \"react\";\nimport PropTypes from \"prop-types\";\n\nimport ReactLocalization, { isReactLocalization} from \"./localization\";\n\n/*\n * The Provider component for the `ReactLocalization` class.\n *\n * Exposes a `ReactLocalization` instance to all descendants via React's\n * context feature.  It makes translations available to all localizable\n * elements in the descendant's render tree without the need to pass them\n * explicitly.\n *\n *     <LocalizationProvider messages={…}>\n *         …\n *     </LocalizationProvider>\n *\n * The `LocalizationProvider` component takes one prop: `messages`.  It should\n * be an iterable of `MessageContext` instances in order of the user's\n * preferred languages.  The `MessageContext` instances will be used by\n * `ReactLocalization` to format translations.  If a translation is missing in\n * one instance, `ReactLocalization` will fall back to the next one.\n */\nexport default class LocalizationProvider extends Component {\n  constructor(props) {\n    super(props);\n    const { messages } = props;\n\n    if (messages === undefined) {\n      throw new Error(\"LocalizationProvider must receive the messages prop.\");\n    }\n\n    if (!messages[Symbol.iterator]) {\n      throw new Error(\"The messages prop must be an iterable.\");\n    }\n\n    this.l10n = new ReactLocalization(messages);\n  }\n\n  getChildContext() {\n    return {\n      l10n: this.l10n\n    };\n  }\n\n  componentWillReceiveProps(next) {\n    const { messages } = next;\n\n    if (messages !== this.props.messages) {\n      this.l10n.setMessages(messages);\n    }\n  }\n\n  render() {\n    return Children.only(this.props.children);\n  }\n}\n\nLocalizationProvider.childContextTypes = {\n  l10n: isReactLocalization\n};\n\nLocalizationProvider.propTypes = {\n  children: PropTypes.element.isRequired,\n  messages: isIterable\n};\n\nfunction isIterable(props, propName, componentName) {\n  const prop = props[propName];\n\n  if (Symbol.iterator in Object(prop)) {\n    return null;\n  }\n\n  return new Error(\n    `The ${propName} prop supplied to ${componentName} must be an iterable.`\n  );\n}\n","import { createElement, Component } from \"react\";\n\nimport { isReactLocalization } from \"./localization\";\n\nexport default function withLocalization(Inner) {\n  class WithLocalization extends Component {\n    componentDidMount() {\n      const { l10n } = this.context;\n\n      if (l10n) {\n        l10n.subscribe(this);\n      }\n    }\n\n    componentWillUnmount() {\n      const { l10n } = this.context;\n\n      if (l10n) {\n        l10n.unsubscribe(this);\n      }\n    }\n\n    /*\n     * Rerender this component in a new language.\n     */\n    relocalize() {\n      // When the `ReactLocalization`'s fallback chain changes, update the\n      // component.\n      this.forceUpdate();\n    }\n\n    /*\n     * Find a translation by `id` and format it to a string using `args`.\n     */\n    getString(id, args, fallback) {\n      const { l10n } = this.context;\n\n      if (!l10n) {\n        return fallback || id;\n      }\n\n      return l10n.getString(id, args, fallback);\n    }\n\n    render() {\n      return createElement(\n        Inner,\n        Object.assign(\n          // getString needs to be re-bound on updates to trigger a re-render\n          { getString: (...args) => this.getString(...args) },\n          this.props\n        )\n      );\n    }\n  }\n\n  WithLocalization.displayName = `WithLocalization(${displayName(Inner)})`;\n\n  WithLocalization.contextTypes = {\n    l10n: isReactLocalization\n  };\n\n  return WithLocalization;\n}\n\nfunction displayName(component) {\n  return component.displayName || component.name || \"Component\";\n}\n","/* eslint-env browser */\n\nconst TEMPLATE = document.createElement(\"template\");\n\nexport function parseMarkup(str) {\n  TEMPLATE.innerHTML = str;\n  return TEMPLATE.content;\n}\n","/**\n * Copyright (c) 2013-present, Facebook, Inc.\n *\n * This source code is licensed under the MIT license found in the\n * LICENSE file in this directory.\n */\n\n// For HTML, certain tags should omit their close tag. We keep a whitelist for\n// those special-case tags.\n\nvar omittedCloseTags = {\n  area: true,\n  base: true,\n  br: true,\n  col: true,\n  embed: true,\n  hr: true,\n  img: true,\n  input: true,\n  keygen: true,\n  link: true,\n  meta: true,\n  param: true,\n  source: true,\n  track: true,\n  wbr: true,\n  // NOTE: menuitem's close tag should be omitted, but that causes problems.\n};\n\nexport default omittedCloseTags;\n","/**\n * Copyright (c) 2013-present, Facebook, Inc.\n *\n * This source code is licensed under the MIT license found in the\n * LICENSE file in this directory.\n */\n\nimport omittedCloseTags from './omittedCloseTags';\n\n// For HTML, certain tags cannot have children. This has the same purpose as\n// `omittedCloseTags` except that `menuitem` should still have its closing tag.\n\nvar voidElementTags = {\n  menuitem: true,\n  ...omittedCloseTags,\n};\n\nexport default voidElementTags;\n","import { isValidElement, cloneElement, Component, Children } from \"react\";\nimport PropTypes from \"prop-types\";\n\nimport { isReactLocalization } from \"./localization\";\nimport { parseMarkup } from \"./markup\";\nimport VOID_ELEMENTS from \"../vendor/voidElementTags\";\n\n// Match the opening angle bracket (<) in HTML tags, and HTML entities like\n// &amp;, &#0038;, &#x0026;.\nconst reMarkup = /<|&#?\\w+;/;\n\n/*\n * Prepare props passed to `Localized` for formatting.\n */\nfunction toArguments(props) {\n  const args = {};\n  const elems = {};\n\n  for (const [propname, propval] of Object.entries(props)) {\n    if (propname.startsWith(\"$\")) {\n      const name = propname.substr(1);\n      args[name] = propval;\n    } else if (isValidElement(propval)) {\n      // We'll try to match localNames of elements found in the translation with\n      // names of elements passed as props. localNames are always lowercase.\n      const name = propname.toLowerCase();\n      elems[name] = propval;\n    }\n  }\n\n  return [args, elems];\n}\n\n/*\n * The `Localized` class renders its child with translated props and children.\n *\n *     <Localized id=\"hello-world\">\n *         <p>{'Hello, world!'}</p>\n *     </Localized>\n *\n * The `id` prop should be the unique identifier of the translation.  Any\n * attributes found in the translation will be applied to the wrapped element.\n *\n * Arguments to the translation can be passed as `$`-prefixed props on\n * `Localized`.\n *\n *     <Localized id=\"hello-world\" $username={name}>\n *         <p>{'Hello, { $username }!'}</p>\n *     </Localized>\n *\n *  It's recommended that the contents of the wrapped component be a string\n *  expression.  The string will be used as the ultimate fallback if no\n *  translation is available.  It also makes it easy to grep for strings in the\n *  source code.\n */\nexport default class Localized extends Component {\n  componentDidMount() {\n    const { l10n } = this.context;\n\n    if (l10n) {\n      l10n.subscribe(this);\n    }\n  }\n\n  componentWillUnmount() {\n    const { l10n } = this.context;\n\n    if (l10n) {\n      l10n.unsubscribe(this);\n    }\n  }\n\n  /*\n   * Rerender this component in a new language.\n   */\n  relocalize() {\n    // When the `ReactLocalization`'s fallback chain changes, update the\n    // component.\n    this.forceUpdate();\n  }\n\n  render() {\n    const { l10n } = this.context;\n    const { id, attrs, children } = this.props;\n    const elem = Children.only(children);\n\n    if (!l10n) {\n      // Use the wrapped component as fallback.\n      return elem;\n    }\n\n    const mcx = l10n.getMessageContext(id);\n\n    if (mcx === null) {\n      // Use the wrapped component as fallback.\n      return elem;\n    }\n\n    const msg = mcx.getMessage(id);\n    const [args, elems] = toArguments(this.props);\n    const {\n      value: messageValue,\n      attrs: messageAttrs\n    } = l10n.formatCompound(mcx, msg, args);\n\n    // The default is to forbid all message attributes. If the attrs prop exists\n    // on the Localized instance, only set message attributes which have been\n    // explicitly allowed by the developer.\n    if (attrs && messageAttrs) {\n      var localizedProps = {};\n\n      for (const [name, value] of Object.entries(messageAttrs)) {\n        if (attrs[name]) {\n          localizedProps[name] = value;\n        }\n      }\n    }\n\n    // If the wrapped component is a known void element, explicitly dismiss the\n    // message value and do not pass it to cloneElement in order to avoid the\n    // \"void element tags must neither have `children` nor use\n    // `dangerouslySetInnerHTML`\" error.\n    if (elem.type in VOID_ELEMENTS) {\n      return cloneElement(elem, localizedProps);\n    }\n\n    // If the message has a null value, we're only interested in its attributes.\n    // Do not pass the null value to cloneElement as it would nuke all children\n    // of the wrapped component.\n    if (messageValue === null) {\n      return cloneElement(elem, localizedProps);\n    }\n\n    // If the message value doesn't contain any markup nor any HTML entities,\n    // insert it as the only child of the wrapped component.\n    if (!reMarkup.test(messageValue)) {\n      return cloneElement(elem, localizedProps, messageValue);\n    }\n\n    // If the message contains markup, parse it and try to match the children\n    // found in the translation with the props passed to this Localized.\n    const translationNodes = Array.from(parseMarkup(messageValue).childNodes);\n    const translatedChildren = translationNodes.map(childNode => {\n      if (childNode.nodeType === childNode.TEXT_NODE) {\n        return childNode.textContent;\n      }\n\n      // If the child is not expected just take its textContent.\n      if (!elems.hasOwnProperty(childNode.localName)) {\n        return childNode.textContent;\n      }\n\n      const sourceChild = elems[childNode.localName];\n\n      // If the element passed as a prop to <Localized> is a known void element,\n      // explicitly dismiss any textContent which might have accidentally been\n      // defined in the translation to prevent the \"void element tags must not\n      // have children\" error.\n      if (sourceChild.type in VOID_ELEMENTS) {\n        return sourceChild;\n      }\n\n      // TODO Protect contents of elements wrapped in <Localized>\n      // https://github.com/projectfluent/fluent.js/issues/184\n      // TODO  Control localizable attributes on elements passed as props\n      // https://github.com/projectfluent/fluent.js/issues/185\n      return cloneElement(sourceChild, null, childNode.textContent);\n    });\n\n    return cloneElement(elem, localizedProps, ...translatedChildren);\n  }\n}\n\nLocalized.contextTypes = {\n  l10n: isReactLocalization\n};\n\nLocalized.propTypes = {\n  children: PropTypes.element.isRequired,\n};\n","/*\n * @module fluent-react\n * @overview\n *\n\n * `fluent-react` provides React bindings for Fluent.  It takes advantage of\n * React's Components system and the virtual DOM.  Translations are exposed to\n * components via the provider pattern.\n *\n *     <LocalizationProvider messages={…}>\n *         <Localized id=\"hello-world\">\n *             <p>{'Hello, world!'}</p>\n *         </Localized>\n *     </LocalizationProvider>\n *\n * Consult the documentation of the `LocalizationProvider` and the `Localized`\n * components for more information.\n */\n\nexport { default as LocalizationProvider } from \"./provider\";\nexport { default as withLocalization } from \"./with_localization\";\nexport { default as Localized } from \"./localized\";\nexport { default as ReactLocalization, isReactLocalization }\n  from \"./localization\";\n","this.Dedupe = class Dedupe {\n  constructor(createKey) {\n    this.createKey = createKey || this.defaultCreateKey;\n  }\n\n  defaultCreateKey(item) {\n    return item;\n  }\n\n  /**\n   * Dedupe any number of grouped elements favoring those from earlier groups.\n   *\n   * @param {Array} groups Contains an arbitrary number of arrays of elements.\n   * @returns {Array} A matching array of each provided group deduped.\n   */\n  group(...groups) {\n    const globalKeys = new Set();\n    const result = [];\n    for (const values of groups) {\n      const valueMap = new Map();\n      for (const value of values) {\n        const key = this.createKey(value);\n        if (!globalKeys.has(key) && !valueMap.has(key)) {\n          valueMap.set(key, value);\n        }\n      }\n      result.push(valueMap);\n      valueMap.forEach((value, key) => globalKeys.add(key));\n    }\n    return result.map(m => Array.from(m.values()));\n  }\n};\n\nconst EXPORTED_SYMBOLS = [\"Dedupe\"];\n","/* This Source Code Form is subject to the terms of the Mozilla Public\n * License, v. 2.0. If a copy of the MPL was not distributed with this\n * file, You can obtain one at http://mozilla.org/MPL/2.0/. */\n\"use strict\";\n\nconst {actionTypes: at} = ChromeUtils.import(\"resource://activity-stream/common/Actions.jsm\", {});\nconst {Dedupe} = ChromeUtils.import(\"resource://activity-stream/common/Dedupe.jsm\", {});\n\nconst TOP_SITES_DEFAULT_ROWS = 1;\nconst TOP_SITES_MAX_SITES_PER_ROW = 8;\n\nconst dedupe = new Dedupe(site => site && site.url);\n\nconst INITIAL_STATE = {\n  App: {\n    // Have we received real data from the app yet?\n    initialized: false,\n  },\n  ASRouter: {\n    initialized: false,\n    allowLegacySnippets: null,\n  },\n  Snippets: {initialized: false},\n  TopSites: {\n    // Have we received real data from history yet?\n    initialized: false,\n    // The history (and possibly default) links\n    rows: [],\n    // Used in content only to dispatch action to TopSiteForm.\n    editForm: null,\n    // Used in content only to open the SearchShortcutsForm modal.\n    showSearchShortcutsForm: false,\n    // The list of available search shortcuts.\n    searchShortcuts: [],\n  },\n  Prefs: {\n    initialized: false,\n    values: {},\n  },\n  Dialog: {\n    visible: false,\n    data: {},\n  },\n  Sections: [],\n  Pocket: {\n    isUserLoggedIn: null,\n    pocketCta: {},\n    waitingForSpoc: true,\n  },\n};\n\nfunction App(prevState = INITIAL_STATE.App, action) {\n  switch (action.type) {\n    case at.INIT:\n      return Object.assign({}, prevState, action.data || {}, {initialized: true});\n    default:\n      return prevState;\n  }\n}\n\nfunction ASRouter(prevState = INITIAL_STATE.ASRouter, action) {\n  switch (action.type) {\n    case at.AS_ROUTER_INITIALIZED:\n      return {...action.data, initialized: true};\n    case at.AS_ROUTER_PREF_CHANGED:\n      return {...prevState, ...action.data};\n    default:\n      return prevState;\n  }\n}\n\n/**\n * insertPinned - Inserts pinned links in their specified slots\n *\n * @param {array} a list of links\n * @param {array} a list of pinned links\n * @return {array} resulting list of links with pinned links inserted\n */\nfunction insertPinned(links, pinned) {\n  // Remove any pinned links\n  const pinnedUrls = pinned.map(link => link && link.url);\n  let newLinks = links.filter(link => (link ? !pinnedUrls.includes(link.url) : false));\n  newLinks = newLinks.map(link => {\n    if (link && link.isPinned) {\n      delete link.isPinned;\n      delete link.pinIndex;\n    }\n    return link;\n  });\n\n  // Then insert them in their specified location\n  pinned.forEach((val, index) => {\n    if (!val) { return; }\n    let link = Object.assign({}, val, {isPinned: true, pinIndex: index});\n    if (index > newLinks.length) {\n      newLinks[index] = link;\n    } else {\n      newLinks.splice(index, 0, link);\n    }\n  });\n\n  return newLinks;\n}\n\nfunction TopSites(prevState = INITIAL_STATE.TopSites, action) {\n  let hasMatch;\n  let newRows;\n  switch (action.type) {\n    case at.TOP_SITES_UPDATED:\n      if (!action.data || !action.data.links) {\n        return prevState;\n      }\n      return Object.assign({}, prevState, {initialized: true, rows: action.data.links}, action.data.pref ? {pref: action.data.pref} : {});\n    case at.TOP_SITES_PREFS_UPDATED:\n      return Object.assign({}, prevState, {pref: action.data.pref});\n    case at.TOP_SITES_EDIT:\n      return Object.assign({}, prevState, {\n        editForm: {\n          index: action.data.index,\n          previewResponse: null,\n        },\n      });\n    case at.TOP_SITES_CANCEL_EDIT:\n      return Object.assign({}, prevState, {editForm: null});\n    case at.TOP_SITES_OPEN_SEARCH_SHORTCUTS_MODAL:\n      return Object.assign({}, prevState, {showSearchShortcutsForm: true});\n    case at.TOP_SITES_CLOSE_SEARCH_SHORTCUTS_MODAL:\n      return Object.assign({}, prevState, {showSearchShortcutsForm: false});\n    case at.PREVIEW_RESPONSE:\n      if (!prevState.editForm || action.data.url !== prevState.editForm.previewUrl) {\n        return prevState;\n      }\n      return Object.assign({}, prevState, {\n        editForm: {\n          index: prevState.editForm.index,\n          previewResponse: action.data.preview,\n          previewUrl: action.data.url,\n        },\n      });\n    case at.PREVIEW_REQUEST:\n      if (!prevState.editForm) {\n        return prevState;\n      }\n      return Object.assign({}, prevState, {\n        editForm: {\n          index: prevState.editForm.index,\n          previewResponse: null,\n          previewUrl: action.data.url,\n        },\n      });\n    case at.PREVIEW_REQUEST_CANCEL:\n      if (!prevState.editForm) {\n        return prevState;\n      }\n      return Object.assign({}, prevState, {\n        editForm: {\n          index: prevState.editForm.index,\n          previewResponse: null,\n        },\n      });\n    case at.SCREENSHOT_UPDATED:\n      newRows = prevState.rows.map(row => {\n        if (row && row.url === action.data.url) {\n          hasMatch = true;\n          return Object.assign({}, row, {screenshot: action.data.screenshot});\n        }\n        return row;\n      });\n      return hasMatch ? Object.assign({}, prevState, {rows: newRows}) : prevState;\n    case at.PLACES_BOOKMARK_ADDED:\n      if (!action.data) {\n        return prevState;\n      }\n      newRows = prevState.rows.map(site => {\n        if (site && site.url === action.data.url) {\n          const {bookmarkGuid, bookmarkTitle, dateAdded} = action.data;\n          return Object.assign({}, site, {bookmarkGuid, bookmarkTitle, bookmarkDateCreated: dateAdded});\n        }\n        return site;\n      });\n      return Object.assign({}, prevState, {rows: newRows});\n    case at.PLACES_BOOKMARK_REMOVED:\n      if (!action.data) {\n        return prevState;\n      }\n      newRows = prevState.rows.map(site => {\n        if (site && site.url === action.data.url) {\n          const newSite = Object.assign({}, site);\n          delete newSite.bookmarkGuid;\n          delete newSite.bookmarkTitle;\n          delete newSite.bookmarkDateCreated;\n          return newSite;\n        }\n        return site;\n      });\n      return Object.assign({}, prevState, {rows: newRows});\n    case at.PLACES_LINK_DELETED:\n      if (!action.data) {\n        return prevState;\n      }\n      newRows = prevState.rows.filter(site => action.data.url !== site.url);\n      return Object.assign({}, prevState, {rows: newRows});\n    case at.UPDATE_SEARCH_SHORTCUTS:\n      return {...prevState, searchShortcuts: action.data.searchShortcuts};\n    case at.SNIPPETS_PREVIEW_MODE:\n      return {...prevState, rows: []};\n    default:\n      return prevState;\n  }\n}\n\nfunction Dialog(prevState = INITIAL_STATE.Dialog, action) {\n  switch (action.type) {\n    case at.DIALOG_OPEN:\n      return Object.assign({}, prevState, {visible: true, data: action.data});\n    case at.DIALOG_CANCEL:\n      return Object.assign({}, prevState, {visible: false});\n    case at.DELETE_HISTORY_URL:\n      return Object.assign({}, INITIAL_STATE.Dialog);\n    default:\n      return prevState;\n  }\n}\n\nfunction Prefs(prevState = INITIAL_STATE.Prefs, action) {\n  let newValues;\n  switch (action.type) {\n    case at.PREFS_INITIAL_VALUES:\n      return Object.assign({}, prevState, {initialized: true, values: action.data});\n    case at.PREF_CHANGED:\n      newValues = Object.assign({}, prevState.values);\n      newValues[action.data.name] = action.data.value;\n      return Object.assign({}, prevState, {values: newValues});\n    default:\n      return prevState;\n  }\n}\n\nfunction Sections(prevState = INITIAL_STATE.Sections, action) {\n  let hasMatch;\n  let newState;\n  switch (action.type) {\n    case at.SECTION_DEREGISTER:\n      return prevState.filter(section => section.id !== action.data);\n    case at.SECTION_REGISTER:\n      // If section exists in prevState, update it\n      newState = prevState.map(section => {\n        if (section && section.id === action.data.id) {\n          hasMatch = true;\n          return Object.assign({}, section, action.data);\n        }\n        return section;\n      });\n      // Otherwise, append it\n      if (!hasMatch) {\n        const initialized = !!(action.data.rows && action.data.rows.length > 0);\n        const section = Object.assign({title: \"\", rows: [], enabled: false}, action.data, {initialized});\n        newState.push(section);\n      }\n      return newState;\n    case at.SECTION_UPDATE:\n      newState = prevState.map(section => {\n        if (section && section.id === action.data.id) {\n          // If the action is updating rows, we should consider initialized to be true.\n          // This can be overridden if initialized is defined in the action.data\n          const initialized = action.data.rows ? {initialized: true} : {};\n\n          // Make sure pinned cards stay at their current position when rows are updated.\n          // Disabling a section (SECTION_UPDATE with empty rows) does not retain pinned cards.\n          if (action.data.rows && action.data.rows.length > 0 && section.rows.find(card => card.pinned)) {\n            const rows = Array.from(action.data.rows);\n            section.rows.forEach((card, index) => {\n              if (card.pinned) {\n                // Only add it if it's not already there.\n                if (rows[index].guid !== card.guid) {\n                  rows.splice(index, 0, card);\n                }\n              }\n            });\n            return Object.assign({}, section, initialized, Object.assign({}, action.data, {rows}));\n          }\n\n          return Object.assign({}, section, initialized, action.data);\n        }\n        return section;\n      });\n\n      if (!action.data.dedupeConfigurations) {\n        return newState;\n      }\n\n      action.data.dedupeConfigurations.forEach(dedupeConf => {\n        newState = newState.map(section => {\n          if (section.id === dedupeConf.id) {\n            const dedupedRows = dedupeConf.dedupeFrom.reduce((rows, dedupeSectionId) => {\n              const dedupeSection = newState.find(s => s.id === dedupeSectionId);\n              const [, newRows] = dedupe.group(dedupeSection.rows, rows);\n              return newRows;\n            }, section.rows);\n\n            return Object.assign({}, section, {rows: dedupedRows});\n          }\n\n          return section;\n        });\n      });\n\n      return newState;\n    case at.SECTION_UPDATE_CARD:\n      return prevState.map(section => {\n        if (section && section.id === action.data.id && section.rows) {\n          const newRows = section.rows.map(card => {\n            if (card.url === action.data.url) {\n              return Object.assign({}, card, action.data.options);\n            }\n            return card;\n          });\n          return Object.assign({}, section, {rows: newRows});\n        }\n        return section;\n      });\n    case at.PLACES_BOOKMARK_ADDED:\n      if (!action.data) {\n        return prevState;\n      }\n      return prevState.map(section => Object.assign({}, section, {\n        rows: section.rows.map(item => {\n          // find the item within the rows that is attempted to be bookmarked\n          if (item.url === action.data.url) {\n            const {bookmarkGuid, bookmarkTitle, dateAdded} = action.data;\n            return Object.assign({}, item, {\n              bookmarkGuid,\n              bookmarkTitle,\n              bookmarkDateCreated: dateAdded,\n              type: \"bookmark\",\n            });\n          }\n          return item;\n        }),\n      }));\n    case at.PLACES_SAVED_TO_POCKET:\n      if (!action.data) {\n        return prevState;\n      }\n      return prevState.map(section => Object.assign({}, section, {\n        rows: section.rows.map(item => {\n          if (item.url === action.data.url) {\n            return Object.assign({}, item, {\n              open_url: action.data.open_url,\n              pocket_id: action.data.pocket_id,\n              title: action.data.title,\n              type: \"pocket\",\n            });\n          }\n          return item;\n        }),\n      }));\n    case at.PLACES_BOOKMARK_REMOVED:\n      if (!action.data) {\n        return prevState;\n      }\n      return prevState.map(section => Object.assign({}, section, {\n        rows: section.rows.map(item => {\n          // find the bookmark within the rows that is attempted to be removed\n          if (item.url === action.data.url) {\n            const newSite = Object.assign({}, item);\n            delete newSite.bookmarkGuid;\n            delete newSite.bookmarkTitle;\n            delete newSite.bookmarkDateCreated;\n            if (!newSite.type || newSite.type === \"bookmark\") {\n              newSite.type = \"history\";\n            }\n            return newSite;\n          }\n          return item;\n        }),\n      }));\n    case at.PLACES_LINK_DELETED:\n    case at.PLACES_LINK_BLOCKED:\n      if (!action.data) {\n        return prevState;\n      }\n      return prevState.map(section =>\n        Object.assign({}, section, {rows: section.rows.filter(site => site.url !== action.data.url)}));\n    case at.DELETE_FROM_POCKET:\n    case at.ARCHIVE_FROM_POCKET:\n      return prevState.map(section =>\n        Object.assign({}, section, {rows: section.rows.filter(site => site.pocket_id !== action.data.pocket_id)}));\n    case at.SNIPPETS_PREVIEW_MODE:\n      return prevState.map(section => ({...section, rows: []}));\n    default:\n      return prevState;\n  }\n}\n\nfunction Snippets(prevState = INITIAL_STATE.Snippets, action) {\n  switch (action.type) {\n    case at.SNIPPETS_DATA:\n      return Object.assign({}, prevState, {initialized: true}, action.data);\n    case at.SNIPPET_BLOCKED:\n      return Object.assign({}, prevState, {blockList: prevState.blockList.concat(action.data)});\n    case at.SNIPPETS_BLOCKLIST_CLEARED:\n      return Object.assign({}, prevState, {blockList: []});\n    case at.SNIPPETS_RESET:\n      return INITIAL_STATE.Snippets;\n    default:\n      return prevState;\n  }\n}\n\nfunction Pocket(prevState = INITIAL_STATE.Pocket, action) {\n  switch (action.type) {\n    case at.POCKET_WAITING_FOR_SPOC:\n      return {...prevState, waitingForSpoc: action.data};\n    case at.POCKET_LOGGED_IN:\n      return {...prevState, isUserLoggedIn: !!action.data};\n    case at.POCKET_CTA:\n      return {\n        ...prevState,\n        pocketCta: {\n          ctaButton: action.data.cta_button,\n          ctaText: action.data.cta_text,\n          ctaUrl: action.data.cta_url,\n          useCta: action.data.use_cta,\n        },\n      };\n    default:\n      return prevState;\n  }\n}\n\nthis.INITIAL_STATE = INITIAL_STATE;\nthis.TOP_SITES_DEFAULT_ROWS = TOP_SITES_DEFAULT_ROWS;\nthis.TOP_SITES_MAX_SITES_PER_ROW = TOP_SITES_MAX_SITES_PER_ROW;\n\nthis.reducers = {TopSites, App, ASRouter, Snippets, Prefs, Dialog, Sections, Pocket};\n\nconst EXPORTED_SYMBOLS = [\"reducers\", \"INITIAL_STATE\", \"insertPinned\", \"TOP_SITES_DEFAULT_ROWS\", \"TOP_SITES_MAX_SITES_PER_ROW\"];\n","export const cardContextTypes = {\n  history: {\n    intlID: \"type_label_visited\",\n    icon: \"history-item\",\n  },\n  bookmark: {\n    intlID: \"type_label_bookmarked\",\n    icon: \"bookmark-added\",\n  },\n  trending: {\n    intlID: \"type_label_recommended\",\n    icon: \"trending\",\n  },\n  now: {\n    intlID: \"type_label_now\",\n    icon: \"now\",\n  },\n  pocket: {\n    intlID: \"type_label_pocket\",\n    icon: \"pocket\",\n  },\n  download: {\n    intlID: \"type_label_downloaded\",\n    icon: \"download\",\n  },\n};\n","import {actionCreators as ac, actionTypes as at} from \"common/Actions.jsm\";\nimport {FormattedMessage, injectIntl} from \"react-intl\";\nimport {cardContextTypes} from \"./types\";\nimport {connect} from \"react-redux\";\nimport {GetPlatformString} from \"content-src/lib/link-menu-options\";\nimport {LinkMenu} from \"content-src/components/LinkMenu/LinkMenu\";\nimport React from \"react\";\nimport {ScreenshotUtils} from \"content-src/lib/screenshot-utils\";\n\n// Keep track of pending image loads to only request once\nconst gImageLoading = new Map();\n\n/**\n * Card component.\n * Cards are found within a Section component and contain information about a link such\n * as preview image, page title, page description, and some context about if the page\n * was visited, bookmarked, trending etc...\n * Each Section can make an unordered list of Cards which will create one instane of\n * this class. Each card will then get a context menu which reflects the actions that\n * can be done on this Card.\n */\nexport class _Card extends React.PureComponent {\n  constructor(props) {\n    super(props);\n    this.state = {\n      activeCard: null,\n      imageLoaded: false,\n      showContextMenu: false,\n      cardImage: null,\n    };\n    this.onMenuButtonClick = this.onMenuButtonClick.bind(this);\n    this.onMenuUpdate = this.onMenuUpdate.bind(this);\n    this.onLinkClick = this.onLinkClick.bind(this);\n  }\n\n  /**\n   * Helper to conditionally load an image and update state when it loads.\n   */\n  async maybeLoadImage() {\n    // No need to load if it's already loaded or no image\n    const {cardImage} = this.state;\n    if (!cardImage) {\n      return;\n    }\n\n    const imageUrl = cardImage.url;\n    if (!this.state.imageLoaded) {\n      // Initialize a promise to share a load across multiple card updates\n      if (!gImageLoading.has(imageUrl)) {\n        const loaderPromise = new Promise((resolve, reject) => {\n          const loader = new Image();\n          loader.addEventListener(\"load\", resolve);\n          loader.addEventListener(\"error\", reject);\n          loader.src = imageUrl;\n        });\n\n        // Save and remove the promise only while it's pending\n        gImageLoading.set(imageUrl, loaderPromise);\n        loaderPromise.catch(ex => ex).then(() => gImageLoading.delete(imageUrl)).catch();\n      }\n\n      // Wait for the image whether just started loading or reused promise\n      await gImageLoading.get(imageUrl);\n\n      // Only update state if we're still waiting to load the original image\n      if (ScreenshotUtils.isRemoteImageLocal(this.state.cardImage, this.props.link.image) &&\n          !this.state.imageLoaded) {\n        this.setState({imageLoaded: true});\n      }\n    }\n  }\n\n  /**\n   * Helper to obtain the next state based on nextProps and prevState.\n   *\n   * NOTE: Rename this method to getDerivedStateFromProps when we update React\n   *       to >= 16.3. We will need to update tests as well. We cannot rename this\n   *       method to getDerivedStateFromProps now because there is a mismatch in\n   *       the React version that we are using for both testing and production.\n   *       (i.e. react-test-render => \"16.3.2\", react => \"16.2.0\").\n   *\n   * See https://github.com/airbnb/enzyme/blob/master/packages/enzyme-adapter-react-16/package.json#L43.\n   */\n  static getNextStateFromProps(nextProps, prevState) {\n    const {image} = nextProps.link;\n    const imageInState = ScreenshotUtils.isRemoteImageLocal(prevState.cardImage, image);\n    let nextState = null;\n\n    // Image is updating.\n    if (!imageInState && nextProps.link) {\n      nextState = {imageLoaded: false};\n    }\n\n    if (imageInState) {\n      return nextState;\n    }\n\n    // Since image was updated, attempt to revoke old image blob URL, if it exists.\n    ScreenshotUtils.maybeRevokeBlobObjectURL(prevState.cardImage);\n\n    nextState = nextState || {};\n    nextState.cardImage = ScreenshotUtils.createLocalImageObject(image);\n\n    return nextState;\n  }\n\n  onMenuButtonClick(event) {\n    event.preventDefault();\n    this.setState({\n      activeCard: this.props.index,\n      showContextMenu: true,\n    });\n  }\n\n  /**\n   * Report to telemetry additional information about the item.\n   */\n  _getTelemetryInfo() {\n    // Filter out \"history\" type for being the default\n    if (this.props.link.type !== \"history\") {\n      return {value: {card_type: this.props.link.type}};\n    }\n\n    return null;\n  }\n\n  onLinkClick(event) {\n    event.preventDefault();\n    if (this.props.link.type === \"download\") {\n      this.props.dispatch(ac.OnlyToMain({\n        type: at.SHOW_DOWNLOAD_FILE,\n        data: this.props.link,\n      }));\n    } else {\n      const {altKey, button, ctrlKey, metaKey, shiftKey} = event;\n      this.props.dispatch(ac.OnlyToMain({\n        type: at.OPEN_LINK,\n        data: Object.assign(this.props.link, {event: {altKey, button, ctrlKey, metaKey, shiftKey}}),\n      }));\n    }\n    if (this.props.isWebExtension) {\n      this.props.dispatch(ac.WebExtEvent(at.WEBEXT_CLICK, {\n        source: this.props.eventSource,\n        url: this.props.link.url,\n        action_position: this.props.index,\n      }));\n    } else {\n      this.props.dispatch(ac.UserEvent(Object.assign({\n        event: \"CLICK\",\n        source: this.props.eventSource,\n        action_position: this.props.index,\n      }, this._getTelemetryInfo())));\n\n      if (this.props.shouldSendImpressionStats) {\n        this.props.dispatch(ac.ImpressionStats({\n          source: this.props.eventSource,\n          click: 0,\n          tiles: [{id: this.props.link.guid, pos: this.props.index}],\n        }));\n      }\n    }\n  }\n\n  onMenuUpdate(showContextMenu) {\n    this.setState({showContextMenu});\n  }\n\n  componentDidMount() {\n    this.maybeLoadImage();\n  }\n\n  componentDidUpdate() {\n    this.maybeLoadImage();\n  }\n\n  // NOTE: Remove this function when we update React to >= 16.3 since React will\n  //       call getDerivedStateFromProps automatically. We will also need to\n  //       rename getNextStateFromProps to getDerivedStateFromProps.\n  componentWillMount() {\n    const nextState = _Card.getNextStateFromProps(this.props, this.state);\n    if (nextState) {\n      this.setState(nextState);\n    }\n  }\n\n  // NOTE: Remove this function when we update React to >= 16.3 since React will\n  //       call getDerivedStateFromProps automatically. We will also need to\n  //       rename getNextStateFromProps to getDerivedStateFromProps.\n  componentWillReceiveProps(nextProps) {\n    const nextState = _Card.getNextStateFromProps(nextProps, this.state);\n    if (nextState) {\n      this.setState(nextState);\n    }\n  }\n\n  componentWillUnmount() {\n    ScreenshotUtils.maybeRevokeBlobObjectURL(this.state.cardImage);\n  }\n\n  render() {\n    const {index, className, link, dispatch, contextMenuOptions, eventSource, shouldSendImpressionStats} = this.props;\n    const {props} = this;\n    const isContextMenuOpen = this.state.showContextMenu && this.state.activeCard === index;\n    // Display \"now\" as \"trending\" until we have new strings #3402\n    const {icon, intlID} = cardContextTypes[link.type === \"now\" ? \"trending\" : link.type] || {};\n    const hasImage = this.state.cardImage || link.hasImage;\n    const imageStyle = {backgroundImage: this.state.cardImage ? `url(${this.state.cardImage.url})` : \"none\"};\n    const outerClassName = [\n      \"card-outer\",\n      className,\n      isContextMenuOpen && \"active\",\n      props.placeholder && \"placeholder\",\n    ].filter(v => v).join(\" \");\n\n    return (<li className={outerClassName}>\n      <a href={link.type === \"pocket\" ? link.open_url : link.url} onClick={!props.placeholder ? this.onLinkClick : undefined}>\n        <div className=\"card\">\n          <div className=\"card-preview-image-outer\">\n            {hasImage &&\n              <div className={`card-preview-image${this.state.imageLoaded ? \" loaded\" : \"\"}`} style={imageStyle} />\n            }\n          </div>\n          <div className=\"card-details\">\n            {link.type === \"download\" && <div className=\"card-host-name alternate\"><FormattedMessage id={GetPlatformString(this.props.platform)} /></div>}\n            {link.hostname &&\n              <div className=\"card-host-name\">\n                {link.hostname.slice(0, 100)}{link.type === \"download\" && `  \\u2014 ${link.description}`}\n              </div>\n            }\n            <div className={[\n              \"card-text\",\n              icon ? \"\" : \"no-context\",\n              link.description ? \"\" : \"no-description\",\n              link.hostname ? \"\" : \"no-host-name\",\n            ].join(\" \")}>\n              <h4 className=\"card-title\" dir=\"auto\">{link.title}</h4>\n              <p className=\"card-description\" dir=\"auto\">{link.description}</p>\n            </div>\n            <div className=\"card-context\">\n              {icon && !link.context && <span className={`card-context-icon icon icon-${icon}`} />}\n              {link.icon && link.context && <span className=\"card-context-icon icon\" style={{backgroundImage: `url('${link.icon}')`}} />}\n              {intlID && !link.context && <div className=\"card-context-label\"><FormattedMessage id={intlID} defaultMessage=\"Visited\" /></div>}\n              {link.context && <div className=\"card-context-label\">{link.context}</div>}\n            </div>\n          </div>\n        </div>\n      </a>\n      {!props.placeholder && <button className=\"context-menu-button icon\" title={this.props.intl.formatMessage({id: \"context_menu_title\"})}\n        onClick={this.onMenuButtonClick}>\n        <span className=\"sr-only\">{`Open context menu for ${link.title}`}</span>\n      </button>}\n      {isContextMenuOpen &&\n        <LinkMenu\n          dispatch={dispatch}\n          index={index}\n          source={eventSource}\n          onUpdate={this.onMenuUpdate}\n          options={link.contextMenuOptions || contextMenuOptions}\n          site={link}\n          siteInfo={this._getTelemetryInfo()}\n          shouldSendImpressionStats={shouldSendImpressionStats} />\n      }\n   </li>);\n  }\n}\n_Card.defaultProps = {link: {}};\nexport const Card = connect(state => ({platform: state.Prefs.values.platform}))(injectIntl(_Card));\nexport const PlaceholderCard = props => <Card placeholder={true} className={props.className} />;\n","import {FormattedMessage} from \"react-intl\";\nimport React from \"react\";\n\nexport class TopSiteFormInput extends React.PureComponent {\n  constructor(props) {\n    super(props);\n    this.state = {validationError: this.props.validationError};\n    this.onChange = this.onChange.bind(this);\n    this.onMount = this.onMount.bind(this);\n  }\n\n  componentWillReceiveProps(nextProps) {\n    if (nextProps.shouldFocus && !this.props.shouldFocus) {\n      this.input.focus();\n    }\n    if (nextProps.validationError && !this.props.validationError) {\n      this.setState({validationError: true});\n    }\n    // If the component is in an error state but the value was cleared by the parent\n    if (this.state.validationError && !nextProps.value) {\n      this.setState({validationError: false});\n    }\n  }\n\n  onChange(ev) {\n    if (this.state.validationError) {\n      this.setState({validationError: false});\n    }\n    this.props.onChange(ev);\n  }\n\n  onMount(input) {\n    this.input = input;\n  }\n\n  render() {\n    const showClearButton = this.props.value && this.props.onClear;\n    const {typeUrl} = this.props;\n    const {validationError} = this.state;\n\n    return (<label><FormattedMessage id={this.props.titleId} />\n      <div className={`field ${typeUrl ? \"url\" : \"\"}${validationError ? \" invalid\" : \"\"}`}>\n        {this.props.loading ?\n          <div className=\"loading-container\"><div className=\"loading-animation\" /></div> :\n          showClearButton && <div className=\"icon icon-clear-input\" onClick={this.props.onClear} />}\n        <input type=\"text\"\n          value={this.props.value}\n          ref={this.onMount}\n          onChange={this.onChange}\n          placeholder={this.props.intl.formatMessage({id: this.props.placeholderId})}\n          autoFocus={this.props.shouldFocus}\n          disabled={this.props.loading} />\n        {validationError &&\n          <aside className=\"error-tooltip\">\n            <FormattedMessage id={this.props.errorMessageId} />\n          </aside>}\n      </div>\n    </label>);\n  }\n}\n\nTopSiteFormInput.defaultProps = {\n  showClearButton: false,\n  value: \"\",\n  validationError: false,\n};\n","import {actionCreators as ac, actionTypes as at} from \"common/Actions.jsm\";\nimport {FormattedMessage} from \"react-intl\";\nimport React from \"react\";\nimport {TOP_SITES_SOURCE} from \"./TopSitesConstants\";\nimport {TopSiteFormInput} from \"./TopSiteFormInput\";\nimport {TopSiteLink} from \"./TopSite\";\n\nexport class TopSiteForm extends React.PureComponent {\n  constructor(props) {\n    super(props);\n    const {site} = props;\n    this.state = {\n      label: site ? (site.label || site.hostname) : \"\",\n      url: site ? site.url : \"\",\n      validationError: false,\n      customScreenshotUrl: site ? site.customScreenshotURL : \"\",\n      showCustomScreenshotForm: site ? site.customScreenshotURL : false,\n    };\n    this.onClearScreenshotInput = this.onClearScreenshotInput.bind(this);\n    this.onLabelChange = this.onLabelChange.bind(this);\n    this.onUrlChange = this.onUrlChange.bind(this);\n    this.onCancelButtonClick = this.onCancelButtonClick.bind(this);\n    this.onClearUrlClick = this.onClearUrlClick.bind(this);\n    this.onDoneButtonClick = this.onDoneButtonClick.bind(this);\n    this.onCustomScreenshotUrlChange = this.onCustomScreenshotUrlChange.bind(this);\n    this.onPreviewButtonClick = this.onPreviewButtonClick.bind(this);\n    this.onEnableScreenshotUrlForm = this.onEnableScreenshotUrlForm.bind(this);\n    this.validateUrl = this.validateUrl.bind(this);\n  }\n\n  onLabelChange(event) {\n    this.setState({\"label\": event.target.value});\n  }\n\n  onUrlChange(event) {\n    this.setState({\n      url: event.target.value,\n      validationError: false,\n    });\n  }\n\n  onClearUrlClick() {\n    this.setState({\n      url: \"\",\n      validationError: false,\n    });\n  }\n\n  onEnableScreenshotUrlForm() {\n    this.setState({showCustomScreenshotForm: true});\n  }\n\n  _updateCustomScreenshotInput(customScreenshotUrl) {\n    this.setState({\n      customScreenshotUrl,\n      validationError: false,\n    });\n    this.props.dispatch({type: at.PREVIEW_REQUEST_CANCEL});\n  }\n\n  onCustomScreenshotUrlChange(event) {\n    this._updateCustomScreenshotInput(event.target.value);\n  }\n\n  onClearScreenshotInput() {\n    this._updateCustomScreenshotInput(\"\");\n  }\n\n  onCancelButtonClick(ev) {\n    ev.preventDefault();\n    this.props.onClose();\n  }\n\n  onDoneButtonClick(ev) {\n    ev.preventDefault();\n\n    if (this.validateForm()) {\n      const site = {url: this.cleanUrl(this.state.url)};\n      const {index} = this.props;\n      if (this.state.label !== \"\") {\n        site.label = this.state.label;\n      }\n\n      if (this.state.customScreenshotUrl) {\n        site.customScreenshotURL = this.cleanUrl(this.state.customScreenshotUrl);\n      } else if (this.props.site && this.props.site.customScreenshotURL) {\n        // Used to flag that previously cached screenshot should be removed\n        site.customScreenshotURL = null;\n      }\n      this.props.dispatch(ac.AlsoToMain({\n        type: at.TOP_SITES_PIN,\n        data: {site, index},\n      }));\n      this.props.dispatch(ac.UserEvent({\n        source: TOP_SITES_SOURCE,\n        event: \"TOP_SITES_EDIT\",\n        action_position: index,\n      }));\n\n      this.props.onClose();\n    }\n  }\n\n  onPreviewButtonClick(event) {\n    event.preventDefault();\n    if (this.validateForm()) {\n      this.props.dispatch(ac.AlsoToMain({\n        type: at.PREVIEW_REQUEST,\n        data: {url: this.cleanUrl(this.state.customScreenshotUrl)},\n      }));\n      this.props.dispatch(ac.UserEvent({\n        source: TOP_SITES_SOURCE,\n        event: \"PREVIEW_REQUEST\",\n      }));\n    }\n  }\n\n  cleanUrl(url) {\n    // If we are missing a protocol, prepend http://\n    if (!url.startsWith(\"http:\") && !url.startsWith(\"https:\")) {\n      return `http://${url}`;\n    }\n    return url;\n  }\n\n  _tryParseUrl(url) {\n    try {\n      return new URL(url);\n    } catch (e) {\n      return null;\n    }\n  }\n\n  validateUrl(url) {\n    const validProtocols = [\"http:\", \"https:\"];\n    const urlObj = this._tryParseUrl(url) || this._tryParseUrl(this.cleanUrl(url));\n\n    return urlObj && validProtocols.includes(urlObj.protocol);\n  }\n\n  validateCustomScreenshotUrl() {\n    const {customScreenshotUrl} = this.state;\n    return !customScreenshotUrl || this.validateUrl(customScreenshotUrl);\n  }\n\n  validateForm() {\n    const validate = this.validateUrl(this.state.url) && this.validateCustomScreenshotUrl();\n\n    if (!validate) {\n      this.setState({validationError: true});\n    }\n\n    return validate;\n  }\n\n  _renderCustomScreenshotInput() {\n    const {customScreenshotUrl} = this.state;\n    const requestFailed = this.props.previewResponse === \"\";\n    const validationError = (this.state.validationError && !this.validateCustomScreenshotUrl()) || requestFailed;\n    // Set focus on error if the url field is valid or when the input is first rendered and is empty\n    const shouldFocus = (validationError && this.validateUrl(this.state.url)) || !customScreenshotUrl;\n    const isLoading = this.props.previewResponse === null &&\n      customScreenshotUrl && this.props.previewUrl === this.cleanUrl(customScreenshotUrl);\n\n    if (!this.state.showCustomScreenshotForm) {\n      return (<a className=\"enable-custom-image-input\" onClick={this.onEnableScreenshotUrlForm}>\n        <FormattedMessage id=\"topsites_form_use_image_link\" />\n      </a>);\n    }\n    return (<div className=\"custom-image-input-container\">\n      <TopSiteFormInput\n        errorMessageId={requestFailed ? \"topsites_form_image_validation\" : \"topsites_form_url_validation\"}\n        loading={isLoading}\n        onChange={this.onCustomScreenshotUrlChange}\n        onClear={this.onClearScreenshotInput}\n        shouldFocus={shouldFocus}\n        typeUrl={true}\n        value={customScreenshotUrl}\n        validationError={validationError}\n        titleId=\"topsites_form_image_url_label\"\n        placeholderId=\"topsites_form_url_placeholder\"\n        intl={this.props.intl} />\n    </div>);\n  }\n\n  render() {\n    const {customScreenshotUrl} = this.state;\n    const requestFailed = this.props.previewResponse === \"\";\n    // For UI purposes, editing without an existing link is \"add\"\n    const showAsAdd = !this.props.site;\n    const previous = (this.props.site && this.props.site.customScreenshotURL) || \"\";\n    const changed = customScreenshotUrl && this.cleanUrl(customScreenshotUrl) !== previous;\n    // Preview mode if changes were made to the custom screenshot URL and no preview was received yet\n    // or the request failed\n    const previewMode = changed && !this.props.previewResponse;\n    const previewLink = Object.assign({}, this.props.site);\n    if (this.props.previewResponse) {\n      previewLink.screenshot = this.props.previewResponse;\n      previewLink.customScreenshotURL = this.props.previewUrl;\n    }\n    return (\n      <form className=\"topsite-form\">\n        <div className=\"form-input-container\">\n          <h3 className=\"section-title\">\n            <FormattedMessage id={showAsAdd ? \"topsites_form_add_header\" : \"topsites_form_edit_header\"} />\n          </h3>\n          <div className=\"fields-and-preview\">\n            <div className=\"form-wrapper\">\n              <TopSiteFormInput onChange={this.onLabelChange}\n                value={this.state.label}\n                titleId=\"topsites_form_title_label\"\n                placeholderId=\"topsites_form_title_placeholder\"\n                intl={this.props.intl} />\n              <TopSiteFormInput onChange={this.onUrlChange}\n                shouldFocus={this.state.validationError && !this.validateUrl(this.state.url)}\n                value={this.state.url}\n                onClear={this.onClearUrlClick}\n                validationError={this.state.validationError && !this.validateUrl(this.state.url)}\n                titleId=\"topsites_form_url_label\"\n                typeUrl={true}\n                placeholderId=\"topsites_form_url_placeholder\"\n                errorMessageId=\"topsites_form_url_validation\"\n                intl={this.props.intl} />\n              {this._renderCustomScreenshotInput()}\n            </div>\n            <TopSiteLink link={previewLink}\n              defaultStyle={requestFailed}\n              title={this.state.label} />\n          </div>\n        </div>\n        <section className=\"actions\">\n          <button className=\"cancel\" type=\"button\" onClick={this.onCancelButtonClick}>\n            <FormattedMessage id=\"topsites_form_cancel_button\" />\n          </button>\n          {previewMode ?\n            <button className=\"done preview\" type=\"submit\" onClick={this.onPreviewButtonClick}>\n              <FormattedMessage id=\"topsites_form_preview_button\" />\n            </button> :\n            <button className=\"done\" type=\"submit\" onClick={this.onDoneButtonClick}>\n              <FormattedMessage id={showAsAdd ? \"topsites_form_add_button\" : \"topsites_form_save_button\"} />\n            </button>}\n        </section>\n      </form>\n    );\n  }\n}\n\nTopSiteForm.defaultProps = {\n  site: null,\n  index: -1,\n};\n"],"sourceRoot":""}