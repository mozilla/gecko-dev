# A3-GFB-diagnosis-plan
Bug URL: https://bugzilla.mozilla.org/show_bug.cgi?id=1510706

Patch URL:

Pull Request URL:

## Bug Diagnosis

All of the following Java classes in the Android version of Firefox are reported to contain pointless bitwise expressions:

- CacheDataSource
- DataSpec
- GeckoScreenOrientation
- GeckoSession
- GeckoThread
- Tx3gDecoder

The benefit of fixing this bug is a cleaner code base that will reduce the amount of
friction other programmers will face when attempting to read or work with the code.

The drawback of attempting to fix this bug is that other parts of the code rely on the
values generated by these “pointless” bitwise expressions. An incorrect fix could
potentially prevent other parts of the programmer from running correctly.

<br/>

Under closer examination the following information has been extracted for each file:

For **CacheDataSource.java**

**Located in:** mozilla-central/mobile/android/geckoview/src/thirdparty/java/com/google/android/exopla yer2/upstream/cache/

**Has pointless bitwise expressions:**

![c1pc](https://github.com/cherkaski/gecko-dev/blob/bug-1510706/doc/pictures/c1p1.png)

<br/>

For **DataSpec.java**

**Located in:** mozilla-central/mobile/android/geckoview/src/thirdparty/java/com/google/android/exoplayer2/upstream

**Has pointless bitwise expressions:**

![c2p1](https://github.com/cherkaski/gecko-dev/blob/bug-1510706/doc/pictures/c2p1.png)

<br/>

For **GeckoScreenOrientation.java**

**Located in:** mozilla-central/mobile/android/geckoview/src/main/java/org/mozilla/gecko

**Has pointless bitwise expressions:**

![c3p1](https://github.com/cherkaski/gecko-dev/blob/bug-1510706/doc/pictures/c3p1.png)

<br/>

For **GeckoSession.java**

**Located in:** mozilla-central/mobile/android/geckoview/src/main/java/org/mozilla/geckoview

**Has pointless bitwise expressions:** 

![c4p1](https://github.com/cherkaski/gecko-dev/blob/bug-1510706/doc/pictures/c4p1.png)

![c4p2](https://github.com/cherkaski/gecko-dev/blob/bug-1510706/doc/pictures/c4p2.png)

![c4p3](https://github.com/cherkaski/gecko-dev/blob/bug-1510706/doc/pictures/c4p3.png)

![c4p4](https://github.com/cherkaski/gecko-dev/blob/bug-1510706/doc/pictures/c4p4.png)

<br/>

For **GeckoThread.java**

**Located in:** mozilla-central/mobile/android/geckoview/src/main/java/org/mozilla/gecko

**Has pointless bitwise expressions:**

![c5p1](https://github.com/cherkaski/gecko-dev/blob/bug-1510706/doc/pictures/c5p1.png)

<br/>

For **Tx3gDecoder.java:**

**Located in:** mozilla-central/mobile/android/geckoview/src/thirdparty/java/com/google/android/exoplayer2/text/tx3g

**Has pointless bitwise expressions:**

![c6p1](https://github.com/cherkaski/gecko-dev/blob/bug-1510706/doc/pictures/c6p1.png)

<br/>

## Proposed Fix

Because all expressions of the form ```n << 0``` evaluate to ```n```, and all expressions of the
form ```0 << n``` evaluate to ```0```, the simplest fix to this issue would be to replace all
expressions of the form ```n << 0``` with the constant value of n and all expressions of the
form ```0 << n``` with the constant value of ```0```.

## Test Plan

To demonstrate that the problem has been fixed the code analysis tool inside of Android Studio (Analyze -> Inspect Code) must no longer mark the lines of code discussed above as pointless bitwise expressions.

`./mach build` must also run to ensure that all code still compiles successfully after the proposed changes have been implemented.

To ensure that the patch does not break existing functionality `./mach geckoview-junit` must run successfully as well.
