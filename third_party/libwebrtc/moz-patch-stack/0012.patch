From: Dan Minor <dminor@mozilla.com>
Date: Mon, 13 Aug 2018 08:34:00 -0400
Subject: Bug 1376873 - Allow single channel opus; r=padenot

Differential Revision: https://phabricator.services.mozilla.com/D7469
Mercurial Revision: https://hg.mozilla.org/mozilla-central/rev/92a7c3eee9f0c80ffbf79fdab8f8f2b8f6bd7701
---
 .../builtin_audio_encoder_factory_unittest.cc | 23 ++++++++-----------
 .../codecs/opus/audio_encoder_opus.cc         |  2 +-
 2 files changed, 10 insertions(+), 15 deletions(-)

diff --git a/modules/audio_coding/codecs/builtin_audio_encoder_factory_unittest.cc b/modules/audio_coding/codecs/builtin_audio_encoder_factory_unittest.cc
index d29db465a6..7c12a54a68 100644
--- a/modules/audio_coding/codecs/builtin_audio_encoder_factory_unittest.cc
+++ b/modules/audio_coding/codecs/builtin_audio_encoder_factory_unittest.cc
@@ -136,18 +136,17 @@ TEST(BuiltinAudioEncoderFactoryTest, SupportsTheExpectedFormats) {
 
   const std::vector<SdpAudioFormat> expected_formats = {
 #ifdef WEBRTC_CODEC_OPUS
-    {"opus", 48000, 2, {{"minptime", "10"}, {"useinbandfec", "1"}}},
+      {"opus", 48000, 2, {{"minptime", "10"}, {"useinbandfec", "1"}}},
 #endif
 #if defined(WEBRTC_CODEC_ISAC) || defined(WEBRTC_CODEC_ISACFX)
-    {"isac", 16000, 1},
+      {"isac", 16000, 1},
 #endif
 #ifdef WEBRTC_CODEC_ISAC
-    {"isac", 32000, 1},
+      {"isac", 32000, 1},
 #endif
-    {"G722", 8000, 1},
-    {"pcmu", 8000, 1},
-    {"pcma", 8000, 1}
-  };
+      {"G722", 8000, 1},
+      {"pcmu", 8000, 1},
+      {"pcma", 8000, 1}};
 
   ASSERT_THAT(supported_formats, ElementsAreArray(expected_formats));
 }
@@ -159,16 +158,12 @@ TEST(BuiltinAudioEncoderFactoryTest, MaxNrOfChannels) {
       CreateBuiltinAudioEncoderFactory();
   std::vector<std::string> codecs = {
 #ifdef WEBRTC_CODEC_OPUS
-    "opus",
+      "opus",
 #endif
 #if defined(WEBRTC_CODEC_ISAC) || defined(WEBRTC_CODEC_ISACFX)
-    "isac",
+      "isac",
 #endif
-    "pcmu",
-    "pcma",
-    "l16",
-    "G722",
-    "G711",
+      "pcmu", "pcma", "l16", "G722", "G711",
   };
 
   for (auto codec : codecs) {
diff --git a/modules/audio_coding/codecs/opus/audio_encoder_opus.cc b/modules/audio_coding/codecs/opus/audio_encoder_opus.cc
index 3fb926ab34..cc47beb51a 100644
--- a/modules/audio_coding/codecs/opus/audio_encoder_opus.cc
+++ b/modules/audio_coding/codecs/opus/audio_encoder_opus.cc
@@ -231,7 +231,7 @@ AudioCodecInfo AudioEncoderOpusImpl::QueryAudioEncoder(
 std::optional<AudioEncoderOpusConfig> AudioEncoderOpusImpl::SdpToConfig(
     const SdpAudioFormat& format) {
   if (!absl::EqualsIgnoreCase(format.name, "opus") ||
-      format.clockrate_hz != kRtpTimestampRateHz || format.num_channels != 2) {
+      format.clockrate_hz != kRtpTimestampRateHz) {
     return std::nullopt;
   }
 
