# A3

## Bug Title 

Display CodeMirror's gutter in console input when devtools.webconsole.input.editor is true

https://bugzilla.mozilla.org/show_bug.cgi?id=1519315

## Diagnosis:

In the developer tools (F12), the console input within the `Console` page, does not have a gutter on the sidebar of the input. This line number exists in the gutter of the console input for the `Debugger` and `Style Editor` pages. The end goal as described by the bug creator (Nicolas Chevobbe), is to display the line number on the gutter, similar to that of the `Debugger` / `Style Editor` pages.

![1551859343588](C:\Users\George\AppData\Roaming\Typora\typora-user-images\1551859343588.png)

I believe this bug has value in fixing, as it contributes directly to the productivity of other developers, who utilize Firefox and its developer tools, to create their web applications. As a web developer myself, I know first hand just how useful the console tools are, and by fixing this bug, I will enable developers to have more accessible look-up references for the code in their console logs.

## Testing Procedure (Manual Inspection Process)

This is how the page looks before my patch

![console input](C:\Users\George\Desktop\console input.png)

This is how the page looks after my patch (notice the line number)

![console new](C:\Users\George\Desktop\console new.png)

## Fix Solution

After speaking with my mentor and gaining some insight into the code, I discovered that I needed to modify 3 files to achieve the desired line number gutters within the console input:

1. `JSTerm.js`
2. `store.js`
3. `constants.js`

Within `constants.js` in the UI object, I added an `EDITOR` field with value `devtools.webconsole.input.editor`.

```javascript
// constants.js
    UI: {
      // Filter bar UI preference only have the suffix since it can be used either for
      // the webconsole or the browser console.
      FILTER_BAR: "ui.filterbar",
      // Persist is only used by the webconsole.
      PERSIST: "devtools.webconsole.persistlog",
      // Max number of entries in history list.
      INPUT_HISTORY_COUNT: "devtools.webconsole.inputHistoryCount",
      // Is editor mode enabled.
      EDITOR: "devtools.webconsole.input.editor", // <-------------------------------
    },
};
```

Within the `initialState` object in `store.js`, I added a field for `editor` that gets the boolean value stored in the `constants.js` file.

```javascript
// store.js
const initialState = {
    prefs: PrefState({
      logLimit,
      sidebarToggle,
      jstermCodeMirror,
      historyCount,
	}),
	ui: UiState({
        filterBarVisible: getBoolPref(PREFS.UI.FILTER_BAR),
        networkMessageActiveTabId: "headers",
        persistLogs: getBoolPref(PREFS.UI.PERSIST),
        editor: getBoolPref(PREFS.UI.EDITOR), // <-------------------------------
	}),
};
```

Within `JSTerm.js`, I :

1. First declared an `editorMode` field in the static `propTypes()`
2. Within the constructor of `JSTerm.js`, I declared the editor with the `lineNumbers` field initialized to `this.props.editorMode`. 
3. And lastly, connected the `editorMode` prop to the redux store (`store.js`) by using the Redux connect function, `mapStateToProps(state) in `JSterm.js`.

```javascript
// JSTerm.js

// Step 1
class JSTerm extends Component {
  static get propTypes() {
    return {
      //...
      editorMode: PropTypes.bool, // <----------------------------------------------
    };
  }
 
// Step 2
constructor(props) {
    super(props);
    this.editor = new Editor({
        autofocus: true,
        enableCodeFolding: false,
        autoCloseBrackets: false,
        lineNumbers: this.props.editorMode, // <------------------------------------
    //...

// Step 3
function mapStateToProps(state) {
  return {
    history: getHistory(state),
    getValueFromHistory: (direction) => getHistoryValue(state, direction),
    autocompleteData: getAutocompleteState(state),
    editorMode: state.ui.editor,  // <------------------------------------
  };
}
    
```

## Conclusion

With these changes, the console input will now correctly show the line numbers in the gutter when `devtools.webconsole.input.editor` is True. (as shown in the Manual Inspection section)